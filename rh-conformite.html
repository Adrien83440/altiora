<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover"/>
  <title>ALTEORE â€” ConformitÃ© & LÃ©gal RH</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"/>
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    :root{
      --rh-dark:#052e16;--rh-main:#059669;--rh-mid:#10b981;--rh-bright:#34d399;
      --rh-ghost:#f0fdf4;--rh-border:#d1fae5;
      --text:#1a1f36;--muted:#6b7280;--border:#e2e8f0;--bg:#f5f7ff;
      --sidebar-w:252px;--radius:12px;
      --red:#ef4444;--orange:#f59e0b;--blue:#3b82f6;--purple:#6366f1;
      --amber:#d97706;--teal:#0891b2;
    }
    body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg);color:var(--text);display:flex;min-height:100vh;font-size:13px;}

    /* SIDEBAR */
    .sidebar{width:var(--sidebar-w);min-height:100vh;background:linear-gradient(180deg,#052e16 0%,#064e23 50%,#065f2c 100%);display:flex;flex-direction:column;position:fixed;left:0;top:0;z-index:100;padding-bottom:24px;overflow-y:auto;}
    .sidebar-logo{display:flex;align-items:center;gap:10px;padding:26px 20px 22px;border-bottom:1px solid rgba(255,255,255,0.08);margin-bottom:10px;}
    .sidebar-logo-icon{width:36px;height:36px;background:rgba(255,255,255,0.15);border:1px solid rgba(255,255,255,0.2);border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:16px;}
    .sidebar-logo-text{font-size:18px;font-weight:800;color:white;letter-spacing:1px;}
    .nav-item{display:flex;align-items:center;gap:11px;padding:10px 20px;color:rgba(255,255,255,0.6);font-size:13px;font-weight:500;cursor:pointer;border-left:3px solid transparent;transition:all 0.18s;text-decoration:none;}
    .nav-item:hover{color:white;background:rgba(255,255,255,0.06);}
    .nav-item.active{color:white;background:rgba(255,255,255,0.1);border-left-color:#34d399;}
    .nav-icon{font-size:15px;width:18px;text-align:center;flex-shrink:0;}
    .sidebar-footer{margin-top:auto;padding:16px 20px 0;border-top:1px solid rgba(255,255,255,0.08);}
    .user-card{display:flex;align-items:center;gap:10px;padding:10px;background:rgba(255,255,255,0.07);border-radius:10px;}
    .user-avatar{width:32px;height:32px;background:linear-gradient(135deg,var(--rh-mid),#059669);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:white;flex-shrink:0;}
    .user-name{font-size:12px;font-weight:600;color:white;}
    .user-plan{font-size:10px;color:rgba(255,255,255,0.4);}
    .logout-btn{margin-left:auto;background:none;border:none;color:rgba(255,255,255,0.3);cursor:pointer;font-size:14px;padding:4px;}

    /* MAIN */
    .main{margin-left:var(--sidebar-w);flex:1;display:flex;flex-direction:column;}
    .topbar{background:white;border-bottom:1px solid var(--border);padding:14px 28px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50;}
    .topbar-left h1{font-size:17px;font-weight:700;}
    .topbar-left p{font-size:12px;color:var(--muted);}
    .topbar-right{display:flex;align-items:center;gap:10px;}
    .btn{padding:8px 16px;border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:all 0.18s;}
    .btn-rh{background:linear-gradient(135deg,var(--rh-main),var(--rh-mid));color:white;box-shadow:0 3px 10px rgba(5,150,105,.25);}
    .btn-rh:hover{opacity:.9;transform:translateY(-1px);}
    .btn-outline{background:white;color:var(--rh-main);border:1.5px solid var(--rh-border);}
    .btn-outline:hover{border-color:var(--rh-main);background:var(--rh-ghost);}
    .btn-sm{padding:5px 12px;font-size:12px;}
    .btn-xs{padding:3px 8px;font-size:11px;}
    .btn-danger{background:#fef2f2;color:var(--red);border:1px solid #fecaca;}
    .btn-amber{background:#fffbeb;color:var(--amber);border:1px solid #fde68a;}

    /* CONTENT LAYOUT */
    .content{padding:22px 28px;flex:1;display:flex;gap:20px;align-items:flex-start;}
    .left-nav{width:220px;flex-shrink:0;position:sticky;top:78px;}
    .right-content{flex:1;min-width:0;display:flex;flex-direction:column;gap:16px;}

    /* LEFT NAV */
    .conf-nav{background:white;border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;}
    .conf-nav-head{padding:12px 16px;background:var(--rh-ghost);border-bottom:1px solid var(--rh-border);font-size:11px;font-weight:700;color:var(--rh-dark);text-transform:uppercase;letter-spacing:.5px;}
    .conf-nav-item{display:flex;align-items:center;gap:8px;padding:9px 14px;cursor:pointer;border-left:3px solid transparent;transition:all .15s;font-size:12px;font-weight:500;color:var(--muted);}
    .conf-nav-item:hover{background:var(--rh-ghost);color:var(--rh-dark);}
    .conf-nav-item.active{background:var(--rh-ghost);color:var(--rh-dark);border-left-color:var(--rh-main);font-weight:700;}
    .conf-nav-icon{font-size:14px;width:16px;text-align:center;}
    .conf-nav-badge{margin-left:auto;font-size:9px;font-weight:700;padding:1px 5px;border-radius:8px;}
    .badge-ok{background:#dcfce7;color:#166534;}
    .badge-warn{background:#fef3c7;color:#92400e;}
    .badge-err{background:#fee2e2;color:#991b1b;}
    .badge-info{background:#dbeafe;color:#1e40af;}

    /* SCORE GLOBAL */
    .score-banner{background:linear-gradient(135deg,#052e16,#064e23,#065f2c);border-radius:var(--radius);padding:20px 24px;color:white;display:flex;align-items:center;gap:20px;}
    .score-circle{width:72px;height:72px;border-radius:50%;border:4px solid rgba(255,255,255,.2);display:flex;flex-direction:column;align-items:center;justify-content:center;flex-shrink:0;position:relative;}
    .score-num{font-size:24px;font-weight:800;line-height:1;}
    .score-denom{font-size:11px;color:rgba(255,255,255,.5);}
    .score-info{flex:1;}
    .score-title{font-size:16px;font-weight:700;margin-bottom:4px;}
    .score-sub{font-size:12px;color:rgba(255,255,255,.6);margin-bottom:12px;}
    .score-bar-wrap{height:6px;background:rgba(255,255,255,.15);border-radius:3px;overflow:hidden;}
    .score-bar-fill{height:100%;border-radius:3px;transition:width .8s ease;}
    .score-kpis{display:flex;gap:14px;margin-top:12px;}
    .score-kpi{text-align:center;}
    .score-kpi-val{font-size:18px;font-weight:800;}
    .score-kpi-lbl{font-size:9px;color:rgba(255,255,255,.5);text-transform:uppercase;font-weight:600;}

    /* SECTION CARD */
    .conf-section{background:white;border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;}
    .conf-section-head{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid var(--border);cursor:pointer;user-select:none;}
    .conf-section-head:hover{background:#fafbff;}
    .conf-section-title{font-size:13px;font-weight:700;display:flex;align-items:center;gap:8px;}
    .conf-section-meta{display:flex;align-items:center;gap:8px;}
    .conf-section-body{padding:16px 18px;display:flex;flex-direction:column;gap:10px;}
    .conf-section-body.collapsed{display:none;}
    .chevron{font-size:11px;color:var(--muted);transition:transform .2s;}
    .chevron.open{transform:rotate(90deg);}

    /* OBLIGATION ITEM */
    .oblig-item{border:1.5px solid var(--border);border-radius:10px;padding:12px 14px;transition:all .15s;display:flex;gap:12px;align-items:flex-start;}
    .oblig-item:hover{border-color:#c7d2fe;background:#fafbff;}
    .oblig-item.ok{border-color:#6ee7b7;background:#f0fdf4;}
    .oblig-item.warn{border-color:#fcd34d;background:#fffbeb;}
    .oblig-item.err{border-color:#fca5a5;background:#fef2f2;}
    .oblig-item.na{border-color:#e2e8f0;background:#f8faff;opacity:.7;}
    .oblig-check{width:20px;height:20px;border-radius:6px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:11px;margin-top:1px;}
    .check-ok{background:#dcfce7;color:#166534;}
    .check-warn{background:#fef3c7;color:#92400e;}
    .check-err{background:#fee2e2;color:#991b1b;}
    .check-na{background:#f1f5f9;color:#94a3b8;}
    .check-todo{background:#dbeafe;color:#1e40af;}
    .oblig-content{flex:1;min-width:0;}
    .oblig-title{font-size:12px;font-weight:700;color:var(--text);margin-bottom:2px;}
    .oblig-desc{font-size:11px;color:var(--muted);line-height:1.5;}
    .oblig-ref{font-size:10px;color:#94a3b8;margin-top:4px;font-style:italic;}
    .oblig-actions{display:flex;gap:6px;margin-top:8px;flex-wrap:wrap;}
    .oblig-tag{font-size:10px;font-weight:700;padding:2px 7px;border-radius:12px;}
    .tag-ccn{background:#f3e8ff;color:#7e22ce;}
    .tag-legal{background:#dbeafe;color:#1e40af;}
    .tag-rgpd{background:#fce7f3;color:#9d174d;}
    .tag-social{background:#dcfce7;color:#166534;}
    .tag-hygiene{background:#fff7ed;color:#c2410c;}
    .tag-secu{background:#fef2f2;color:#991b1b;}
    .tag-eff{background:#f0fdf4;color:#166534;}

    /* STATUS SELECTOR */
    .status-sel{display:flex;gap:4px;margin-top:6px;}
    .status-btn{font-size:10px;font-weight:700;padding:3px 8px;border-radius:8px;border:none;cursor:pointer;transition:all .12s;opacity:.5;}
    .status-btn:hover{opacity:.8;}
    .status-btn.active{opacity:1;}
    .sb-ok{background:#dcfce7;color:#166534;}
    .sb-warn{background:#fef3c7;color:#92400e;}
    .sb-err{background:#fee2e2;color:#991b1b;}
    .sb-na{background:#f1f5f9;color:#94a3b8;}

    /* NOTES */
    .oblig-note-input{width:100%;margin-top:6px;padding:6px 8px;border:1.5px solid var(--border);border-radius:6px;font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;color:var(--text);outline:none;resize:none;min-height:48px;}
    .oblig-note-input:focus{border-color:var(--rh-main);}

    /* DOCUMENTS LÃ‰GAUX */
    .doc-legal-item{display:flex;align-items:center;gap:10px;padding:10px 12px;border:1px solid var(--border);border-radius:8px;background:#f8faff;margin-bottom:8px;}
    .doc-legal-item:last-child{margin-bottom:0;}
    .doc-legal-ico{font-size:20px;flex-shrink:0;}
    .doc-legal-info{flex:1;}
    .doc-legal-name{font-size:12px;font-weight:700;}
    .doc-legal-desc{font-size:11px;color:var(--muted);}
    .doc-legal-status{font-size:11px;font-weight:700;padding:3px 8px;border-radius:8px;}

    /* SALARIÃ‰ CARDS */
    .emp-conf-item{display:flex;align-items:center;gap:10px;padding:8px 10px;border-radius:8px;border:1px solid var(--border);background:#fafbff;margin-bottom:6px;}
    .emp-avatar{width:28px;height:28px;border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:white;flex-shrink:0;}
    .emp-conf-name{font-size:12px;font-weight:600;}
    .emp-conf-poste{font-size:10px;color:var(--muted);}
    .emp-conf-badges{display:flex;gap:4px;margin-left:auto;flex-wrap:wrap;justify-content:flex-end;}

    /* CALENDRIER OBLIGATIONS */
    .cal-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;}
    .cal-month{background:#f8faff;border:1px solid var(--border);border-radius:8px;padding:10px;text-align:center;}
    .cal-month-label{font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;margin-bottom:6px;}
    .cal-items{display:flex;flex-direction:column;gap:3px;}
    .cal-item{font-size:9px;padding:2px 5px;border-radius:4px;font-weight:600;text-align:left;}

    /* CCN BADGE */
    .ccn-banner{background:linear-gradient(135deg,#1e3a5f,#1e40af);border-radius:10px;padding:12px 16px;color:white;display:flex;align-items:center;gap:12px;margin-bottom:16px;}
    .ccn-banner-icon{font-size:24px;}
    .ccn-banner-info{flex:1;}
    .ccn-banner-title{font-size:13px;font-weight:700;}
    .ccn-banner-sub{font-size:11px;color:rgba(255,255,255,.6);}
    .ccn-banner-idcc{font-size:10px;font-weight:700;padding:2px 8px;border-radius:12px;background:rgba(255,255,255,.15);color:white;}

    /* PRINT */
    @media print{
      .sidebar,.topbar,.left-nav,.score-banner,.conf-nav{display:none!important;}
      .main{margin:0!important;}
      .content{padding:0!important;flex-direction:column!important;}
      .right-content{width:100%!important;}
      .conf-section-body.collapsed{display:flex!important;}
    }

    /* TOAST */
    .toast{position:fixed;bottom:24px;right:24px;background:#1a1f36;color:white;padding:12px 20px;border-radius:10px;font-size:13px;font-weight:600;z-index:9999;transform:translateY(80px);opacity:0;transition:all .3s;}
    .toast.show{transform:translateY(0);opacity:1;}
    .toast.ok{background:var(--rh-main);}
    .toast.err{background:var(--red);}

    /* LOADER */
    .loader{display:flex;align-items:center;justify-content:center;padding:60px;color:var(--muted);gap:10px;}
    @keyframes spin{to{transform:rotate(360deg)}}
    .spin{width:18px;height:18px;border:2px solid var(--border);border-top-color:var(--rh-main);border-radius:50%;animation:spin .7s linear infinite;}

    /* HAMBURGER */
    .hamburger{display:none;position:fixed;top:14px;left:14px;z-index:1001;width:44px;height:44px;background:#052e16;border:none;border-radius:12px;cursor:pointer;flex-direction:column;align-items:center;justify-content:center;gap:5px;box-shadow:0 4px 16px rgba(5,46,22,.45);}
    .hamburger span{display:block;width:20px;height:2.5px;background:#fff;border-radius:2px;transition:all .25s ease;}
    .nav-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:1000;}
    .nav-overlay.show{display:block;}

    /* MODAL */
    .modal-overlay{position:fixed;inset:0;background:rgba(15,31,92,.45);backdrop-filter:blur(4px);z-index:200;display:none;align-items:center;justify-content:center;}
    .modal-overlay.show{display:flex;}
    .modal{background:white;border-radius:16px;width:100%;max-width:560px;box-shadow:0 24px 60px rgba(15,31,92,.2);overflow:hidden;}
    .modal-head{padding:18px 22px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
    .modal-head h3{font-size:14px;font-weight:700;}
    .modal-close{background:none;border:none;font-size:18px;cursor:pointer;color:var(--muted);}
    .modal-body{padding:20px 22px;max-height:65vh;overflow-y:auto;}
    .modal-foot{padding:14px 22px;border-top:1px solid var(--border);display:flex;gap:10px;justify-content:flex-end;}
    .modal-label{font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;margin-bottom:5px;display:block;}
    .modal-input{width:100%;padding:9px 12px;border:1.5px solid var(--border);border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;outline:none;}
    .modal-input:focus{border-color:var(--rh-main);}
    .modal-textarea{width:100%;padding:9px 12px;border:1.5px solid var(--border);border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;outline:none;resize:vertical;min-height:80px;}
    .modal-textarea:focus{border-color:var(--rh-main);}

    /* â”€â”€ DOCUMENTS & PDF â”€â”€ */
    .doc-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;}
    .doc-card{background:white;border:1.5px solid var(--border);border-radius:10px;padding:14px;cursor:pointer;transition:all .15s;display:flex;flex-direction:column;gap:6px;}
    .doc-card:hover{border-color:var(--rh-main);box-shadow:0 4px 16px rgba(5,150,105,.1);transform:translateY(-1px);}
    .doc-card-icon{font-size:26px;}
    .doc-card-title{font-size:12px;font-weight:700;color:var(--text);line-height:1.3;}
    .doc-card-desc{font-size:11px;color:var(--muted);line-height:1.4;flex:1;}
    .doc-card-footer{display:flex;align-items:center;justify-content:space-between;margin-top:4px;}
    .doc-card-type{font-size:9px;font-weight:700;padding:2px 7px;border-radius:8px;}
    .dtype-affichage{background:#dbeafe;color:#1e40af;}
    .dtype-personnel{background:#dcfce7;color:#166534;}
    .dtype-secu{background:#fef3c7;color:#92400e;}
    .dtype-rgpd{background:#fce7f3;color:#9d174d;}
    .dtype-contrat{background:#f3e8ff;color:#6b21a8;}
    .dtype-registre{background:#f1f5f9;color:#475569;}
    .doc-filter-bar{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:14px;}
    .doc-filter-btn{font-size:11px;font-weight:600;padding:5px 12px;border-radius:20px;border:1.5px solid var(--border);background:white;color:var(--muted);cursor:pointer;transition:all .15s;}
    .doc-filter-btn:hover,.doc-filter-btn.active{border-color:var(--rh-main);background:var(--rh-ghost);color:var(--rh-main);}

    /* EMP ITEM CLIQUABLE */
    .emp-conf-item{cursor:pointer;transition:all .15s;}
    .emp-conf-item:hover{background:#f0fdf4 !important;border-color:var(--rh-main) !important;}
    .emp-conf-item.selected{background:#dcfce7 !important;border-color:var(--rh-main) !important;}

    /* MODAL PDF GENERATION */
    .pdf-overlay{position:fixed;inset:0;background:rgba(5,46,22,.6);backdrop-filter:blur(6px);z-index:400;display:none;align-items:flex-end;}
    .pdf-overlay.show{display:flex;}
    .pdf-drawer{background:white;width:100%;max-height:96vh;border-radius:18px 18px 0 0;display:flex;flex-direction:column;box-shadow:0 -12px 60px rgba(0,0,0,.2);animation:slideUp .3s ease;}
    @keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
    .pdf-drawer-head{padding:16px 24px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px;flex-shrink:0;}
    .pdf-drawer-head h3{font-size:15px;font-weight:700;flex:1;}
    .pdf-drawer-body{display:flex;flex:1;min-height:0;overflow:hidden;}
    .pdf-left{width:300px;flex-shrink:0;border-right:1px solid var(--border);overflow-y:auto;padding:16px;}
    .pdf-right{flex:1;overflow-y:auto;padding:16px;background:#f5f7ff;}
    .pdf-field-grp{margin-bottom:14px;}
    .pdf-lbl{font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;display:block;margin-bottom:5px;}
    .pdf-sel{width:100%;padding:8px 10px;border:1.5px solid var(--border);border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;outline:none;background:white;}
    .pdf-sel:focus{border-color:var(--rh-main);}
    .pdf-inp{width:100%;padding:7px 10px;border:1.5px solid var(--border);border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;outline:none;margin-bottom:6px;}
    .pdf-inp:focus{border-color:var(--rh-main);}
    .pdf-drawer-foot{padding:12px 24px;border-top:1px solid var(--border);display:flex;gap:10px;justify-content:flex-end;flex-shrink:0;}

    /* APERÃ‡U DOCUMENT */
    .doc-preview{background:white;border:1px solid var(--border);border-radius:8px;padding:24px 28px;font-size:11.5px;line-height:1.75;color:#1a1f36;box-shadow:0 2px 8px rgba(0,0,0,.06);}
    .doc-preview h2{font-size:15px;font-weight:800;text-align:center;margin-bottom:4px;color:#052e16;text-transform:uppercase;letter-spacing:.5px;}
    .doc-preview .dp-sub{font-size:10px;text-align:center;color:var(--muted);margin-bottom:18px;font-style:italic;}
    .doc-preview .dp-header{display:flex;justify-content:space-between;font-size:11px;margin-bottom:18px;padding-bottom:12px;border-bottom:2px solid #e2e8f0;}
    .doc-preview .dp-header b{font-size:12px;display:block;margin-bottom:3px;}
    .doc-preview .dp-field{display:inline-block;background:#f0fdf4;border:1px solid #d1fae5;border-radius:4px;padding:1px 6px;font-weight:700;color:#065f2c;}
    .doc-preview p{margin-bottom:8px;}
    .doc-preview ul{margin:6px 0 10px 18px;}
    .doc-preview li{margin-bottom:3px;}
    .doc-preview .dp-sign{margin-top:24px;display:grid;grid-template-columns:1fr 1fr;gap:20px;}
    .doc-preview .dp-sign-box{border:1px solid #e2e8f0;border-radius:6px;padding:10px;min-height:60px;}
    .doc-preview .dp-sign-lbl{font-size:9px;font-weight:700;color:var(--muted);text-transform:uppercase;margin-bottom:3px;}
    .doc-preview table{width:100%;border-collapse:collapse;margin:8px 0;font-size:11px;}
    .doc-preview th{background:#f0fdf4;padding:6px 9px;text-align:left;font-size:10px;font-weight:700;color:#166534;border:1px solid #d1fae5;}
    .doc-preview td{padding:5px 9px;border:1px solid #e2e8f0;}
    .doc-preview tr:nth-child(even) td{background:#fafbff;}
    .doc-preview .dp-footer{font-size:9.5px;color:var(--muted);border-top:1px solid #e2e8f0;margin-top:18px;padding-top:8px;font-style:italic;text-align:center;}
    .doc-preview .dp-warn-box{background:#fffbeb;border:1px solid #fcd34d;border-radius:6px;padding:8px 12px;font-size:11px;color:#92400e;margin:10px 0;}
    .doc-preview .dp-section{margin-top:14px;padding-top:10px;border-top:1px solid #f1f5f9;}
    .doc-preview .dp-section-title{font-size:11px;font-weight:800;color:#052e16;text-transform:uppercase;letter-spacing:.4px;margin-bottom:6px;}

    /* PRINT */
    @media print{
      body > *{display:none !important;}
      #print-zone{display:block !important;position:fixed;inset:0;padding:15mm 18mm;background:white;font-family:'Plus Jakarta Sans',sans-serif;font-size:11pt;color:#000;}
    }
    #print-zone{display:none;}

    @media(max-width:768px){
      .hamburger{display:flex!important;}
      .sidebar{position:fixed!important;top:0!important;left:0!important;height:100vh!important;width:min(280px,84vw)!important;z-index:1001!important;transform:translateX(-105%)!important;transition:transform .3s cubic-bezier(.4,0,.2,1)!important;}
      .sidebar.open{transform:translateX(0)!important;box-shadow:8px 0 32px rgba(0,0,0,.3)!important;}
      .main{margin-left:0!important;}
      .topbar{padding:10px 10px 10px 62px!important;}
      .content{padding:12px 10px!important;flex-direction:column!important;}
      .left-nav{width:100%!important;position:static!important;}
      .cal-grid{grid-template-columns:repeat(2,1fr)!important;}
      .doc-grid{grid-template-columns:1fr 1fr!important;}
      .pdf-drawer{max-height:97vh;}
      .pdf-drawer-body{flex-direction:column;}
      .pdf-left{width:100%!important;border-right:none;border-bottom:1px solid var(--border);max-height:200px;}
    }
  </style>
</head>
<body>

<button class="hamburger" id="hamburger-btn" onclick="toggleSidebar()">
  <span></span><span></span><span></span>
</button>
<div class="nav-overlay" id="nav-overlay" onclick="closeSidebar()"></div>

<!-- SIDEBAR injectÃ©e par nav.js -->
<div class="main">
  <div class="topbar">
    <div class="topbar-left">
      <h1>âš–ï¸ ConformitÃ© & LÃ©gal</h1>
      <p id="topbar-ccn-sub">Audit de conformitÃ© RH Â· Documents lÃ©gaux Â· RGPD Â· SÃ©curitÃ© au travail</p>
    </div>
    <div class="topbar-right">
      <button class="btn btn-outline btn-sm" onclick="window.print()">ğŸ–¨ï¸ Rapport</button>
      <button class="btn btn-rh btn-sm" onclick="saveAll()">ğŸ’¾ Sauvegarder</button>
      <a href="rh-dashboard.html" class="btn btn-outline btn-sm">â† RH</a>
    </div>
  </div>

  <div class="content" id="main-content">
    <div class="loader"><div class="spin"></div><span>Chargementâ€¦</span></div>
  </div>
</div>

<!-- MODAL AJOUT NOTE -->
<div class="modal-overlay" id="modal-note">
  <div class="modal">
    <div class="modal-head">
      <h3 id="modal-note-title">ğŸ“ Commentaire</h3>
      <button class="modal-close" onclick="closeModalNote()">âœ•</button>
    </div>
    <div class="modal-body">
      <label class="modal-label">Statut</label>
      <select class="modal-input" id="mn-status" style="margin-bottom:12px">
        <option value="ok">âœ… Conforme</option>
        <option value="warn">âš ï¸ Ã€ amÃ©liorer</option>
        <option value="err">âŒ Non conforme</option>
        <option value="na">â€” Non applicable</option>
      </select>
      <label class="modal-label">Note / commentaire</label>
      <textarea class="modal-textarea" id="mn-note" placeholder="DÃ©crivez l'action entreprise, la date de mise en conformitÃ© prÃ©vueâ€¦"></textarea>
      <label class="modal-label" style="margin-top:12px">Date d'Ã©chÃ©ance</label>
      <input type="date" class="modal-input" id="mn-echeance"/>
    </div>
    <div class="modal-foot">
      <button class="btn btn-outline btn-sm" onclick="closeModalNote()">Annuler</button>
      <button class="btn btn-rh btn-sm" onclick="saveNote()">Enregistrer</button>
    </div>
  </div>
</div>

<!-- MODAL PDF GÃ‰NÃ‰RATION -->
<div class="pdf-overlay" id="pdf-overlay">
  <div class="pdf-drawer">
    <div class="pdf-drawer-head">
      <div style="font-size:22px" id="pdf-doc-icon">ğŸ“„</div>
      <h3 id="pdf-doc-title">Document</h3>
      <button onclick="closePdfDrawer()" style="background:none;border:none;font-size:20px;cursor:pointer;color:var(--muted);padding:4px">âœ•</button>
    </div>
    <div class="pdf-drawer-body">
      <!-- PARAMÃˆTRES -->
      <div class="pdf-left">
        <div style="font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:12px">ParamÃ¨tres</div>

        <div class="pdf-field-grp">
          <label class="pdf-lbl">ğŸ¢ Entreprise</label>
          <input class="pdf-inp" id="pdf-raison" placeholder="Raison sociale" />
          <input class="pdf-inp" id="pdf-adresse" placeholder="Adresse" />
          <input class="pdf-inp" id="pdf-siret" placeholder="SIRET" />
          <input class="pdf-inp" id="pdf-ccn-label" placeholder="Convention collective" />
        </div>

        <div class="pdf-field-grp" id="pdf-salarie-grp">
          <label class="pdf-lbl">ğŸ‘¤ SalariÃ© concernÃ©</label>
          <select class="pdf-sel" id="pdf-salarie-sel" onchange="onPdfSalarieSel(this.value)">
            <option value="">â€” Entreprise uniquement â€”</option>
          </select>
          <div id="pdf-salarie-fields" style="margin-top:8px;display:none">
            <input class="pdf-inp" id="pdf-emp-nom" placeholder="Nom complet" />
            <input class="pdf-inp" id="pdf-emp-poste" placeholder="Poste" />
            <input class="pdf-inp" id="pdf-emp-date-embauche" placeholder="Date d'embauche" />
          </div>
        </div>

        <div class="pdf-field-grp" id="pdf-extra-grp">
          <!-- Champs dynamiques selon le document -->
        </div>

        <div style="margin-top:4px;padding:10px;background:var(--rh-ghost);border-radius:8px;font-size:11px;color:var(--rh-dark)">
          ğŸ’¡ Les champs se prÃ©-remplissent avec les donnÃ©es de votre compte. Modifiez si besoin.
        </div>
      </div>
      <!-- APERÃ‡U -->
      <div class="pdf-right">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
          <div style="font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.5px">AperÃ§u du document</div>
          <div style="display:flex;gap:8px">
            <button class="btn btn-outline btn-sm" onclick="refreshPreview()">ğŸ”„ Actualiser</button>
          </div>
        </div>
        <div id="pdf-preview-zone"></div>
      </div>
    </div>
    <div class="pdf-drawer-foot">
      <button class="btn btn-outline" onclick="closePdfDrawer()">Fermer</button>
      <button class="btn btn-success" onclick="printDocument()">ğŸ–¨ï¸ Imprimer / PDF</button>
    </div>
  </div>
</div>

<!-- ZONE PRINT (masquÃ©e, visible uniquement Ã  l'impression) -->
<div id="print-zone"></div>

<div class="toast" id="toast"></div>

<!-- FIREBASE -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getFirestore, initializeFirestore, doc, getDoc, setDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
  const app = initializeApp({
    apiKey:"AIzaSyB003WqdRKrT0gbv7P4BNIICuXeqbu8dR4",
    authDomain:"altiora-70599.firebaseapp.com",
    projectId:"altiora-70599",
    storageBucket:"altiora-70599.firebasestorage.app",
    messagingSenderId:"120905555746",
    appId:"1:120905555746:web:618460c65cdc9e57cc8f7b"
  });
  const auth = getAuth(app);
  const db = initializeFirestore(app, { experimentalAutoDetectLongPolling: true });
  window._auth=auth; window._db=db;
  window._doc=doc; window._getDoc=getDoc; window._setDoc=setDoc;
  window._collection=collection; window._getDocs=getDocs;
  window._signOut=signOut;
  onAuthStateChanged(auth, user => {
    if (!user) { window.location.href='index.html'; return; }
    window._uid = user.uid;
    const name = user.displayName || user.email.split('@')[0];
    ['uname','uname2'].forEach(id=>{const el=document.getElementById(id);if(el)el.textContent=name;});
    ['av','av2'].forEach(id=>{const el=document.getElementById(id);if(el)el.textContent=name.charAt(0).toUpperCase();});
    window._firebaseReady = true;
    window.initConformite();
  });
</script>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CCN â€” mÃªme rÃ©fÃ©rentiel que rh-params / rh-employes
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CCN_RULES = {
  'droit_commun':        {label:'Code du travail (droit commun)',        idcc:null,  secteur:'tous'},
  'chr':                 {label:'HÃ´tels-CafÃ©s-Restaurants (CHR)',         idcc:1979,  secteur:'chr'},
  'restauration_rapide': {label:'Restauration rapide',                    idcc:1501,  secteur:'chr'},
  'commerce':            {label:'Commerce de dÃ©tail non alimentaire',     idcc:1517,  secteur:'commerce'},
  'commerce_alimentaire':{label:'Commerce alimentaire',                   idcc:2216,  secteur:'commerce'},
  'grande_distribution': {label:'Grande distribution',                    idcc:2216,  secteur:'commerce'},
  'boulangerie':         {label:'Boulangerie-PÃ¢tisserie artisanale',      idcc:843,   secteur:'alim'},
  'patisserie':          {label:'PÃ¢tisserie artisanale',                  idcc:1267,  secteur:'alim'},
  'boucherie':           {label:'Boucherie-Charcuterie artisanale',       idcc:953,   secteur:'alim'},
  'btp':                 {label:'BÃ¢timent (BTP ouvriers)',                idcc:1597,  secteur:'btp'},
  'btp_etam':            {label:'BTP â€” ETAM',                             idcc:2609,  secteur:'btp'},
  'coiffure':            {label:'Coiffure',                               idcc:2596,  secteur:'beaute'},
  'esthetique':          {label:'EsthÃ©tique-CosmÃ©tique-Parfumerie',       idcc:3032,  secteur:'beaute'},
  'sante':               {label:'SantÃ© (FEHAP / EHPAD)',                  idcc:29,    secteur:'sante'},
  'cabinet_medical':     {label:'Cabinet mÃ©dical / Para-mÃ©dical',         idcc:1748,  secteur:'sante'},
  'pharmacie':           {label:"Pharmacie d'officine",                   idcc:1996,  secteur:'sante'},
  'nettoyage':           {label:'Nettoyage et services associÃ©s',         idcc:3043,  secteur:'services'},
  'transport_routier':   {label:'Transport routier (conducteurs)',        idcc:16,    secteur:'transport'},
  'transport_voyageurs': {label:'Transport en commun',                    idcc:1424,  secteur:'transport'},
  'automobile':          {label:"Services de l'automobile",               idcc:1090,  secteur:'auto'},
  'immobilier':          {label:'Immobilier / Agences',                   idcc:1527,  secteur:'immo'},
  'securite':            {label:'PrÃ©vention-SÃ©curitÃ© privÃ©e',             idcc:1351,  secteur:'securite_priv'},
  'agriculture':         {label:'Agriculture / Exploitations agricoles',  idcc:7024,  secteur:'agri'},
  'viticulture':         {label:'Viticulture',                            idcc:9111,  secteur:'agri'},
  'sap':                 {label:'Services Ã  la personne (SAP)',           idcc:3127,  secteur:'sap'},
  'aide_domicile':       {label:'Aide Ã  domicile (associations)',         idcc:2941,  secteur:'sap'},
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ã‰TAT GLOBAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var _params = {};
var _employes = {};
var _conformiteData = {}; // DonnÃ©es sauvegardÃ©es { itemId: { statut, note, echeance } }
var _selectedEmpId  = null;
var _rhParams       = {};
var _currentSection = 'affichage';
var _modalItemId = null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.initConformite = async function() {
  try {
    // Charger params
    const dp = await window._getDoc(window._doc(window._db, 'rh_params', window._uid));
    if (dp.exists()) { _params = dp.data(); _rhParams = dp.data(); }

    // Charger employÃ©s
    const se = await window._getDocs(window._collection(window._db, 'rh', window._uid, 'employes'));
    se.forEach(d => _employes[d.id] = Object.assign({id:d.id}, d.data()));

    // Charger donnÃ©es conformitÃ© sauvegardÃ©es
    const dc = await window._getDoc(window._doc(window._db, 'rh', window._uid, 'conformite', 'audit'));
    if (dc.exists()) _conformiteData = dc.data();

    renderPage();
  } catch(e) {
    console.error(e);
    document.getElementById('main-content').innerHTML = '<div class="loader" style="color:var(--red)">âš ï¸ Erreur de chargement : ' + e.message + '</div>';
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DÃ‰FINITION DES OBLIGATIONS (corpus complet)
// Chaque obligation : { id, titre, desc, ref, tags[], secteurs[], effectifMin, statut_defaut }
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getObligations() {
  const ccn = _params.ccnDefault || 'droit_commun';
  const effectif = _params.effectif || '1-9';
  const eff10 = effectif !== '1-9';
  const eff50 = effectif === '50-249' || effectif === '250+';
  const eff11 = effectif !== '1-9'; // â‰¥ 11 (mÃªme rÃ¨gle que â‰¥10 pour simplification)
  const secteur = (CCN_RULES[ccn] || {}).secteur || 'tous';

  return [

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 1. AFFICHAGES OBLIGATOIRES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    { cat:'affichage', id:'aff_interdiction_fumer', titre:"Interdiction de fumer / vapoter",
      desc:"Affichage visible Ã  l'entrÃ©e et dans chaque local de l'interdiction de fumer et de vapoter.",
      ref:"Art. R3512-2 Code de la santÃ© publique", tags:['legal'], priorite:'haute', obligatoire:true },

    { cat:'affichage', id:'aff_harcelement', titre:"HarcÃ¨lement moral et sexuel",
      desc:"Textes des articles L1152-1 et L1153-1 du Code du travail + coordonnÃ©es du DÃ©fenseur des droits et de l'inspection du travail.",
      ref:"Art. L1152-1, L1153-1 CT + DÃ©cret 2019-15", tags:['legal','rgpd'], priorite:'haute', obligatoire:true },

    { cat:'affichage', id:'aff_inspection_travail', titre:"CoordonnÃ©es de l'inspection du travail",
      desc:"Adresse et numÃ©ro de tÃ©lÃ©phone de l'inspecteur du travail dont dÃ©pend l'Ã©tablissement.",
      ref:"Art. R4711-1 CT", tags:['legal'], priorite:'haute', obligatoire:true },

    { cat:'affichage', id:'aff_medecin_travail', titre:"CoordonnÃ©es du mÃ©decin du travail",
      desc:"Nom, adresse et tÃ©lÃ©phone du service de santÃ© au travail interentreprises (SSTI).",
      ref:"Art. R4711-1 CT", tags:['legal','social'], priorite:'haute', obligatoire:true },

    { cat:'affichage', id:'aff_urgences', titre:"NumÃ©ros d'urgence et consignes de sÃ©curitÃ©",
      desc:"SAMU 15, Police 17, Pompiers 18, Urgences 112 + consignes d'Ã©vacuation en cas d'incendie avec plan d'Ã©vacuation.",
      ref:"Art. R4227-28 CT", tags:['secu'], priorite:'haute', obligatoire:true },

    { cat:'affichage', id:'aff_egalite_remuneration', titre:"Ã‰galitÃ© de rÃ©munÃ©ration H/F",
      desc:"Affichage de l'Ã©galitÃ© de rÃ©munÃ©ration entre hommes et femmes (art. L3221-1 Ã  L3221-7 CT).",
      ref:"Art. L3221-9 CT", tags:['legal','social'], priorite:'haute', obligatoire:true },

    { cat:'affichage', id:'aff_horaires', titre:"Horaires collectifs de travail",
      desc:"Affichage des horaires de travail de chaque catÃ©gorie de personnel, datÃ© et signÃ©.",
      ref:"Art. D3171-1 CT", tags:['legal'], priorite:'haute', obligatoire:true },

    { cat:'affichage', id:'aff_conges_payes', titre:"Ordre des dÃ©parts en congÃ©s payÃ©s",
      desc:"Affichage de l'ordre de dÃ©part en congÃ©s au moins 1 mois avant le dÃ©part (si dÃ©parts organisÃ©s).",
      ref:"Art. D3141-6 CT", tags:['legal'], priorite:'moyenne', obligatoire:true },

    { cat:'affichage', id:'aff_convention_collective', titre:"Existence de la convention collective",
      desc:"IntitulÃ© de la convention collective applicable, disponible pour consultation sur demande.",
      ref:"Art. L2262-5 CT", tags:['legal','ccn'], priorite:'haute', obligatoire:true },

    { cat:'affichage', id:'aff_rqth', titre:"Obligation d'emploi des travailleurs handicapÃ©s",
      desc:"Information sur l'obligation d'emploi des travailleurs handicapÃ©s (OETH) pour les entreprises â‰¥ 20 salariÃ©s.",
      ref:"Art. L5212-1 CT", tags:['legal','social'], priorite:'haute', obligatoire: effectif !== '1-9' },

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 2. REGISTRES & DOCUMENTS OBLIGATOIRES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    { cat:'registres', id:'reg_personnel', titre:"Registre unique du personnel",
      desc:"Tenu Ã  jour dÃ¨s le 1er salariÃ©. Contient : nom, prÃ©nom, nationalitÃ©, date de naissance, sexe, emploi, qualification, date d'entrÃ©e et de sortie, pour chaque travailleur.",
      ref:"Art. L1221-13 et D1221-23 CT", tags:['legal','social'], priorite:'haute', obligatoire:true },

    { cat:'registres', id:'reg_accidents', titre:"Registre des accidents du travail bÃ©nins",
      desc:"Tenu en accord avec le mÃ©decin du travail pour les accidents n'entraÃ®nant pas d'arrÃªt de travail ni de soins mÃ©dicaux donnant lieu Ã  prise en charge.",
      ref:"Art. L441-4 Code SS + Art. R441-16 CSS", tags:['secu','social'], priorite:'haute', obligatoire:true },

    { cat:'registres', id:'reg_conges', titre:"Document individuel de contrÃ´le des congÃ©s et absences",
      desc:"Suivi des CP, RTT, absences, rÃ©cupÃ©rations par salariÃ©. Conservation 5 ans.",
      ref:"Art. D3171-11 CT", tags:['legal','social'], priorite:'haute', obligatoire:true },

    { cat:'registres', id:'reg_delegues', titre:"ProcÃ¨s-verbaux des Ã©lections CSE / DP",
      desc:"Conservation des PV d'Ã©lections (ou carence si aucun candidat) des reprÃ©sentants du personnel.",
      ref:"Art. L2314-29 CT", tags:['legal','social'], priorite:'haute', obligatoire: eff11 },

    { cat:'registres', id:'reg_document_unique', titre:"Document Unique d'Ã‰valuation des Risques (DUER)",
      desc:"Inventaire des risques professionnels identifiÃ©s dans l'Ã©tablissement. Mis Ã  jour annuellement et aprÃ¨s tout accident grave. Conservation 40 ans.",
      ref:"Art. R4121-1 CT", tags:['secu','legal'], priorite:'critique', obligatoire:true },

    { cat:'registres', id:'reg_mise_en_demeure', titre:"Registre des mises en demeure et procÃ¨s-verbaux",
      desc:"Conservation des mises en demeure de l'inspection du travail et des procÃ¨s-verbaux d'infraction.",
      ref:"Art. L8113-7 CT", tags:['legal'], priorite:'haute', obligatoire:true },

    { cat:'registres', id:'reg_formation', titre:"Plan de dÃ©veloppement des compÃ©tences",
      desc:"Document listant les actions de formation planifiÃ©es pour les salariÃ©s. PrÃ©sentÃ© au CSE pour consultation.",
      ref:"Art. L6312-1 CT", tags:['legal','social'], priorite:'haute', obligatoire: eff10 },

    { cat:'reglement', id:'regl_interieur', titre:"RÃ¨glement intÃ©rieur",
      desc:"Document obligatoire â‰¥50 salariÃ©s fixant les rÃ¨gles gÃ©nÃ©rales de discipline, d'hygiÃ¨ne et de sÃ©curitÃ©. DÃ©posÃ© Ã  l'inspection du travail et affichÃ©.",
      ref:"Art. L1321-1 CT", tags:['legal'], priorite:'haute', obligatoire: eff50 },

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 3. SANTÃ‰ ET SÃ‰CURITÃ‰ AU TRAVAIL
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    { cat:'secu', id:'secu_visite_medicale', titre:"Visites mÃ©dicales d'embauche et de suivi",
      desc:"Visite d'information et de prÃ©vention (VIP) dans les 3 mois suivant l'embauche. Suivi renforcÃ© pour les postes Ã  risque. Conservation des fiches d'aptitude.",
      ref:"Art. R4624-10 CT", tags:['secu','social'], priorite:'critique', obligatoire:true },

    { cat:'secu', id:'secu_premiers_secours', titre:"Sauveteurs Secouristes du Travail (SST)",
      desc:"Au moins 1 SST formÃ© par atelier ou chantier oÃ¹ des travaux dangereux sont effectuÃ©s. RecommandÃ© dans tous les Ã©tablissements.",
      ref:"Art. R4224-15 CT", tags:['secu'], priorite:'haute', obligatoire:true },

    { cat:'secu', id:'secu_epi', titre:"Equipements de Protection Individuelle (EPI)",
      desc:"Fourniture gratuite d'EPI adaptÃ©s aux risques. Formation Ã  leur utilisation. Remplacement et entretien assurÃ©s par l'employeur.",
      ref:"Art. R4321-1 CT", tags:['secu'], priorite:'haute', obligatoire:true },

    { cat:'secu', id:'secu_formation_securite', titre:"Formation Ã  la sÃ©curitÃ© dÃ¨s l'embauche",
      desc:"Formation pratique et appropriÃ©e Ã  la sÃ©curitÃ© du travailleur Ã  l'embauche, lors d'un changement de poste, aprÃ¨s accident du travail grave.",
      ref:"Art. L4141-2 CT", tags:['secu','legal'], priorite:'haute', obligatoire:true },

    { cat:'secu', id:'secu_incendie', titre:"Formation incendie et exercices d'Ã©vacuation",
      desc:"Formation d'Ã©vacuation annuelle avec exercice pratique. DÃ©signation d'un responsable Ã©vacuation. Plans d'Ã©vacuation affichÃ©s et extincteurs vÃ©rifiÃ©s.",
      ref:"Art. R4227-28 et R4227-39 CT", tags:['secu'], priorite:'haute', obligatoire:true },

    { cat:'secu', id:'secu_alcool_drogue', titre:"Politique alcool et drogues sur le lieu de travail",
      desc:"Interdiction de l'alcool et des substances illicites sur le lieu de travail. Mention dans le rÃ¨glement intÃ©rieur. ProcÃ©dure en cas de suspicion.",
      ref:"Art. R4228-20 CT", tags:['secu','legal'], priorite:'haute', obligatoire:true },

    { cat:'secu', id:'secu_penibilite', titre:"PrÃ©vention de la pÃ©nibilitÃ© (C2P)",
      desc:"DÃ©claration des facteurs de risques professionnels au-delÃ  des seuils : travail de nuit, bruit, vibrations, tempÃ©ratures extrÃªmes, port de charges. Alimentez le Compte Professionnel de PrÃ©vention.",
      ref:"Art. L4163-1 CT", tags:['secu','social'], priorite:'haute', obligatoire:true },

    { cat:'secu', id:'secu_teletra_risques', titre:"Ã‰valuation des risques psychosociaux (RPS)",
      desc:"IntÃ©gration des RPS (stress, burn-out, harcÃ¨lement) dans le DUER. Plan d'action de prÃ©vention. Indicateurs de suivi.",
      ref:"Accord national interprofessionnel 2008 + Art. L4121-1 CT", tags:['secu','social'], priorite:'haute', obligatoire:true },

    // SpÃ©cifique CHR / restauration
    { cat:'secu', id:'secu_hygiene_alim', titre:"HygiÃ¨ne alimentaire â€” Formation HACCP",
      desc:"Au moins 1 personne formÃ©e Ã  l'hygiÃ¨ne alimentaire (mÃ©thode HACCP) par Ã©tablissement manipulant des denrÃ©es. Obligation CHR / restauration / boulangerie / boucherie.",
      ref:"RÃ¨glement CE 852/2004 + ArrÃªtÃ© 05/10/2011", tags:['secu','hygiene'], priorite:'critique',
      obligatoire: ['chr','restauration_rapide','boulangerie','patisserie','boucherie','commerce_alimentaire','grande_distribution'].includes(ccn) },

    { cat:'secu', id:'secu_haccp_plan', titre:"Plan de maÃ®trise sanitaire (PMS)",
      desc:"Document dÃ©crivant les mesures d'hygiÃ¨ne, le plan HACCP, les procÃ©dures de traÃ§abilitÃ© et de gestion des non-conformitÃ©s. Obligatoire CHR / IAA.",
      ref:"Art. 5 RÃ¨glement CE 852/2004", tags:['secu','hygiene'], priorite:'critique',
      obligatoire: ['chr','restauration_rapide','boulangerie','patisserie','boucherie','commerce_alimentaire'].includes(ccn) },

    // BTP spÃ©cifique
    { cat:'secu', id:'secu_btp_ppsps', titre:"Plan Particulier de SÃ©curitÃ© et de Protection de la SantÃ© (PPSPS)",
      desc:"Document de prÃ©vention Ã©tabli pour chaque chantier. Coordination SPS obligatoire pour les chantiers importants.",
      ref:"Art. R4532-60 CT", tags:['secu','btp'], priorite:'critique',
      obligatoire: ['btp','btp_etam'].includes(ccn) },

    { cat:'secu', id:'secu_btp_carteproBTP', titre:"Carte professionnelle BTP",
      desc:"Carte BTP obligatoire pour tout salariÃ© et intÃ©rimaire sur chantier depuis 2017. DÃ©livrÃ©e par la CNETP. Ã€ vÃ©rifier pour chaque nouveau salariÃ©.",
      ref:"Art. L8291-1 CT", tags:['secu','btp'], priorite:'haute',
      obligatoire: ['btp','btp_etam'].includes(ccn) },

    // Transport
    { cat:'secu', id:'secu_transport_aptitude', titre:"Visite mÃ©dicale aptitude conducteur",
      desc:"Visite mÃ©dicale spÃ©cifique pour les conducteurs de vÃ©hicules de transport. Renouvellement tous les 5 ans (3 ans aprÃ¨s 60 ans).",
      ref:"Art. R221-10 Code de la route", tags:['secu'], priorite:'critique',
      obligatoire: ['transport_routier','transport_voyageurs'].includes(ccn) },

    // SÃ©curitÃ© privÃ©e
    { cat:'secu', id:'secu_securite_agrement', titre:"AgrÃ©ment CNAPS et carte professionnelle agents",
      desc:"Chaque agent de sÃ©curitÃ© doit possÃ©der une carte professionnelle valide dÃ©livrÃ©e par le CNAPS. AgrÃ©ment de l'entreprise requis.",
      ref:"Art. L612-20 Code de la sÃ©curitÃ© intÃ©rieure", tags:['secu','legal'], priorite:'critique',
      obligatoire: ccn === 'securite' },

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 4. RGPD & DONNÃ‰ES PERSONNELLES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    { cat:'rgpd', id:'rgpd_registre_traitement', titre:"Registre des activitÃ©s de traitement",
      desc:"Inventaire de tous les traitements de donnÃ©es personnelles (salariÃ©s, clients, fournisseurs). Tenu Ã  jour, accessible Ã  la CNIL sur demande.",
      ref:"Art. 30 RGPD", tags:['rgpd'], priorite:'critique', obligatoire:true },

    { cat:'rgpd', id:'rgpd_politique_confidentialite', titre:"Politique de confidentialitÃ© (site web)",
      desc:"Document dÃ©crivant les donnÃ©es collectÃ©es, leur usage, durÃ©e de conservation, droits des utilisateurs. AffichÃ©e sur le site web.",
      ref:"Art. 13 et 14 RGPD", tags:['rgpd'], priorite:'haute', obligatoire:true },

    { cat:'rgpd', id:'rgpd_mentions_legales', titre:"Mentions lÃ©gales (site web)",
      desc:"Nom, raison sociale, SIRET, adresse, directeur de publication, hÃ©bergeur. Obligatoires sur tout site internet.",
      ref:"Art. 6 Loi LCEN 2004-575", tags:['rgpd','legal'], priorite:'haute', obligatoire:true },

    { cat:'rgpd', id:'rgpd_information_salaries', titre:"Information des salariÃ©s sur le traitement de leurs donnÃ©es",
      desc:"Remise d'une notice d'information RGPD Ã  l'embauche : donnÃ©es collectÃ©es, finalitÃ©, durÃ©e de conservation, droits d'accÃ¨s/rectification/suppression.",
      ref:"Art. 13 RGPD + DÃ©libÃ©ration CNIL", tags:['rgpd','social'], priorite:'haute', obligatoire:true },

    { cat:'rgpd', id:'rgpd_dpo', titre:"DÃ©signation d'un DPO (si requis)",
      desc:"DÃ©lÃ©guÃ© Ã  la Protection des DonnÃ©es obligatoire pour les organismes publics, le traitement Ã  grande Ã©chelle de donnÃ©es sensibles, ou la surveillance systÃ©matique. RecommandÃ© pour toute entreprise.",
      ref:"Art. 37 RGPD", tags:['rgpd'], priorite:'moyenne',
      obligatoire: eff50 },

    { cat:'rgpd', id:'rgpd_camera_videosurveillance', titre:"VidÃ©osurveillance / VidÃ©oprotection",
      desc:"DÃ©claration auprÃ¨s de la prÃ©fecture (loi 1995). Information des salariÃ©s (RGPD). Panneau d'information visible. Conservation max 30 jours. Zones interdites (toilettes, vestiaires, salles de pause).",
      ref:"Loi 95-73 + Art. L1222-4 CT + Art. 13 RGPD", tags:['rgpd','secu'], priorite:'haute', obligatoire:false },

    { cat:'rgpd', id:'rgpd_cnil_biometrie', titre:"Autorisation CNIL pour donnÃ©es biomÃ©triques",
      desc:"Tout dispositif de contrÃ´le biomÃ©trique (empreintes, reconnaissance faciale) nÃ©cessite une autorisation CNIL prÃ©alable. Analyse d'impact (AIPD) obligatoire.",
      ref:"Art. 9 RGPD + DÃ©libÃ©ration CNIL", tags:['rgpd'], priorite:'haute', obligatoire:false },

    { cat:'rgpd', id:'rgpd_retention_docs_rh', titre:"DurÃ©es de conservation des documents RH",
      desc:"Bulletins de paie : 5 ans. Contrats de travail : 5 ans aprÃ¨s fin de contrat. Registre personnel : 5 ans. Dossier salariÃ© : 5 ans. DUER : 40 ans. VidÃ©osurveillance : 30 jours.",
      ref:"Code CT + RGPD", tags:['rgpd','legal'], priorite:'haute', obligatoire:true },

    { cat:'rgpd', id:'rgpd_cookies', titre:"Politique de gestion des cookies (site web)",
      desc:"Bandeau cookies conforme : consentement explicite, granularitÃ© par catÃ©gorie (analytique, marketing, etc.), refus aussi simple qu'accepter.",
      ref:"Art. 82 Loi Informatique et LibertÃ©s + Recommandation CNIL 2020", tags:['rgpd'], priorite:'haute', obligatoire:true },

    { cat:'rgpd', id:'rgpd_sous_traitants', titre:"Clauses RGPD dans les contrats sous-traitants",
      desc:"Tout sous-traitant traitant des donnÃ©es personnelles pour votre compte doit signer un DPA (Data Processing Agreement) conforme Ã  l'art. 28 RGPD.",
      ref:"Art. 28 RGPD", tags:['rgpd'], priorite:'haute', obligatoire:true },

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 5. DROIT DU TRAVAIL â€” CONTRATS & PERSONNEL
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    { cat:'contrats', id:'cont_contrat_ecrit', titre:"Contrat de travail Ã©crit pour chaque salariÃ©",
      desc:"CDI : Ã©crit recommandÃ© (obligatoire si CCN l'impose). CDD, temps partiel, intÃ©rim : Ã©crit obligatoire dans les 2 jours ouvrables. Convention collective doit Ãªtre mentionnÃ©e.",
      ref:"Art. L1221-1 et L3123-6 CT", tags:['legal','social','ccn'], priorite:'critique', obligatoire:true },

    { cat:'contrats', id:'cont_avenant', titre:"Avenant signÃ© pour toute modification du contrat",
      desc:"Toute modification du contrat (salaire, horaires, fonctions) doit Ãªtre formalisÃ©e par un avenant signÃ© par les deux parties avant application.",
      ref:"Art. L1222-6 CT", tags:['legal','social'], priorite:'haute', obligatoire:true },

    { cat:'contrats', id:'cont_periode_essai', titre:"Respect des pÃ©riodes d'essai et dÃ©lais de prÃ©venance",
      desc:"DurÃ©es lÃ©gales ET conventionnelles. DÃ©lai de prÃ©venance en cas de rupture (minimum 24h si < 8 jours, 48h si < 1 mois, 2 semaines si < 3 mois, 1 mois si > 3 mois).",
      ref:"Art. L1221-19 CT + CCN applicable", tags:['legal','social','ccn'], priorite:'haute', obligatoire:true },

    { cat:'contrats', id:'cont_cdd_motifs', titre:"CDD : motifs lÃ©gaux et durÃ©e maximale",
      desc:"CDD uniquement pour motifs lÃ©gaux (remplacement, accroissement activitÃ©, saisonnier, etc.). DurÃ©e max 18 mois (36 mois accroissement exceptionnel). Renouvellement max 2 fois.",
      ref:"Art. L1242-2 et L1243-13 CT", tags:['legal','social'], priorite:'haute', obligatoire:true },

    { cat:'contrats', id:'cont_temps_partiel', titre:"Temps partiel : durÃ©e minimale et mentions obligatoires",
      desc:"Minimum 24h/semaine (sauf dÃ©rogations). RÃ©partition horaire fixÃ©e au contrat. Heures complÃ©mentaires â‰¤ 1/10 de la durÃ©e contractuelle (1/3 si accord collectif).",
      ref:"Art. L3123-1 et L3123-6 CT", tags:['legal','social','ccn'], priorite:'haute', obligatoire:true },

    { cat:'contrats', id:'cont_bulletin_paie', titre:"Bulletin de paie conforme (dÃ©matÃ©rialisÃ© possible)",
      desc:"Mentions obligatoires : SIREN, CCN, emploi, classification, salaire brut, cotisations, NET SOCIAL, NET Ã€ PAYER, date de paiement. Conservation 5 ans.",
      ref:"Art. R3243-1 CT + DÃ©cret 2016-190", tags:['legal','social','ccn'], priorite:'critique', obligatoire:true },

    { cat:'contrats', id:'cont_smic', titre:"Respect du SMIC et des salaires minima CCN",
      desc:"Salaire brut â‰¥ SMIC en vigueur. VÃ©rification rÃ©guliÃ¨re des grilles de salaires de la CCN applicable qui peuvent Ãªtre supÃ©rieures au SMIC.",
      ref:"Art. L3231-2 CT + ArrÃªtÃ©s d'extension CCN", tags:['legal','social','ccn'], priorite:'critique', obligatoire:true },

    { cat:'contrats', id:'cont_heures_sup', titre:"Heures supplÃ©mentaires : majorations et contingent",
      desc:"HS majorÃ©es de 25% (8 premiÃ¨res) puis 50%. Contingent annuel d'HS (220h droit commun, peut varier selon CCN). Contrepartie en repos obligatoire.",
      ref:"Art. L3121-28 CT + CCN applicable", tags:['legal','social','ccn'], priorite:'haute', obligatoire:true },

    { cat:'contrats', id:'cont_egalite_pro', titre:"Index Ã©galitÃ© professionnelle H/F",
      desc:"Calcul et publication de l'Index Ã©galitÃ© H/F avant le 1er mars chaque annÃ©e. Obligatoire â‰¥50 salariÃ©s. Sanctions si < 75/100 sans plan de rattrapage.",
      ref:"Loi 2018-771 + DÃ©cret 2019-15", tags:['legal','social'], priorite:'haute', obligatoire: eff50 },

    { cat:'contrats', id:'cont_entretien_pro', titre:"Entretiens professionnels bisannuels (art. L6315-1)",
      desc:"Entretien professionnel tous les 2 ans. Bilan rÃ©capitulatif tous les 6 ans : 1 action de formation suivie, 1 Ã©lÃ©ment de certification acquis, progression salariale ou professionnelle. Sinon : abondement CPF de 3000â‚¬.",
      ref:"Art. L6315-1 CT", tags:['legal','social','ccn'], priorite:'critique', obligatoire:true },

    { cat:'contrats', id:'cont_mutuelle', titre:"Mutuelle collective obligatoire",
      desc:"Couverture complÃ©mentaire santÃ© collective obligatoire pour tous les salariÃ©s. Part patronale minimum 50%. Cas de dispense possibles (ayant droit, CDD < 3 mois).",
      ref:"Loi ANI 2013 + Art. L911-7 CSS", tags:['legal','social'], priorite:'haute', obligatoire:true },

    { cat:'contrats', id:'cont_participation', titre:"Participation et intÃ©ressement",
      desc:"Participation aux bÃ©nÃ©fices obligatoire â‰¥50 salariÃ©s 3 ans. IntÃ©ressement facultatif mais exonÃ©rations fiscales attractives.",
      ref:"Art. L3321-1 CT", tags:['legal','social'], priorite:'haute', obligatoire: eff50 },

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 6. REPRÃ‰SENTATION DU PERSONNEL
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    { cat:'representation', id:'rep_cse_election', titre:"Ã‰lections CSE (ComitÃ© Social et Ã‰conomique)",
      desc:"Mise en place du CSE obligatoire â‰¥11 salariÃ©s (pendant 12 mois consÃ©cutifs). Organisation des Ã©lections dans les 90 jours. PV de carence si aucun candidat.",
      ref:"Art. L2311-2 et L2314-1 CT", tags:['legal','social'], priorite:'critique', obligatoire: eff11 },

    { cat:'representation', id:'rep_cse_reunions', titre:"RÃ©unions CSE pÃ©riodiques",
      desc:"â‰¥11 salariÃ©s : au moins 1 rÃ©union/mois. â‰¥50 salariÃ©s : rÃ©unions thÃ©matiques (SSCT, Ã©conomique, ordinaire). PV de chaque rÃ©union.",
      ref:"Art. L2315-27 CT", tags:['legal','social'], priorite:'haute', obligatoire: eff11 },

    { cat:'representation', id:'rep_negociation', titre:"NÃ©gociation annuelle obligatoire (NAO)",
      desc:"NÃ©gociation annuelle sur les salaires, le temps de travail et le partage de la valeur ajoutÃ©e. â‰¥50 salariÃ©s avec dÃ©lÃ©guÃ© syndical.",
      ref:"Art. L2242-1 CT", tags:['legal','social'], priorite:'haute', obligatoire: eff50 },

    { cat:'representation', id:'rep_syndicats', titre:"LibertÃ© syndicale et affichage des communications syndicales",
      desc:"LibertÃ© d'adhÃ©sion syndicale. Panneau d'affichage dÃ©diÃ© aux organisations syndicales. Ne pas entraver l'activitÃ© syndicale.",
      ref:"Art. L2141-1 CT", tags:['legal','social'], priorite:'haute', obligatoire: eff50 },

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 7. OBLIGATIONS SOCIALES & DÃ‰CLARATIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    { cat:'social', id:'soc_dpae', titre:"DPAE (DÃ©claration PrÃ©alable Ã  l'Embauche)",
      desc:"DÃ©claration obligatoire auprÃ¨s de l'URSSAF au plus tÃ´t 8 jours avant l'embauche, au plus tard 1 heure avant la prise de poste.",
      ref:"Art. L1221-10 CT", tags:['legal','social'], priorite:'critique', obligatoire:true },

    { cat:'social', id:'soc_dsn', titre:"DSN (DÃ©claration Sociale Nominative) mensuelle",
      desc:"DÃ©claration mensuelle transmise Ã  la CNAV, CPAM, PÃ´le Emploi, URSSAF. DÃ©lai : 5 ou 15 du mois suivant. PÃ©nalitÃ©s en cas de retard.",
      ref:"Art. L133-5-3 CSS", tags:['legal','social'], priorite:'critique', obligatoire:true },

    { cat:'social', id:'soc_urssaf', titre:"Paiement des cotisations URSSAF",
      desc:"Paiement mensuel (ou trimestriel si â‰¤9 salariÃ©s et option choisie) des charges sociales patronales et salariales.",
      ref:"Art. R243-6 CSS", tags:['legal','social'], priorite:'critique', obligatoire:true },

    { cat:'social', id:'soc_retraite_complementaire', titre:"AdhÃ©sion Ã  une caisse de retraite complÃ©mentaire",
      desc:"AdhÃ©sion obligatoire Ã  l'AGIRC-ARRCO pour tous les salariÃ©s du secteur privÃ©. DÃ©claration et paiement des cotisations.",
      ref:"Accord national AGIRC-ARRCO", tags:['legal','social'], priorite:'critique', obligatoire:true },

    { cat:'social', id:'soc_prevoyance_ccn', titre:"PrÃ©voyance collective CCN",
      desc:"Garanties de prÃ©voyance (incapacitÃ©, invaliditÃ©, dÃ©cÃ¨s) imposÃ©es par la convention collective. VÃ©rifier le taux et les bÃ©nÃ©ficiaires selon la CCN.",
      ref:"CCN applicable + Art. L911-2 CSS", tags:['legal','social','ccn'], priorite:'haute', obligatoire:true },

    { cat:'social', id:'soc_1pct_logement', titre:"Participation effort construction (1% patronal)",
      desc:"Participation Ã  l'effort de construction (PEEC) : 0,45% de la masse salariale brute annuelle N-1. Obligatoire â‰¥20 salariÃ©s.",
      ref:"Art. L313-1 CCH", tags:['legal','social'], priorite:'haute',
      obligatoire: effectif !== '1-9' && effectif !== '10-49' },

    { cat:'social', id:'soc_taxe_apprentissage', titre:"Taxe d'apprentissage et contribution formation",
      desc:"Taxe d'apprentissage (0,68% MS) + Contribution Ã  la formation professionnelle (0,55% MS â‰¤10 salariÃ©s, 1% â‰¥11 salariÃ©s). Via DSN.",
      ref:"Art. L6241-1 CT", tags:['legal','social'], priorite:'haute', obligatoire:true },

    { cat:'social', id:'soc_agefiph', titre:"Contribution AGEFIPH / FIPHFP (obligation emploi handicapÃ©)",
      desc:"Si â‰¥20 salariÃ©s et taux d'emploi travailleurs handicapÃ©s < 6% : contribution AGEFIPH. DÃ©claration annuelle DOETH.",
      ref:"Art. L5212-9 CT", tags:['legal','social'], priorite:'haute',
      obligatoire: effectif !== '1-9' && effectif !== '10-49' },

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 8. SPÃ‰CIFIQUES PAR SECTEUR / CCN
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    { cat:'ccn_specifique', id:'ccn_licenciement_proc', titre:"ProcÃ©dure de licenciement conforme Ã  la CCN",
      desc:"Respecter la procÃ©dure lÃ©gale ET conventionnelle : convocation entretien prÃ©alable, dÃ©lai entre convocation et entretien (5 jours ouvrables), notification par LRAR, dÃ©lai de prÃ©avis CCN.",
      ref:"Art. L1232-2 CT + CCN applicable", tags:['legal','social','ccn'], priorite:'critique', obligatoire:true },

    { cat:'ccn_specifique', id:'ccn_preavis', titre:"PrÃ©avis de rupture conforme Ã  la CCN",
      desc:"Le prÃ©avis applicable est le plus favorable entre la loi et la CCN. VÃ©rifier les durÃ©es par catÃ©gorie (ouvrier, employÃ©, agent de maÃ®trise, cadre).",
      ref:"Art. L1234-1 CT + CCN applicable", tags:['legal','social','ccn'], priorite:'haute', obligatoire:true },

    { cat:'ccn_specifique', id:'ccn_primes', titre:"Primes conventionnelles obligatoires",
      desc:"Prime d'anciennetÃ©, prime de vacances, prime de fin d'annÃ©e prÃ©vues par la CCN. VÃ©rifier l'anciennetÃ© de chaque salariÃ© et les seuils dÃ©clencheurs.",
      ref:"CCN applicable", tags:['social','ccn'], priorite:'haute', obligatoire:true },

    { cat:'ccn_specifique', id:'ccn_classification', titre:"Classification des emplois conforme Ã  la CCN",
      desc:"Chaque salariÃ© doit avoir une classification (coefficient, niveau, Ã©chelon) correspondant Ã  ses fonctions rÃ©elles, conforme Ã  la grille de la CCN.",
      ref:"CCN applicable", tags:['social','ccn'], priorite:'haute', obligatoire:true },

    { cat:'ccn_specifique', id:'ccn_travail_nuit', titre:"Travail de nuit : contreparties lÃ©gales et conventionnelles",
      desc:"Majoration minimum 10% (variable selon CCN). Information du mÃ©decin du travail. BÃ©nÃ©fice d'un suivi mÃ©dical renforcÃ©. Contrepartie en repos.",
      ref:"Art. L3122-7 CT + CCN applicable", tags:['legal','social','ccn'], priorite:'haute',
      obligatoire: ['boulangerie','patisserie','chr','sante','transport_routier','securite'].includes(ccn) },

    { cat:'ccn_specifique', id:'ccn_dimanche', titre:"Travail le dimanche : dÃ©rogations et majorations",
      desc:"Autorisation prÃ©fectorale ou dÃ©rogation de droit selon le secteur. RÃ©munÃ©ration majorÃ©e (minimum 30% ou selon CCN). Volontariat du salariÃ© formalisÃ©.",
      ref:"Art. L3132-12 CT + CCN applicable", tags:['legal','social','ccn'], priorite:'haute',
      obligatoire: ['chr','restauration_rapide','commerce','commerce_alimentaire','grande_distribution','boulangerie'].includes(ccn) },

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // 9. NUMÃ‰RIQUE & OUTILS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    { cat:'numerique', id:'num_charte_info', titre:"Charte informatique",
      desc:"Document dÃ©finissant les rÃ¨gles d'utilisation des outils informatiques professionnels (internet, email, tÃ©lÃ©phone, rÃ©seaux sociaux). AnnexÃ©e au rÃ¨glement intÃ©rieur ou remise individuellement.",
      ref:"CNIL + Art. L1222-4 CT", tags:['rgpd','legal'], priorite:'moyenne', obligatoire:false },

    { cat:'numerique', id:'num_teletravail', titre:"Accord ou charte de tÃ©lÃ©travail",
      desc:"Si tÃ©lÃ©travail rÃ©gulier : accord collectif ou charte unilatÃ©rale. Formalisation des modalitÃ©s, prise en charge des frais, Ã©quipements, droit Ã  la dÃ©connexion.",
      ref:"Art. L1222-9 CT + ANI TÃ©lÃ©travail 2020", tags:['legal','social'], priorite:'haute', obligatoire:false },

    { cat:'numerique', id:'num_droit_deconnexion', titre:"Droit Ã  la dÃ©connexion",
      desc:"â‰¥50 salariÃ©s : nÃ©gociation sur les modalitÃ©s du droit Ã  la dÃ©connexion. En l'absence d'accord : charte Ã©laborÃ©e aprÃ¨s avis du CSE.",
      ref:"Art. L2242-17 CT", tags:['legal','social'], priorite:'moyenne', obligatoire: eff50 },

    { cat:'numerique', id:'num_cybersecurite', titre:"Politique de cybersÃ©curitÃ© et sauvegardes",
      desc:"Politique de mots de passe, chiffrement des donnÃ©es sensibles, sauvegardes rÃ©guliÃ¨res, procÃ©dure en cas de violation de donnÃ©es (notification CNIL dans 72h).",
      ref:"Art. 33 RGPD + Guide CNIL TPE/PME", tags:['rgpd','secu'], priorite:'haute', obligatoire:true },

  ];
}

// CatÃ©gories
const CATEGORIES = [
  { id:'affichage',       label:'ğŸ“‹ Affichages obligatoires',        icon:'ğŸ“‹' },
  { id:'registres',       label:'ğŸ“ Registres & Documents',          icon:'ğŸ“' },
  { id:'reglement',       label:'ğŸ“œ RÃ¨glement intÃ©rieur',             icon:'ğŸ“œ' },
  { id:'secu',            label:'ğŸ¦º SantÃ© & SÃ©curitÃ©',                icon:'ğŸ¦º' },
  { id:'rgpd',            label:'ğŸ”’ RGPD & DonnÃ©es',                  icon:'ğŸ”’' },
  { id:'contrats',        label:'ğŸ“„ Contrats & Personnel',            icon:'ğŸ“„' },
  { id:'representation',  label:'ğŸ¤ ReprÃ©sentation du personnel',     icon:'ğŸ¤' },
  { id:'social',          label:'ğŸ’¼ Obligations sociales',            icon:'ğŸ’¼' },
  { id:'ccn_specifique',  label:'âš–ï¸ CCN â€” Obligations spÃ©cifiques',  icon:'âš–ï¸' },
  { id:'numerique',       label:'ğŸ’» NumÃ©rique & Outils',              icon:'ğŸ’»' },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPage() {
  const mc = document.getElementById('main-content');
  const obligations = getObligations();
  const ccn = _params.ccnDefault || 'droit_commun';
  const ccnInfo = CCN_RULES[ccn] || {};
  const empList = Object.values(_employes).filter(e => e.statut !== 'archive');

  // Calcul score global
  const applicables = obligations.filter(o => o.obligatoire);
  const scores = applicables.map(o => {
    const d = _conformiteData[o.id] || {};
    const st = d.statut || 'todo';
    return st === 'ok' ? 1 : st === 'warn' ? 0.5 : st === 'err' ? 0 : st === 'na' ? null : null;
  }).filter(v => v !== null);
  const totalOk = scores.filter(v => v === 1).length;
  const totalWarn = scores.filter(v => v === 0.5).length;
  const totalErr = scores.filter(v => v === 0).length;
  const totalTodo = applicables.filter(o => {
    const st = (_conformiteData[o.id] || {}).statut;
    return !st || st === 'todo';
  }).length;
  const evaluated = scores.length;
  const scorePct = evaluated > 0 ? Math.round((totalOk + totalWarn * 0.5) / applicables.length * 100) : 0;
  const barColor = scorePct >= 80 ? '#34d399' : scorePct >= 50 ? '#fbbf24' : '#f87171';

  // Update topbar subtitle avec CCN
  const tb = document.getElementById('topbar-ccn-sub');
  if (tb) tb.textContent = 'CCN : ' + (ccnInfo.label || 'Code du travail') + (ccnInfo.idcc ? ' (IDCC '+ccnInfo.idcc+')' : '') + ' Â· ' + empList.length + ' salariÃ©(s)';

  // Badges par catÃ©gorie
  function catBadge(catId) {
    const items = obligations.filter(o => o.cat === catId && o.obligatoire);
    if (!items.length) return '';
    const errs = items.filter(o => (_conformiteData[o.id]||{}).statut === 'err').length;
    const warns = items.filter(o => (_conformiteData[o.id]||{}).statut === 'warn').length;
    const oks = items.filter(o => (_conformiteData[o.id]||{}).statut === 'ok').length;
    if (errs) return `<span class="conf-nav-badge badge-err">${errs} âŒ</span>`;
    if (warns) return `<span class="conf-nav-badge badge-warn">${warns} âš ï¸</span>`;
    if (oks === items.length) return `<span class="conf-nav-badge badge-ok">âœ“</span>`;
    return `<span class="conf-nav-badge badge-info">${items.length - oks} â†’</span>`;
  }

  mc.innerHTML = `
  <div style="display:flex;gap:20px;align-items:flex-start;width:100%">

    <!-- NAV GAUCHE -->
    <div class="left-nav">
      <div class="conf-nav">
        <div class="conf-nav-head">Rubriques</div>
        ${CATEGORIES.map(c => `
          <div class="conf-nav-item ${_currentSection===c.id?'active':''}" id="nav-${c.id}" onclick="scrollToSection('${c.id}')">
            <span class="conf-nav-icon">${c.icon}</span>
            <span>${c.label.replace(/^.+ /,'')}</span>
            ${catBadge(c.id)}
          </div>`).join('')}
        <div class="conf-nav-item ${_currentSection==='documents'?'active':''}" id="nav-documents" onclick="scrollToSection('documents')" style="border-top:1px solid var(--rh-border);margin-top:4px;padding-top:10px">
          <span class="conf-nav-icon">ğŸ“„</span>
          <span>Documents Ã  imprimer</span>
          <span class="conf-nav-badge" style="background:#dbeafe;color:#1e40af;font-size:9px;font-weight:700;padding:1px 5px;border-radius:8px">PDF</span>
        </div>
      </div>

      <!-- SYNTHÃˆSE EMPLOYÃ‰S -->
      <div class="conf-nav" style="margin-top:12px">
        <div class="conf-nav-head">ğŸ‘¥ SalariÃ©s (${empList.length})</div>
        <div style="padding:8px 10px;max-height:280px;overflow-y:auto">
          ${empList.length === 0
            ? '<div style="font-size:11px;color:var(--muted);padding:8px;text-align:center">Aucun salariÃ©</div>'
            : empList.slice(0,15).map(e => {
                const COLORS=['#059669','#3b82f6','#8b5cf6','#f59e0b','#ef4444','#14b8a6'];
                const ci = (e.prenom||'A').charCodeAt(0) % COLORS.length;
                const init = ((e.prenom||'')[0]||'').toUpperCase() + ((e.nom||'')[0]||'').toUpperCase();
                const manquants = getManquantsSalarie(e);
                const isSelected = _selectedEmpId === (e.id||e.uid);
                return `<div class="emp-conf-item${isSelected?' selected':''}" onclick="openFicheSalarie('${e.id||e.uid||''}','${(e.prenom||'').replace(/'/g,"\\'")} ${(e.nom||'').replace(/'/g,"\\'")}')">
                  <div class="emp-avatar" style="background:${COLORS[ci]}">${init}</div>
                  <div style="flex:1;min-width:0">
                    <div class="emp-conf-name">${e.prenom||''} ${e.nom||''}</div>
                    <div class="emp-conf-poste">${e.poste||'â€”'}</div>
                  </div>
                  ${manquants > 0
                    ? `<span class="oblig-tag tag-secu" style="font-size:9px">${manquants} âš </span>`
                    : `<span style="font-size:12px">âœ…</span>`}
                </div>`;
              }).join('') +
              (empList.length > 12 ? `<div style="font-size:10px;color:var(--muted);text-align:center;padding:4px">+ ${empList.length-12} autres</div>` : '')
          }
        </div>
      </div>
    </div>

    <!-- CONTENU DROIT -->
    <div class="right-content" id="right-content">

      <!-- SCORE GLOBAL -->
      <div class="score-banner">
        <div class="score-circle">
          <div class="score-num" style="color:${barColor}">${scorePct}</div>
          <div class="score-denom">/ 100</div>
        </div>
        <div class="score-info">
          <div class="score-title">Score de conformitÃ© RH</div>
          <div class="score-sub">${applicables.length} obligations applicables Â· ${empList.length} salariÃ©(s)</div>
          <div class="score-bar-wrap">
            <div class="score-bar-fill" style="width:${scorePct}%;background:${barColor}"></div>
          </div>
          <div class="score-kpis">
            <div class="score-kpi"><div class="score-kpi-val" style="color:#34d399">${totalOk}</div><div class="score-kpi-lbl">Conformes</div></div>
            <div class="score-kpi"><div class="score-kpi-val" style="color:#fbbf24">${totalWarn}</div><div class="score-kpi-lbl">Ã€ amÃ©liorer</div></div>
            <div class="score-kpi"><div class="score-kpi-val" style="color:#f87171">${totalErr}</div><div class="score-kpi-lbl">Non conf.</div></div>
            <div class="score-kpi"><div class="score-kpi-val" style="color:rgba(255,255,255,.5)">${totalTodo}</div><div class="score-kpi-lbl">Ã€ Ã©valuer</div></div>
          </div>
        </div>
        <div style="text-align:right;flex-shrink:0">
          <div style="font-size:10px;color:rgba(255,255,255,.4);margin-bottom:6px">Convention collective</div>
          <div style="font-size:12px;font-weight:700;color:white">${ccnInfo.label||'Code du travail'}</div>
          ${ccnInfo.idcc ? `<div style="font-size:10px;color:rgba(255,255,255,.5)">IDCC ${ccnInfo.idcc}</div>` : ''}
          <div style="font-size:10px;color:rgba(255,255,255,.4);margin-top:8px">${empList.length} salariÃ©(s) actif(s)</div>
        </div>
      </div>

      <!-- CALENDRIER DES OBLIGATIONS RÃ‰CURRENTES -->
      <div class="conf-section" id="section-calendrier">
        <div class="conf-section-head" onclick="toggleSection('calendrier')">
          <div class="conf-section-title">ğŸ“… Calendrier des obligations rÃ©currentes</div>
          <div class="conf-section-meta">
            <span style="font-size:11px;color:var(--muted)">Actions Ã  planifier dans l'annÃ©e</span>
            <span class="chevron open" id="chev-calendrier">â€º</span>
          </div>
        </div>
        <div class="conf-section-body" id="body-calendrier">
          ${renderCalendrier(ccn)}
        </div>
      </div>

      <!-- SECTIONS PAR CATÃ‰GORIE -->
      ${CATEGORIES.map(cat => {
        const items = obligations.filter(o => o.cat === cat.id);
        if (!items.length) return '';
        const applicable = items.filter(o => o.obligatoire);
        const nonApp = items.filter(o => !o.obligatoire);
        return `
          <div class="conf-section" id="section-${cat.id}">
            <div class="conf-section-head" onclick="toggleSection('${cat.id}')">
              <div class="conf-section-title">${cat.label}</div>
              <div class="conf-section-meta">
                ${renderCatSummary(applicable)}
                <span class="chevron open" id="chev-${cat.id}">â€º</span>
              </div>
            </div>
            <div class="conf-section-body" id="body-${cat.id}">
              ${applicable.map(o => renderObligation(o)).join('')}
              ${nonApp.length > 0 ? `
                <div style="font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;padding:8px 0 4px;margin-top:6px;border-top:1px solid var(--border)">
                  RecommandÃ© / conditionnel
                </div>
                ${nonApp.map(o => renderObligation(o)).join('')}
              ` : ''}
            </div>
          </div>`;
      }).join('')}

      <!-- SYNTHÃˆSE PAR SALARIÃ‰ -->
      <div class="conf-section" id="section-salaries">
        <div class="conf-section-head" onclick="toggleSection('salaries')">
          <div class="conf-section-title">ğŸ‘¥ ConformitÃ© par salariÃ©</div>
          <div class="conf-section-meta">
            <span style="font-size:11px;color:var(--muted)">${empList.length} salariÃ©(s)</span>
            <span class="chevron open" id="chev-salaries">â€º</span>
          </div>
        </div>
        <div class="conf-section-body" id="body-salaries">
          ${renderSalariesConformite(empList)}
        </div>
      </div>

      <!-- FICHE SALARIÃ‰ CONFORMITÃ‰ (affichÃ©e quand on clique dans le panneau gauche) -->
      <div class="conf-section" id="section-fiche-salarie" style="display:none">
        <div class="conf-section-head" style="background:linear-gradient(135deg,#052e16,#064e23)">
          <div class="conf-section-title" style="color:white" id="fiche-salarie-title">ğŸ‘¤ Fiche salariÃ©</div>
          <div class="conf-section-meta">
            <button onclick="closeFicheSalarie()" style="background:rgba(255,255,255,.15);border:none;color:white;border-radius:6px;padding:4px 10px;font-size:11px;cursor:pointer">âœ• Fermer</button>
          </div>
        </div>
        <div class="conf-section-body" id="body-fiche-salarie" style="padding:0"></div>
      </div>

      <!-- DOCUMENTS Ã€ IMPRIMER / PDF -->
      <div class="conf-section" id="section-documents">
        <div class="conf-section-head" onclick="toggleSection('documents')">
          <div class="conf-section-title">ğŸ“„ Documents lÃ©gaux Ã  imprimer / PDF</div>
          <div class="conf-section-meta">
            <span style="font-size:11px;color:var(--muted)">Affichages obligatoires Â· Registres Â· Attestations Â· Formulaires</span>
            <span class="chevron open" id="chev-documents">â€º</span>
          </div>
        </div>
        <div class="conf-section-body" id="body-documents">
          <div style="padding:14px">
            <div class="doc-filter-bar" id="doc-filter-bar">
              <button class="doc-filter-btn active" onclick="filterDocs('all',this)">Tous</button>
              <button class="doc-filter-btn" onclick="filterDocs('affichage',this)">ğŸ“‹ Affichages</button>
              <button class="doc-filter-btn" onclick="filterDocs('personnel',this)">ğŸ‘¤ Personnel</button>
              <button class="doc-filter-btn" onclick="filterDocs('secu',this)">ğŸ¦º SÃ©curitÃ©</button>
              <button class="doc-filter-btn" onclick="filterDocs('rgpd',this)">ğŸ”’ RGPD</button>
              <button class="doc-filter-btn" onclick="filterDocs('contrat',this)">ğŸ“ Contrats</button>
              <button class="doc-filter-btn" onclick="filterDocs('registre',this)">ğŸ“š Registres</button>
            </div>
            <div class="doc-grid" id="doc-grid">${renderDocGrid()}</div>
          </div>
        </div>
      </div>

    </div>
  </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER OBLIGATION ITEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderObligation(o) {
  const d = _conformiteData[o.id] || {};
  const statut = d.statut || (o.obligatoire ? 'todo' : 'na');
  const checkIcons = { ok:'âœ“', warn:'âš ', err:'âœ•', na:'â€”', todo:'?' };
  const checkClasses = { ok:'check-ok', warn:'check-warn', err:'check-err', na:'check-na', todo:'check-todo' };
  const itemClasses = { ok:'ok', warn:'warn', err:'err', na:'na', todo:'' };

  const tagHtml = o.tags.map(t => `<span class="oblig-tag tag-${t}">${{legal:'âš–ï¸ LÃ©gal',rgpd:'ğŸ”’ RGPD',social:'ğŸ‘¥ Social',secu:'ğŸ¦º SÃ©curitÃ©',hygiene:'ğŸ½ï¸ HygiÃ¨ne',ccn:'ğŸ“‹ CCN',btp:'ğŸ—ï¸ BTP',eff:'ğŸ¢ Effectif'}[t]||t}</span>`).join(' ');

  const prioHtml = o.priorite === 'critique'
    ? '<span style="font-size:9px;font-weight:700;padding:2px 6px;border-radius:8px;background:#fee2e2;color:#991b1b">CRITIQUE</span>'
    : '';

  return `<div class="oblig-item ${itemClasses[statut]||''}" id="item-${o.id}">
    <div class="oblig-check ${checkClasses[statut]}">${checkIcons[statut]}</div>
    <div class="oblig-content">
      <div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap">
        <div class="oblig-title">${o.titre}</div>
        ${prioHtml}
        ${!o.obligatoire ? '<span style="font-size:9px;font-weight:700;padding:2px 6px;border-radius:8px;background:#f1f5f9;color:#64748b">RecommandÃ©</span>' : ''}
      </div>
      <div class="oblig-desc">${o.desc}</div>
      <div class="oblig-ref">ğŸ“Œ ${o.ref}</div>
      ${d.note ? `<div style="margin-top:6px;padding:6px 8px;background:#f8faff;border-radius:6px;font-size:11px;color:var(--text);border-left:3px solid var(--rh-main)">ğŸ’¬ ${d.note}</div>` : ''}
      ${d.echeance ? `<div style="font-size:10px;color:var(--amber);margin-top:4px;font-weight:600">â° Ã‰chÃ©ance : ${new Date(d.echeance).toLocaleDateString('fr-FR')}</div>` : ''}
      <div style="display:flex;align-items:center;gap:8px;margin-top:8px;flex-wrap:wrap">
        <div style="display:flex;gap:4px">
          ${['ok','warn','err','na'].map(s => `
            <button class="status-btn sb-${s} ${statut===s?'active':''}" onclick="setStatut('${o.id}','${s}')">
              ${{ok:'âœ… OK',warn:'âš ï¸ Partiel',err:'âŒ KO',na:'â€” N/A'}[s]}
            </button>`).join('')}
        </div>
        <button class="btn btn-outline btn-xs" onclick="openModalNote('${o.id}','${o.titre.replace(/'/g,"\\'")}')">ğŸ’¬ Note</button>
        ${tagHtml}
      </div>
    </div>
  </div>`;
}

function renderCatSummary(items) {
  if (!items.length) return '';
  const errs = items.filter(o => (_conformiteData[o.id]||{}).statut === 'err').length;
  const warns = items.filter(o => (_conformiteData[o.id]||{}).statut === 'warn').length;
  const oks = items.filter(o => (_conformiteData[o.id]||{}).statut === 'ok').length;
  return `<span style="font-size:11px;color:var(--muted)">${oks}âœ… ${warns}âš ï¸ ${errs}âŒ</span>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALENDRIER OBLIGATIONS RÃ‰CURRENTES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderCalendrier(ccn) {
  const cal = {
    '01':['DSN paie dÃ©cembre (15/01)','Taxe apprentissage (solde)'],
    '02':['DSN janvier','Index Ã©galitÃ© H/F â‰¥50 sal. (avant 01/03)'],
    '03':['DSN fÃ©vrier','NAO â€” compte-rendu sinon PV carence'],
    '04':['DSN mars','Bilan DUER annuel','VÃ©rification extincteurs'],
    '05':['DSN avril','VÃ©rification contrats CDD (durÃ©e max)'],
    '06':['DSN mai','Exercice Ã©vacuation incendie','Visite mÃ©decin travail (planning)'],
    '07':['DSN juin','Bilan entretiens professionnels (6 ans)'],
    '08':['DSN juillet','VÃ©rification habilitations Ã©lectriques BTP'],
    '09':['DSN aoÃ»t','Plan de formation N+1 (prÃ©sentation CSE â‰¥50)'],
    '10':['DSN septembre','Renouvellement carte pro BTP si applicable'],
    '11':['DSN octobre','Convocation CSE pour budget Å“uvres sociales â‰¥50','DOETH (emploi handicapÃ©) â‰¥20 sal.'],
    '12':['DSN novembre','ClÃ´ture PEEC (1% logement)','PrÃ©parer N1 : taxe apprentissage'],
  };
  const months = ['Jan','FÃ©v','Mar','Avr','Mai','Jun','Jul','AoÃ»','Sep','Oct','Nov','DÃ©c'];
  const colors = ['#dbeafe','#dcfce7','#fef3c7','#fee2e2'];

  return `<div class="cal-grid">${Object.entries(cal).map(([m, items], idx) => `
    <div class="cal-month">
      <div class="cal-month-label">${months[parseInt(m)-1]}</div>
      <div class="cal-items">
        ${items.map((item, i) => `<div class="cal-item" style="background:${colors[i%colors.length]};color:#374151">${item}</div>`).join('')}
      </div>
    </div>`).join('')}</div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFORMITÃ‰ PAR SALARIÃ‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getManquantsSalarie(e) {
  const docsRequis = ['cni','rib','vitale','contrat'];
  return docsRequis.filter(d => {
    const docs = e.documents || [];
    return !docs.some(doc => doc.type === d);
  }).length;
}

function renderSalariesConformite(empList) {
  if (!empList.length) return '<div style="text-align:center;padding:20px;color:var(--muted);font-size:12px">Aucun salariÃ© actif.</div>';

  const checks = [
    { id:'visite', label:'Visite mÃ©dicale', check: e => (e.prochaineSuiviMedical || e.dateVisiteMedicale) ? 'ok' : 'warn' },
    { id:'contrat', label:'Contrat', check: e => (e.documents||[]).some(d=>d.type==='contrat') ? 'ok' : 'err' },
    { id:'rib', label:'RIB', check: e => (e.documents||[]).some(d=>d.type==='rib') ? 'ok' : 'warn' },
    { id:'cni', label:'PiÃ¨ce ID', check: e => (e.documents||[]).some(d=>d.type==='cni') ? 'ok' : 'warn' },
    { id:'mutuelle', label:'Mutuelle', check: e => e.mutuelle ? 'ok' : 'warn' },
    { id:'entretien', label:'Entretien pro', check: e => {
        if (!e.derniereEmbauche) return 'warn';
        const embauche = new Date(e.derniereEmbauche);
        const now = new Date();
        const years = (now - embauche) / (365.25 * 24 * 3600 * 1000);
        return years < 2 ? 'ok' : (years < 3 ? 'warn' : 'err');
      }
    },
  ];

  const statIcons = { ok:'âœ…', warn:'âš ï¸', err:'âŒ' };

  return `
    <div style="overflow-x:auto">
      <table style="width:100%;border-collapse:collapse;font-size:12px;min-width:600px">
        <thead>
          <tr style="background:var(--rh-ghost)">
            <th style="padding:8px 12px;text-align:left;font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;border-bottom:1px solid var(--border)">SalariÃ©</th>
            ${checks.map(c=>`<th style="padding:8px 10px;text-align:center;font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;border-bottom:1px solid var(--border)">${c.label}</th>`).join('')}
            <th style="padding:8px 10px;text-align:center;font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;border-bottom:1px solid var(--border)">Fiche</th>
          </tr>
        </thead>
        <tbody>
          ${empList.map(e => {
            const COLORS=['#059669','#3b82f6','#8b5cf6','#f59e0b','#ef4444','#14b8a6'];
            const ci = (e.prenom||'A').charCodeAt(0) % COLORS.length;
            const init = ((e.prenom||'')[0]||'').toUpperCase()+((e.nom||'')[0]||'').toUpperCase();
            return `<tr style="border-bottom:1px solid #f1f5f9">
              <td style="padding:8px 12px">
                <div style="display:flex;align-items:center;gap:8px">
                  <div style="width:24px;height:24px;border-radius:6px;background:${COLORS[ci]};display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;color:white;flex-shrink:0">${init}</div>
                  <div>
                    <div style="font-weight:600">${e.prenom||''} ${e.nom||''}</div>
                    <div style="font-size:10px;color:var(--muted)">${e.poste||'â€”'}</div>
                  </div>
                </div>
              </td>
              ${checks.map(c => {
                const st = c.check(e);
                return `<td style="text-align:center;padding:8px 10px;font-size:14px">${statIcons[st]||'â€”'}</td>`;
              }).join('')}
              <td style="text-align:center;padding:8px 10px">
                <a href="rh-employes.html" style="font-size:10px;color:var(--rh-main);font-weight:700;text-decoration:none">â†’ Fiche</a>
              </td>
            </tr>`;
          }).join('')}
        </tbody>
      </table>
    </div>
    <div style="margin-top:12px;font-size:11px;color:var(--muted);padding:8px 10px;background:#f8faff;border-radius:8px;border:1px solid var(--border)">
      ğŸ’¡ <b>Visite mÃ©dicale</b> : Ã  planifier dans les 3 mois suivant l'embauche puis selon le suivi dÃ©fini. <b>Entretien professionnel</b> : obligatoire tous les 2 ans (art. L6315-1 CT).
    </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setStatut(itemId, statut) {
  if (!_conformiteData[itemId]) _conformiteData[itemId] = {};
  _conformiteData[itemId].statut = statut;
  // Mettre Ã  jour l'item visuellement
  const item = document.getElementById('item-' + itemId);
  if (!item) return;
  const checkIcons = { ok:'âœ“', warn:'âš ', err:'âœ•', na:'â€”', todo:'?' };
  const checkCls = { ok:'check-ok', warn:'check-warn', err:'check-err', na:'check-na', todo:'check-todo' };
  const itemCls = { ok:'ok', warn:'warn', err:'err', na:'na', todo:'' };
  const check = item.querySelector('.oblig-check');
  if (check) { check.textContent = checkIcons[statut]; check.className = 'oblig-check ' + (checkCls[statut]||''); }
  item.className = 'oblig-item ' + (itemCls[statut]||'');
  // Mettre Ã  jour les boutons
  item.querySelectorAll('.status-btn').forEach(btn => {
    btn.classList.toggle('active', btn.textContent.includes({ok:'OK',warn:'Partiel',err:'KO',na:'N/A'}[statut]||''));
  });
  scheduleAutoSave();
}

var _autoSaveTimer = null;
function scheduleAutoSave() {
  clearTimeout(_autoSaveTimer);
  _autoSaveTimer = setTimeout(() => saveAll(true), 2000);
}

async function saveAll(silent) {
  if (!window._uid) return;
  try {
    await window._setDoc(
      window._doc(window._db, 'rh', window._uid, 'conformite', 'audit'),
      Object.assign({}, _conformiteData, { updatedAt: new Date().toISOString() }),
      { merge: true }
    );
    if (!silent) showToast('âœ… DonnÃ©es de conformitÃ© sauvegardÃ©es', 'ok');
  } catch(e) {
    showToast('Erreur : ' + e.message, 'err');
  }
}

// Modal note
var _modalItemTitle = '';
function openModalNote(itemId, titre) {
  _modalItemId = itemId;
  _modalItemTitle = titre;
  const d = _conformiteData[itemId] || {};
  document.getElementById('modal-note-title').textContent = 'ğŸ“ ' + titre;
  document.getElementById('mn-status').value = d.statut || 'ok';
  document.getElementById('mn-note').value = d.note || '';
  document.getElementById('mn-echeance').value = d.echeance || '';
  document.getElementById('modal-note').classList.add('show');
}

function closeModalNote() {
  document.getElementById('modal-note').classList.remove('show');
  _modalItemId = null;
}

function saveNote() {
  if (!_modalItemId) return;
  if (!_conformiteData[_modalItemId]) _conformiteData[_modalItemId] = {};
  const statut = document.getElementById('mn-status').value;
  const note = document.getElementById('mn-note').value.trim();
  const echeance = document.getElementById('mn-echeance').value;
  _conformiteData[_modalItemId].statut = statut;
  if (note) _conformiteData[_modalItemId].note = note;
  else delete _conformiteData[_modalItemId].note;
  if (echeance) _conformiteData[_modalItemId].echeance = echeance;
  else delete _conformiteData[_modalItemId].echeance;
  closeModalNote();
  // Re-render l'item
  const o = getObligations().find(x => x.id === _modalItemId);
  if (o) {
    const container = document.getElementById('item-' + _modalItemId);
    if (container) container.outerHTML = renderObligation(o);
  }
  scheduleAutoSave();
}

function toggleSection(id) {
  const body = document.getElementById('body-' + id);
  const chev = document.getElementById('chev-' + id);
  if (!body) return;
  body.classList.toggle('collapsed');
  if (chev) chev.classList.toggle('open', !body.classList.contains('collapsed'));
}

function scrollToSection(id) {
  _currentSection = id;
  const el = document.getElementById('section-' + id);
  if (el) el.scrollIntoView({ behavior:'smooth', block:'start' });
  document.querySelectorAll('.conf-nav-item').forEach(item => item.classList.remove('active'));
  const nav = document.getElementById('nav-' + id);
  if (nav) nav.classList.add('active');
}

// Sidebar mobile
function toggleSidebar() {
  document.querySelector('.sidebar')?.classList.toggle('open');
  document.getElementById('nav-overlay')?.classList.toggle('show');
}
function closeSidebar() {
  document.querySelector('.sidebar')?.classList.remove('open');
  document.getElementById('nav-overlay')?.classList.remove('show');
}

function showToast(msg, type) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.className = 'toast show ' + (type||'');
  setTimeout(() => t.className = 'toast', 3200);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ã‰TAT GLOBAL â€” DOCUMENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var _selectedEmpId = null;
var _currentDocId  = null;
var _pdfDocDef     = null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CATALOGUE DES DOCUMENTS LÃ‰GAUX
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DOCS_CATALOGUE = [
  // â”€â”€ AFFICHAGES OBLIGATOIRES â”€â”€
  { id:'aff_tabac',     icon:'ğŸš­', titre:'Interdiction de fumer et vapoter',   cat:'affichage', desc:'Affichage obligatoire dans tous les lieux de travail couverts et fermÃ©s (Art. R3512-2 CSP)', tags:['legal'],   needsSalarie:false,
    content: (d) => `<h2>INTERDICTION DE FUMER ET VAPOTER</h2><div class="dp-sub">Article R3512-2 du Code de la santÃ© publique</div>
    <div class="dp-header"><div><b>${d.raison}</b>${d.adresse}</div><div style="text-align:right"><b>AffichÃ© le :</b> ${today()}</div></div>
    <div class="dp-warn-box">âš ï¸ Il est <strong>INTERDIT DE FUMER ET DE VAPOTER</strong> dans tous les locaux clos et couverts de cet Ã©tablissement.</div>
    <p>Cette interdiction s'applique :</p><ul><li>Ã€ l'ensemble des salariÃ©s, clients, fournisseurs et visiteurs</li><li>Dans tous les espaces couverts : bureaux, couloirs, sanitaires, vestiaires, rÃ©fectoires, vÃ©hicules de service</li></ul>
    <p>ConformÃ©ment Ã  l'article L3512-8 du Code de la santÃ© publique, le non-respect de cette interdiction est passible d'une amende de 4Ã¨me classe.</p>
    <div class="dp-section"><div class="dp-section-title">Zone fumeurs dÃ©signÃ©e</div><p>Il n'existe pas de zone fumeurs dans cet Ã©tablissement / La zone fumeurs dÃ©signÃ©e est : _______________</p></div>
    <div class="dp-footer">Document Ã©tabli par ${d.raison} â€” SIRET ${d.siret} â€” Convention collective : ${d.ccn}</div>` },

  { id:'aff_harce',     icon:'ğŸ¤', titre:'PrÃ©vention du harcÃ¨lement',          cat:'affichage', desc:'HarcÃ¨lement moral et sexuel â€” coordonnÃ©es du DÃ©fenseur des droits (L1152-1, L1153-1 CT)', tags:['legal','rgpd'], needsSalarie:false,
    content: (d) => `<h2>HARCÃˆLEMENT MORAL ET SEXUEL â€” INFORMATION DES SALARIÃ‰S</h2><div class="dp-sub">Articles L1152-1 et L1153-1 du Code du travail</div>
    <div class="dp-header"><div><b>${d.raison}</b>${d.adresse}</div><div style="text-align:right">AffichÃ© le : ${today()}</div></div>
    <div class="dp-section"><div class="dp-section-title">ğŸš« HarcÃ¨lement moral (Art. L1152-1 CT)</div>
    <p>Aucun salariÃ© ne doit subir des agissements rÃ©pÃ©tÃ©s ayant pour objet ou effet une dÃ©gradation de ses conditions de travail susceptible de porter atteinte Ã  ses droits, Ã  sa dignitÃ©, d'altÃ©rer sa santÃ© physique ou mentale ou de compromettre son avenir professionnel.</p></div>
    <div class="dp-section"><div class="dp-section-title">ğŸš« HarcÃ¨lement sexuel (Art. L1153-1 CT)</div>
    <p>Aucun salariÃ© ne doit subir des faits qui consistent en des propos ou comportements Ã  connotation sexuelle rÃ©pÃ©tÃ©s, ou tout autre comportement assimilÃ©, qui portent atteinte Ã  sa dignitÃ©.</p></div>
    <div class="dp-section"><div class="dp-section-title">ğŸ“ Contacts utiles</div>
    <table><tr><th>Organisme</th><th>CoordonnÃ©es</th></tr>
    <tr><td>DÃ©fenseur des droits</td><td>09 69 39 00 00 â€” www.defenseurdesdroits.fr</td></tr>
    <tr><td>Inspection du travail</td><td>Ã€ complÃ©ter</td></tr>
    <tr><td>RÃ©fÃ©rent(e) harcÃ¨lement de l'entreprise</td><td>Ã€ dÃ©signer et complÃ©ter</td></tr></table></div>
    <div class="dp-footer">${d.raison} â€” SIRET ${d.siret}</div>` },

  { id:'aff_egalite',   icon:'âš–ï¸', titre:'Ã‰galitÃ© de rÃ©munÃ©ration H/F',       cat:'affichage', desc:'Obligation d\'affichage de l\'Ã©galitÃ© de traitement (Art. L3221-9 CT)', tags:['legal','social'], needsSalarie:false,
    content: (d) => `<h2>Ã‰GALITÃ‰ DE RÃ‰MUNÃ‰RATION ENTRE LES FEMMES ET LES HOMMES</h2><div class="dp-sub">Article L3221-9 du Code du travail</div>
    <div class="dp-header"><div><b>${d.raison}</b>${d.adresse}</div><div style="text-align:right">AffichÃ© le : ${today()}</div></div>
    <p>ConformÃ©ment aux dispositions des articles L3221-1 et suivants du Code du travail, <strong>${d.raison}</strong> garantit Ã  l'ensemble de ses salariÃ©s l'Ã©galitÃ© de rÃ©munÃ©ration entre les femmes et les hommes pour un travail de valeur Ã©gale.</p>
    <div class="dp-section"><div class="dp-section-title">Principe d'Ã©galitÃ© salariale</div>
    <p>Tout employeur est tenu d'assurer, pour un mÃªme travail ou pour un travail de valeur Ã©gale, l'Ã©galitÃ© de rÃ©munÃ©ration entre les femmes et les hommes.</p>
    <p>Sont considÃ©rÃ©s comme ayant une valeur Ã©gale les travaux qui exigent des salariÃ©s un ensemble comparable de connaissances professionnelles consacrÃ©es par un titre, un diplÃ´me ou une pratique professionnelle, de capacitÃ©s dÃ©coulant de l'expÃ©rience acquise, de responsabilitÃ©s et de charge physique ou nerveuse.</p></div>
    <div class="dp-section"><div class="dp-section-title">Recours en cas de discrimination</div>
    <p>Tout salariÃ© estimant Ãªtre victime d'une inÃ©galitÃ© de rÃ©munÃ©ration peut saisir le Conseil de Prud'hommes ou le DÃ©fenseur des droits.</p></div>
    <div class="dp-footer">${d.raison} â€” SIRET ${d.siret} â€” Convention collective : ${d.ccn}</div>` },

  { id:'aff_inspection', icon:'ğŸ›ï¸', titre:'CoordonnÃ©es Inspection du travail', cat:'affichage', desc:'Affichage obligatoire de l\'adresse et nÂ° de tÃ©lÃ©phone de l\'IT (Art. R4711-1 CT)', tags:['legal'], needsSalarie:false,
    content: (d) => `<h2>INSPECTION DU TRAVAIL â€” COORDONNÃ‰ES</h2><div class="dp-sub">Article R4711-1 du Code du travail</div>
    <div class="dp-header"><div><b>${d.raison}</b>${d.adresse}</div><div style="text-align:right">Mis Ã  jour le : ${today()}</div></div>
    <table><tr><th>Organisme</th><th>Adresse</th><th>TÃ©lÃ©phone</th></tr>
    <tr><td><strong>DREETS / DDETS</strong><br><small>(Inspection du travail)</small></td><td>Ã€ complÃ©ter selon dÃ©partement</td><td>Ã€ complÃ©ter</td></tr>
    <tr><td><strong>URSSAF</strong></td><td>Ã€ complÃ©ter</td><td>3957</td></tr>
    <tr><td><strong>MÃ©decin du travail / SSTI</strong></td><td>Ã€ complÃ©ter</td><td>Ã€ complÃ©ter</td></tr>
    <tr><td><strong>CPAM</strong></td><td>Ã€ complÃ©ter</td><td>36 46</td></tr>
    <tr><td><strong>SAMU</strong></td><td>â€”</td><td>15</td></tr>
    <tr><td><strong>Pompiers</strong></td><td>â€”</td><td>18</td></tr>
    <tr><td><strong>Police / Gendarmerie</strong></td><td>â€”</td><td>17</td></tr>
    <tr><td><strong>Urgences europÃ©ennes</strong></td><td>â€”</td><td>112</td></tr></table>
    <div class="dp-footer">${d.raison} â€” SIRET ${d.siret}</div>` },

  { id:'aff_horaires',  icon:'ğŸ•', titre:'Horaires collectifs de travail',     cat:'affichage', desc:'Horaires de travail de l\'Ã©tablissement â€” Art. D3171-1 CT', tags:['legal'], needsSalarie:false,
    content: (d) => `<h2>HORAIRES COLLECTIFS DE TRAVAIL</h2><div class="dp-sub">Article D3171-1 du Code du travail</div>
    <div class="dp-header"><div><b>${d.raison}</b>${d.adresse}</div><div style="text-align:right">En vigueur Ã  compter du : ___________</div></div>
    <table><tr><th>Jour</th><th>Heure de dÃ©but</th><th>Pause dÃ©jeuner</th><th>Heure de fin</th><th>Total heures</th></tr>
    <tr><td>Lundi</td><td>___h___</td><td>___h___ â€” ___h___</td><td>___h___</td><td>___ h</td></tr>
    <tr><td>Mardi</td><td>___h___</td><td>___h___ â€” ___h___</td><td>___h___</td><td>___ h</td></tr>
    <tr><td>Mercredi</td><td>___h___</td><td>___h___ â€” ___h___</td><td>___h___</td><td>___ h</td></tr>
    <tr><td>Jeudi</td><td>___h___</td><td>___h___ â€” ___h___</td><td>___h___</td><td>___ h</td></tr>
    <tr><td>Vendredi</td><td>___h___</td><td>___h___ â€” ___h___</td><td>___h___</td><td>___ h</td></tr>
    <tr><td>Samedi</td><td>___h___</td><td>â€”</td><td>___h___</td><td>___ h</td></tr>
    <tr><td>Dimanche</td><td colspan="4" style="color:var(--muted)">Repos hebdomadaire</td></tr></table>
    <p style="font-size:11px;margin-top:10px">DurÃ©e hebdomadaire de travail : <strong>___ heures</strong> â€” Contingent annuel d'heures supplÃ©mentaires : <strong>___ heures</strong></p>
    <div class="dp-sign"><div class="dp-sign-box"><div class="dp-sign-lbl">Signature employeur</div></div><div class="dp-sign-box"><div class="dp-sign-lbl">Date d'affichage</div></div></div>
    <div class="dp-footer">${d.raison} â€” SIRET ${d.siret} â€” Convention collective : ${d.ccn}</div>` },

  // â”€â”€ PERSONNEL â”€â”€
  { id:'pers_dpae',     icon:'ğŸ“¨', titre:'DPAE â€” DÃ©claration PrÃ©alable Ã  l\'Embauche', cat:'personnel', desc:'Ã€ remettre Ã  l\'URSSAF avant toute embauche (Art. L1221-10 CT)', tags:['legal','social'], needsSalarie:true,
    content: (d) => `<h2>DÃ‰CLARATION PRÃ‰ALABLE Ã€ L'EMBAUCHE (DPAE)</h2><div class="dp-sub">Article L1221-10 du Code du travail â€” Ã€ transmettre Ã  l'URSSAF avant l'embauche</div>
    <div class="dp-header"><div><b>${d.raison}</b><br>${d.adresse}<br>SIRET : ${d.siret}</div><div style="text-align:right">Date : ${today()}</div></div>
    <div class="dp-section"><div class="dp-section-title">SalariÃ© concernÃ©</div>
    <table><tr><th>Nom et prÃ©nom</th><td><span class="dp-field">${d.empNom||'Ã€ complÃ©ter'}</span></td></tr>
    <tr><th>Date de naissance</th><td>___/___/______</td></tr>
    <tr><th>NÂ° SÃ©curitÃ© Sociale</th><td>_ __ __ __ __ __ ___</td></tr>
    <tr><th>Poste occupÃ©</th><td><span class="dp-field">${d.empPoste||'Ã€ complÃ©ter'}</span></td></tr>
    <tr><th>Date d'embauche prÃ©vue</th><td><span class="dp-field">${d.empDateEmbauche||'___/___/______'}</span></td></tr>
    <tr><th>Type de contrat</th><td>â˜ CDI &nbsp;&nbsp; â˜ CDD &nbsp;&nbsp; â˜ Alternance &nbsp;&nbsp; â˜ IntÃ©rim</td></tr>
    <tr><th>DurÃ©e hebdomadaire</th><td>___ heures/semaine</td></tr></table></div>
    <div class="dp-warn-box">âš ï¸ La DPAE doit Ãªtre effectuÃ©e au plus tard le dernier jour ouvrable prÃ©cÃ©dant la date effective d'embauche, via net-entreprises.fr ou par voie postale.</div>
    <div class="dp-sign"><div class="dp-sign-box"><div class="dp-sign-lbl">Signature et cachet employeur</div><br>${d.raison}</div><div class="dp-sign-box"><div class="dp-sign-lbl">AccusÃ© de rÃ©ception URSSAF</div></div></div>
    <div class="dp-footer">${d.raison} â€” SIRET ${d.siret}</div>` },

  { id:'pers_attestation', icon:'ğŸ“‹', titre:'Attestation de travail',          cat:'personnel', desc:'Attestation de prÃ©sence / d\'emploi pour un salariÃ©', tags:['legal'], needsSalarie:true,
    content: (d) => `<h2>ATTESTATION DE TRAVAIL</h2><div class="dp-sub">Document remis sur demande du salariÃ©</div>
    <div class="dp-header"><div><b>${d.raison}</b><br>${d.adresse}<br>SIRET : ${d.siret}<br>Convention collective : ${d.ccn}</div><div style="text-align:right">Fait le : ${today()}</div></div>
    <p>Je soussignÃ©(e), reprÃ©sentant lÃ©gal de <strong>${d.raison}</strong>, certifie que :</p>
    <p><strong><span class="dp-field">${d.empNom||'Nom PrÃ©nom'}</span></strong>, nÃ©(e) le _______________, 
    est employÃ©(e) en qualitÃ© de <span class="dp-field">${d.empPoste||'Poste'}</span> 
    depuis le <span class="dp-field">${d.empDateEmbauche||'date d\'embauche'}</span>.</p>
    <table style="margin:14px 0"><tr><th>Type de contrat</th><td>â˜ CDI &nbsp; â˜ CDD jusqu'au ___________</td></tr>
    <tr><th>DurÃ©e de travail</th><td>___ heures / semaine</td></tr>
    <tr><th>RÃ©munÃ©ration brute mensuelle</th><td>___________ â‚¬ brut</td></tr>
    <tr><th>Statut</th><td>â˜ Ouvrier/EmployÃ© &nbsp; â˜ Agent de maÃ®trise &nbsp; â˜ Cadre</td></tr></table>
    <p>Cette attestation est dÃ©livrÃ©e Ã  l'intÃ©ressÃ©(e) pour faire valoir ce que de droit.</p>
    <div class="dp-sign"><div class="dp-sign-box"><div class="dp-sign-lbl">Signature et cachet employeur</div><br><br>${d.raison}</div><div class="dp-sign-box"><div class="dp-sign-lbl">Lieu et date</div><br><br>Ã€ ____________, le ${today()}</div></div>
    <div class="dp-footer">${d.raison} â€” SIRET ${d.siret}</div>` },

  { id:'pers_remise_bulletin', icon:'ğŸ’¶', titre:'ReÃ§u pour solde de tout compte', cat:'personnel', desc:'Remis lors de la rupture du contrat de travail (Art. L1234-20 CT)', tags:['legal'], needsSalarie:true,
    content: (d) => `<h2>REÃ‡U POUR SOLDE DE TOUT COMPTE</h2><div class="dp-sub">Article L1234-20 du Code du travail</div>
    <div class="dp-header"><div><b>${d.raison}</b><br>${d.adresse}<br>SIRET : ${d.siret}</div><div style="text-align:right">Fait le : ${today()}</div></div>
    <p>Je soussignÃ©(e) <strong><span class="dp-field">${d.empNom||'Nom PrÃ©nom'}</span></strong>, 
    ayant exercÃ© les fonctions de <span class="dp-field">${d.empPoste||'Poste'}</span> 
    au sein de <strong>${d.raison}</strong> du <span class="dp-field">${d.empDateEmbauche||'___'}</span> au <span class="dp-field">___________</span>,</p>
    <p>reconnais avoir reÃ§u de mon employeur la somme totale de <strong>___________ â‚¬ net</strong> en rÃ¨glement dÃ©finitif de tous mes droits affÃ©rents Ã  mon contrat de travail.</p>
    <table style="margin:12px 0"><tr><th>Poste</th><th>Montant net</th></tr>
    <tr><td>Salaire du mois en cours (prorata)</td><td>___________ â‚¬</td></tr>
    <tr><td>IndemnitÃ© compensatrice de congÃ©s payÃ©s</td><td>___________ â‚¬</td></tr>
    <tr><td>IndemnitÃ© de prÃ©avis (si applicable)</td><td>___________ â‚¬</td></tr>
    <tr><td>IndemnitÃ© lÃ©gale / conventionnelle de licenciement</td><td>___________ â‚¬</td></tr>
    <tr><td style="font-weight:700">TOTAL NET versÃ©</td><td style="font-weight:700">___________ â‚¬</td></tr></table>
    <div class="dp-warn-box">âš ï¸ Ce reÃ§u peut Ãªtre dÃ©noncÃ© dans les 6 mois qui suivent sa signature (Art. L1234-20 CT). PassÃ© ce dÃ©lai, il est libÃ©ratoire pour l'employeur.</div>
    <div class="dp-sign"><div class="dp-sign-box"><div class="dp-sign-lbl">Signature salariÃ© â€” "Lu et approuvÃ©"</div></div><div class="dp-sign-box"><div class="dp-sign-lbl">Signature employeur + cachet</div><br>${d.raison}</div></div>
    <div class="dp-footer">${d.raison} â€” SIRET ${d.siret}</div>` },

  { id:'pers_entretien_pro', icon:'ğŸ¯', titre:'Compte-rendu d\'entretien professionnel', cat:'personnel', desc:'Tous les 2 ans obligatoire â€” Art. L6315-1 CT (sanction CPF 3 000â‚¬)', tags:['legal','social'], needsSalarie:true,
    content: (d) => `<h2>COMPTE-RENDU D'ENTRETIEN PROFESSIONNEL</h2><div class="dp-sub">Article L6315-1 du Code du travail â€” Obligatoire tous les 2 ans</div>
    <div class="dp-header"><div><b>${d.raison}</b><br>Convention collective : ${d.ccn}</div><div style="text-align:right">Date de l'entretien : ${today()}</div></div>
    <table style="margin-bottom:12px"><tr><th>SalariÃ©</th><td><span class="dp-field">${d.empNom||'Nom PrÃ©nom'}</span></td><th>Poste</th><td><span class="dp-field">${d.empPoste||'â€”'}</span></td></tr>
    <tr><th>Date d'embauche</th><td><span class="dp-field">${d.empDateEmbauche||'â€”'}</span></td><th>Responsable</th><td>_______________</td></tr></table>
    <div class="dp-section"><div class="dp-section-title">1. Bilan du parcours professionnel</div><p>Ã‰volution de poste depuis le dernier entretien : _______________<br>Formations suivies : _______________<br>CompÃ©tences dÃ©veloppÃ©es : _______________</p></div>
    <div class="dp-section"><div class="dp-section-title">2. Perspectives et souhaits du salariÃ©</div><p>Ã‰volution souhaitÃ©e : _______________<br>Besoins en formation exprimÃ©s : _______________<br>MobilitÃ© envisagÃ©e : â˜ Oui &nbsp; â˜ Non</p></div>
    <div class="dp-section"><div class="dp-section-title">3. Actions convenues</div>
    <table><tr><th>Action</th><th>Ã‰chÃ©ance</th><th>Responsable</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr></table></div>
    <div class="dp-warn-box">ğŸ“Œ Tous les 6 ans, un bilan rÃ©capitulatif doit confirmer que le salariÃ© a bÃ©nÃ©ficiÃ© de l'entretien tous les 2 ans, suivi au moins une formation et acquis un Ã©lÃ©ment de certification ou de progression salariale/professionnelle. Ã€ dÃ©faut : abondement correctif CPF de 3 000 â‚¬.</div>
    <div class="dp-sign"><div class="dp-sign-box"><div class="dp-sign-lbl">Signature salariÃ©</div></div><div class="dp-sign-box"><div class="dp-sign-lbl">Signature employeur</div></div></div>
    <div class="dp-footer">${d.raison} â€” SIRET ${d.siret}</div>` },

  // â”€â”€ SÃ‰CURITÃ‰ â”€â”€
  { id:'secu_consignes', icon:'ğŸ”¥', titre:'Consignes incendie et Ã©vacuation',  cat:'secu', desc:'Affichage obligatoire â€” numÃ©ros urgence + consignes (Art. R4227-28 CT)', tags:['secu'], needsSalarie:false,
    content: (d) => `<h2>CONSIGNES DE SÃ‰CURITÃ‰ INCENDIE</h2><div class="dp-sub">Article R4227-28 du Code du travail â€” Ã€ afficher dans chaque local</div>
    <div class="dp-header"><div><b>${d.raison}</b><br>${d.adresse}</div><div style="text-align:right">Responsable sÃ©curitÃ© : _______________</div></div>
    <div class="dp-warn-box" style="background:#fee2e2;border-color:#f87171;color:#7f1d1d;font-size:13px;font-weight:700;text-align:center">ğŸ”¥ EN CAS D'INCENDIE â€” AGISSEZ VITE ET GARDEZ VOTRE CALME</div>
    <div class="dp-section"><div class="dp-section-title" style="color:#991b1b">ğŸ“ NumÃ©ros d'urgence</div>
    <table><tr><td style="font-weight:700;font-size:18px">ğŸ”¥ 18</td><td>Pompiers</td><td style="font-weight:700;font-size:18px">ğŸš‘ 15</td><td>SAMU</td><td style="font-weight:700;font-size:18px">ğŸš” 17</td><td>Police</td><td style="font-weight:700;font-size:18px">ğŸ†˜ 112</td><td>Urgences europÃ©ennes</td></tr></table></div>
    <div class="dp-section"><div class="dp-section-title">Que faire en cas d'incendie ?</div>
    <ol style="margin-left:16px"><li>Donnez l'alerte â€” appelez le 18 ou actionnez le dÃ©clencheur manuel</li><li>Ã‰vacuez calmement par les sorties de secours indiquÃ©es</li><li>N'empruntez jamais l'ascenseur</li><li>Rejoignez le point de rassemblement : _______________</li><li>Ne rentrez pas dans le bÃ¢timent avant autorisation des secours</li></ol></div>
    <div class="dp-section"><div class="dp-section-title">Emplacement des Ã©quipements de sÃ©curitÃ©</div>
    <p>Extincteurs : _______________ Â· DÃ©clencheurs manuels : _______________ Â· Sorties de secours : _______________</p></div>
    <div class="dp-footer">${d.raison} â€” Exercice d'Ã©vacuation : ____/____/______</div>` },

  { id:'secu_duer',     icon:'ğŸ“‹', titre:'Couverture DUER â€” Document Unique',  cat:'secu', desc:'Page de garde du DUER (Art. R4121-1 CT) â€” Mise Ã  jour annuelle obligatoire', tags:['secu','legal'], needsSalarie:false,
    content: (d) => `<h2>DOCUMENT UNIQUE D'Ã‰VALUATION DES RISQUES PROFESSIONNELS</h2><div class="dp-sub">Article R4121-1 du Code du travail â€” Mise Ã  jour annuelle</div>
    <div class="dp-header"><div><b>${d.raison}</b><br>${d.adresse}<br>SIRET : ${d.siret}<br>Effectif : ___ salariÃ©s</div><div style="text-align:right">Version : ___<br>Date de mise Ã  jour : ${today()}<br>Prochain bilan : ___________</div></div>
    <div class="dp-section"><div class="dp-section-title">Objet du document</div>
    <p>Le prÃ©sent document recense l'ensemble des risques professionnels identifiÃ©s au sein de l'Ã©tablissement conformÃ©ment aux obligations lÃ©gales. Il est mis Ã  jour au moins chaque annÃ©e, lors de toute dÃ©cision d'amÃ©nagement important, ou lors d'information supplÃ©mentaire sur un risque.</p></div>
    <div class="dp-section"><div class="dp-section-title">UnitÃ©s de travail identifiÃ©es</div>
    <table><tr><th>NÂ°</th><th>UnitÃ© de travail</th><th>Nombre de salariÃ©s</th><th>Risques principaux identifiÃ©s</th><th>Niveau de risque</th></tr>
    <tr><td>1</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>â˜ Faible â˜ Moyen â˜ Ã‰levÃ©</td></tr>
    <tr><td>2</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>â˜ Faible â˜ Moyen â˜ Ã‰levÃ©</td></tr>
    <tr><td>3</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>â˜ Faible â˜ Moyen â˜ Ã‰levÃ©</td></tr></table></div>
    <div class="dp-warn-box">âš ï¸ Ce document doit Ãªtre conservÃ© pendant 40 ans. Il est tenu Ã  disposition des salariÃ©s, du CSE, de l'inspection du travail et des services de santÃ© au travail.</div>
    <div class="dp-sign"><div class="dp-sign-box"><div class="dp-sign-lbl">Signature employeur / Direction</div></div><div class="dp-sign-box"><div class="dp-sign-lbl">Visa CSE / ReprÃ©sentant du personnel (si applicable)</div></div></div>
    <div class="dp-footer">${d.raison} â€” SIRET ${d.siret} â€” Conservation : 40 ans</div>` },

  { id:'secu_sst',      icon:'ğŸ©º', titre:'Liste des Sauveteurs Secouristes (SST)', cat:'secu', desc:'Affichage des SST habilitÃ©s dans l\'entreprise (Art. R4224-15 CT)', tags:['secu'], needsSalarie:false,
    content: (d) => `<h2>SAUVETEURS SECOURISTES DU TRAVAIL (SST)</h2><div class="dp-sub">Article R4224-15 du Code du travail</div>
    <div class="dp-header"><div><b>${d.raison}</b><br>${d.adresse}</div><div style="text-align:right">Mis Ã  jour le : ${today()}</div></div>
    <p>Les personnes formÃ©es aux premiers secours et habilitÃ©es Ã  intervenir en cas d'accident sont :</p>
    <table><tr><th>Nom et prÃ©nom</th><th>Poste</th><th>Localisation</th><th>Date de certification</th><th>Renouvellement</th></tr>
    <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
    <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
    <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr></table>
    <p style="margin-top:12px">ğŸ“ En cas d'urgence : <strong>15 (SAMU) Â· 18 (Pompiers) Â· 112 (Urgences)</strong></p>
    <div class="dp-footer">${d.raison} â€” SIRET ${d.siret}</div>` },

  // â”€â”€ RGPD â”€â”€
  { id:'rgpd_info_sal',  icon:'ğŸ”’', titre:'Information RGPD des salariÃ©s',     cat:'rgpd', desc:'Notice d\'information sur le traitement des donnÃ©es personnelles (Art. 13 RGPD)', tags:['rgpd'], needsSalarie:true,
    content: (d) => `<h2>INFORMATION RELATIVE AU TRAITEMENT DE VOS DONNÃ‰ES PERSONNELLES</h2><div class="dp-sub">Articles 13 et 14 du RÃ¨glement GÃ©nÃ©ral sur la Protection des DonnÃ©es (RGPD)</div>
    <div class="dp-header"><div><b>${d.raison}</b><br>${d.adresse}<br>SIRET : ${d.siret}</div><div style="text-align:right">Remis Ã  : <span class="dp-field">${d.empNom||'_______________'}</span><br>Le : ${today()}</div></div>
    <div class="dp-section"><div class="dp-section-title">Responsable du traitement</div><p>${d.raison}, ${d.adresse} â€” Contact : _______________</p></div>
    <div class="dp-section"><div class="dp-section-title">DonnÃ©es traitÃ©es et finalitÃ©s</div>
    <table><tr><th>CatÃ©gorie de donnÃ©es</th><th>FinalitÃ©</th><th>Base lÃ©gale</th><th>DurÃ©e de conservation</th></tr>
    <tr><td>IdentitÃ©, coordonnÃ©es</td><td>Gestion RH, paie</td><td>ExÃ©cution du contrat</td><td>5 ans aprÃ¨s fin contrat</td></tr>
    <tr><td>DonnÃ©es bancaires (RIB)</td><td>Virement salaire</td><td>ExÃ©cution du contrat</td><td>5 ans</td></tr>
    <tr><td>NÂ° SÃ©curitÃ© Sociale</td><td>DÃ©clarations sociales</td><td>Obligation lÃ©gale</td><td>5 ans</td></tr>
    <tr><td>Absences, congÃ©s</td><td>Gestion temps de travail</td><td>ExÃ©cution du contrat</td><td>5 ans</td></tr>
    <tr><td>DonnÃ©es de santÃ© (arrÃªts)</td><td>Gestion des absences</td><td>Obligation lÃ©gale</td><td>5 ans</td></tr></table></div>
    <div class="dp-section"><div class="dp-section-title">Vos droits</div>
    <p>Vous disposez d'un droit d'accÃ¨s, de rectification, d'effacement, de limitation et de portabilitÃ© de vos donnÃ©es. Pour exercer ces droits : _______________<br>Vous pouvez Ã©galement introduire une rÃ©clamation auprÃ¨s de la CNIL (www.cnil.fr â€” 3 Place de Fontenoy, 75007 Paris).</p></div>
    <div class="dp-sign"><div class="dp-sign-box"><div class="dp-sign-lbl">Signature salariÃ© â€” "Lu et reÃ§u"</div></div><div class="dp-sign-box"><div class="dp-sign-lbl">Date de remise</div><br>${today()}</div></div>
    <div class="dp-footer">${d.raison} â€” SIRET ${d.siret}</div>` },

  { id:'rgpd_video',    icon:'ğŸ“¹', titre:'Information vidÃ©osurveillance',      cat:'rgpd', desc:'Panneau d\'information obligatoire si vidÃ©osurveillance (Art. L1222-4 CT + RGPD)', tags:['rgpd','legal'], needsSalarie:false,
    content: (d) => `<h2>INFORMATION â€” SYSTÃˆME DE VIDÃ‰OSURVEILLANCE</h2><div class="dp-sub">Loi nÂ°95-73 du 21 janvier 1995 â€” Article L1222-4 CT â€” Article 13 RGPD</div>
    <div class="dp-header"><div><b>${d.raison}</b><br>${d.adresse}</div><div style="text-align:right">AffichÃ© le : ${today()}</div></div>
    <div class="dp-warn-box" style="font-size:13px;text-align:center">ğŸ“¹ <strong>CET Ã‰TABLISSEMENT EST Ã‰QUIPÃ‰ D'UN SYSTÃˆME DE VIDÃ‰OSURVEILLANCE</strong></div>
    <div class="dp-section"><div class="dp-section-title">Informations sur le traitement</div>
    <table><tr><th>Responsable du traitement</th><td>${d.raison}</td></tr>
    <tr><th>FinalitÃ©</th><td>SÃ©curitÃ© des biens et des personnes, prÃ©vention des actes malveillants</td></tr>
    <tr><th>Destinataires</th><td>Direction, services de sÃ©curitÃ©, autoritÃ©s compÃ©tentes si rÃ©quisition</td></tr>
    <tr><th>DurÃ©e de conservation</th><td>Maximum 30 jours (sauf procÃ©dure judiciaire en cours)</td></tr>
    <tr><th>Autorisation prÃ©fectorale nÂ°</th><td>Ã€ complÃ©ter</td></tr></table></div>
    <div class="dp-section"><div class="dp-section-title">Vos droits</div>
    <p>ConformÃ©ment au RGPD, vous disposez d'un droit d'accÃ¨s aux images vous concernant. Demande Ã  adresser Ã  : _______________<br>Vous pouvez Ã©galement vous adresser Ã  la CNIL : www.cnil.fr</p></div>
    <div class="dp-footer">${d.raison} â€” SIRET ${d.siret}</div>` },

  // â”€â”€ REGISTRES / ADMIN â”€â”€
  { id:'reg_personnel', icon:'ğŸ“š', titre:'Page de garde â€” Registre unique du personnel', cat:'registre', desc:'Couverture obligatoire du RUP (Art. L1221-13 CT)', tags:['legal'], needsSalarie:false,
    content: (d) => `<h2>REGISTRE UNIQUE DU PERSONNEL</h2><div class="dp-sub">Article L1221-13 du Code du travail â€” Document obligatoire dÃ¨s le premier salariÃ©</div>
    <div class="dp-header"><div><b>${d.raison}</b><br>${d.adresse}<br>SIRET : ${d.siret}<br>Convention collective : ${d.ccn}</div><div style="text-align:right">Ouvert le : ___________<br>Tenu par : _______________</div></div>
    <div class="dp-section"><div class="dp-section-title">Obligations lÃ©gales</div>
    <p>Le registre unique du personnel doit mentionner, dans l'ordre des embauches, les informations suivantes pour chaque salariÃ© :</p>
    <ul><li>Identification : nom, prÃ©noms, date de naissance, nationalitÃ©</li><li>Sexe</li><li>Emploi, qualification</li><li>Date d'entrÃ©e et de sortie de l'Ã©tablissement</li><li>Pour les travailleurs Ã©trangers : type et numÃ©ro d'ordre du titre valant autorisation de travail</li><li>Pour les salariÃ©s Ã  temps partiel : mention "salariÃ© Ã  temps partiel"</li><li>Pour les salariÃ©s en CDD et intÃ©rimaires : mention "salariÃ© sous contrat Ã  durÃ©e dÃ©terminÃ©e" ou "salariÃ© temporaire"</li></ul></div>
    <div class="dp-warn-box">âš ï¸ Ce registre doit Ãªtre conservÃ© pendant 5 ans aprÃ¨s le dÃ©part du salariÃ©. Il doit Ãªtre tenu Ã  la disposition de l'inspection du travail, des dÃ©lÃ©guÃ©s du personnel et des reprÃ©sentants syndicaux.</div>
    <table style="margin-top:12px"><tr><th>Date</th><th>Nom PrÃ©nom</th><th>NationalitÃ©</th><th>Emploi</th><th>Qualification</th><th>Contrat</th><th>EntrÃ©e</th><th>Sortie</th></tr>
    <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr></table>
    <div class="dp-footer">${d.raison} â€” Conservation : 5 ans aprÃ¨s dÃ©part du dernier salariÃ© inscrit</div>` },

  { id:'reg_accidents',  icon:'ğŸ©¹', titre:'Registre des accidents du travail bÃ©nins', cat:'registre', desc:'Registre AT sans arrÃªt (Art. L441-4 CSS) â€” en lieu et place de dÃ©claration', tags:['secu','legal'], needsSalarie:false,
    content: (d) => `<h2>REGISTRE DES ACCIDENTS DU TRAVAIL BÃ‰NINS</h2><div class="dp-sub">Article L441-4 du Code de la SÃ©curitÃ© Sociale â€” Tenu avec accord de la CARSAT</div>
    <div class="dp-header"><div><b>${d.raison}</b><br>${d.adresse}<br>SIRET : ${d.siret}</div><div style="text-align:right">Ouvert le : ___________<br>NÂ° accord CARSAT : _______________</div></div>
    <div class="dp-section"><div class="dp-section-title">Rappel â€” Conditions d'utilisation</div>
    <p>Ce registre ne peut Ãªtre utilisÃ© qu'avec l'accord de la CARSAT compÃ©tente. Il permet d'inscrire les accidents du travail n'entraÃ®nant ni arrÃªt de travail, ni soins mÃ©dicaux pris en charge par la SÃ©curitÃ© Sociale.</p></div>
    <table><tr><th>Date</th><th>Nom, PrÃ©nom</th><th>Nature et siÃ¨ge de la lÃ©sion</th><th>Circonstances</th><th>TÃ©moins</th><th>Visa victime</th><th>Visa employeur</th></tr>
    <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
    <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>
    <tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr></table>
    <div class="dp-warn-box">âš ï¸ Ce registre doit Ãªtre prÃ©sentÃ© Ã  tout moment Ã  l'inspection du travail et aux agents de la CARSAT. Conservation : 5 ans.</div>
    <div class="dp-footer">${d.raison} â€” SIRET ${d.siret} â€” Conservation : 5 ans</div>` },

  // â”€â”€ CONTRATS â”€â”€
  { id:'cont_avenant',  icon:'âœï¸', titre:'Avenant au contrat de travail',      cat:'contrat', desc:'Modification d\'un Ã©lÃ©ment essentiel du contrat (Art. L1222-6 CT)', tags:['legal'], needsSalarie:true,
    content: (d) => `<h2>AVENANT AU CONTRAT DE TRAVAIL</h2><div class="dp-sub">Article L1222-6 du Code du travail</div>
    <div class="dp-header"><div><b>${d.raison}</b><br>${d.adresse}<br>SIRET : ${d.siret}</div><div style="text-align:right">Fait le : ${today()}</div></div>
    <p>Entre :</p>
    <p><strong>${d.raison}</strong>, reprÃ©sentÃ©e par _______________, en qualitÃ© de _______________,<br>
    d'une part,</p>
    <p>Et :</p>
    <p><strong><span class="dp-field">${d.empNom||'Nom PrÃ©nom'}</span></strong>, salariÃ©(e) exerÃ§ant les fonctions de <span class="dp-field">${d.empPoste||'Poste actuel'}</span> depuis le <span class="dp-field">${d.empDateEmbauche||'___________'}</span>,<br>
    d'autre part,</p>
    <p>Il a Ã©tÃ© convenu ce qui suit :</p>
    <div class="dp-section"><div class="dp-section-title">Article 1 â€” Objet de l'avenant</div>
    <p>Ã€ compter du _______________, les conditions suivantes sont modifiÃ©es :</p>
    <table><tr><th>Ã‰lÃ©ment modifiÃ©</th><th>Ancienne valeur</th><th>Nouvelle valeur</th></tr>
    <tr><td>â˜ Poste / qualification</td><td>&nbsp;</td><td>&nbsp;</td></tr>
    <tr><td>â˜ RÃ©munÃ©ration</td><td>&nbsp;</td><td>&nbsp;</td></tr>
    <tr><td>â˜ DurÃ©e de travail</td><td>&nbsp;</td><td>&nbsp;</td></tr>
    <tr><td>â˜ Lieu de travail</td><td>&nbsp;</td><td>&nbsp;</td></tr></table></div>
    <div class="dp-section"><div class="dp-section-title">Article 2 â€” Dispositions inchangÃ©es</div>
    <p>Toutes les autres dispositions du contrat de travail initial et de ses avenants Ã©ventuels restent inchangÃ©es.</p></div>
    <div class="dp-warn-box">âš ï¸ Cet avenant doit Ãªtre signÃ© par les deux parties pour Ãªtre valable. La modification d'un Ã©lÃ©ment essentiel du contrat ne peut Ãªtre imposÃ©e au salariÃ©.</div>
    <div class="dp-sign"><div class="dp-sign-box"><div class="dp-sign-lbl">Le salariÃ© â€” "Lu et approuvÃ©"<br><span class="dp-field">${d.empNom||'Nom PrÃ©nom'}</span></div></div><div class="dp-sign-box"><div class="dp-sign-lbl">L'employeur â€” Signature + cachet<br>${d.raison}</div></div></div>
    <div class="dp-footer">${d.raison} â€” SIRET ${d.siret}</div>` },

  { id:'cont_teletravail', icon:'ğŸ ', titre:'Accord de tÃ©lÃ©travail',           cat:'contrat', desc:'Charte ou accord individuel de tÃ©lÃ©travail (Art. L1222-9 CT)', tags:['legal'], needsSalarie:true,
    content: (d) => `<h2>ACCORD INDIVIDUEL DE TÃ‰LÃ‰TRAVAIL</h2><div class="dp-sub">Article L1222-9 du Code du travail</div>
    <div class="dp-header"><div><b>${d.raison}</b><br>${d.adresse}<br>SIRET : ${d.siret}</div><div style="text-align:right">Date d'effet : ${today()}</div></div>
    <p>Entre <strong>${d.raison}</strong> et <strong><span class="dp-field">${d.empNom||'Nom PrÃ©nom'}</span></strong>, <span class="dp-field">${d.empPoste||'Poste'}</span>, il est convenu des modalitÃ©s de tÃ©lÃ©travail suivantes :</p>
    <div class="dp-section"><div class="dp-section-title">Article 1 â€” ModalitÃ©s du tÃ©lÃ©travail</div>
    <table><tr><th>Jours de tÃ©lÃ©travail</th><td>___ jour(s) par semaine â€” Jour(s) fixe(s) : _______________</td></tr>
    <tr><th>Lieu de tÃ©lÃ©travail</th><td>Domicile principal : _______________</td></tr>
    <tr><th>Plages horaires</th><td>Identiques aux horaires habituels : ___h___ â€” ___h___</td></tr>
    <tr><th>Date de dÃ©but</th><td>___________</td></tr>
    <tr><th>PÃ©riode d'adaptation</th><td>___ mois â€” RÃ©versibilitÃ© possible avec prÃ©avis de ___ jours</td></tr></table></div>
    <div class="dp-section"><div class="dp-section-title">Article 2 â€” Ã‰quipements</div>
    <p>â˜ L'employeur fournit : _______________ &nbsp;&nbsp; â˜ Le salariÃ© utilise son propre matÃ©riel (indemnisation : ___â‚¬/mois)</p></div>
    <div class="dp-section"><div class="dp-section-title">Article 3 â€” Droit Ã  la dÃ©connexion</div>
    <p>Le salariÃ© bÃ©nÃ©ficie d'un droit Ã  la dÃ©connexion en dehors de ses plages horaires de travail. Aucune rÃ©ponse ne peut lui Ãªtre exigÃ©e en dehors des horaires dÃ©finis ci-dessus.</p></div>
    <div class="dp-sign"><div class="dp-sign-box"><div class="dp-sign-lbl">SalariÃ© â€” "Lu et approuvÃ©"<br><span class="dp-field">${d.empNom||'Nom PrÃ©nom'}</span></div></div><div class="dp-sign-box"><div class="dp-sign-lbl">Employeur<br>${d.raison}</div></div></div>
    <div class="dp-footer">${d.raison} â€” SIRET ${d.siret}</div>` },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDU DE LA GRILLE DOCUMENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDocGrid(filter) {
  filter = filter || 'all';
  const docs = filter === 'all' ? DOCS_CATALOGUE : DOCS_CATALOGUE.filter(d => d.cat === filter);
  if (!docs.length) return '<div style="padding:20px;text-align:center;color:var(--muted)">Aucun document dans cette catÃ©gorie.</div>';
  const typeLabels = {affichage:'ğŸ“‹ Affichage',personnel:'ğŸ‘¤ Personnel',secu:'ğŸ¦º SÃ©curitÃ©',rgpd:'ğŸ”’ RGPD',contrat:'ğŸ“ Contrat',registre:'ğŸ“š Registre'};
  return docs.map(doc => `
    <div class="doc-card" onclick="openPdfDrawer('${doc.id}')">
      <div class="doc-card-icon">${doc.icon}</div>
      <div class="doc-card-title">${doc.titre}</div>
      <div class="doc-card-desc">${doc.desc}</div>
      <div class="doc-card-footer">
        <span class="doc-card-type dtype-${doc.cat}">${typeLabels[doc.cat]||doc.cat}</span>
        ${doc.needsSalarie ? '<span style="font-size:9px;font-weight:700;background:#f0fdf4;color:#166534;padding:2px 6px;border-radius:8px">ğŸ‘¤ SalariÃ©</span>' : ''}
      </div>
    </div>`).join('');
}

function filterDocs(cat, btn) {
  document.querySelectorAll('.doc-filter-btn').forEach(b => b.classList.remove('active'));
  if (btn) btn.classList.add('active');
  const grid = document.getElementById('doc-grid');
  if (grid) grid.innerHTML = renderDocGrid(cat);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DRAWER PDF â€” OUVERTURE / FERMETURE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openPdfDrawer(docId) {
  const docDef = DOCS_CATALOGUE.find(d => d.id === docId);
  if (!docDef) return;
  _currentDocId = docId;
  _pdfDocDef    = docDef;

  document.getElementById('pdf-doc-icon').textContent  = docDef.icon;
  document.getElementById('pdf-doc-title').textContent = docDef.titre;

  // PrÃ©-remplir depuis les donnÃ©es chargÃ©es
  const params = _rhParams || {};
  document.getElementById('pdf-raison').value     = params.raisonSociale  || '';
  document.getElementById('pdf-adresse').value    = params.adresse        || '';
  document.getElementById('pdf-siret').value      = params.siret          || '';
  document.getElementById('pdf-ccn-label').value  = (getCcnInfo(params.ccn)||{}).label || '';

  // Remplir la liste des salariÃ©s
  const sel = document.getElementById('pdf-salarie-sel');
  sel.innerHTML = '<option value="">â€” Entreprise uniquement â€”</option>';
  empList.forEach(e => {
    const opt = document.createElement('option');
    opt.value = e.id || e.uid || '';
    opt.textContent = `${e.prenom||''} ${e.nom||''} â€” ${e.poste||''}`;
    sel.appendChild(opt);
  });

  // Si un salariÃ© est dÃ©jÃ  sÃ©lectionnÃ© dans la page, le prÃ©-sÃ©lectionner
  if (_selectedEmpId) {
    sel.value = _selectedEmpId;
    onPdfSalarieSel(_selectedEmpId);
  }

  // Afficher / masquer le groupe salariÃ©
  const sGrp = document.getElementById('pdf-salarie-grp');
  if (sGrp) sGrp.style.display = docDef.needsSalarie ? 'block' : 'block'; // toujours visible

  document.getElementById('pdf-overlay').classList.add('show');
  refreshPreview();
}

function closePdfDrawer() {
  document.getElementById('pdf-overlay').classList.remove('show');
  _currentDocId = null;
  _pdfDocDef    = null;
}

function onPdfSalarieSel(uid) {
  const flds = document.getElementById('pdf-salarie-fields');
  if (!uid) {
    if (flds) flds.style.display = 'none';
    refreshPreview();
    return;
  }
  const emp = empList.find(e => (e.id||e.uid) === uid);
  if (emp) {
    document.getElementById('pdf-emp-nom').value          = `${emp.prenom||''} ${emp.nom||''}`.trim();
    document.getElementById('pdf-emp-poste').value        = emp.poste || '';
    document.getElementById('pdf-emp-date-embauche').value = emp.dateEmbauche || emp.derniereEmbauche || '';
  }
  if (flds) flds.style.display = 'block';
  refreshPreview();
}

function getPdfData() {
  return {
    raison   : document.getElementById('pdf-raison').value    || '[Raison sociale]',
    adresse  : document.getElementById('pdf-adresse').value   || '[Adresse]',
    siret    : document.getElementById('pdf-siret').value     || '[SIRET]',
    ccn      : document.getElementById('pdf-ccn-label').value || '[Convention collective]',
    empNom   : document.getElementById('pdf-emp-nom').value   || '',
    empPoste : document.getElementById('pdf-emp-poste').value || '',
    empDateEmbauche: document.getElementById('pdf-emp-date-embauche').value || '',
  };
}

function refreshPreview() {
  if (!_pdfDocDef) return;
  const data = getPdfData();
  const html  = _pdfDocDef.content(data);
  const zone  = document.getElementById('pdf-preview-zone');
  if (zone) zone.innerHTML = `<div class="doc-preview">${html}</div>`;
  // Sync print zone aussi
  document.getElementById('print-zone').innerHTML = `<div style="font-family:'Plus Jakarta Sans',sans-serif;font-size:11pt;color:#000;line-height:1.7">${html}</div>`;
}

// Ã‰couter les changements dans le formulaire pour actualiser l'aperÃ§u
document.addEventListener('input', function(e) {
  if (e.target && e.target.closest && e.target.closest('.pdf-left')) {
    clearTimeout(window._pdfRefreshTimer);
    window._pdfRefreshTimer = setTimeout(refreshPreview, 400);
  }
});

function printDocument() {
  refreshPreview();
  setTimeout(() => window.print(), 200);
}

function today() {
  return new Date().toLocaleDateString('fr-FR', {day:'2-digit',month:'long',year:'numeric'});
}

function getCcnInfo(ccnId) {
  const CCN_LIST = [
    {id:'chr',label:'CHR â€” HÃ´tels, CafÃ©s, Restaurants (IDCC 1979)',idcc:'1979'},
    {id:'commerce',label:'Commerce de dÃ©tail (IDCC 1486)',idcc:'1486'},
    {id:'boulangerie',label:'Boulangerie-PÃ¢tisserie artisanale (IDCC 843)',idcc:'843'},
    {id:'btp',label:'BTP â€” Ouvriers (IDCC 1597)',idcc:'1597'},
    {id:'coiffure',label:'Coiffure (IDCC 2596)',idcc:'2596'},
    {id:'transport_routier',label:'Transports routiers (IDCC 16)',idcc:'16'},
  ];
  return CCN_LIST.find(c => c.id === ccnId) || {label: ccnId||'Code du travail', idcc: ''};
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SALARIÃ‰ CLIQUABLE â†’ FICHE CONFORMITÃ‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openFicheSalarie(uid, nom) {
  _selectedEmpId = uid;

  // Mettre Ã  jour la sÃ©lection visuelle dans le panneau gauche
  document.querySelectorAll('.emp-conf-item').forEach(el => el.classList.remove('selected'));
  // Re-render list pour reflÃ©ter la sÃ©lection (ou juste toggler la classe)
  event && event.currentTarget && event.currentTarget.classList.add('selected');

  const emp = empList.find(e => (e.id||e.uid) === uid);
  if (!emp) return;

  const section = document.getElementById('section-fiche-salarie');
  const body    = document.getElementById('body-fiche-salarie');
  const title   = document.getElementById('fiche-salarie-title');
  if (!section || !body) return;

  title.textContent = `ğŸ‘¤ ${nom} â€” Fiche de conformitÃ©`;
  section.style.display = 'block';
  body.innerHTML = renderFicheSalarie(emp);

  // Scroller vers la fiche
  setTimeout(() => section.scrollIntoView({behavior:'smooth', block:'start'}), 100);
}

function closeFicheSalarie() {
  _selectedEmpId = null;
  const section = document.getElementById('section-fiche-salarie');
  if (section) section.style.display = 'none';
  document.querySelectorAll('.emp-conf-item').forEach(el => el.classList.remove('selected'));
}

function renderFicheSalarie(emp) {
  const COLORS = ['#059669','#3b82f6','#8b5cf6','#f59e0b','#ef4444','#14b8a6'];
  const ci = (emp.prenom||'A').charCodeAt(0) % COLORS.length;
  const init = ((emp.prenom||'')[0]||'').toUpperCase() + ((emp.nom||'')[0]||'').toUpperCase();
  const nom = `${emp.prenom||''} ${emp.nom||''}`.trim();

  const checks = [
    { id:'contrat', icon:'ğŸ“', label:'Contrat de travail', check: () => (emp.documents||[]).some(d=>d.type==='contrat') ? {ok:true,msg:'Contrat enregistrÃ©'} : {ok:false,msg:'Aucun contrat enregistrÃ© dans les documents RH'} },
    { id:'cni', icon:'ğŸªª', label:'PiÃ¨ce d\'identitÃ©', check: () => (emp.documents||[]).some(d=>d.type==='cni') ? {ok:true,msg:'CNI / Titre de sÃ©jour enregistrÃ©'} : {ok:null,msg:'Non enregistrÃ© â€” vÃ©rifier manuellement'} },
    { id:'rib', icon:'ğŸ’³', label:'RIB', check: () => (emp.documents||[]).some(d=>d.type==='rib') ? {ok:true,msg:'RIB enregistrÃ©'} : {ok:null,msg:'RIB non enregistrÃ©'} },
    { id:'vitale', icon:'ğŸ’š', label:'Carte vitale', check: () => (emp.documents||[]).some(d=>d.type==='vitale') ? {ok:true,msg:'Copie enregistrÃ©e'} : {ok:null,msg:'Non enregistrÃ©e'} },
    { id:'mutuelle', icon:'ğŸ¥', label:'Attestation mutuelle', check: () => emp.mutuelle ? {ok:true,msg:'Mutuelle : '+emp.mutuelle} : {ok:null,msg:'Mutuelle non renseignÃ©e'} },
    { id:'visite_med', icon:'ğŸ©º', label:'Visite mÃ©dicale', check: () => {
        if (emp.prochaineSuiviMedical) return {ok:true, msg:`Prochaine visite : ${new Date(emp.prochaineSuiviMedical).toLocaleDateString('fr-FR')}`};
        if (emp.dateVisiteMedicale) return {ok:null, msg:`DerniÃ¨re visite : ${new Date(emp.dateVisiteMedicale).toLocaleDateString('fr-FR')} â€” Planifier la prochaine`};
        return {ok:false, msg:'Aucune visite mÃ©dicale renseignÃ©e'};
    }},
    { id:'entretien_pro', icon:'ğŸ¯', label:'Entretien professionnel', check: () => {
        if (!emp.derniereEmbauche) return {ok:null, msg:'Date d\'embauche inconnue'};
        const years = (new Date() - new Date(emp.derniereEmbauche)) / (365.25*24*3600*1000);
        if (years < 2) return {ok:true, msg:`EmbauchÃ©(e) il y a ${years.toFixed(1)} an(s) â€” Entretien Ã  planifier avant le ${new Date(new Date(emp.derniereEmbauche).setFullYear(new Date(emp.derniereEmbauche).getFullYear()+2)).toLocaleDateString('fr-FR')}`};
        if (years < 3) return {ok:null, msg:`âš ï¸ Entretien professionnel dÃ» depuis ${Math.floor((years-2)*12)} mois`};
        return {ok:false, msg:`âŒ Entretien professionnel en retard de ${Math.floor((years-2)*12)} mois (risque pÃ©nalitÃ© CPF 3 000â‚¬)`};
    }},
    { id:'dpae', icon:'ğŸ“¨', label:'DPAE effectuÃ©e', check: () => emp.dpaeDate ? {ok:true, msg:`DPAE effectuÃ©e le ${new Date(emp.dpaeDate).toLocaleDateString('fr-FR')}`} : {ok:null, msg:'DPAE non renseignÃ©e dans la fiche'} },
  ];

  const docs_pertinents = DOCS_CATALOGUE.filter(d => d.needsSalarie);

  return `
    <div style="padding:16px">
      <!-- EN-TÃŠTE SALARIÃ‰ -->
      <div style="display:flex;align-items:center;gap:16px;padding:16px;background:var(--rh-ghost);border-radius:10px;margin-bottom:16px">
        <div style="width:52px;height:52px;border-radius:12px;background:${COLORS[ci]};display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:700;color:white;flex-shrink:0">${init}</div>
        <div style="flex:1">
          <div style="font-size:17px;font-weight:800;color:var(--text)">${nom}</div>
          <div style="font-size:12px;color:var(--muted)">${emp.poste||'Poste non renseignÃ©'} Â· ${emp.typeContrat||'CDI'}</div>
          <div style="font-size:11px;color:var(--muted)">EmbauchÃ©(e) le ${emp.dateEmbauche||emp.derniereEmbauche ? new Date(emp.dateEmbauche||emp.derniereEmbauche).toLocaleDateString('fr-FR') : 'â€”'}</div>
        </div>
        <div style="display:flex;gap:8px">
          <a href="rh-employes.html" class="btn btn-outline btn-sm" style="text-decoration:none">ğŸ“‹ Fiche complÃ¨te</a>
          <button class="btn btn-primary btn-sm" onclick="openPdfDrawerForEmp('${emp.id||emp.uid||''}')">ğŸ“„ GÃ©nÃ©rer doc PDF</button>
        </div>
      </div>

      <!-- CHECKLIST CONFORMITÃ‰ -->
      <div style="font-size:12px;font-weight:700;color:var(--text);margin-bottom:10px">Checklist de conformitÃ©</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:16px">
        ${checks.map(c => {
          const res = c.check();
          const color = res.ok === true ? '#059669' : res.ok === false ? '#ef4444' : '#f59e0b';
          const bg    = res.ok === true ? '#f0fdf4' : res.ok === false ? '#fef2f2' : '#fffbeb';
          const icon  = res.ok === true ? 'âœ…' : res.ok === false ? 'âŒ' : 'âš ï¸';
          return `<div style="padding:10px 12px;border-radius:8px;background:${bg};border:1px solid ${color}22;display:flex;align-items:flex-start;gap:8px">
            <span style="font-size:14px;flex-shrink:0">${icon}</span>
            <div>
              <div style="font-size:11px;font-weight:700;color:var(--text)">${c.icon} ${c.label}</div>
              <div style="font-size:10px;color:${color};margin-top:2px">${res.msg}</div>
            </div>
          </div>`;
        }).join('')}
      </div>

      <!-- DOCUMENTS Ã€ GÃ‰NÃ‰RER POUR CE SALARIÃ‰ -->
      <div style="font-size:12px;font-weight:700;color:var(--text);margin-bottom:10px">Documents Ã  gÃ©nÃ©rer pour ${nom}</div>
      <div style="display:flex;flex-wrap:wrap;gap:8px">
        ${docs_pertinents.map(doc => `
          <button onclick="openPdfDrawer('${doc.id}'); document.getElementById('pdf-salarie-sel').value='${emp.id||emp.uid||''}'; onPdfSalarieSel('${emp.id||emp.uid||''}')" 
                  style="display:flex;align-items:center;gap:6px;padding:7px 12px;border:1.5px solid var(--border);border-radius:8px;background:white;cursor:pointer;font-size:11px;font-weight:600;color:var(--text);transition:all .15s" 
                  onmouseover="this.style.borderColor='var(--rh-main)';this.style.background='var(--rh-ghost)'" 
                  onmouseout="this.style.borderColor='var(--border)';this.style.background='white'">
            ${doc.icon} ${doc.titre}
          </button>`).join('')}
      </div>
    </div>`;
}

function openPdfDrawerForEmp(uid) {
  // Ouvre le drawer avec ce salariÃ© sÃ©lectionnÃ© â€” laisse choisir le type de document
  _selectedEmpId = uid;
  // Proposer un choix de document
  openPdfDrawer('pers_attestation');
  setTimeout(() => {
    const sel = document.getElementById('pdf-salarie-sel');
    if (sel) { sel.value = uid; onPdfSalarieSel(uid); }
  }, 100);
}

window.filterDocs         = filterDocs;
window.openPdfDrawer      = openPdfDrawer;
window.closePdfDrawer     = closePdfDrawer;
window.onPdfSalarieSel    = onPdfSalarieSel;
window.refreshPreview     = refreshPreview;
window.printDocument      = printDocument;
window.openFicheSalarie   = openFicheSalarie;
window.closeFicheSalarie  = closeFicheSalarie;
window.openPdfDrawerForEmp= openPdfDrawerForEmp;

window.saveAll = saveAll;
window.setStatut = setStatut;
window.openModalNote = openModalNote;
window.closeModalNote = closeModalNote;
window.saveNote = saveNote;
window.toggleSection = toggleSection;
window.scrollToSection = scrollToSection;
window.toggleSidebar = toggleSidebar;
window.closeSidebar = closeSidebar;
</script>

<script src="nav.js"></script>
</body>
</html>
