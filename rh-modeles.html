<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover"/>
  <title>ALTEORE ‚Äî Mod√®les de documents RH</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"/>
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    :root{
      --blue-dark:#0f1f5c;--blue-main:#1a3dce;--blue-light:#4f7ef8;--blue-ghost:#f0f4ff;
      --text:#1a1f36;--muted:#6b7280;--border:#e2e8f0;--bg:#f5f7ff;--sidebar-w:252px;--radius:12px;
      --green:#10b981;--green-light:#d1fae5;--orange:#f59e0b;--orange-light:#fef3c7;
      --red:#ef4444;--red-light:#fee2e2;--purple:#6366f1;--purple-light:#eef2ff;
    }
    html,body{overflow-x:hidden;max-width:100vw;}
    body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg);color:var(--text);display:flex;min-height:100vh;font-size:13px;}
    .main{margin-left:var(--sidebar-w);flex:1;display:flex;flex-direction:column;min-width:0;}
    .topbar{background:white;border-bottom:1px solid var(--border);padding:14px 28px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50;}
    .topbar-left h1{font-size:17px;font-weight:700;}
    .topbar-left p{font-size:12px;color:var(--muted);margin-top:2px;}
    .topbar-right{display:flex;align-items:center;gap:10px;}
    .btn{padding:8px 16px;border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:all .18s;}
    .btn-primary{background:linear-gradient(135deg,var(--blue-main),var(--blue-light));color:white;box-shadow:0 3px 10px rgba(26,61,206,.25);}
    .btn-primary:hover{opacity:.9;transform:translateY(-1px);}
    .btn-outline{background:white;color:var(--blue-main);border:1.5px solid var(--border);}
    .btn-outline:hover{border-color:var(--blue-main);background:var(--blue-ghost);}
    .btn-ai{background:linear-gradient(135deg,#7c3aed,#a855f7);color:white;box-shadow:0 3px 12px rgba(124,58,237,.3);}
    .btn-ai:hover{opacity:.9;transform:translateY(-1px);}
    .btn-success{background:linear-gradient(135deg,#10b981,#34d399);color:white;}
    .btn-sm{padding:5px 12px;font-size:12px;}
    .btn-xs{padding:3px 8px;font-size:11px;}
    .content{padding:22px 28px;flex:1;display:flex;flex-direction:column;gap:20px;}

    /* STATS */
    .stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;}
    .stat-card{background:white;border:1px solid var(--border);border-radius:var(--radius);padding:14px 18px;display:flex;align-items:center;gap:12px;}
    .stat-icon{width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;}
    .stat-val{font-size:22px;font-weight:800;color:var(--text);}
    .stat-lbl{font-size:11px;color:var(--muted);font-weight:500;}

    /* BARRE RECHERCHE */
    .search-bar{position:relative;}
    .search-bar input{width:100%;padding:9px 12px 9px 36px;border:1.5px solid var(--border);border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;outline:none;background:white;}
    .search-bar input:focus{border-color:var(--blue-main);}
    .search-icon{position:absolute;left:11px;top:50%;transform:translateY(-50%);font-size:14px;pointer-events:none;}

    /* THEMES */
    .themes-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;}
    .theme-card{background:white;border:2px solid var(--border);border-radius:14px;padding:18px;cursor:pointer;transition:all .2s;position:relative;overflow:hidden;}
    .theme-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--tc,#4f7ef8);}
    .theme-card:hover{border-color:var(--tc,#4f7ef8);transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.08);}
    .theme-card.active{border-color:var(--tc,#4f7ef8);background:var(--tb,#f0f4ff);}
    .theme-icon-wrap{width:42px;height:42px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:22px;background:var(--tb,#f0f4ff);margin-bottom:10px;}
    .theme-name{font-size:13px;font-weight:700;margin-bottom:3px;}
    .theme-count{font-size:11px;color:var(--muted);}
    .theme-count strong{color:var(--tc,var(--blue-main));}
    .theme-examples{display:flex;flex-wrap:wrap;gap:4px;margin-top:8px;}
    .theme-ex{font-size:10px;padding:2px 7px;border-radius:8px;background:#f1f5f9;color:var(--muted);}

    /* DOCS GRID */
    .docs-section{background:white;border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;}
    .docs-section-head{padding:14px 18px;background:#f8faff;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
    .docs-section-title{font-size:14px;font-weight:700;display:flex;align-items:center;gap:8px;}
    .docs-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:0;background:var(--border);}
    .doc-card{background:white;padding:16px;cursor:pointer;transition:background .15s;position:relative;gap:1px;}
    .doc-card:hover{background:#f8faff;}
    .doc-card.active{background:var(--blue-ghost);}
    .doc-card-top{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:8px;}
    .doc-icon{font-size:22px;}
    .doc-badge{font-size:9px;font-weight:700;padding:2px 7px;border-radius:10px;}
    .badge-disciplinaire{background:#fee2e2;color:#991b1b;}
    .badge-legal{background:#dcfce7;color:#166534;}
    .badge-admin{background:#fef3c7;color:#92400e;}
    .badge-entretien{background:#dbeafe;color:#1e40af;}
    .badge-culture{background:#f3e8ff;color:#6b21a8;}
    .doc-name{font-size:12px;font-weight:700;margin-bottom:3px;line-height:1.4;}
    .doc-sub{font-size:11px;color:var(--muted);line-height:1.4;}
    .doc-tags{display:flex;flex-wrap:wrap;gap:4px;margin-top:8px;}
    .doc-tag{font-size:9px;padding:1px 6px;border-radius:8px;background:#f1f5f9;color:var(--muted);font-weight:600;}
    .doc-fav{position:absolute;top:10px;right:10px;background:none;border:none;font-size:14px;cursor:pointer;opacity:.35;transition:.15s;padding:2px;}
    .doc-fav:hover,.doc-fav.on{opacity:1;}

    /* PANEL */
    .doc-panel{background:white;border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;}
    .doc-panel-head{padding:20px 24px;border-bottom:1px solid var(--border);}
    .doc-big-title{font-size:19px;font-weight:800;display:flex;align-items:center;gap:10px;margin-bottom:6px;}
    .doc-desc{font-size:12px;color:var(--muted);line-height:1.6;margin-bottom:12px;}
    .legal-banner{background:linear-gradient(135deg,#eff6ff,#f0fdf4);border:1px solid #bfdbfe;border-radius:10px;padding:11px 15px;display:flex;align-items:flex-start;gap:9px;}
    .legal-banner-text{font-size:11px;color:#1e40af;line-height:1.5;}

    /* FORM */
    .form-section{background:white;border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;}
    .form-section-head{padding:13px 18px;background:#f8faff;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
    .form-section-title{font-size:13px;font-weight:700;display:flex;align-items:center;gap:7px;}
    .prefill-bar{display:flex;gap:8px;padding:10px 18px;background:#fafbff;border-bottom:1px solid var(--border);flex-wrap:wrap;align-items:center;}
    .prefill-lbl{font-size:11px;font-weight:600;color:var(--muted);}
    .prefill-btn{display:flex;align-items:center;gap:5px;padding:5px 11px;border:1.5px solid var(--border);border-radius:8px;background:white;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:600;cursor:pointer;color:var(--text);transition:all .15s;}
    .prefill-btn:hover{border-color:var(--blue-main);background:var(--blue-ghost);color:var(--blue-main);}
    .form-body{padding:18px;}
    .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    .form-field{display:flex;flex-direction:column;gap:4px;}
    .form-field.full{grid-column:1/-1;}
    .form-label{font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.3px;}
    .form-label span{color:var(--red);margin-left:2px;}
    .form-input{padding:8px 11px;border:1.5px solid var(--border);border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;color:var(--text);outline:none;background:white;transition:border-color .15s;}
    .form-input:focus{border-color:var(--blue-main);box-shadow:0 0 0 3px rgba(79,126,248,.1);}
    .form-textarea{resize:vertical;min-height:72px;line-height:1.5;}
    .form-select{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%236b7280' fill='none' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;padding-right:30px;}

    /* GEN BAR */
    .gen-bar{background:linear-gradient(135deg,#1e1b4b,#312e81);border-radius:var(--radius);padding:18px 22px;display:flex;align-items:center;justify-content:space-between;gap:16px;}
    .gen-bar-text h3{font-size:14px;font-weight:700;color:white;margin-bottom:3px;}
    .gen-bar-text p{font-size:12px;color:rgba(255,255,255,.6);}
    .gen-bar-actions{display:flex;gap:8px;flex-shrink:0;}

    /* R√âSULTAT */
    .result-doc{background:white;border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;}
    .result-head{padding:13px 18px;background:linear-gradient(135deg,#f0fdf4,#dcfce7);border-bottom:1px solid #bbf7d0;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;}
    .result-title{font-size:13px;font-weight:700;color:#166534;display:flex;align-items:center;gap:7px;}
    .doc-content-wrap{padding:28px 36px;min-height:240px;}
    .doc-content{font-size:13px;line-height:1.9;color:var(--text);}
    .doc-content h2{font-size:13px;font-weight:800;margin:20px 0 8px;color:var(--blue-dark);text-transform:uppercase;letter-spacing:.5px;}
    .doc-content p{margin-bottom:8px;}
    .doc-content ul{margin:6px 0 8px 20px;}
    .doc-content li{margin-bottom:4px;}
    .field-blank{background:#fef9c3;border-bottom:1px solid #d97706;padding:0 4px;display:inline-block;min-width:60px;}
    .ai-loading{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 40px;gap:14px;text-align:center;}
    .ai-spinner{width:40px;height:40px;border:3px solid #e8eaf6;border-top-color:#7c3aed;border-radius:50%;animation:spin .8s linear infinite;}
    @keyframes spin{to{transform:rotate(360deg)}}
    .ai-loading-text{font-size:14px;font-weight:700;color:#6b21a8;}
    .ai-loading-sub{font-size:12px;color:var(--muted);}

    /* HISTORIQUE */
    .hist-overlay{position:fixed;inset:0;background:rgba(15,31,92,.45);backdrop-filter:blur(4px);z-index:200;display:none;align-items:center;justify-content:center;}
    .hist-modal{background:white;border-radius:16px;width:100%;max-width:560px;box-shadow:0 24px 60px rgba(15,31,92,.2);overflow:hidden;}
    .hist-modal-head{padding:18px 22px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
    .hist-modal-head h3{font-size:15px;font-weight:700;}
    .hist-close{background:none;border:none;font-size:18px;cursor:pointer;color:var(--muted);}
    .hist-modal-body{max-height:65vh;overflow-y:auto;}
    .hist-item{display:flex;align-items:center;gap:10px;padding:10px 16px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .15s;}
    .hist-item:hover{background:#fafbff;}
    .hist-item-info{flex:1;min-width:0;}
    .hist-item-name{font-size:12px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .hist-item-date{font-size:11px;color:var(--muted);}
    .hist-del{background:none;border:none;font-size:14px;cursor:pointer;color:var(--red);opacity:.4;padding:4px;}
    .hist-del:hover{opacity:1;}

    /* TOAST */
    .toast{position:fixed;bottom:24px;right:24px;background:#1a1f36;color:white;padding:12px 20px;border-radius:10px;font-size:13px;font-weight:600;z-index:9999;transform:translateY(80px);opacity:0;transition:all .3s;}
    .toast.show{transform:translateY(0);opacity:1;}
    .toast.success{background:#10b981;}
    .toast.warning{background:#f59e0b;}

    /* HAMBURGER */
    .hamburger{display:none;position:fixed;top:14px;left:14px;z-index:1001;width:44px;height:44px;background:#0f1f5c;border:none;border-radius:12px;cursor:pointer;flex-direction:column;align-items:center;justify-content:center;gap:5px;box-shadow:0 4px 16px rgba(15,31,92,.45);}
    .hamburger span{display:block;width:20px;height:2.5px;background:#fff;border-radius:2px;transition:all .25s ease;}
    .hamburger.open span:nth-child(1){transform:translateY(7.5px) rotate(45deg);}
    .hamburger.open span:nth-child(2){opacity:0;}
    .hamburger.open span:nth-child(3){transform:translateY(-7.5px) rotate(-45deg);}
    .nav-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:1000;}
    .nav-overlay.show{display:block;}

    @media(max-width:768px){
      .hamburger{display:flex!important;}
      .main{margin-left:0!important;width:100vw!important;}
      .topbar{padding:10px 10px 10px 62px!important;}
      .content{padding:12px 10px!important;}
      .stats-row{grid-template-columns:1fr 1fr!important;gap:8px!important;}
      .themes-grid{grid-template-columns:1fr 1fr!important;gap:8px!important;}
      .docs-grid{grid-template-columns:1fr!important;}
      .form-grid{grid-template-columns:1fr!important;}
      .gen-bar{flex-direction:column!important;}
    }
    @media(max-width:480px){
      .themes-grid{grid-template-columns:1fr!important;}
      .stats-row{grid-template-columns:1fr!important;}
    }
  </style>
</head>
<body>

<button class="hamburger" id="hamburger" onclick="window.toggleMobileNav&&toggleMobileNav()">
  <span></span><span></span><span></span>
</button>
<div class="nav-overlay" id="navOverlay" onclick="window.toggleMobileNav&&toggleMobileNav()"></div>

<div class="main">
  <div class="topbar">
    <div class="topbar-left">
      <h1>üìÑ Mod√®les de documents RH</h1>
      <p>G√©n√©rateur IA ¬∑ R√©daction professionnelle ¬∑ Conformit√© Code du travail fran√ßais</p>
    </div>
    <div class="topbar-right">
      <button class="btn btn-outline btn-sm" onclick="showHistory()">üïê Historique</button>
    </div>
  </div>

  <div class="content">

    <!-- DISCLAIMER -->
    <div style="background:linear-gradient(135deg,#fffbeb,#fef3c7);border:1px solid #fcd34d;border-radius:10px;padding:11px 16px;display:flex;align-items:center;gap:10px;font-size:12px;color:#78350f;">
      <span style="font-size:16px;flex-shrink:0">‚ö†Ô∏è</span>
      <span><strong>Important :</strong> Ces mod√®les sont fournis √† titre indicatif et g√©n√©r√©s par IA. Pour tout document contractuel ou disciplinaire, consultez un juriste ou expert-comptable. La l√©gislation du travail √©volue r√©guli√®rement.</span>
    </div>

    <!-- STATS -->
    <div class="stats-row">
      <div class="stat-card"><div class="stat-icon" style="background:#dbeafe">üìÑ</div><div><div class="stat-val" id="stat-total">0</div><div class="stat-lbl">Mod√®les disponibles</div></div></div>
      <div class="stat-card"><div class="stat-icon" style="background:#d1fae5">‚úÖ</div><div><div class="stat-val" id="stat-gen">0</div><div class="stat-lbl">Documents g√©n√©r√©s</div></div></div>
      <div class="stat-card"><div class="stat-icon" style="background:#fef3c7">‚≠ê</div><div><div class="stat-val" id="stat-fav">0</div><div class="stat-lbl">En favoris</div></div></div>
      <div class="stat-card"><div class="stat-icon" style="background:#f3e8ff">ü§ñ</div><div><div class="stat-val" style="font-size:13px;font-weight:700;color:var(--purple)">IA Active</div><div class="stat-lbl">G√©n√©ration assist√©e</div></div></div>
    </div>

    <!-- RECHERCHE -->
    <div class="search-bar">
      <span class="search-icon">üîç</span>
      <input id="searchInput" type="text" placeholder="Rechercher un mod√®le... (avertissement, CDI, entretien, attestation...)" oninput="filterDocs(this.value)"/>
    </div>

    <!-- TH√àMES -->
    <div class="themes-grid" id="themesGrid"></div>

    <!-- DOCS LIST -->
    <div class="docs-section" id="docsSection" style="display:none">
      <div class="docs-section-head">
        <div class="docs-section-title" id="docsTitle">Mod√®les</div>
        <button class="btn btn-outline btn-xs" onclick="showAllThemes()">‚Üê Tous les th√®mes</button>
      </div>
      <div class="docs-grid" id="docsGrid"></div>
    </div>

    <!-- PANEL DOCUMENT -->
    <div id="docPanel"></div>

  </div>
</div>

<!-- HISTORIQUE MODAL -->
<div class="hist-overlay" id="histModal">
  <div class="hist-modal">
    <div class="hist-modal-head">
      <h3>üïê Historique des documents</h3>
      <button class="hist-close" onclick="closeHistModal()">‚úï</button>
    </div>
    <div class="hist-modal-body" id="histList"><div style="padding:30px;text-align:center;color:var(--muted)">Chargement...</div></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<!-- FIREBASE -->
<script type="module">
  import{initializeApp}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import{getAuth,onAuthStateChanged,signOut}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import{getFirestore,doc,setDoc,getDoc,collection,getDocs,deleteDoc,addDoc,query,orderBy,limit}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
  const app=initializeApp({apiKey:"AIzaSyB003WqdRKrT0gbv7P4BNIICuXeqbu8dR4",authDomain:"altiora-70599.firebaseapp.com",projectId:"altiora-70599",storageBucket:"altiora-70599.firebasestorage.app",messagingSenderId:"120905555746",appId:"1:120905555746:web:618460c65cdc9e57cc8f7b"});
  const auth=getAuth(app);const db=getFirestore(app);
  window._auth=auth;window._db=db;window._doc=doc;window._setDoc=setDoc;
  window._getDoc=getDoc;window._collection=collection;window._getDocs=getDocs;
  window._deleteDoc=deleteDoc;window._addDoc=addDoc;window._query=query;
  window._orderBy=orderBy;window._limit=limit;window._signOut=signOut;
  onAuthStateChanged(auth,function(user){
    if(!user){window.location.href='index.html';return;}
    window._uid=user.uid;
    window._firebaseReady=true;
    window.startApp();
  });
</script>

<script>
// ‚ïê‚ïê CATALOGUE COMPLET ‚ïê‚ïê
var DOCS=[
  // MESURES DISCIPLINAIRES
  {id:'avertissement',cat:'Mesures disciplinaires',icon:'‚ö†Ô∏è',name:'Avertissement',sub:'Sanction √©crite mineure ‚Äî 1er niveau',badge:'disciplinaire',
   legal:'L1331-1 √† L1331-4 CT ¬∑ Prescription 3 ans ¬∑ Pas d\'entretien pr√©alable si faute mineure ¬∑ Remis en main propre ou LRAR',
   tags:['Sanction','Disciplinaire'],
   fields:[
    {id:'emp_nom',label:'Nom complet du salari√©',type:'text',required:true,placeholder:'Jean Dupont'},
    {id:'emp_poste',label:'Poste occup√©',type:'text',required:true},
    {id:'emp_date_contrat',label:'Date d\'embauche',type:'date',required:true},
    {id:'emp_adresse',label:'Adresse compl√®te du salari√©',type:'text',required:true,placeholder:'3 rue des Lilas, 69001 Lyon'},
    {id:'entreprise_nom',label:'Nom de l\'entreprise',type:'text',required:true},
    {id:'entreprise_adresse',label:'Adresse de l\'entreprise',type:'text',required:true,placeholder:'12 rue de la Paix, 75001 Paris'},
    {id:'entreprise_siret',label:'SIRET',type:'text',required:false,placeholder:'XXX XXX XXX XXXXX'},
    {id:'signataire',label:'Signataire',type:'text',required:true},
    {id:'qualite_signataire',label:'Qualit√© du signataire',type:'text',required:true,placeholder:'G√©rant, DRH...'},
    {id:'date_faits',label:'Date des faits reproch√©s',type:'date',required:true},
    {id:'description_faits',label:'Description pr√©cise des faits',type:'textarea',required:true,placeholder:'Date, lieu, comportement constat√©...'},
    {id:'date_doc',label:'Date du document',type:'date',required:true}
   ]},
  {id:'mise-en-demeure',cat:'Mesures disciplinaires',icon:'üö®',name:'Mise en demeure',sub:'Injonction formelle de respecter les obligations',badge:'disciplinaire',
   legal:'Droit g√©n√©ral des contrats + droit du travail ¬∑ Preuve √©crite opposable ¬∑ Recommand√© LRAR',
   tags:['Disciplinaire','Lettre AR'],
   fields:[
    {id:'emp_nom',label:'Nom du salari√©',type:'text',required:true},
    {id:'emp_poste',label:'Poste',type:'text',required:true},
    {id:'emp_adresse',label:'Adresse du salari√©',type:'text',required:true,placeholder:'3 rue des Lilas, 69001 Lyon'},
    {id:'entreprise_nom',label:'Entreprise',type:'text',required:true},
    {id:'entreprise_adresse',label:'Adresse de l\'entreprise',type:'text',required:true,placeholder:'12 rue de la Paix, 75001 Paris'},
    {id:'entreprise_siret',label:'SIRET',type:'text',required:false},
    {id:'signataire',label:'Signataire',type:'text',required:true},
    {id:'qualite_signataire',label:'Qualit√©',type:'text',required:true,placeholder:'G√©rant, DRH...'},
    {id:'objet_demeure',label:'Objet de la mise en demeure',type:'select',required:true,options:['Retards r√©p√©t√©s','Absences non justifi√©es','Non-respect du r√®glement int√©rieur','Insubordination','Autre']},
    {id:'detail_faits',label:'D√©tail des faits et manquements',type:'textarea',required:true},
    {id:'delai_reg',label:'D√©lai accord√© pour r√©gularisation',type:'select',options:['48 heures','72 heures','1 semaine','15 jours']},
    {id:'date_doc',label:'Date du document',type:'date',required:true}
   ]},
  {id:'mise-a-pied-conservatoire',cat:'Mesures disciplinaires',icon:'üîí',name:'Mise √† pied conservatoire',sub:'Suspension imm√©diate ‚Äî faute grave pr√©sum√©e',badge:'disciplinaire',
   legal:'L1332-3 CT ¬∑ Mesure provisoire non disciplinaire ¬∑ Proc√©dure disciplinaire sous 8 jours ¬∑ Salaire suspendu',
   tags:['Disciplinaire','Urgence'],
   fields:[
    {id:'emp_nom',label:'Nom du salari√©',type:'text',required:true},
    {id:'emp_poste',label:'Poste',type:'text',required:true},
    {id:'emp_adresse',label:'Adresse du salari√©',type:'text',required:true,placeholder:'3 rue des Lilas, 69001 Lyon'},
    {id:'entreprise_nom',label:'Entreprise',type:'text',required:true},
    {id:'entreprise_adresse',label:'Adresse de l\'entreprise',type:'text',required:true,placeholder:'12 rue de la Paix, 75001 Paris'},
    {id:'entreprise_siret',label:'SIRET',type:'text',required:false},
    {id:'signataire',label:'Signataire',type:'text',required:true},
    {id:'qualite_signataire',label:'Qualit√©',type:'text',required:true,placeholder:'G√©rant, DRH...'},
    {id:'date_faits',label:'Date et heure des faits',type:'text',required:true,placeholder:'Lundi 24 mars 2025 √† 14h30'},
    {id:'nature_faute',label:'Nature de la faute pr√©sum√©e',type:'textarea',required:true},
    {id:'date_entretien',label:'Date convocation entretien disciplinaire',type:'date',required:true},
    {id:'date_doc',label:'Date du document',type:'date',required:true}
   ]},
  {id:'licenciement-faute-grave',cat:'Mesures disciplinaires',icon:'‚õî',name:'Licenciement ‚Äî Faute grave',sub:'Sans pr√©avis ni indemnit√©',badge:'disciplinaire',
   legal:'L1234-1 CT ¬∑ Entretien pr√©alable obligatoire ¬∑ Pas de pr√©avis ¬∑ LRAR apr√®s entretien',
   tags:['Licenciement','Faute grave','LRAR'],
   fields:[
    {id:'emp_nom',label:'Nom du salari√©',type:'text',required:true},
    {id:'emp_poste',label:'Poste',type:'text',required:true},
    {id:'emp_anciennete',label:'Date d\'embauche',type:'date',required:true},
    {id:'emp_adresse',label:'Adresse du salari√©',type:'text',required:true,placeholder:'3 rue des Lilas, 69001 Lyon'},
    {id:'entreprise_nom',label:'Entreprise',type:'text',required:true},
    {id:'entreprise_adresse',label:'Adresse de l\'entreprise',type:'text',required:true,placeholder:'12 rue de la Paix, 75001 Paris'},
    {id:'entreprise_siret',label:'SIRET',type:'text',required:false},
    {id:'signataire',label:'Signataire',type:'text',required:true},
    {id:'qualite_signataire',label:'Qualit√©',type:'text',required:true,placeholder:'G√©rant, DRH...'},
    {id:'date_entretien',label:'Date entretien pr√©alable',type:'date',required:true},
    {id:'nature_faute',label:'Nature et description pr√©cise de la faute grave',type:'textarea',required:true},
    {id:'date_faits',label:'Date des faits constitutifs',type:'date',required:true},
    {id:'date_doc',label:'Date du courrier',type:'date',required:true}
   ]},
  {id:'licenciement-cause-reelle',cat:'Mesures disciplinaires',icon:'üìã',name:'Licenciement ‚Äî Cause r√©elle et s√©rieuse',sub:'Motif personnel non disciplinaire',badge:'disciplinaire',
   legal:'L1232-1 CT ¬∑ Entretien pr√©alable obligatoire ¬∑ D√©lai 2 jours ouvrables mini ¬∑ LRAR ¬∑ Indemnit√© l√©gale si anciennet√© ‚â• 8 mois',
   tags:['Licenciement','Motif personnel','LRAR'],
   fields:[
    {id:'emp_nom',label:'Nom du salari√©',type:'text',required:true},
    {id:'emp_poste',label:'Poste',type:'text',required:true},
    {id:'emp_anciennete',label:'Date d\'entr√©e',type:'date',required:true},
    {id:'emp_adresse',label:'Adresse du salari√©',type:'text',required:true,placeholder:'3 rue des Lilas, 69001 Lyon'},
    {id:'entreprise_nom',label:'Entreprise',type:'text',required:true},
    {id:'entreprise_adresse',label:'Adresse de l\'entreprise',type:'text',required:true,placeholder:'12 rue de la Paix, 75001 Paris'},
    {id:'entreprise_siret',label:'SIRET',type:'text',required:false},
    {id:'signataire',label:'Signataire',type:'text',required:true},
    {id:'qualite_signataire',label:'Qualit√©',type:'text',required:true,placeholder:'G√©rant, DRH...'},
    {id:'date_entretien',label:'Date entretien pr√©alable',type:'date',required:true},
    {id:'motif',label:'Motif d√©taill√© du licenciement',type:'textarea',required:true,placeholder:'Insuffisance professionnelle, absences r√©p√©t√©es...'},
    {id:'preavis',label:'Dur√©e du pr√©avis',type:'select',options:['1 mois','2 mois','3 mois','Dispens√© de pr√©avis (indemnit√© compensatrice)']},
    {id:'date_doc',label:'Date du courrier',type:'date',required:true}
   ]},
  // RUPTURES
  {id:'rupture-conventionnelle',cat:'Ruptures de contrat',icon:'ü§ù',name:'Convention de rupture conventionnelle',sub:'Rupture CDI √† l\'amiable ‚Äî homologu√©e DREETS',badge:'legal',
   legal:'L1237-11 √† L1237-16 CT ¬∑ 1 entretien min. ¬∑ Cerfa 14598*01 ¬∑ R√©tractation 15 jours cal. ¬∑ Homologation DREETS 15 jours ¬∑ Ouvre droit au ch√¥mage',
   tags:['Rupture CDI','DREETS','Cerfa'],
   fields:[
    {id:'emp_nom',label:'Nom complet du salari√©',type:'text',required:true,placeholder:'Jean Dupont'},
    {id:'emp_adresse',label:'Adresse du salari√©',type:'text',required:true},
    {id:'emp_poste',label:'Poste occup√©',type:'text',required:true},
    {id:'emp_anciennete',label:'Date d\'entr√©e',type:'date',required:true},
    {id:'entreprise_nom',label:'Nom de l\'entreprise',type:'text',required:true},
    {id:'entreprise_adresse',label:'Adresse de l\'entreprise',type:'text',required:true},
    {id:'entreprise_siret',label:'SIRET',type:'text',required:false},
    {id:'signataire',label:'Repr√©sentant de l\'entreprise',type:'text',required:true},
    {id:'date_1er_entretien',label:'Date du 1er entretien',type:'date',required:true},
    {id:'date_rupture',label:'Date envisag√©e de rupture',type:'date',required:true},
    {id:'indemnite',label:'Indemnit√© sp√©cifique de rupture (‚Ç¨)',type:'number',required:true,placeholder:'Montant minimum l√©gal'},
    {id:'motif_commun',label:'Contexte de la rupture (facultatif)',type:'textarea',required:false,placeholder:'D√©part en retraite, reconversion, accord mutuel...'}
   ]},
  {id:'demission-accuse',cat:'Ruptures de contrat',icon:'üö™',name:'Accus√© r√©ception d√©mission',sub:'Prise d\'acte √©crite de la d√©mission',badge:'admin',
   legal:'Pas de formalisme l√©gal ¬∑ Recommand√© d\'accuser r√©ception par √©crit ¬∑ Pr√©avis selon convention collective',
   tags:['D√©mission','Accus√© r√©ception'],
   fields:[
    {id:'emp_nom',label:'Nom du salari√©',type:'text',required:true},
    {id:'emp_poste',label:'Poste',type:'text',required:true},
    {id:'emp_adresse',label:'Adresse du salari√©',type:'text',required:true,placeholder:'3 rue des Lilas, 69001 Lyon'},
    {id:'entreprise_nom',label:'Entreprise',type:'text',required:true},
    {id:'entreprise_adresse',label:'Adresse de l\'entreprise',type:'text',required:true,placeholder:'12 rue de la Paix, 75001 Paris'},
    {id:'entreprise_siret',label:'SIRET',type:'text',required:false},
    {id:'signataire',label:'Signataire',type:'text',required:true},
    {id:'qualite_signataire',label:'Qualit√©',type:'text',required:true,placeholder:'G√©rant, DRH...'},
    {id:'date_demission',label:'Date de la lettre de d√©mission',type:'date',required:true},
    {id:'preavis',label:'Dur√©e du pr√©avis',type:'select',options:['1 semaine','1 mois','2 mois','3 mois','Dispens√© par l\'employeur']},
    {id:'date_fin',label:'Date de fin de contrat pr√©vue',type:'date',required:true},
    {id:'date_doc',label:'Date du document',type:'date',required:true}
   ]},
  {id:'periode-essai-rupture',cat:'Ruptures de contrat',icon:'‚ùå',name:'Rupture p√©riode d\'essai',sub:'Fin de contrat pendant la p√©riode d\'essai',badge:'admin',
   legal:'L1221-25 CT ¬∑ D√©lai de pr√©venance obligatoire ¬∑ Pas d\'indemnit√© l√©gale ¬∑ √Ä l\'initiative employeur ou salari√©',
   tags:['P√©riode essai','Rupture'],
   fields:[
    {id:'emp_nom',label:'Nom du salari√©',type:'text',required:true},
    {id:'emp_poste',label:'Poste',type:'text',required:true},
    {id:'emp_adresse',label:'Adresse du salari√©',type:'text',required:true,placeholder:'3 rue des Lilas, 69001 Lyon'},
    {id:'date_debut',label:'Date de d√©but p√©riode d\'essai',type:'date',required:true},
    {id:'initiateur',label:'√Ä l\'initiative de',type:'select',options:['L\'employeur','Le salari√©']},
    {id:'motif',label:'Raison interne (non obligatoire)',type:'textarea',required:false},
    {id:'date_preavenir',label:'Date de notification',type:'date',required:true},
    {id:'date_fin',label:'Date de fin effective',type:'date',required:true},
    {id:'entreprise_nom',label:'Entreprise',type:'text',required:true},
    {id:'entreprise_adresse',label:'Adresse de l\'entreprise',type:'text',required:true,placeholder:'12 rue de la Paix, 75001 Paris'},
    {id:'entreprise_siret',label:'SIRET',type:'text',required:false},
    {id:'signataire',label:'Signataire',type:'text',required:true},
    {id:'qualite_signataire',label:'Qualit√©',type:'text',required:true,placeholder:'G√©rant, DRH...'}
   ]},
  // RECRUTEMENT
  {id:'convocation-entretien-embauche',cat:'Recrutement et embauche',icon:'üì©',name:'Convocation entretien d\'embauche',sub:'Invitation officielle √† un entretien de recrutement',badge:'admin',
   legal:'Pas d\'obligation l√©gale de forme ¬∑ Bonne pratique de formaliser ¬∑ RGPD pour donn√©es collect√©es',
   tags:['Recrutement','Convocation'],
   fields:[
    {id:'candidat_nom',label:'Nom du candidat',type:'text',required:true},
    {id:'poste',label:'Poste √† pourvoir',type:'text',required:true},
    {id:'date_entretien',label:'Date de l\'entretien',type:'date',required:true},
    {id:'heure',label:'Heure',type:'text',required:true,placeholder:'10h00'},
    {id:'lieu',label:'Lieu (adresse ou lien visio)',type:'text',required:true},
    {id:'interlocuteur',label:'Interlocuteur(s) pr√©sents',type:'text',required:false},
    {id:'documents',label:'Documents √† apporter',type:'textarea',required:false,placeholder:'CV, dipl√¥mes...'},
    {id:'entreprise_nom',label:'Entreprise',type:'text',required:true},
    {id:'entreprise_adresse',label:'Adresse de l\'entreprise',type:'text',required:true,placeholder:'12 rue de la Paix, 75001 Paris'},
    {id:'entreprise_siret',label:'SIRET',type:'text',required:false},
    {id:'signataire',label:'Signataire',type:'text',required:true}
   ]},
  {id:'promesse-embauche',cat:'Recrutement et embauche',icon:'üéâ',name:'Promesse d\'embauche (offre ferme)',sub:'Engagement unilat√©ral de l\'employeur',badge:'legal',
   legal:'Cass. Soc. 21/09/2017 ¬∑ Offre ferme si poste + r√©mun√©ration + date pr√©cises ¬∑ Rupture = licenciement sans cause r√©elle',
   tags:['Recrutement','Promesse','Offre ferme'],
   fields:[
    {id:'candidat_nom',label:'Nom du candidat',type:'text',required:true},
    {id:'candidat_adresse',label:'Adresse du candidat',type:'text',required:true,placeholder:'3 rue des Lilas, 69001 Lyon'},
    {id:'poste',label:'Poste propos√©',type:'text',required:true},
    {id:'type_contrat',label:'Type de contrat',type:'select',options:['CDI','CDD','Alternance','Stage','Int√©rim']},
    {id:'date_debut',label:'Date de prise de poste',type:'date',required:true},
    {id:'salaire',label:'Salaire brut mensuel (‚Ç¨)',type:'number',required:true},
    {id:'temps_travail',label:'Temps de travail',type:'select',options:['Temps plein (35h)','Temps partiel','Forfait jours cadre']},
    {id:'lieu_travail',label:'Lieu de travail',type:'text',required:true},
    {id:'avantages',label:'Avantages (optionnel)',type:'textarea',required:false,placeholder:'Tickets restaurant, mutuelle, prime...'},
    {id:'delai_reponse',label:'D√©lai de r√©ponse attendu',type:'text',required:false},
    {id:'entreprise_nom',label:'Entreprise',type:'text',required:true},
    {id:'entreprise_adresse',label:'Adresse de l\'entreprise',type:'text',required:true,placeholder:'12 rue de la Paix, 75001 Paris'},
    {id:'entreprise_siret',label:'SIRET',type:'text',required:false},
    {id:'signataire',label:'Signataire',type:'text',required:true},
    {id:'qualite_signataire',label:'Qualit√©',type:'text',required:true,placeholder:'G√©rant, DRH...'},
    {id:'date_doc',label:'Date du document',type:'date',required:true}
   ]},
  // ENTRETIENS
  {id:'entretien-annuel',cat:'Entretiens et √©valuations',icon:'üéØ',name:'Entretien annuel d\'√©valuation',sub:'Grille compl√®te pour piloter la performance',badge:'entretien',
   legal:'Pas d\'obligation l√©gale ¬∑ Diff√©rent de l\'entretien professionnel L6315-1 ¬∑ Peut fonder des d√©cisions RH ¬∑ Conserver les CR sign√©s',
   tags:['√âvaluation','Performance','Annuel'],
   fields:[
    {id:'emp_nom',label:'Nom du collaborateur',type:'text',required:true},
    {id:'emp_poste',label:'Poste',type:'text',required:true},
    {id:'emp_anciennete',label:'Date d\'entr√©e',type:'date',required:true},
    {id:'manager',label:'Nom du manager',type:'text',required:true},
    {id:'date_entretien',label:'Date de l\'entretien',type:'date',required:true},
    {id:'periode_evaluee',label:'P√©riode √©valu√©e',type:'text',required:true,placeholder:'Du 01/01/2025 au 31/12/2025'},
    {id:'objectifs_atteints',label:'Objectifs fix√©s et niveau d\'atteinte',type:'textarea',required:true,placeholder:'Objectif 1 : description -> Atteint / Partiellement / Non atteint'},
    {id:'points_forts',label:'Points forts et r√©alisations',type:'textarea',required:true},
    {id:'axes_amelioration',label:'Axes d\'am√©lioration',type:'textarea',required:true},
    {id:'objectifs_n1',label:'Objectifs pour la prochaine p√©riode',type:'textarea',required:true},
    {id:'formation',label:'Besoins en formation',type:'textarea',required:false},
    {id:'evolution',label:'Souhaits d\'√©volution du collaborateur',type:'textarea',required:false},
    {id:'note_globale',label:'Note globale (optionnel)',type:'select',required:false,options:['','Exceptionnel (5/5)','Tr√®s bon (4/5)','Satisfaisant (3/5)','√Ä am√©liorer (2/5)','Insuffisant (1/5)']}
   ]},
  {id:'entretien-mi-annee',cat:'Entretiens et √©valuations',icon:'üìä',name:'Entretien de mi-ann√©e (check-in)',sub:'Point d\'√©tape sur les objectifs annuels',badge:'entretien',
   legal:'Bonne pratique manag√©riale ¬∑ Pas de cadre l√©gal sp√©cifique ¬∑ Documenter les √©changes et actions',
   tags:['Check-in','Mi-ann√©e','Objectifs'],
   fields:[
    {id:'emp_nom',label:'Collaborateur',type:'text',required:true},
    {id:'emp_poste',label:'Poste',type:'text',required:true},
    {id:'manager',label:'Manager',type:'text',required:true},
    {id:'date_entretien',label:'Date',type:'date',required:true},
    {id:'rappel_objectifs',label:'Rappel des objectifs annuels',type:'textarea',required:true},
    {id:'avancement',label:'√âtat d\'avancement',type:'textarea',required:true},
    {id:'obstacles',label:'Obstacles rencontr√©s',type:'textarea',required:false},
    {id:'soutien_manager',label:'Soutien attendu du manager',type:'textarea',required:false},
    {id:'ajustements',label:'Ajustements d\'objectifs',type:'textarea',required:false},
    {id:'actions',label:'Actions d√©cid√©es',type:'textarea',required:true}
   ]},
  {id:'entretien-professionnel',cat:'Entretiens et √©valuations',icon:'üéì',name:'Entretien professionnel',sub:'Bilan parcours et formation ‚Äî obligatoire tous les 2 ans',badge:'legal',
   legal:'L6315-1 CT OBLIGATOIRE ¬∑ Tous les 2 ans ¬∑ Bilan tous les 6 ans ¬∑ Abondement CPF si non respect√© (3 000 ‚Ç¨)',
   tags:['Formation','Obligatoire','CPF'],
   fields:[
    {id:'emp_nom',label:'Nom du salari√©',type:'text',required:true},
    {id:'emp_poste',label:'Poste',type:'text',required:true},
    {id:'emp_anciennete',label:'Date d\'entr√©e',type:'date',required:true},
    {id:'date_entretien',label:'Date de l\'entretien',type:'date',required:true},
    {id:'dernier_entretien',label:'Date du dernier entretien professionnel',type:'date',required:false},
    {id:'bilan_parcours',label:'Bilan du parcours professionnel',type:'textarea',required:true},
    {id:'formations_suivies',label:'Formations suivies depuis dernier entretien',type:'textarea',required:false},
    {id:'certifications',label:'Certifications obtenues',type:'textarea',required:false},
    {id:'projet_pro',label:'Projet professionnel du salari√©',type:'textarea',required:true},
    {id:'besoins_formation',label:'Besoins en formation',type:'textarea',required:true},
    {id:'cpf',label:'Information CPF d√©livr√©e',type:'select',options:['Oui, le salari√© a √©t√© inform√© de son CPF','Non']}
   ]},
  {id:'entretien-retour-absence',cat:'Entretiens et √©valuations',icon:'üîÑ',name:'Entretien retour apr√®s absence',sub:'Accueil et r√©int√©gration post-absence',badge:'entretien',
   legal:'Obligatoire apr√®s AT/maladie pro ¬∑ Recommand√© apr√®s toute absence longue ¬∑ Identifier les besoins d\'adaptation',
   tags:['Retour','R√©int√©gration','Absence'],
   fields:[
    {id:'emp_nom',label:'Collaborateur',type:'text',required:true},
    {id:'emp_poste',label:'Poste',type:'text',required:true},
    {id:'manager',label:'Manager',type:'text',required:true},
    {id:'date_retour',label:'Date de retour',type:'date',required:true},
    {id:'type_absence',label:'Type d\'absence',type:'select',options:['Maladie ordinaire','Accident du travail','Maladie professionnelle','Cong√© maternit√©/paternit√©','Cong√© parental','Autre']},
    {id:'duree_absence',label:'Dur√©e de l\'absence',type:'text',required:true,placeholder:'3 semaines, 2 mois...'},
    {id:'etat_sante',label:'Am√©nagement n√©cessaire ?',type:'textarea',required:false},
    {id:'missions_actuelles',label:'Missions et priorit√©s imm√©diates',type:'textarea',required:true},
    {id:'accompagnement',label:'Accompagnement mis en place',type:'textarea',required:false}
   ]},
  // CULTURE
  {id:'charte-valeurs',cat:'Culture et vision',icon:'‚≠ê',name:'Charte des valeurs de l\'entreprise',sub:'Formalise la vision, mission et valeurs fondatrices',badge:'culture',
   legal:'Document non contractuel ¬∑ Renforce la marque employeur ¬∑ Peut figurer dans onboarding et r√®glement int√©rieur',
   tags:['Culture','Valeurs','Vision'],
   fields:[
    {id:'entreprise_nom',label:'Nom de l\'entreprise',type:'text',required:true},
    {id:'entreprise_adresse',label:'Adresse de l\'entreprise',type:'text',required:false,placeholder:'12 rue de la Paix, 75001 Paris'},
    {id:'secteur',label:'Secteur d\'activit√©',type:'text',required:true,placeholder:'Commerce alimentaire, Conseil RH...'},
    {id:'fondee',label:'Ann√©e de cr√©ation',type:'text',required:false},
    {id:'vision',label:'Vision (o√π voulez-vous aller √† long terme ?)',type:'textarea',required:true,placeholder:'Devenir la r√©f√©rence r√©gionale en mati√®re de...'},
    {id:'mission',label:'Mission (pourquoi existez-vous ?)',type:'textarea',required:true,placeholder:'Notre raison d\'√™tre est d\'aider...'},
    {id:'valeurs',label:'Valeurs fondamentales',type:'textarea',required:true,placeholder:'1. Int√©grit√©\n2. Innovation\n3. Bienveillance'},
    {id:'engagements',label:'Engagements envers les √©quipes',type:'textarea',required:false},
    {id:'comportements',label:'Comportements attendus au quotidien',type:'textarea',required:false},
    {id:'dirigeant',label:'Mot du dirigeant / Signataire',type:'text',required:true}
   ]},
  {id:'welcome-book',cat:'Culture et vision',icon:'üëã',name:'Guide de bienvenue (Welcome Book)',sub:'Livret d\'accueil complet pour les nouveaux',badge:'culture',
   legal:'Bonne pratique onboarding ¬∑ Peut int√©grer r√®glement int√©rieur et informations l√©gales ¬∑ R√©duit le turnover pr√©coce',
   tags:['Onboarding','Welcome','Culture'],
   fields:[
    {id:'entreprise_nom',label:'Entreprise',type:'text',required:true},
    {id:'entreprise_adresse',label:'Adresse de l\'entreprise',type:'text',required:false,placeholder:'12 rue de la Paix, 75001 Paris'},
    {id:'secteur',label:'Secteur',type:'text',required:true},
    {id:'nb_employes',label:'Effectif',type:'select',options:['1-5','6-20','21-50','51-200','+200']},
    {id:'vision',label:'Vision et mission',type:'textarea',required:true},
    {id:'valeurs',label:'Valeurs cl√©s',type:'textarea',required:true},
    {id:'organisation',label:'Structure de l\'√©quipe',type:'textarea',required:false,placeholder:'Direction, services, qui fait quoi...'},
    {id:'pratiques',label:'Pratiques et rituels d\'√©quipe',type:'textarea',required:false,placeholder:'R√©union hebdo le lundi, d√©jeuner mensuel...'},
    {id:'outils',label:'Outils et logiciels utilis√©s',type:'textarea',required:false},
    {id:'infos_pratiques',label:'Infos pratiques (horaires, acc√®s, parking...)',type:'textarea',required:false},
    {id:'contact_rh',label:'Contact RH / interlocuteur principal',type:'text',required:true}
   ]},
  {id:'teletravail-accord',cat:'Culture et vision',icon:'üè†',name:'Accord de t√©l√©travail',sub:'Cadre le t√©l√©travail pour un salari√© ou l\'√©quipe',badge:'legal',
   legal:'L1222-9 CT ¬∑ Accord individuel ou collectif ¬∑ Droit √† la d√©connexion L2242-17 ¬∑ Mentions obligatoires : jours, lieu, frais, √©quipement',
   tags:['T√©l√©travail','Accord','Remote'],
   fields:[
    {id:'emp_nom',label:'Salari√© concern√© (ou "ensemble des salari√©s")',type:'text',required:true},
    {id:'entreprise_nom',label:'Entreprise',type:'text',required:true},
    {id:'jours_teletravail',label:'Jours de t√©l√©travail autoris√©s',type:'select',options:['1 jour/semaine','2 jours/semaine','3 jours/semaine','4 jours/semaine','Flexible']},
    {id:'lieu_teletravail',label:'Lieu de t√©l√©travail autoris√©',type:'text',required:true,placeholder:'Domicile principal / Tout lieu en France'},
    {id:'materiel',label:'Mat√©riel fourni par l\'entreprise',type:'textarea',required:false},
    {id:'frais',label:'Indemnisation des frais',type:'textarea',required:false,placeholder:'10 ‚Ç¨/mois forfait internet...'},
    {id:'plages_joignabilite',label:'Plages horaires de joignabilit√©',type:'text',required:true,placeholder:'9h-12h et 14h-17h'},
    {id:'date_debut',label:'Date d\'entr√©e en vigueur',type:'date',required:true},
    {id:'entreprise_adresse',label:'Adresse de l\'entreprise',type:'text',required:false,placeholder:'12 rue de la Paix, 75001 Paris'},
    {id:'signataire',label:'Signataire',type:'text',required:true},
    {id:'qualite_signataire',label:'Qualit√©',type:'text',required:true,placeholder:'G√©rant, DRH...'}
   ]},
  // DOCUMENTS ADMINISTRATIFS
  {id:'attestation-emploi',cat:'Documents administratifs',icon:'üìÉ',name:'Attestation de travail',sub:'Justificatif de la relation de travail en cours',badge:'admin',
   legal:'Pas de formalisme l√©gal ¬∑ Courrier √† en-t√™te recommand√© ¬∑ √Ä remettre sur simple demande du salari√©',
   tags:['Attestation','Justificatif'],
   fields:[
    {id:'emp_nom',label:'Nom du salari√©',type:'text',required:true},
    {id:'emp_poste',label:'Poste occup√©',type:'text',required:true},
    {id:'emp_adresse',label:'Adresse du salari√©',type:'text',required:true,placeholder:'3 rue des Lilas, 69001 Lyon'},
    {id:'emp_anciennete',label:'Date d\'entr√©e',type:'date',required:true},
    {id:'type_contrat',label:'Type de contrat',type:'select',options:['CDI','CDD','Alternance','Temps partiel CDI']},
    {id:'salaire_brut',label:'Salaire brut mensuel (optionnel)',type:'number',required:false},
    {id:'objet_attestation',label:'Objet de la demande (optionnel)',type:'text',required:false,placeholder:'Location immobili√®re, dossier banque...'},
    {id:'entreprise_nom',label:'Entreprise',type:'text',required:true},
    {id:'entreprise_adresse',label:'Adresse de l\'entreprise',type:'text',required:true,placeholder:'12 rue de la Paix, 75001 Paris'},
    {id:'entreprise_siret',label:'SIRET',type:'text',required:false},
    {id:'signataire',label:'Signataire',type:'text',required:true},
    {id:'qualite_signataire',label:'Qualit√©',type:'text',required:true,placeholder:'G√©rant, DRH...'},
    {id:'date_doc',label:'Date du document',type:'date',required:true}
   ]},
  {id:'avenant-contrat',cat:'Documents administratifs',icon:'‚úèÔ∏è',name:'Avenant au contrat de travail',sub:'Modification d\'un √©l√©ment essentiel du contrat',badge:'legal',
   legal:'Tout √©l√©ment essentiel modifi√© n√©cessite avenant sign√© ¬∑ Refus du salari√© = maintien conditions initiales ¬∑ D√©lai de r√©flexion raisonnable',
   tags:['Contrat','Avenant','Modification'],
   fields:[
    {id:'emp_nom',label:'Nom du salari√©',type:'text',required:true},
    {id:'emp_poste_actuel',label:'Poste actuel',type:'text',required:true},
    {id:'emp_adresse',label:'Adresse du salari√©',type:'text',required:true,placeholder:'3 rue des Lilas, 69001 Lyon'},
    {id:'date_contrat_initial',label:'Date du contrat initial',type:'date',required:true},
    {id:'objet_avenant',label:'Objet de l\'avenant',type:'select',options:['Changement de poste','Modification de salaire','Changement de lieu de travail','Modification du temps de travail','Promotion / √©volution','Autre modification']},
    {id:'ancienne_clause',label:'Ancienne clause / Situation actuelle',type:'textarea',required:true},
    {id:'nouvelle_clause',label:'Nouvelle clause / Nouvelle situation',type:'textarea',required:true},
    {id:'date_effet',label:'Date d\'entr√©e en vigueur',type:'date',required:true},
    {id:'entreprise_nom',label:'Entreprise',type:'text',required:true},
    {id:'entreprise_adresse',label:'Adresse de l\'entreprise',type:'text',required:true,placeholder:'12 rue de la Paix, 75001 Paris'},
    {id:'entreprise_siret',label:'SIRET',type:'text',required:false},
    {id:'signataire',label:'Signataire',type:'text',required:true},
    {id:'qualite_signataire',label:'Qualit√©',type:'text',required:true,placeholder:'G√©rant, DRH...'},
    {id:'date_doc',label:'Date du document',type:'date',required:true}
   ]},
  {id:'note-de-service',cat:'Documents administratifs',icon:'üì¢',name:'Note de service',sub:'Communication officielle interne √† l\'entreprise',badge:'admin',
   legal:'Doit √™tre port√©e √† la connaissance des salari√©s ¬∑ Peut fonder une sanction si non respect√©e ¬∑ Opposable si diffusion tra√ßable',
   tags:['Communication','Interne','Note'],
   fields:[
    {id:'entreprise_nom',label:'Entreprise',type:'text',required:true},
    {id:'destinataires',label:'Destinataires',type:'text',required:true,placeholder:'Tout le personnel, Service commercial...'},
    {id:'objet',label:'Objet de la note',type:'text',required:true},
    {id:'contenu',label:'Contenu de la note',type:'textarea',required:true},
    {id:'date_application',label:'Date d\'application',type:'date',required:false},
    {id:'entreprise_adresse',label:'Adresse de l\'entreprise',type:'text',required:false,placeholder:'12 rue de la Paix, 75001 Paris'},
    {id:'signataire',label:'Signataire',type:'text',required:true},
    {id:'qualite_signataire',label:'Qualit√©',type:'text',required:true,placeholder:'G√©rant, DRH...'},
    {id:'date_doc',label:'Date du document',type:'date',required:true}
   ]}
];

// TH√àMES
var THEMES=[
  {id:'Mesures disciplinaires',icon:'‚ö†Ô∏è',color:'#ef4444',bg:'#fee2e2',ex:['Avertissement','Licenciement','Mise √† pied']},
  {id:'Ruptures de contrat',icon:'üö™',color:'#f59e0b',bg:'#fef3c7',ex:['Rupture conventionnelle','D√©mission','P√©riode essai']},
  {id:'Recrutement et embauche',icon:'üéØ',color:'#10b981',bg:'#d1fae5',ex:['Convocation','Promesse d\'embauche']},
  {id:'Entretiens et √©valuations',icon:'üí¨',color:'#3b82f6',bg:'#dbeafe',ex:['Entretien annuel','Entretien pro','Retour absence']},
  {id:'Culture et vision',icon:'‚≠ê',color:'#8b5cf6',bg:'#f3e8ff',ex:['Charte valeurs','Welcome Book','T√©l√©travail']},
  {id:'Documents administratifs',icon:'üìÅ',color:'#0ea5e9',bg:'#e0f2fe',ex:['Attestation','Avenant','Note de service']}
];

// STATE
var _cur=null,_gen='',_hist=[],_favs=JSON.parse(localStorage.getItem('rh_favs')||'[]');
var _genCount=parseInt(localStorage.getItem('rh_gen_count')||'0');
var _curTheme=null,_company={},_employes={};

// INIT
window.startApp=function(){
  renderThemes();
  updateStats();
  loadCompany();
  loadEmployes();
};

function renderThemes(){
  var g=document.getElementById('themesGrid');
  g.innerHTML=THEMES.map(function(t){
    var count=DOCS.filter(function(d){return d.cat===t.id;}).length;
    var exHtml=t.ex.slice(0,3).map(function(e){return '<span class="theme-ex">'+e+'</span>';}).join('');
    return '<div class="theme-card'+((_curTheme===t.id)?' active':'')+'" style="--tc:'+t.color+';--tb:'+t.bg+'" onclick="selTheme(\''+escQ(t.id)+'\')">'+
      '<div class="theme-icon-wrap">'+t.icon+'</div>'+
      '<div class="theme-name">'+t.id+'</div>'+
      '<div class="theme-count"><strong>'+count+'</strong> mod√®le'+(count>1?'s':'')+'</div>'+
      '<div class="theme-examples">'+exHtml+'</div>'+
    '</div>';
  }).join('');
  document.getElementById('stat-total').textContent=DOCS.length;
}

function escQ(s){return s.replace(/'/g,"\\'");}

window.selTheme=function(catId){
  _curTheme=catId;
  renderThemes();
  var docs=DOCS.filter(function(d){return d.cat===catId;});
  var t=THEMES.find(function(t){return t.id===catId;});
  var sec=document.getElementById('docsSection');
  sec.style.display='block';
  document.getElementById('docsTitle').innerHTML=(t?t.icon:'üìÇ')+' <span>'+catId+'</span> <span style="font-size:11px;font-weight:400;color:var(--muted)">('+docs.length+')</span>';
  renderGrid(docs);
  sec.scrollIntoView({behavior:'smooth',block:'start'});
};

window.showAllThemes=function(){
  _curTheme=null;
  renderThemes();
  document.getElementById('docsSection').style.display='none';
  document.getElementById('docPanel').innerHTML='';
};

function renderGrid(docs){
  var g=document.getElementById('docsGrid');
  if(!docs||!docs.length){g.innerHTML='<div style="grid-column:1/-1;padding:40px;text-align:center;color:var(--muted)">Aucun mod√®le trouv√©</div>';return;}
  g.innerHTML=docs.map(function(d){
    var fav=_favs.indexOf(d.id)>=0;
    return '<div class="doc-card'+(_cur&&_cur.id===d.id?' active':'')+'" onclick="selDoc(\''+escQ(d.id)+'\')">'+
      '<button class="doc-fav'+(fav?' on':'')+'" onclick="event.stopPropagation();togFav(\''+escQ(d.id)+'\')" title="'+(fav?'Retirer des':'Ajouter aux')+' favoris">'+(fav?'‚≠ê':'‚òÜ')+'</button>'+
      '<div class="doc-card-top"><div class="doc-icon">'+d.icon+'</div><span class="doc-badge badge-'+d.badge+'">'+d.badge+'</span></div>'+
      '<div class="doc-name">'+d.name+'</div>'+
      '<div class="doc-sub">'+d.sub+'</div>'+
      '<div class="doc-tags">'+d.tags.map(function(t){return '<span class="doc-tag">'+t+'</span>';}).join('')+'</div>'+
    '</div>';
  }).join('');
}

window.filterDocs=function(q){
  q=(q||'').toLowerCase().trim();
  if(!q){
    if(_curTheme)selTheme(_curTheme);
    else{document.getElementById('docsSection').style.display='none';}
    return;
  }
  var res=DOCS.filter(function(d){return d.name.toLowerCase().includes(q)||d.cat.toLowerCase().includes(q)||d.sub.toLowerCase().includes(q)||d.tags.some(function(t){return t.toLowerCase().includes(q);});});
  document.getElementById('docsSection').style.display='block';
  document.getElementById('docsTitle').innerHTML='üîç R√©sultats pour "<em>'+q+'</em>" <span style="font-size:11px;font-weight:400;color:var(--muted)">('+res.length+')</span>';
  renderGrid(res);
};

window.selDoc=function(id){
  var d=DOCS.find(function(x){return x.id===id;});
  if(!d)return;
  _cur=d;_gen='';
  if(_curTheme)renderGrid(DOCS.filter(function(x){return x.cat===_curTheme;}));
  renderPanel(d);
  document.getElementById('docPanel').scrollIntoView({behavior:'smooth',block:'start'});
};

function renderPanel(d){
  var fieldsHtml=d.fields.map(function(f){
    var full=f.type==='textarea'?'full':'';
    var inp='';
    if(f.type==='select'){
      inp='<select class="form-input form-select" id="f-'+f.id+'"><option value="">‚Äî S√©lectionner ‚Äî</option>'+(f.options||[]).map(function(o){return '<option value="'+o+'">'+o+'</option>';}).join('')+'</select>';
    }else if(f.type==='textarea'){
      inp='<textarea class="form-input form-textarea" id="f-'+f.id+'" placeholder="'+(f.placeholder||'')+'"></textarea>';
    }else{
      inp='<input class="form-input" id="f-'+f.id+'" type="'+(f.type||'text')+'" placeholder="'+(f.placeholder||'')+'"'+(f.type==='number'?' inputmode="decimal"':'')+'/>';
    }
    return '<div class="form-field '+full+'"><label class="form-label">'+f.label+(f.required?'<span>*</span>':'')+'</label>'+inp+'</div>';
  }).join('');

  document.getElementById('docPanel').innerHTML=
    '<div class="doc-panel">'+
      '<div class="doc-panel-head">'+
        '<div class="doc-big-title"><span>'+d.icon+'</span>'+d.name+'</div>'+
        '<div class="doc-desc">'+d.sub+'</div>'+
        '<div class="legal-banner"><span style="font-size:16px;flex-shrink:0">‚öñÔ∏è</span><div class="legal-banner-text"><strong>R√©f√©rence l√©gale :</strong> '+d.legal+'</div></div>'+
      '</div>'+
    '</div>'+
    '<div class="form-section">'+
      '<div class="form-section-head">'+
        '<div class="form-section-title">üìù Informations du document</div>'+
        '<button class="btn btn-outline btn-sm" onclick="fillExample()">üí° Exemple</button>'+
      '</div>'+
      '<div class="prefill-bar">'+
        '<span class="prefill-lbl">Pr√©remplir :</span>'+
        '<button class="prefill-btn" onclick="prefillCompany()">üè¢ Mon entreprise</button>'+
        '<button class="prefill-btn" onclick="openEmpPrefill()">üë§ Un employ√©</button>'+
      '</div>'+
      '<div class="form-body"><div class="form-grid">'+fieldsHtml+'</div></div>'+
    '</div>'+
    '<div class="gen-bar">'+
      '<div class="gen-bar-text"><h3>ü§ñ G√©n√©rer avec l\'IA</h3><p>Claude r√©dige un document professionnel conforme au droit du travail fran√ßais</p></div>'+
      '<div class="gen-bar-actions">'+
        '<button class="btn btn-outline btn-sm" onclick="fillExample()" style="color:white;border-color:rgba(255,255,255,.3)">üí° Exemple</button>'+
        '<button class="btn btn-ai" onclick="generateDoc()">ü™Ñ G√©n√©rer le document</button>'+
      '</div>'+
    '</div>'+
    '<div id="resultZone"></div>';

  if(_company.nom)prefillCompany(true);
}

// PREFILL ENTREPRISE
async function loadCompany(){
  if(!window._uid)return;
  try{var s=await window._getDoc(window._doc(window._db,'users',window._uid));if(s.exists())_company=s.data();}catch(e){}
}
window.prefillCompany=function(silent){
  var d=_company;
  if(!d.nom&&!d.entreprise&&!silent){toast('Aucune donn√©e entreprise en m√©moire','warning');return;}
  var set=function(id,v){var el=document.getElementById('f-'+id);if(el&&v)el.value=v;};
  set('entreprise_nom',d.nom||d.entreprise||'');
  set('entreprise_adresse',d.adresse||d.adresseEntreprise||'');
  set('entreprise_siret',d.siret||'');
  if(!silent)toast('Donn√©es entreprise pr√©remplies ‚úì','success');
};

// PREFILL EMPLOY√â
async function loadEmployes(){
  if(!window._uid)return;
  try{
    var s=await window._getDocs(window._collection(window._db,'rh',window._uid,'employes'));
    s.forEach(function(d){_employes[d.id]=Object.assign({id:d.id},d.data());});
  }catch(e){}
}
window.openEmpPrefill=function(){
  var emps=Object.values(_employes);
  if(!emps.length){toast('Aucun employ√© enregistr√© dans le module RH','warning');return;}
  emps.sort(function(a,b){return ((a.prenom||'')+(a.nom||'')).localeCompare((b.prenom||'')+(b.nom||''));});
  var names=emps.map(function(e,i){return (i+1)+'. '+((e.prenom||'')+' '+(e.nom||'')).trim();}).join('\n');
  var chosen=prompt('S√©lectionnez l\'employ√© (saisissez le num√©ro) :\n\n'+names);
  var idx=parseInt(chosen)-1;
  if(!isNaN(idx)&&emps[idx])prefillEmployee(emps[idx].id);
};
window.prefillEmployee=function(empId){
  var e=_employes[empId];if(!e)return;
  var set=function(id,v){var el=document.getElementById('f-'+id);if(el&&v)el.value=v;};
  set('emp_nom',(e.prenom||'')+' '+(e.nom||''));
  set('candidat_nom',(e.prenom||'')+' '+(e.nom||''));
  set('emp_poste',e.poste||'');
  set('emp_adresse',e.adresse||'');
  set('emp_anciennete',e.dateEmbauche||'');
  set('emp_date_contrat',e.dateEmbauche||'');
  toast('Donn√©es employ√© pr√©remplies ‚úì','success');
};

// EXEMPLE
window.fillExample=function(){
  if(!_cur)return;
  var today=new Date().toISOString().split('T')[0];
  var ex={
    emp_nom:'Marie Martin',emp_poste:'Responsable commerciale',emp_adresse:'12 avenue des Roses, 69003 Lyon',
    emp_anciennete:'2021-01-15',emp_date_contrat:'2021-01-15',emp_poste_actuel:'Responsable commerciale',
    entreprise_nom:'SARL Exemple Commerce',entreprise_adresse:'45 rue du Commerce, 75011 Paris',entreprise_siret:'123 456 789 00012',
    signataire:'Jean Dupont',qualite_signataire:'G√©rant',date_doc:today,date_faits:today,date_entretien:today,
    description_faits:'Le salari√© s\'est pr√©sent√© avec un retard de 2 heures sans pr√©venir son sup√©rieur, et ce pour la troisi√®me fois ce mois-ci.',
    nature_faute:'Absence injustifi√©e sans pr√©venir et refus de regagner son poste malgr√© la demande.',
    motif:'Insuffisance professionnelle constat√©e sur les 6 derniers mois malgr√© un accompagnement mis en place.',
    poste:'Charg√©(e) de client√®le',date_debut:today,heure:'10h00',
    lieu:'45 rue du Commerce, 75011 Paris',
    objectifs_atteints:'Objectif 1 : Atteindre 80% du quota mensuel ‚Üí Partiellement atteint (65%)\nObjectif 2 : R√©duire les d√©lais de traitement ‚Üí Atteint',
    points_forts:'Excellent relationnel client, esprit d\'initiative, bonne ma√Ætrise des outils num√©riques.',
    axes_amelioration:'Am√©liorer la rigueur administrative, renforcer le suivi des dossiers en cours.',
    objectifs_n1:'1. Atteindre 90% du quota mensuel\n2. Former 2 nouveaux collaborateurs',
    vision:'Devenir la r√©f√©rence r√©gionale dans notre secteur d\'ici 5 ans.',
    mission:'Accompagner nos clients dans leur d√©veloppement avec des solutions innovantes.',
    valeurs:'1. Int√©grit√©\n2. Innovation\n3. Bienveillance\n4. Performance',
    secteur:'Commerce et distribution',manager:'Paul Leblanc',
    candidat_nom:'Paul Bernard',candidat_adresse:'8 rue des Lilas, 31000 Toulouse',
    destinataires:'Tout le personnel',objet:'Nouvelles modalit√©s de pointage',
    contenu:'√Ä compter du 1er du mois prochain, le pointage se fera via l\'application mobile. Chaque collaborateur recevra ses identifiants par email d\'ici vendredi.',
    bilan_parcours:'Parcours complet en commerce depuis 5 ans, √©volution vers plus de responsabilit√©s.',
    projet_pro:'√âvoluer vers un poste de management d\'√©quipe commerciale.',
    besoins_formation:'Formation management et techniques de vente avanc√©es.',
    dirigeant:'Jean Dupont, G√©rant',
    ancienne_clause:'Salaire brut mensuel : 2 200 ‚Ç¨',
    nouvelle_clause:'Salaire brut mensuel : 2 500 ‚Ç¨ (suite √† la promotion au poste de responsable)',
    date_effet:today,date_contrat_initial:'2021-01-15',
    rappel_objectifs:'Atteindre 80% du quota mensuel, former 2 collaborateurs.',
    avancement:'Quota √† 72%, formation de 1 collaborateur en cours.',
    actions:'Mise en place d\'un point hebdomadaire avec le manager.'
  };
  _cur.fields.forEach(function(f){
    var el=document.getElementById('f-'+f.id);
    if(!el)return;
    if(ex[f.id])el.value=ex[f.id];
    else if(f.type==='select'&&f.options&&f.options.length>0)el.value=f.options[0];
  });
  toast('Donn√©es d\'exemple charg√©es ‚úì','success');
};

// G√âN√âRATION IA
window.generateDoc=function(){
  if(!_cur)return;
  var values={};
  _cur.fields.forEach(function(f){
    var el=document.getElementById('f-'+f.id);
    values[f.id]=(el&&el.value)||'';
  });
  var rz=document.getElementById('resultZone');
  rz.innerHTML='<div class="result-doc"><div class="ai-loading"><div class="ai-spinner"></div><div class="ai-loading-text">R√©daction en cours...</div><div class="ai-loading-sub">L\'IA g√©n√®re votre document RH conforme au droit fran√ßais</div></div></div>';
  var fieldsDesc=_cur.fields.map(function(f){return f.label+' : '+(values[f.id]||'Non renseign√©');}).join('\n');
  var prompt='Tu es un expert en droit du travail fran√ßais et RH. R√©dige un document RH professionnel de type "'+_cur.name+'" en fran√ßais.\n\nDOCUMENT : '+_cur.name+'\nSOUS-TYPE : '+_cur.sub+'\nR√âF√âRENCE L√âGALE : '+_cur.legal+'\n\nDONN√âES SAISIES :\n'+fieldsDesc+'\n\nINSTRUCTIONS :\n- R√©dige un document complet, professionnel et juridiquement adapt√©\n- Utilise un ton formel appropri√©\n- Respecte les usages du droit du travail fran√ßais\n- Structure clairement avec des paragraphes si pertinent\n- Si des donn√©es sont manquantes, mets-les entre crochets [√Ä compl√©ter]\n- Inclus les mentions l√©gales obligatoires si n√©cessaire\n- Termine par les lignes de signature appropri√©es\n- Produis UNIQUEMENT le contenu du document, sans introduction ni commentaire';

  fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({model:'claude-haiku-4-5-20251001',max_tokens:2000,messages:[{role:'user',content:prompt}]})})
  .then(function(r){if(!r.ok)throw new Error('HTTP '+r.status);return r.json();})
  .then(function(data){
    var text=(data.content&&data.content[0]&&data.content[0].text)||'';
    if(!text)throw new Error('R√©ponse vide');
    _gen=text;
    _genCount++;
    localStorage.setItem('rh_gen_count',_genCount);
    updateStats();
    showResult(text);
    autoSave();
  })
  .catch(function(err){
    rz.innerHTML='<div class="result-doc"><div style="padding:30px;text-align:center;color:var(--red)"><div style="font-size:32px;margin-bottom:10px">‚ö†Ô∏è</div><div style="font-weight:700;margin-bottom:6px">Erreur de g√©n√©ration</div><div style="font-size:12px;color:var(--muted)">'+err.message+'<br><br><em>V√©rifiez que l\'API Claude est configur√©e c√¥t√© serveur (proxy /api/claude-proxy).</em></div><button class="btn btn-primary btn-sm" style="margin-top:14px" onclick="generateDoc()">R√©essayer</button></div></div>';
  });
};

function showResult(text){
  var html=text
    .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
    .replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>')
    .replace(/\[([^\]]+)\]/g,'<span class="field-blank">[$1]</span>')
    .replace(/\n\n/g,'</p><p>')
    .replace(/\n/g,'<br>');
  html='<p>'+html+'</p>';
  document.getElementById('resultZone').innerHTML=
    '<div class="result-doc">'+
      '<div class="result-head">'+
        '<div class="result-title">‚úÖ Document g√©n√©r√© par l\'IA</div>'+
        '<div style="display:flex;gap:8px;flex-wrap:wrap">'+
          '<button class="btn btn-outline btn-sm" onclick="copyDoc()">üìã Copier</button>'+
          '<button class="btn btn-success btn-sm" onclick="printDoc()">üñ®Ô∏è Imprimer / PDF</button>'+
          '<button class="btn btn-ai btn-sm" onclick="generateDoc()">üîÑ Reg√©n√©rer</button>'+
        '</div>'+
      '</div>'+
      '<div class="doc-content-wrap"><div class="doc-content" id="generatedContent">'+html+'</div></div>'+
      '<div style="padding:12px 18px;border-top:1px solid var(--border);background:#fafbff;font-size:11px;color:var(--muted)">'+
        '‚ö†Ô∏è Document g√©n√©r√© √† titre indicatif. Adaptez-le √† votre situation et faites-le valider par un professionnel RH ou juriste.'+
      '</div>'+
    '</div>';
}

window.copyDoc=function(){
  if(!_gen){toast('Aucun document g√©n√©r√©','warning');return;}
  navigator.clipboard.writeText(_gen).then(function(){toast('Copi√© dans le presse-papiers ‚úì','success');}).catch(function(){toast('Impossible de copier','warning');});
};
window.printDoc=function(){
  if(!_gen){toast('Aucun document g√©n√©r√©','warning');return;}
  var win=window.open('','_blank');
  win.document.write('<html><head><title>'+(_cur?_cur.name:'Document RH')+'</title><style>body{font-family:Arial,sans-serif;padding:40px;font-size:14px;line-height:1.8;color:#1a1f36;}p{margin-bottom:10px;}strong{font-weight:bold;}</style></head><body><h1 style="font-size:18px;margin-bottom:20px">'+(_cur?_cur.name:'Document RH')+'</h1>'+document.getElementById('generatedContent').innerHTML+'</body></html>');
  win.document.close();win.focus();setTimeout(function(){win.print();},400);
};

// FAVORIS
window.togFav=function(id){
  var i=_favs.indexOf(id);
  if(i>=0)_favs.splice(i,1);else _favs.push(id);
  localStorage.setItem('rh_favs',JSON.stringify(_favs));
  updateStats();
  if(_curTheme)renderGrid(DOCS.filter(function(d){return d.cat===_curTheme;}));
  toast(i>=0?'Retir√© des favoris':'Ajout√© aux favoris ‚≠ê','success');
};

function updateStats(){
  document.getElementById('stat-total').textContent=DOCS.length;
  document.getElementById('stat-gen').textContent=_genCount;
  document.getElementById('stat-fav').textContent=_favs.length;
}

// HISTORIQUE
async function autoSave(){
  if(!window._uid||!_cur||!_gen)return;
  try{
    await window._addDoc(window._collection(window._db,'rh',window._uid,'doc_history'),{
      docId:_cur.id,docName:_cur.name,docIcon:_cur.icon,
      content:_gen.substring(0,600),createdAt:Date.now()
    });
  }catch(e){}
}
window.showHistory=function(){document.getElementById('histModal').style.display='flex';loadHistory();};
window.closeHistModal=function(){document.getElementById('histModal').style.display='none';};
async function loadHistory(){
  if(!window._uid)return;
  try{
    var q=window._query(window._collection(window._db,'rh',window._uid,'doc_history'),window._orderBy('createdAt','desc'),window._limit(30));
    var snap=await window._getDocs(q);
    _hist=[];snap.forEach(function(d){_hist.push(Object.assign({_id:d.id},d.data()));});
    var list=document.getElementById('histList');
    if(!_hist.length){list.innerHTML='<div style="padding:30px;text-align:center;color:var(--muted)">Aucun document g√©n√©r√© pour l\'instant</div>';return;}
    list.innerHTML=_hist.map(function(h){
      var dt=new Date(h.createdAt);
      var fmt=dt.toLocaleDateString('fr-FR')+' √† '+dt.toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'});
      return '<div class="hist-item" onclick="loadHist(\''+escQ(h._id)+'\')">'+
        '<span style="font-size:22px">'+(h.docIcon||'üìÑ')+'</span>'+
        '<div class="hist-item-info"><div class="hist-item-name">'+(h.docName||'Document')+'</div><div class="hist-item-date">'+fmt+'</div></div>'+
        '<button class="hist-del" onclick="event.stopPropagation();delHist(event,\''+escQ(h._id)+'\')">üóë</button>'+
      '</div>';
    }).join('');
  }catch(e){document.getElementById('histList').innerHTML='<div style="padding:30px;text-align:center;color:var(--red)">Erreur de chargement</div>';}
}
window.loadHist=function(id){
  var h=_hist.find(function(x){return x._id===id;});if(!h)return;
  closeHistModal();
  var d=DOCS.find(function(x){return x.id===h.docId;});
  if(d)selDoc(d.id);
  setTimeout(function(){
    var rz=document.getElementById('resultZone');
    if(rz)rz.innerHTML='<div class="result-doc"><div style="padding:14px 22px;background:#f0fdf4;border-bottom:1px solid #bbf7d0;font-size:12px;color:#166534;font-weight:600">üìú Document charg√© depuis l\'historique</div><div class="doc-content-wrap"><div class="doc-content">'+h.content+'...<br><span style="color:var(--muted);font-style:italic">R√©g√©n√©rez pour obtenir le document complet.</span></div></div></div>';
  },300);
};
window.delHist=async function(e,id){
  e.stopPropagation();
  if(!window._uid)return;
  try{
    await window._deleteDoc(window._doc(window._db,'rh',window._uid,'doc_history',id));
    _hist=_hist.filter(function(h){return h._id!==id;});
    loadHistory();toast('Supprim√©','success');
  }catch(err){toast('Erreur','warning');}
};

// TOAST
function toast(msg,type){
  var t=document.getElementById('toast');
  t.textContent=msg;t.className='toast show '+(type||'');
  setTimeout(function(){t.className='toast';},3200);
}

// MOBILE NAV
window.toggleMobileNav=function(){
  var nav=document.querySelector('nav,aside.sidebar,.sidebar');
  var overlay=document.getElementById('navOverlay');
  var hb=document.getElementById('hamburger');
  if(nav)nav.classList.toggle('open');
  if(overlay)overlay.classList.toggle('show');
  if(hb)hb.classList.toggle('open');
};
</script>

<script src="nav.js"></script>
</body>
</html>
