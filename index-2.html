<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ALTIORA ‚Äî Connexion</title>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0a0a0f;
      --surface: #13131a;
      --border: rgba(255,255,255,0.07);
      --accent: #c8f04d;
      --accent-dim: rgba(200,240,77,0.12);
      --text: #f0f0f0;
      --muted: #6b6b80;
      --error: #ff5f5f;
      --radius: 14px;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      overflow: hidden;
    }

    /* Ambient background */
    body::before {
      content: '';
      position: fixed;
      top: -20%;
      left: -10%;
      width: 60vw;
      height: 60vw;
      background: radial-gradient(ellipse, rgba(200,240,77,0.06) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }
    body::after {
      content: '';
      position: fixed;
      bottom: -20%;
      right: -10%;
      width: 50vw;
      height: 50vw;
      background: radial-gradient(ellipse, rgba(100,80,255,0.06) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }

    .container {
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 440px;
    }

    /* Logo */
    .logo {
      font-family: 'Syne', sans-serif;
      font-weight: 800;
      font-size: 28px;
      letter-spacing: -0.5px;
      color: var(--text);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .logo-dot {
      width: 8px;
      height: 8px;
      background: var(--accent);
      border-radius: 50%;
      display: inline-block;
    }
    .tagline {
      color: var(--muted);
      font-size: 13px;
      font-weight: 300;
      margin-bottom: 40px;
      letter-spacing: 0.3px;
    }

    /* Card */
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 36px;
      backdrop-filter: blur(10px);
    }

    /* Tabs */
    .tabs {
      display: flex;
      background: var(--bg);
      border-radius: 10px;
      padding: 4px;
      margin-bottom: 32px;
      gap: 2px;
    }
    .tab {
      flex: 1;
      padding: 9px;
      font-family: 'Syne', sans-serif;
      font-size: 13px;
      font-weight: 600;
      text-align: center;
      border: none;
      background: transparent;
      color: var(--muted);
      border-radius: 7px;
      cursor: pointer;
      transition: all 0.2s;
      letter-spacing: 0.3px;
    }
    .tab.active {
      background: var(--accent);
      color: #0a0a0f;
    }

    /* Forms */
    .form { display: none; flex-direction: column; gap: 16px; }
    .form.active { display: flex; }

    .form-title {
      font-family: 'Syne', sans-serif;
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 4px;
    }
    .form-sub {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 8px;
      line-height: 1.5;
    }

    .field { display: flex; flex-direction: column; gap: 6px; }
    label {
      font-size: 12px;
      font-weight: 500;
      color: var(--muted);
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }
    input {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px 14px;
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      outline: none;
      transition: border-color 0.2s;
      width: 100%;
    }
    input:focus { border-color: var(--accent); }
    input::placeholder { color: var(--muted); }

    /* Button */
    .btn {
      padding: 13px;
      background: var(--accent);
      color: #0a0a0f;
      border: none;
      border-radius: 10px;
      font-family: 'Syne', sans-serif;
      font-weight: 700;
      font-size: 14px;
      cursor: pointer;
      transition: opacity 0.2s, transform 0.15s;
      letter-spacing: 0.3px;
      margin-top: 4px;
    }
    .btn:hover { opacity: 0.88; }
    .btn:active { transform: scale(0.98); }
    .btn:disabled { opacity: 0.4; cursor: not-allowed; }

    .btn-ghost {
      background: transparent;
      color: var(--muted);
      border: 1px solid var(--border);
      font-family: 'DM Sans', sans-serif;
      font-weight: 400;
    }
    .btn-ghost:hover { color: var(--text); border-color: rgba(255,255,255,0.2); opacity: 1; }

    /* Forgot link */
    .forgot {
      font-size: 12px;
      color: var(--muted);
      text-align: right;
      cursor: pointer;
      text-decoration: underline;
      text-underline-offset: 3px;
      background: none;
      border: none;
      padding: 0;
    }
    .forgot:hover { color: var(--text); }

    /* Alert */
    .alert {
      padding: 11px 14px;
      border-radius: 10px;
      font-size: 13px;
      display: none;
      line-height: 1.4;
    }
    .alert.error { background: rgba(255,95,95,0.1); border: 1px solid rgba(255,95,95,0.2); color: var(--error); display: block; }
    .alert.success { background: var(--accent-dim); border: 1px solid rgba(200,240,77,0.2); color: var(--accent); display: block; }

    /* Spinner */
    @keyframes spin { to { transform: rotate(360deg); } }
    .spinner {
      width: 16px; height: 16px;
      border: 2px solid rgba(10,10,15,0.3);
      border-top-color: #0a0a0f;
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
      display: inline-block;
      vertical-align: middle;
      margin-right: 6px;
    }

    /* Divider */
    .divider {
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--muted);
      font-size: 11px;
      letter-spacing: 1px;
      text-transform: uppercase;
      margin: 4px 0;
    }
    .divider::before, .divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    /* Dashboard placeholder (shown after login) */
    #dashboard {
      display: none;
      text-align: center;
    }
    #dashboard h2 {
      font-family: 'Syne', sans-serif;
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 8px;
    }
    #dashboard p { color: var(--muted); font-size: 14px; margin-bottom: 24px; }
    #dashboard .badge {
      display: inline-block;
      background: var(--accent-dim);
      border: 1px solid rgba(200,240,77,0.25);
      color: var(--accent);
      font-size: 12px;
      font-weight: 600;
      padding: 4px 12px;
      border-radius: 20px;
      margin-bottom: 32px;
      font-family: 'Syne', sans-serif;
    }

    /* Fade in animation */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(16px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .container { animation: fadeUp 0.5s ease both; }
  </style>
</head>
<body>

<div class="container">
  <div class="logo">
    <span class="logo-dot"></span>ALTIORA
  </div>
  <p class="tagline">Pilotez votre entreprise avec pr√©cision</p>

  <!-- AUTH CARD -->
  <div class="card" id="authCard">

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" onclick="switchTab('login')">Connexion</button>
      <button class="tab" onclick="switchTab('register')">Cr√©er un compte</button>
    </div>

    <!-- LOGIN FORM -->
    <form class="form active" id="loginForm" onsubmit="handleLogin(event)">
      <div>
        <div class="form-title">Bon retour üëã</div>
        <div class="form-sub">Connectez-vous √† votre espace ALTIORA</div>
      </div>
      <div id="loginAlert" class="alert"></div>
      <div class="field">
        <label>Email</label>
        <input type="email" id="loginEmail" placeholder="vous@exemple.com" required />
      </div>
      <div class="field">
        <label>Mot de passe</label>
        <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
        <button type="button" class="forgot" onclick="switchTab('reset')">Mot de passe oubli√© ?</button>
      </div>
      <button class="btn" type="submit" id="loginBtn">Se connecter</button>
      <div class="divider">ou</div>
      <button type="button" class="btn btn-ghost" onclick="switchTab('register')">Cr√©er un compte</button>
    </form>

    <!-- REGISTER FORM -->
    <form class="form" id="registerForm" onsubmit="handleRegister(event)">
      <div>
        <div class="form-title">Cr√©er votre compte</div>
        <div class="form-sub">Commencez gratuitement, sans carte bancaire</div>
      </div>
      <div id="registerAlert" class="alert"></div>
      <div class="field">
        <label>Pr√©nom &amp; Nom</label>
        <input type="text" id="registerName" placeholder="Jean Dupont" required />
      </div>
      <div class="field">
        <label>Email</label>
        <input type="email" id="registerEmail" placeholder="vous@exemple.com" required />
      </div>
      <div class="field">
        <label>Mot de passe</label>
        <input type="password" id="registerPassword" placeholder="8 caract√®res minimum" required minlength="8" />
      </div>
      <button class="btn" type="submit" id="registerBtn">Cr√©er mon compte</button>
      <div class="divider">ou</div>
      <button type="button" class="btn btn-ghost" onclick="switchTab('login')">J'ai d√©j√† un compte</button>
    </form>

    <!-- RESET FORM -->
    <form class="form" id="resetForm" onsubmit="handleReset(event)">
      <div>
        <div class="form-title">R√©initialisation</div>
        <div class="form-sub">Entrez votre email et on vous envoie un lien de r√©initialisation.</div>
      </div>
      <div id="resetAlert" class="alert"></div>
      <div class="field">
        <label>Email</label>
        <input type="email" id="resetEmail" placeholder="vous@exemple.com" required />
      </div>
      <button class="btn" type="submit" id="resetBtn">Envoyer le lien</button>
      <div class="divider">ou</div>
      <button type="button" class="btn btn-ghost" onclick="switchTab('login')">‚Üê Retour</button>
    </form>

  </div>

  <!-- DASHBOARD PLACEHOLDER (apr√®s connexion) -->
  <div class="card" id="dashboard">
    <div class="badge">‚úì Connect√©</div>
    <h2>Bienvenue sur ALTIORA</h2>
    <p id="welcomeMsg">Votre espace de pilotage est pr√™t.<br/>Les modules arrivent brique par brique üöÄ</p>
    <button class="btn" style="width:100%; margin-bottom:12px;" onclick="goToDashboard()">Acc√©der au tableau de bord ‚Üí</button>
    <button class="btn btn-ghost" style="width:100%;" onclick="handleLogout()">Se d√©connecter</button>
  </div>

</div>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getAuth,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    sendPasswordResetEmail,
    updateProfile,
    onAuthStateChanged,
    signOut
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import {
    getFirestore,
    doc,
    setDoc,
    getDoc,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB003WqdRKrT0gbv7P4BNIICuXeqbu8dR4",
    authDomain: "altiora-70599.firebaseapp.com",
    projectId: "altiora-70599",
    storageBucket: "altiora-70599.firebasestorage.app",
    messagingSenderId: "120905555746",
    appId: "1:120905555746:web:618460c65cdc9e57cc8f7b",
    measurementId: "G-G85MK9ZKG8"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Expose functions to window
  window._auth = auth;
  window._db = db;
  window._signIn = signInWithEmailAndPassword;
  window._createUser = createUserWithEmailAndPassword;
  window._resetPwd = sendPasswordResetEmail;
  window._updateProfile = updateProfile;
  window._signOut = signOut;
  window._setDoc = setDoc;
  window._getDoc = getDoc;
  window._doc = doc;
  window._serverTimestamp = serverTimestamp;

  // Auth state observer
  onAuthStateChanged(auth, (user) => {
    if (user) {
      showDashboard(user);
    } else {
      showAuth();
    }
  });
</script>

<script>
  // Tab switcher
  function switchTab(tab) {
    document.querySelectorAll('.form').forEach(f => f.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.getElementById(tab + 'Form').classList.add('active');
    if (tab === 'login') document.querySelectorAll('.tab')[0].classList.add('active');
    if (tab === 'register') document.querySelectorAll('.tab')[1].classList.add('active');
    clearAlerts();
  }

  function clearAlerts() {
    document.querySelectorAll('.alert').forEach(a => { a.className = 'alert'; a.textContent = ''; });
  }

  function showAlert(id, message, type = 'error') {
    const el = document.getElementById(id);
    el.className = 'alert ' + type;
    el.textContent = message;
  }

  function setLoading(btnId, loading) {
    const btn = document.getElementById(btnId);
    if (loading) {
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span>Chargement...';
    } else {
      btn.disabled = false;
      btn.innerHTML = btn.id === 'loginBtn' ? 'Se connecter'
        : btn.id === 'registerBtn' ? 'Cr√©er mon compte'
        : 'Envoyer le lien';
    }
  }

  // Firebase error messages in French
  function firebaseError(code) {
    const map = {
      'auth/user-not-found': 'Aucun compte avec cet email.',
      'auth/wrong-password': 'Mot de passe incorrect.',
      'auth/invalid-credential': 'Email ou mot de passe incorrect.',
      'auth/email-already-in-use': 'Un compte existe d√©j√† avec cet email.',
      'auth/weak-password': 'Mot de passe trop faible (8 caract√®res minimum).',
      'auth/invalid-email': 'Adresse email invalide.',
      'auth/too-many-requests': 'Trop de tentatives. R√©essayez dans quelques minutes.',
    };
    return map[code] || 'Une erreur est survenue. R√©essayez.';
  }

  // LOGIN
  async function handleLogin(e) {
    e.preventDefault();
    setLoading('loginBtn', true);
    clearAlerts();
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    try {
      await window._signIn(window._auth, email, password);
      // onAuthStateChanged prend le relais
    } catch (err) {
      showAlert('loginAlert', firebaseError(err.code));
      setLoading('loginBtn', false);
    }
  }

  // REGISTER
  async function handleRegister(e) {
    e.preventDefault();
    setLoading('registerBtn', true);
    clearAlerts();
    const name = document.getElementById('registerName').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;
    try {
      const cred = await window._createUser(window._auth, email, password);
      await window._updateProfile(cred.user, { displayName: name });
      // Cr√©er le profil dans Firestore
      await window._setDoc(window._doc(window._db, 'users', cred.user.uid), {
        name,
        email,
        createdAt: window._serverTimestamp(),
        plan: 'free'
      });
      // onAuthStateChanged prend le relais
    } catch (err) {
      showAlert('registerAlert', firebaseError(err.code));
      setLoading('registerBtn', false);
    }
  }

  // RESET PASSWORD
  async function handleReset(e) {
    e.preventDefault();
    setLoading('resetBtn', true);
    clearAlerts();
    const email = document.getElementById('resetEmail').value;
    try {
      await window._resetPwd(window._auth, email);
      showAlert('resetAlert', '‚úì Email envoy√© ! V√©rifiez votre bo√Æte mail.', 'success');
    } catch (err) {
      showAlert('resetAlert', firebaseError(err.code));
    }
    setLoading('resetBtn', false);
  }

  // LOGOUT
  async function handleLogout() {
    await window._signOut(window._auth);
  }

  // UI state
  function showDashboard(user) {
    document.getElementById('authCard').style.display = 'none';
    const dash = document.getElementById('dashboard');
    dash.style.display = 'block';
    const name = user.displayName ? user.displayName.split(' ')[0] : 'vous';
    document.getElementById('welcomeMsg').innerHTML =
      `Connect√© en tant que <strong>${user.email}</strong><br/>Les modules arrivent brique par brique üöÄ`;
  }

  function showAuth() {
    document.getElementById('authCard').style.display = 'block';
    document.getElementById('dashboard').style.display = 'none';
  }

  function goToDashboard() {
    // Sera remplac√© par la vraie navigation brique 2
    alert('Brique 2 en cours de construction ! üî®');
  }

  // Expose for HTML onclick
  window.switchTab = switchTab;
  window.handleLogin = handleLogin;
  window.handleRegister = handleRegister;
  window.handleReset = handleReset;
  window.handleLogout = handleLogout;
  window.goToDashboard = goToDashboard;
</script>

</body>
</html>
