<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover"/>
<title>ALTEORE â€” Panier Moyen</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --nav:#0f1f5c;--blue:#1a3dce;--blue2:#4f7ef8;--bg:#f4f6fb;--white:#fff;
  --border:#e2e8f0;--text:#1a1f36;--muted:#6b7280;--green:#10b981;--red:#ef4444;
  --orange:#f59e0b;--purple:#6366f1;--radius:14px;--sw:250px;
}
body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg);color:var(--text);display:flex;min-height:100vh;font-size:13px}

/* NAV */
nav{width:var(--sw);min-height:100vh;background:linear-gradient(180deg,#0f1f5c,#162366);position:fixed;top:0;left:0;display:flex;flex-direction:column;padding-bottom:20px;overflow-y:auto;z-index:99}
.logo{display:flex;align-items:center;gap:10px;padding:22px 18px;border-bottom:1px solid rgba(255,255,255,.08)}
.logo-i{width:33px;height:33px;background:rgba(255,255,255,.14);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:15px}
.logo-t{font-size:17px;font-weight:800;color:#fff;letter-spacing:1px}
.ns{font-size:10px;font-weight:700;color:rgba(255,255,255,.28);letter-spacing:1px;text-transform:uppercase;padding:12px 18px 4px}
.ni{display:flex;align-items:center;gap:9px;padding:9px 18px;color:rgba(255,255,255,.55);font-size:12.5px;font-weight:500;cursor:pointer;border-left:3px solid transparent;transition:.15s}
.ni:hover{color:#fff;background:rgba(255,255,255,.06)}
.ni.on{color:#fff;background:rgba(255,255,255,.1);border-left-color:#4f7ef8}
.sub{overflow:hidden;max-height:0;transition:max-height .3s}
.sub.open{max-height:200px}
.si{display:flex;align-items:center;gap:7px;padding:7px 18px 7px 40px;color:rgba(255,255,255,.4);font-size:12px;cursor:pointer;border-left:3px solid transparent;transition:.15s}
.si:hover{color:rgba(255,255,255,.75);background:rgba(255,255,255,.04)}
.si.on{color:#fff;background:rgba(79,126,248,.15);border-left-color:rgba(79,126,248,.6)}
.dot{width:5px;height:5px;border-radius:50%;background:rgba(255,255,255,.25)}
.si.on .dot{background:#4f7ef8}
.nav-footer{margin-top:auto;padding:12px 18px 0;border-top:1px solid rgba(255,255,255,.08)}
.ucard{display:flex;align-items:center;gap:8px;padding:8px;background:rgba(255,255,255,.07);border-radius:8px}
.uav{width:29px;height:29px;background:linear-gradient(135deg,#4f7ef8,#6366f1);border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:#fff}
.un{font-size:11.5px;font-weight:600;color:#fff}
.up{font-size:10px;color:rgba(255,255,255,.3)}
.lbtn{margin-left:auto;background:none;border:none;color:rgba(255,255,255,.3);cursor:pointer;font-size:13px}

/* MAIN */
main{margin-left:var(--sw);flex:1;display:flex;flex-direction:column}
.topbar{background:#fff;border-bottom:1px solid var(--border);padding:12px 24px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50}
.topbar h1{font-size:16px;font-weight:700}
.topbar p{font-size:11px;color:var(--muted)}
.tb-right{display:flex;align-items:center;gap:8px}
.yr-bar{display:flex;gap:5px}
.yr{padding:5px 12px;border:1.5px solid var(--border);border-radius:7px;background:#fff;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:600;cursor:pointer;color:var(--muted);transition:.15s}
.yr.on{background:var(--blue);color:#fff;border-color:var(--blue)}
.btn{padding:7px 14px;border:none;border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:600;cursor:pointer;transition:.15s}
.btn-p{background:linear-gradient(135deg,var(--blue),var(--blue2));color:#fff}
.btn-o{background:#fff;color:var(--blue);border:1.5px solid var(--border)}
.btn-xs{padding:4px 9px;font-size:11px}
.btn-d{background:#fef2f2;color:var(--red);border:1px solid #fecaca}
.badge{font-size:9px;font-weight:700;padding:1px 5px;border-radius:4px;background:#dbeafe;color:#1d4ed8;vertical-align:middle}

/* PAGE CONTENT */
.page{padding:20px 24px;display:flex;flex-direction:column;gap:18px}

/* MONTH PICKER */
.month-strip{display:flex;gap:6px;flex-wrap:wrap}
.mbtn{padding:6px 13px;border:1.5px solid var(--border);border-radius:8px;background:#fff;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:600;cursor:pointer;color:var(--muted);transition:.15s;position:relative}
.mbtn:hover{border-color:var(--blue2);color:var(--blue)}
.mbtn.on{background:var(--blue);color:#fff;border-color:var(--blue)}
.mbtn.has-data::after{content:'';position:absolute;top:4px;right:4px;width:5px;height:5px;border-radius:50%;background:var(--green)}
.mbtn.on.has-data::after{background:#fff}

/* SAISIE CARD */
.saisie{background:#fff;border:2px solid var(--blue2);border-radius:var(--radius);overflow:hidden;box-shadow:0 4px 20px rgba(79,126,248,.1)}
.saisie-head{background:linear-gradient(135deg,#eff6ff,#e8f0ff);padding:14px 20px;border-bottom:1px solid #c7d2fe;display:flex;align-items:center;justify-content:space-between}
.saisie-title{font-size:14px;font-weight:700}
.saisie-month{font-size:13px;font-weight:700;color:var(--blue);background:#dbeafe;padding:4px 12px;border-radius:20px}
.saisie-body{padding:20px}
.fields-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-bottom:20px}
.field{display:flex;flex-direction:column;gap:6px}
.field-lbl{font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;display:flex;align-items:center;gap:5px}
.field-icon{font-size:13px}
.field-wrap{display:flex;align-items:center;gap:8px;padding:10px 14px;border:2px solid var(--border);border-radius:10px;background:#f8faff;transition:.15s}
.field-wrap:focus-within{border-color:var(--blue2);background:#fff;box-shadow:0 0 0 3px rgba(79,126,248,.1)}
.field-input{flex:1;border:none;background:transparent;font-family:'Plus Jakarta Sans',sans-serif;font-size:17px;font-weight:800;color:var(--text);outline:none;min-width:0}
.field-input::placeholder{color:#cbd5e1;font-weight:400;font-size:14px}
.field-unit{font-size:12px;font-weight:700;color:var(--muted)}
.results-row{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
.res-box{background:#f8faff;border:1.5px solid var(--border);border-radius:10px;padding:12px 14px;text-align:center}
.res-box.highlight{background:linear-gradient(135deg,#f0fdf4,#dcfce7);border-color:#86efac}
.res-label{font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;margin-bottom:5px}
.res-val{font-size:20px;font-weight:800;color:var(--text)}
.res-val.green{color:var(--green)}
.res-val.blue{color:var(--blue)}
.res-hint{font-size:10px;color:var(--muted);margin-top:2px}

/* KPI CARDS */
.kpi-row{display:grid;grid-template-columns:repeat(5,1fr);gap:12px}
.kpi{background:#fff;border:1px solid var(--border);border-radius:12px;padding:14px 16px}
.kpi.blue{background:#eff6ff;border-color:#bfdbfe}
.kpi.green{background:#f0fdf4;border-color:#bbf7d0}
.kpi.orange{background:#fffbeb;border-color:#fde68a}
.kpi.purple{background:#f5f3ff;border-color:#ddd6fe}
.kpi-ico{font-size:18px;margin-bottom:5px}
.kpi-lbl{font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.4px}
.kpi-val{font-size:19px;font-weight:800;margin-top:2px}
.kpi-sub{font-size:10px;color:var(--muted);margin-top:1px}
.kpi-trend{font-size:11px;font-weight:700;margin-top:3px}
.up{color:var(--green)}.down{color:var(--red)}

/* GRAPHIQUES */
.g2{display:grid;grid-template-columns:2fr 1fr;gap:14px}
.g3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px}
.card{background:#fff;border:1px solid var(--border);border-radius:12px;padding:16px}
.card-t{font-size:13px;font-weight:700;margin-bottom:12px}
.card-s{font-size:11px;color:var(--muted);font-weight:400;margin-left:4px}

/* CATÃ‰GORIES */
.cats{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.cat{background:#fff;border:1px solid var(--border);border-radius:12px;overflow:hidden}
.cat-top{padding:11px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:8px}
.cat-bar{width:4px;height:26px;border-radius:2px;flex-shrink:0}
.cat-name{font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;border:none;outline:none;background:transparent;flex:1;color:var(--text)}
.cat-body{padding:12px 14px;display:flex;flex-direction:column;gap:7px}
.cat-row{display:flex;justify-content:space-between;align-items:center;font-size:12px}
.cat-in{width:88px;padding:5px 8px;border:1.5px solid var(--border);border-radius:6px;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:600;text-align:right;outline:none;color:var(--text)}
.cat-in:focus{border-color:var(--blue2)}
.cat-r{font-weight:700}.cat-r.blue{color:var(--blue)}.cat-r.green{color:var(--green)}
.cat-div{height:1px;background:var(--border);margin:2px 0}
.add-cat{display:flex;align-items:center;justify-content:center;gap:6px;padding:14px;border:2px dashed var(--border);border-radius:12px;cursor:pointer;color:var(--muted);font-size:13px;font-weight:600;background:#fff;transition:.15s}
.add-cat:hover{border-color:var(--blue2);color:var(--blue);background:#eff6ff}

/* SIMULATEUR */
.sim{background:#fff;border:1px solid var(--border);border-radius:12px;overflow:hidden}
.sim-h{padding:15px 20px;background:linear-gradient(135deg,#4f46e5,#7c3aed);display:flex;align-items:center;justify-content:space-between}
.sim-ht{font-size:14px;font-weight:700;color:#fff}
.sim-b{padding:18px 20px}
.sim-g{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:16px}
.sim-lev{background:#f8faff;border:1.5px solid #e8eaf6;border-radius:10px;padding:14px}
.sim-ll{font-size:11px;font-weight:700;color:var(--text);margin-bottom:8px}
.sim-fw{display:flex;align-items:center;gap:6px;padding:8px 10px;background:#fff;border:2px solid #e2e8f0;border-radius:8px}
.sim-fw:focus-within{border-color:var(--blue2);box-shadow:0 0 0 3px rgba(79,126,248,.1)}
.sim-fi{flex:1;border:none;background:transparent;font-family:'Plus Jakarta Sans',sans-serif;font-size:16px;font-weight:800;color:var(--text);outline:none;min-width:0}
.sim-fi::placeholder{color:#cbd5e1}
.sim-fu{font-size:11px;font-weight:700;color:var(--muted)}
.sim-res{background:linear-gradient(135deg,#1a1f36,#2d3561);border-radius:12px;padding:18px;color:#fff}
.sim-rt{font-size:10px;font-weight:600;color:rgba(255,255,255,.4);text-transform:uppercase;letter-spacing:.5px;margin-bottom:12px}
.sim-rg{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
.sim-ri{text-align:center}
.sim-rl{font-size:10px;color:rgba(255,255,255,.4);font-weight:600;text-transform:uppercase;margin-bottom:4px}
.sim-rc{font-size:11px;color:rgba(255,255,255,.3);margin-bottom:2px}
.sim-rn{font-size:16px;font-weight:800}
.sim-rn.pos{color:#34d399}.sim-rn.neg{color:#f87171}
.sim-rd{font-size:11px;font-weight:700;margin-top:2px}
.sim-rd.pos{color:#6ee7b7}.sim-rd.neg{color:#fca5a5}

.toast{position:fixed;bottom:18px;right:18px;padding:10px 16px;border-radius:9px;font-size:13px;font-weight:600;z-index:9999;transform:translateY(60px);opacity:0;transition:.3s}
.toast.show{transform:translateY(0);opacity:1}
.toast.ok{background:#10b981;color:#fff}
.ucard:hover{background:rgba(255,255,255,.12);transform:translateY(-1px);transition:.15s}


/* â”€â”€ MOBILE UNIQUEMENT â”€â”€ */





/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘   ALTEORE â€” RESPONSIVE MOBILE (iPhone/Android)  â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* 1. RESET global overflow */
html, body { overflow-x: hidden; max-width: 100vw; }

/* 2. HAMBURGER â€” masquÃ© par dÃ©faut */
.hamburger {
  display: none;
  position: fixed;
  top: 14px; left: 14px;
  z-index: 1001;
  width: 44px; height: 44px;
  background: #0f1f5c;
  border: none; border-radius: 12px;
  cursor: pointer;
  flex-direction: column;
  align-items: center; justify-content: center;
  gap: 5px;
  box-shadow: 0 4px 16px rgba(15,31,92,.45);
  -webkit-tap-highlight-color: transparent;
  transition: background .2s;
}
.hamburger:active { background: #1a3dce; }
.hamburger span {
  display: block; width: 20px; height: 2.5px;
  background: #fff; border-radius: 2px;
  transition: all .25s ease;
  pointer-events: none;
}
.hamburger.open span:nth-child(1) { transform: translateY(7.5px) rotate(45deg); }
.hamburger.open span:nth-child(2) { opacity: 0; transform: scaleX(0); }
.hamburger.open span:nth-child(3) { transform: translateY(-7.5px) rotate(-45deg); }

/* 3. OVERLAY */
.nav-overlay {
  display: none; position: fixed; inset: 0;
  background: rgba(0,0,0,.5); z-index: 1000;
  -webkit-tap-highlight-color: transparent;
}
.nav-overlay.show { display: block; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MOBILE â‰¤768px â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 768px) {

  /* HAMBURGER visible */
  .hamburger { display: flex !important; }

  /* SIDEBAR / NAV â†’ drawer */
  nav, aside.sidebar, .sidebar {
    position: fixed !important;
    top: 0 !important; left: 0 !important;
    height: 100vh !important;
    height: -webkit-fill-available !important;
    width: min(280px, 84vw) !important;
    z-index: 1001 !important;
    transform: translateX(-105%) !important;
    transition: transform .3s cubic-bezier(.4,0,.2,1) !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
    margin: 0 !important;
    box-sizing: border-box !important;
  }
  nav.open, aside.sidebar.open, .sidebar.open {
    transform: translateX(0) !important;
    box-shadow: 8px 0 32px rgba(0,0,0,.3) !important;
  }

  /* MAIN CONTENT â†’ pleine largeur */
  .main, main, div.main, .main-content {
    margin-left: 0 !important;
    width: 100vw !important;
    overflow-x: hidden !important;
    box-sizing: border-box !important;
  }

  /* TOPBAR */
  .topbar {
    padding: 10px 10px 10px 62px !important;
    flex-wrap: wrap !important;
    gap: 6px !important;
    position: sticky !important;
    top: 0 !important; z-index: 50 !important;
    background: #fff !important;
    box-shadow: 0 1px 6px rgba(0,0,0,.08) !important;
    box-sizing: border-box !important;
    width: 100% !important;
  }
  .topbar h1, .topbar-left h1, .topbar-left h2 { font-size: 14px !important; }
  .topbar p, .topbar-left p { font-size: 10px !important; }
  .topbar-right, .tb-r {
    width: 100% !important;
    flex-wrap: wrap !important;
    gap: 6px !important;
  }
  .topbar-right .btn, .tb-r .btn,
  .topbar-right button, .tb-r button {
    flex: 1 1 auto !important;
    font-size: 11px !important;
    padding: 7px 8px !important;
    min-height: 36px !important;
    white-space: nowrap !important;
    min-width: 0 !important;
  }

  /* PAGE / CONTENT */
  .content, .page {
    padding: 12px 10px !important;
    overflow-x: hidden !important;
    width: 100% !important;
    box-sizing: border-box !important;
    gap: 12px !important;
  }
  .content > *, .page > * {
    box-sizing: border-box !important;
    max-width: 100% !important;
  }

  /* â”€â”€ TOUTES LES GRILLES â†’ 1 COLONNE â”€â”€ */
  /* Dashboard */
  .kpi-grid-4, .kpi-grid-5 { grid-template-columns: 1fr 1fr !important; gap: 8px !important; margin-bottom: 12px !important; }
  .charts-grid, .charts-grid-3 { grid-template-columns: 1fr !important; gap: 12px !important; }
  /* Suivi CA */
  .kpi-grid { grid-template-columns: 1fr 1fr !important; gap: 8px !important; }
  .charts-grid-2 { grid-template-columns: 1fr !important; gap: 12px !important; }
  /* CoÃ»t de revient */
  .fiche-kpis { grid-template-columns: 1fr 1fr !important; gap: 8px !important; }
  .prix-grid { grid-template-columns: 1fr !important; gap: 10px !important; }
  /* Marges */
  .decomp-grid { grid-template-columns: 1fr !important; gap: 10px !important; }
  .cle-grid { grid-template-columns: 1fr !important; gap: 8px !important; }
  .cle-inputs { grid-template-columns: 1fr 1fr !important; gap: 8px !important; }
  .sim-levers { grid-template-columns: 1fr !important; gap: 8px !important; }
  .sim-result-grid { grid-template-columns: 1fr 1fr !important; gap: 8px !important; }
  .modal-row { grid-template-columns: 1fr !important; gap: 8px !important; }
  /* Pilotage */
  .summary-grid { grid-template-columns: 1fr 1fr !important; gap: 8px !important; margin-bottom: 12px !important; }
  .sections-grid { grid-template-columns: 1fr !important; gap: 12px !important; }
  .tva-result { grid-template-columns: 1fr !important; gap: 8px !important; }
  .cashflow-grid { grid-template-columns: 1fr !important; gap: 8px !important; }
  /* Panier moyen */
  .fields-grid { grid-template-columns: 1fr !important; gap: 10px !important; }
  .results-row { grid-template-columns: 1fr 1fr !important; gap: 8px !important; }
  .g2, .g3 { grid-template-columns: 1fr !important; gap: 12px !important; }
  .cats { grid-template-columns: 1fr !important; gap: 10px !important; }
  .sim-g { grid-template-columns: 1fr 1fr !important; gap: 8px !important; }
  .sim-rg { grid-template-columns: 1fr 1fr !important; gap: 8px !important; }
  /* Dettes */
  .detail-grid { grid-template-columns: 1fr !important; gap: 10px !important; }
  .mgrid2 { grid-template-columns: 1fr !important; gap: 10px !important; }
  /* Profil */
  .plan-grid { grid-template-columns: 1fr !important; gap: 12px !important; }
  /* Universels */
  .kpi-row { grid-template-columns: 1fr 1fr !important; gap: 8px !important; }
  .type-grid { grid-template-columns: 1fr 1fr !important; gap: 8px !important; }
  .fact-kpis { grid-template-columns: 1fr 1fr !important; gap: 8px !important; }
  .calendar-grid { grid-template-columns: repeat(4, 1fr) !important; gap: 5px !important; }

  /* â”€â”€ KPI CARDS â€” texte lisible â”€â”€ */
  .kpi-card, .kpi, .summary-card, .fkpi {
    padding: 12px 10px !important;
    overflow: hidden !important;
    min-width: 0 !important;
  }
  .kpi-value, .kpi-val, .summary-value { font-size: 16px !important; letter-spacing: -0.3px !important; }
  .kpi-label, .kpi-lbl, .summary-label { font-size: 9px !important; line-height: 1.3 !important; }
  .kpi-sub { font-size: 10px !important; }

  /* â”€â”€ TABLEAUX â€” scroll interne propre â”€â”€ */
  .echeancier-wrap,
  div[style*="overflow-x"],
  .section-body, .section-content,
  .table-wrap, .table-card, .table-container,
  .card > div { overflow-x: auto !important; -webkit-overflow-scrolling: touch !important; }
  table { min-width: 460px !important; font-size: 11px !important; }
  
  /* â”€â”€ INPUTS TOUCH (Ã©vite zoom iOS) â”€â”€ */
  input[type=text], input[type=number], input[type=email],
  input[type=date], input[type=tel], input[type=password],
  select, textarea {
    font-size: 16px !important;
    -webkit-appearance: none !important;
  }
  .field-wrap, .mfield-wrap, .sim-fw {
    min-height: 46px !important;
    padding: 10px 12px !important;
  }

  /* â”€â”€ BOUTONS â”€â”€ */
  .btn { min-height: 40px !important; }
  .btn-xs, .btn-sm { min-height: 34px !important; }

  /* â”€â”€ PILOTAGE SUMMARY CARDS â”€â”€ */
  .summary-card .kpi-value,
  .summary-card .summary-value { white-space: nowrap !important; overflow: hidden !important; text-overflow: ellipsis !important; }
  .summary-card .kpi-sub,
  .summary-card .summary-sub { white-space: normal !important; font-size: 10px !important; }

  /* â”€â”€ SECTION HEAD â”€â”€ */
  .section-head { flex-wrap: wrap !important; gap: 6px !important; padding: 10px 12px !important; }
  .section-head .btn, .section-head button { font-size: 10px !important; padding: 4px 8px !important; }

  /* â”€â”€ MONTH STRIP (panier moyen) â”€â”€ */
  .month-strip { overflow-x: auto !important; -webkit-overflow-scrolling: touch !important; flex-wrap: nowrap !important; padding-bottom: 6px !important; }
  .mbtn { flex-shrink: 0 !important; }

  /* â”€â”€ YEAR BAR â”€â”€ */
  .yr-bar { overflow-x: auto !important; flex-wrap: nowrap !important; -webkit-overflow-scrolling: touch !important; }
  .yr { flex-shrink: 0 !important; }

  /* â”€â”€ TABS â”€â”€ */
  .tabs { overflow-x: auto !important; -webkit-overflow-scrolling: touch !important; flex-wrap: nowrap !important; width: 100% !important; }
  .tab { flex-shrink: 0 !important; white-space: nowrap !important; }

  /* â”€â”€ DETTE CARDS â”€â”€ */
  .dette-head { flex-wrap: wrap !important; gap: 8px !important; }
  .dette-stats { flex-direction: column !important; align-items: flex-start !important; gap: 4px !important; }

  /* â”€â”€ SAISIE (panier) â”€â”€ */
  .saisie-head { flex-direction: column !important; gap: 8px !important; align-items: flex-start !important; }

  /* â”€â”€ HERO (profil) â”€â”€ */
  .hero { flex-direction: column !important; text-align: center !important; padding: 16px !important; gap: 12px !important; }
  .hero-right { text-align: center !important; }
  .hero-tags { justify-content: center !important; }
  .hero-name { font-size: 17px !important; }

  /* â”€â”€ MODAL â†’ bottom sheet â”€â”€ */
  .overlay, .modal-overlay { align-items: flex-end !important; padding: 0 !important; }
  .modal {
    width: 100% !important; max-width: 100% !important;
    margin: 0 !important;
    border-radius: 18px 18px 0 0 !important;
    max-height: 92vh !important;
  }

  /* â”€â”€ CANVAS â”€â”€ */
  canvas { max-width: 100% !important; }

  /* â”€â”€ CONTEXT BAR (dashboard) â”€â”€ */
  .context-bar { flex-wrap: wrap !important; gap: 8px !important; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PETIT MOBILE â‰¤420px â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 420px) {
  .kpi-grid-4, .kpi-grid-5, .kpi-grid, .kpi-row,
  .fiche-kpis, .summary-grid, .fact-kpis,
  .type-grid, .results-row, .sim-g { grid-template-columns: 1fr !important; }
  .sim-rg, .sim-result-grid, .cle-inputs { grid-template-columns: 1fr !important; }
  .calendar-grid { grid-template-columns: repeat(3, 1fr) !important; }
}
</style>
</head>
<body>
  <button class="hamburger" id="hamburger" onclick="toggleSidebar()" aria-label="Menu">
    <span></span><span></span><span></span>
  </button>
  <div class="nav-overlay" id="navOverlay" onclick="closeSidebar()"></div>
<nav>
  <div class="logo"><div class="logo-i">ğŸ“Š</div><div class="logo-t">ALTEORE</div></div>
  <div class="ns">Principal</div>
  <div class="ni" id="nav-dashboard" onclick="location.href='dashboard.html'"><span>ğŸ </span><span>Tableau de bord</span></div>
  <div class="ni" id="nav-suivi" onclick="location.href='suivi-ca.html'"><span>ğŸ“ˆ</span><span>Suivi CA & RÃ©sultats</span></div>
  <div class="ni" id="nav-kpis" onclick="toggleNav('kpis-sub',this)"><span>ğŸ¯</span><span style="flex:1">KPIs ClÃ©s</span><span class="chev" id="chev-kpis">â€º</span></div>
  <div class="sub" id="kpis-sub">
    <div class="si" id="nav-cout" onclick="location.href='cout-revient.html'"><span class="dot"></span>CoÃ»t de revient</div>
    <div class="si" id="nav-marges" onclick="location.href='marges.html'"><span class="dot"></span>Marge brute &amp; nette</div>
    <div class="si" id="nav-panier" onclick="location.href='panier-moyen.html'"><span class="dot"></span>Panier moyen</div>
  </div>
  <div class="ni" id="nav-pilotage" onclick="toggleNav('pil-sub',this)"><span>ğŸ§­</span><span style="flex:1">Pilotage</span><span class="chev" id="chev-pil">â€º</span></div>
  <div class="sub" id="pil-sub">
    <div class="si" onclick="location.href='pilotage.html?year=2025'"><span class="dot"></span>Pilotage 2025</div>
    <div class="si" onclick="location.href='pilotage.html?year=2026'"><span class="dot"></span>Pilotage 2026</div>
    <div class="si" onclick="location.href='pilotage.html?year=2027'"><span class="dot"></span>Pilotage 2027</div>
  </div>
  <div class="ni" id="nav-dettes" onclick="location.href='dettes.html'"><span>ğŸ¦</span><span>Dettes &amp; Emprunts</span></div>
    <div class="ns">FidÃ©lisation</div>
  <div class="ni" onclick="toggleFidNav(this)"><span>ğŸ’</span><span style="flex:1">FidÃ©lisation</span><span style="font-size:11px;color:rgba(255,255,255,.3);transition:transform .25s;margin-left:auto" class="fid-chev">â€º</span></div>
  <div class="sub" id="fid-nav-sub">
    <div class="si" onclick="location.href='fidelisation.html'"><span class="dot"></span>Dashboard fidÃ©litÃ©</div>
    <div class="si" onclick="location.href='fidelisation.html';setTimeout(()=>switchTab&&switchTab('clients',null),300)"><span class="dot"></span>Clients</div>
    <div class="si" onclick="location.href='fidelisation.html';setTimeout(()=>switchTab&&switchTab('carte',null),300)"><span class="dot"></span>Carte fidÃ©litÃ©</div>
    <div class="si" onclick="location.href='fidelisation.html';setTimeout(()=>switchTab&&switchTab('points',null),300)"><span class="dot"></span>Points & RÃ©compenses</div>
    <div class="si" onclick="location.href='fidelisation.html';setTimeout(()=>switchTab&&switchTab('coupons',null),300)"><span class="dot"></span>Coupons & Offres</div>
    <div class="si" onclick="location.href='fidelisation.html';setTimeout(()=>switchTab&&switchTab('campagnes',null),300)"><span class="dot"></span>Campagnes</div>
  </div>
  <div class="ni" onclick="location.href='import.html'" style="border-top:1px solid rgba(255,255,255,.08);padding-top:10px"><span>ğŸ“¥</span><span>Import de donnÃ©es</span></div>
<div class="nav-footer">
    <div class="ucard" onclick="location.href='profil.html'" style="cursor:pointer;transition:.15s" title="Mon compte">
      <div class="uav" id="av">A</div>
      <div><div class="un" id="uname">Utilisateur</div><div class="upl">Plan gratuit</div></div>
      <button class="lbtn" onclick="doLogout()">â‹</button>
    </div>
  </div>
</nav>

<main>
  <div class="topbar">
    <div>
      <h1>Panier moyen <span class="badge">HT</span></h1>
      <p>SÃ©lectionnez un mois Â· Saisissez vos donnÃ©es Â· Les calculs sont automatiques</p>
    </div>
    <div class="tb-right">
      <div class="yr-bar" id="yrBar"></div>
      <button class="btn btn-primary" onclick="saveData()">ğŸ’¾ Sauvegarder</button>
    </div>
  </div>

  <div class="page">

    <!-- SÃ‰LECTEUR DE MOIS -->
    <div>
      <div style="font-size:12px;font-weight:700;color:var(--muted);margin-bottom:8px;text-transform:uppercase;letter-spacing:.5px">ğŸ“… Choisissez le mois Ã  saisir</div>
      <div class="month-strip" id="monthStrip"></div>
    </div>

    <!-- ZONE DE SAISIE -->
    <div class="saisie">
      <div class="saisie-head">
        <div class="saisie-title">âœï¸ DonnÃ©es du mois <span class="badge">HT</span></div>
        <div class="saisie-month" id="selectedMonthLabel">Janvier 2026</div>
      </div>
      <div class="saisie-body">
        <div class="fields-grid">
          <div class="field">
            <div class="field-lbl"><span class="field-icon">ğŸ‘¥</span> Nombre de clients</div>
            <div class="field-wrap">
              <input class="field-input" id="f-cli" type="number" placeholder="ex: 45" oninput="onInput()" onchange="onInput()"/>
              <span class="field-unit">clients</span>
            </div>
          </div>
          <div class="field">
            <div class="field-lbl"><span class="field-icon">ğŸ’¶</span> Chiffre d'affaires HT</div>
            <div class="field-wrap">
              <input class="field-input" id="f-ca" type="number" placeholder="ex: 4500" oninput="onInput()" onchange="onInput()"/>
              <span class="field-unit">â‚¬ HT</span>
            </div>
          </div>
          <div class="field">
            <div class="field-lbl"><span class="field-icon">ğŸ”„</span> Nombre de ventes</div>
            <div class="field-wrap">
              <input class="field-input" id="f-txn" type="number" placeholder="ex: 60" oninput="onInput()" onchange="onInput()"/>
              <span class="field-unit">transactions</span>
            </div>
          </div>
        </div>
        <!-- RÃ‰SULTATS AUTO -->
        <div class="results-row">
          <div class="res-box highlight">
            <div class="res-label">ğŸ›’ Panier/vente HT</div>
            <div class="res-val green" id="r-pv">â€”</div>
            <div class="res-hint">CA Ã· nb ventes</div>
          </div>
          <div class="res-box highlight">
            <div class="res-label">ğŸ‘¤ Panier/client HT</div>
            <div class="res-val green" id="r-pc">â€”</div>
            <div class="res-hint">CA Ã· nb clients</div>
          </div>
          <div class="res-box">
            <div class="res-label">ğŸ” Ventes/client</div>
            <div class="res-val blue" id="r-vc">â€”</div>
            <div class="res-hint">nb ventes Ã· nb clients</div>
          </div>
          <div class="res-box">
            <div class="res-label">ğŸ“ˆ Ã‰vol. panier/vente</div>
            <div class="res-val" id="r-evo">â€”</div>
            <div class="res-hint">vs mois prÃ©cÃ©dent</div>
          </div>
        </div>
      </div>
    </div>

    <!-- KPIs -->
    <div class="kpi-row">
      <div class="kpi blue"><div class="kpi-ico">ğŸ›’</div><div class="kpi-lbl">Panier moy./vente HT</div><div class="kpi-val" id="k-pv">â€”</div><div class="kpi-sub">Moy. annuelle</div><div class="kpi-trend" id="k-pv-t"></div></div>
      <div class="kpi green"><div class="kpi-ico">ğŸ‘¤</div><div class="kpi-lbl">Panier moy./client HT</div><div class="kpi-val" id="k-pc">â€”</div><div class="kpi-sub">Moy. annuelle</div><div class="kpi-trend" id="k-pc-t"></div></div>
      <div class="kpi"><div class="kpi-ico">ğŸ’¶</div><div class="kpi-lbl">CA total HT (annÃ©e)</div><div class="kpi-val" id="k-ca">â€”</div><div class="kpi-sub">Cumul annuel</div></div>
      <div class="kpi orange"><div class="kpi-ico">ğŸ”„</div><div class="kpi-lbl">Ventes / mois (moy.)</div><div class="kpi-val" id="k-txn">â€”</div><div class="kpi-sub">Moy. mensuelle</div></div>
      <div class="kpi purple"><div class="kpi-ico">ğŸ‘¥</div><div class="kpi-lbl">Clients / mois (moy.)</div><div class="kpi-val" id="k-cli">â€”</div><div class="kpi-sub">Moy. mensuelle</div></div>
    </div>

    <!-- GRAPHIQUES -->
    <div class="g2">
      <div class="card"><div class="card-t">ğŸ“ˆ Ã‰volution panier moyen HT<span class="card-s">par vente et par client</span></div><div style="height:190px"><canvas id="cEvol"></canvas></div></div>
      <div class="card"><div class="card-t">ğŸ© CA par catÃ©gorie HT</div><div style="height:190px"><canvas id="cCat"></canvas></div></div>
    </div>
    <div class="g3">
      <div class="card"><div class="card-t">ğŸ‘¥ Clients / mois</div><div style="height:130px"><canvas id="cCli"></canvas></div></div>
      <div class="card"><div class="card-t">ğŸ”„ Transactions / mois</div><div style="height:130px"><canvas id="cTxn"></canvas></div></div>
      <div class="card"><div class="card-t">ğŸ’¶ CA mensuel HT</div><div style="height:130px"><canvas id="cCA"></canvas></div></div>
    </div>

    <!-- CATÃ‰GORIES -->
    <div>
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
        <div>
          <div style="font-size:14px;font-weight:700">ğŸ“¦ Panier par catÃ©gorie <span class="badge">HT</span></div>
          <div style="font-size:11px;color:var(--muted);margin-top:2px">Comparez vos catÃ©gories de produits ou services</div>
        </div>
        <button class="btn btn-o btn-xs" onclick="addCat()">+ Ajouter</button>
      </div>
      <div class="cats" id="catsGrid"></div>
    </div>

    <!-- SIMULATEUR -->
    <div class="sim">
      <div class="sim-h">
        <div class="sim-ht">ğŸ”® Simulateur d'impact CA <span style="font-size:11px;opacity:.6;font-weight:400">â€” HT</span></div>
        <button class="btn btn-xs" style="background:rgba(255,255,255,.15);color:#fff;border:1px solid rgba(255,255,255,.25)" onclick="resetSim()">â†º RÃ©initialiser</button>
      </div>
      <div class="sim-b">
        <div class="sim-g">
          <div class="sim-lev"><div class="sim-ll">ğŸ›’ Panier/vente HT</div><div class="sim-fw"><input class="sim-fi" id="s-pv" type="number" placeholder="0" oninput="calcSim()" onchange="calcSim()"/><span class="sim-fu">â‚¬</span></div></div>
          <div class="sim-lev"><div class="sim-ll">ğŸ”„ Nb ventes / mois</div><div class="sim-fw"><input class="sim-fi" id="s-txn" type="number" placeholder="0" oninput="calcSim()" onchange="calcSim()"/><span class="sim-fu">ventes</span></div></div>
          <div class="sim-lev"><div class="sim-ll">ğŸ‘¥ Nb clients / mois</div><div class="sim-fw"><input class="sim-fi" id="s-cli" type="number" placeholder="0" oninput="calcSim()" onchange="calcSim()"/><span class="sim-fu">clients</span></div></div>
          <div class="sim-lev"><div class="sim-ll">ğŸ“… PÃ©riode</div><div class="sim-fw"><input class="sim-fi" id="s-mois" type="number" value="12" oninput="calcSim()" onchange="calcSim()"/><span class="sim-fu">mois</span></div></div>
        </div>
        <div class="sim-res">
          <div class="sim-rt">ğŸ“Š RÃ©sultat simulÃ© vs situation actuelle â€” HT</div>
          <div class="sim-rg">
            <div class="sim-ri"><div class="sim-rl">Panier/vente HT</div><div class="sim-rc" id="sr-pv-c">â€”</div><div class="sim-rn" id="sr-pv-n">â€”</div><div class="sim-rd" id="sr-pv-d"></div></div>
            <div class="sim-ri"><div class="sim-rl">CA mensuel HT</div><div class="sim-rc" id="sr-cam-c">â€”</div><div class="sim-rn" id="sr-cam-n">â€”</div><div class="sim-rd" id="sr-cam-d"></div></div>
            <div class="sim-ri"><div class="sim-rl">CA annuel HT</div><div class="sim-rc" id="sr-caa-c">â€”</div><div class="sim-rn" id="sr-caa-n">â€”</div><div class="sim-rd" id="sr-caa-d"></div></div>
            <div class="sim-ri"><div class="sim-rl">Panier/client HT</div><div class="sim-rc" id="sr-pc-c">â€”</div><div class="sim-rn" id="sr-pc-n">â€”</div><div class="sim-rd" id="sr-pc-d"></div></div>
            <div class="sim-ri"><div class="sim-rl">Ventes/client</div><div class="sim-rc" id="sr-vc-c">â€”</div><div class="sim-rn" id="sr-vc-n">â€”</div><div class="sim-rd" id="sr-vc-d"></div></div>
          </div>
        </div>
      </div>
    </div>

  </div>
</main>

<div class="toast" id="toast"></div>

<script>
const MN=['Janvier','FÃ©vrier','Mars','Avril','Mai','Juin','Juillet','AoÃ»t','Septembre','Octobre','Novembre','DÃ©cembre'];
const COLORS=['#4f7ef8','#10b981','#f59e0b','#ef4444','#6366f1','#14b8a6','#ec4899','#8b5cf6'];
let _yr=new Date().getFullYear(), _mi=new Date().getMonth(), _charts={};

// â”€â”€ STORAGE â”€â”€
function lk(y){return'alteore_pm_'+y}
function ck(y){return'alteore_pm_cats_'+y}
function loadM(y){try{const d=localStorage.getItem(lk(y));if(d)return JSON.parse(d)}catch(e){}return Array(12).fill(null).map(()=>({cli:'',ca:'',txn:''}))}
function saveM(y,d){localStorage.setItem(lk(y),JSON.stringify(d))}
function loadC(y){try{const d=localStorage.getItem(ck(y));if(d)return JSON.parse(d)}catch(e){}return[]}
function saveC(y,d){localStorage.setItem(ck(y),JSON.stringify(d))}

let months=loadM(_yr), cats=loadC(_yr);

// â”€â”€ UTILS â”€â”€
function fe(n){return(parseFloat(n)||0).toLocaleString('fr-FR',{minimumFractionDigits:2,maximumFractionDigits:2})+' â‚¬'}
function fi(n){return Math.round(parseFloat(n)||0).toLocaleString('fr-FR')}
function set(id,v){const e=document.getElementById(id);if(e)e.textContent=v}
function setC(id,cls){const e=document.getElementById(id);if(e)e.className=cls}
function calc(m){const c=parseFloat(m.cli)||0,a=parseFloat(m.ca)||0,t=parseFloat(m.txn)||0;return{c,a,t,pv:t>0?a/t:0,pc:c>0?a/c:0,vc:c>0?t/c:0}}
function toggleSub(){document.getElementById('ksub').classList.toggle('open')}
function togglePil(el){document.getElementById('psub').classList.toggle('open');el.classList.toggle('on')}
async function doLogout(){try{if(window._signOut&&window._auth)await window._signOut(window._auth)}catch(e){}location.href='index.html'}

// â”€â”€ YEAR BAR â”€â”€
function buildYr(){
  document.getElementById('yrBar').innerHTML=[2024,2025,2026,2027].map(y=>
    `<button class="yr ${y===_yr?'on':''}" onclick="switchYr(${y})">${y}</button>`).join('');
}
function switchYr(y){saveM(_yr,months);saveC(_yr,cats);_yr=y;months=loadM(y);cats=loadC(y);buildYr();buildStrip();renderAll()}

// â”€â”€ MONTH STRIP â”€â”€
function buildStrip(){
  document.getElementById('monthStrip').innerHTML=MN.map((m,i)=>{
    const d=months[i];const hasData=d&&(d.cli||d.ca||d.txn);
    return`<button class="mbtn ${i===_mi?'on':''} ${hasData?'has-data':''}" onclick="selMonth(${i})">${m.slice(0,3)}</button>`;
  }).join('');
  document.getElementById('selectedMonthLabel').textContent=MN[_mi]+' '+_yr;
}
function selMonth(i){_mi=i;buildStrip();fillForm()}

// â”€â”€ FORM â”€â”€
function fillForm(){
  const m=months[_mi];
  document.getElementById('f-cli').value=m.cli||'';
  document.getElementById('f-ca').value=m.ca||'';
  document.getElementById('f-txn').value=m.txn||'';
  updateResults();
}

function onInput(){
  months[_mi].cli=document.getElementById('f-cli').value;
  months[_mi].ca=document.getElementById('f-ca').value;
  months[_mi].txn=document.getElementById('f-txn').value;
  updateResults();
  buildStrip();
  renderKPIs();
  renderCharts();
  prefillSim();
}

function updateResults(){
  const m=months[_mi];
  const c=calc(m);
  // Panier/vente
  set('r-pv', c.pv>0?fe(c.pv):'â€”');
  set('r-pc', c.pc>0?fe(c.pc):'â€”');
  set('r-vc', c.vc>0?c.vc.toFixed(2):'â€”');
  // Ã‰volution vs mois prÃ©cÃ©dent
  const prev=months[_mi>0?_mi-1:0];
  const cp=calc(prev);
  const rEvo=document.getElementById('r-evo');
  if(_mi>0&&cp.pv>0&&c.pv>0){
    const d=(c.pv-cp.pv)/cp.pv*100;
    rEvo.textContent=(d>=0?'â–² +':'â–¼ ')+Math.abs(d).toFixed(1)+'%';
    rEvo.className='res-val '+(d>=0?'green':'down');
  } else { rEvo.textContent='â€”'; rEvo.className='res-val'; }
}

// â”€â”€ KPIs â”€â”€
function getStats(){
  const active=months.map((m,i)=>({...calc(m),i})).filter(m=>m.a>0||m.c>0||m.t>0);
  if(!active.length)return null;
  const caT=active.reduce((s,m)=>s+m.a,0),txnT=active.reduce((s,m)=>s+m.t,0),cliT=active.reduce((s,m)=>s+m.c,0),n=active.length;
  return{pv:txnT>0?caT/txnT:0,pc:cliT>0?caT/cliT:0,caTotal:caT,txnAvg:txnT/n,cliAvg:cliT/n,active};
}

function renderKPIs(){
  const s=getStats();
  if(!s){['k-pv','k-pc','k-ca','k-txn','k-cli'].forEach(id=>set(id,'â€”'));return}
  set('k-pv',fe(s.pv)); set('k-pc',fe(s.pc)); set('k-ca',fe(s.caTotal));
  set('k-txn',fi(s.txnAvg)); set('k-cli',fi(s.cliAvg));
  const a=s.active;
  if(a.length>=2){
    const l=a[a.length-1],p=a[a.length-2];
    if(p.pv>0){const d=(l.pv-p.pv)/p.pv*100;document.getElementById('k-pv-t').innerHTML=`<span class="${d>=0?'up':'down'}">${d>=0?'â–²':'â–¼'} ${Math.abs(d).toFixed(1)}%</span>`}
    if(p.pc>0){const d=(l.pc-p.pc)/p.pc*100;document.getElementById('k-pc-t').innerHTML=`<span class="${d>=0?'up':'down'}">${d>=0?'â–²':'â–¼'} ${Math.abs(d).toFixed(1)}%</span>`}
  }
}

// â”€â”€ CHARTS â”€â”€
function dc(id){if(_charts[id]){try{_charts[id].destroy()}catch(e){}delete _charts[id]}}
function renderCharts(){
  const pvD=months.map(m=>calc(m).pv||null);
  const pcD=months.map(m=>calc(m).pc||null);
  const cliD=months.map(m=>parseFloat(m.cli)||null);
  const txnD=months.map(m=>parseFloat(m.txn)||null);
  const caD=months.map(m=>parseFloat(m.ca)||null);

  dc('cEvol');const e=document.getElementById('cEvol');if(e)_charts.cEvol=new Chart(e,{type:'line',data:{labels:MN,datasets:[
    {label:'Panier/vente HT',data:pvD,borderColor:'#4f7ef8',backgroundColor:'#4f7ef822',tension:.4,fill:true,pointRadius:4,borderWidth:2.5,spanGaps:true},
    {label:'Panier/client HT',data:pcD,borderColor:'#10b981',backgroundColor:'#10b98122',tension:.4,fill:true,pointRadius:4,borderWidth:2.5,spanGaps:true},
  ]},options:{responsive:true,maintainAspectRatio:false,interaction:{mode:'index',intersect:false},plugins:{legend:{position:'bottom',labels:{font:{size:11},boxWidth:11}}},scales:{y:{beginAtZero:true,ticks:{callback:v=>v+'â‚¬'}}}}});

  dc('cCat');const cat=document.getElementById('cCat');if(cat){
    const cd=cats.map(c=>parseFloat(c.ca)||0).filter(v=>v>0);
    const cl=cats.filter(c=>parseFloat(c.ca)>0).map(c=>c.nom||'Sans nom');
    _charts.cCat=new Chart(cat,{type:'doughnut',data:{labels:cd.length?cl:['Aucune catÃ©gorie'],datasets:[{data:cd.length?cd:[1],backgroundColor:cd.length?COLORS.slice(0,cd.length):['#e2e8f0'],borderWidth:2,borderColor:'#fff',hoverOffset:5}]},options:{responsive:true,maintainAspectRatio:false,cutout:'55%',plugins:{legend:{position:'bottom',labels:{font:{size:11},boxWidth:10}}}}});
  }

  function bar(id,data,color){dc(id);const el=document.getElementById(id);if(el)_charts[id]=new Chart(el,{type:'bar',data:{labels:MN,datasets:[{data,backgroundColor:color+'bb',borderRadius:3}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}})}
  bar('cCli',cliD,'#6366f1'); bar('cTxn',txnD,'#f59e0b');
  dc('cCA');const ca=document.getElementById('cCA');if(ca)_charts.cCA=new Chart(ca,{type:'line',data:{labels:MN,datasets:[{data:caD,borderColor:'#4f7ef8',backgroundColor:'#4f7ef822',fill:true,tension:.4,pointRadius:3,borderWidth:2,spanGaps:true}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,ticks:{callback:v=>v+'â‚¬'}}}}});
}

// â”€â”€ CATÃ‰GORIES â”€â”€
function renderCats(){
  const grid=document.getElementById('catsGrid');
  grid.innerHTML=cats.map((c,i)=>{
    const a=parseFloat(c.ca)||0,t=parseFloat(c.txn)||0,cl=parseFloat(c.cli)||0;
    const pv=t>0?fe(a/t):'â€”',pc=cl>0?fe(a/cl):'â€”',vc=cl>0?(t/cl).toFixed(2):'â€”';
    return`<div class="cat" style="border-top:3px solid ${COLORS[i%8]}">
      <div class="cat-top"><div class="cat-bar" style="background:${COLORS[i%8]}"></div>
        <input class="cat-name" value="${c.nom||''}" placeholder="Nom catÃ©gorie..." oninput="updCat(${i},'nom',this.value)"/>
        <button class="btn btn-d btn-xs" onclick="delCat(${i})">âœ•</button></div>
      <div class="cat-body">
        <div class="cat-row"><span>CA mensuel HT</span><input class="cat-in" type="number" placeholder="0" value="${c.ca||''}" oninput="updCat(${i},'ca',this.value)" onchange="updCat(${i},'ca',this.value)"/> <span class="cat-r" style="font-size:10px;color:var(--muted)">â‚¬</span></div>
        <div class="cat-row"><span>Nb ventes/mois</span><input class="cat-in" type="number" placeholder="0" value="${c.txn||''}" oninput="updCat(${i},'txn',this.value)" onchange="updCat(${i},'txn',this.value)"/></div>
        <div class="cat-row"><span>Nb clients/mois</span><input class="cat-in" type="number" placeholder="0" value="${c.cli||''}" oninput="updCat(${i},'cli',this.value)" onchange="updCat(${i},'cli',this.value)"/></div>
        <div class="cat-div"></div>
        <div class="cat-row"><span>ğŸ›’ Panier/vente HT</span><div class="cat-r blue">${pv}</div></div>
        <div class="cat-row"><span>ğŸ‘¤ Panier/client HT</span><div class="cat-r green">${pc}</div></div>
        <div class="cat-row"><span>ğŸ” Ventes/client</span><div class="cat-r">${vc}</div></div>
      </div></div>`;
  }).join('')+`<div class="add-cat" onclick="addCat()"><span style="font-size:18px">+</span> Nouvelle catÃ©gorie</div>`;
}
function addCat(){cats.push({nom:'',ca:'',txn:'',cli:''});renderCats();renderCharts()}
function delCat(i){cats.splice(i,1);renderCats();renderCharts()}
function updCat(i,f,v){cats[i][f]=v;renderCats();renderCharts()}

// â”€â”€ SIMULATEUR â”€â”€
function prefillSim(){
  const s=getStats();if(!s)return;
  document.getElementById('s-pv').placeholder=s.pv.toFixed(2);
  document.getElementById('s-txn').placeholder=Math.round(s.txnAvg);
  document.getElementById('s-cli').placeholder=Math.round(s.cliAvg);
  const cam=s.pv*s.txnAvg;
  set('sr-pv-c',s.pv>0?fe(s.pv):'â€”'); set('sr-cam-c',cam>0?fe(cam):'â€”');
  set('sr-caa-c',fe(s.caTotal)); set('sr-pc-c',s.pc>0?fe(s.pc):'â€”');
  const vc=s.cliAvg>0?s.txnAvg/s.cliAvg:0; set('sr-vc-c',vc>0?vc.toFixed(2):'â€”');
}
function calcSim(){
  const s=getStats();
  const pv=parseFloat(document.getElementById('s-pv').value)||(s?s.pv:0);
  const txn=parseFloat(document.getElementById('s-txn').value)||(s?s.txnAvg:0);
  const cli=parseFloat(document.getElementById('s-cli').value)||(s?s.cliAvg:0);
  const mois=parseFloat(document.getElementById('s-mois').value)||12;
  const camS=pv*txn, caaS=camS*mois, pcS=cli>0?camS/cli:0, vcS=cli>0?txn/cli:0;
  const camC=s?s.pv*s.txnAvg:0;
  function rr(nId,dId,nv,cv,isE=true){
    const d=nv-cv,pos=d>=0,fmt=isE?fe:(v=>v.toFixed(2));
    const en=document.getElementById(nId);if(en){en.textContent=fmt(nv);en.className='sim-rn '+(nv<0?'neg':pos?'pos':'')}
    const ed=document.getElementById(dId);if(ed){ed.textContent=(pos?'+':'')+fmt(d);ed.className='sim-rd '+(pos?'pos':'neg')}
  }
  rr('sr-pv-n','sr-pv-d',pv,s?s.pv:0);
  rr('sr-cam-n','sr-cam-d',camS,camC);
  rr('sr-caa-n','sr-caa-d',caaS,s?s.caTotal:0);
  rr('sr-pc-n','sr-pc-d',pcS,s?s.pc:0);
  rr('sr-vc-n','sr-vc-d',vcS,s&&s.cliAvg>0?s.txnAvg/s.cliAvg:0,false);
}
function resetSim(){['s-pv','s-txn','s-cli'].forEach(id=>document.getElementById(id).value='');document.getElementById('s-mois').value='12';calcSim()}


async function saveData(){
  saveM(_yr,months);saveC(_yr,cats);
  if(window._uid&&window._setDoc)window._setDoc(window._doc(window._db,'panier',window._uid,'data','all'),{[`y${_yr}`]:{months,cats}},{merge:true}).catch(()=>{});
  showToast('âœ… SauvegardÃ© !','ok');
}
function showToast(msg,type){const t=document.getElementById('toast');t.textContent=msg;t.className='toast show '+(type||'');setTimeout(()=>t.className='toast',3000)}

function renderAll(){buildStrip();fillForm();renderKPIs();renderCharts();renderCats();prefillSim()}
async function tryFirebase(){
  if(!window._uid||!window._getDoc)return;
  try{
    const snap=await window._getDoc(window._doc(window._db,'panier',window._uid,'data','all'));
    if(snap.exists()){const d=snap.data()[`y${_yr}`];if(d&&d.months){months=d.months;if(d.cats)cats=d.cats;renderAll()}}
    const u=window._auth?.currentUser;if(u){const n=u.displayName||u.email?.split('@')[0]||'';document.getElementById('uname').textContent=n;document.getElementById('av').textContent=n[0]?.toUpperCase()||'A'}
  }catch(e){}
}

// â”€â”€ START IMMÃ‰DIAT â”€â”€
buildYr(); renderAll();
setTimeout(tryFirebase,500);

  main.addEventListener('change', e=>{
    if(e.target.matches('select'))
  });
});
</script>

<script type="module">
import{initializeApp}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import{getAuth,onAuthStateChanged,signOut}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import{getFirestore,doc,setDoc,getDoc}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
const app=initializeApp({apiKey:"AIzaSyB003WqdRKrT0gbv7P4BNIICuXeqbu8dR4",authDomain:"alteore-70599.firebaseapp.com",projectId:"alteore-70599",storageBucket:"alteore-70599.firebasestorage.app",messagingSenderId:"120905555746",appId:"1:120905555746:web:618460c65cdc9e57cc8f7b"});
const auth=getAuth(app),db=getFirestore(app);
window._auth=auth;window._db=db;window._doc=doc;window._setDoc=setDoc;window._getDoc=getDoc;window._signOut=signOut;
onAuthStateChanged(auth,user=>{if(!user){location.href='index.html';return}window._uid=user.uid;tryFirebase()});
</script>

<script>
function toggleNav(subId, el) {
  const sub = document.getElementById(subId);
  const isOpen = sub.classList.contains('open');
  sub.classList.toggle('open');
  // rotate chevron
  const chevId = subId === 'kpis-sub' ? 'chev-kpis' : 'chev-pil';
  const chev = document.getElementById(chevId);
  if (chev) chev.style.transform = isOpen ? '' : 'rotate(90deg)';
}
function activatePage(pageId, openSub) {
  const el = document.getElementById(pageId);
  if (el) el.classList.add('on');
  if (openSub) {
    const sub = document.getElementById(openSub);
    if (sub) sub.classList.add('open');
    const chevId = openSub === 'kpis-sub' ? 'chev-kpis' : 'chev-pil';
    const chev = document.getElementById(chevId);
    if (chev) chev.style.transform = 'rotate(90deg)';
  }
}
</script>
<script>document.addEventListener('DOMContentLoaded',()=>activatePage('nav-panier','kpis-sub'));</script>



<script>
(function(){
  function toggleSidebar(){
    var nav = document.querySelector('nav') || document.querySelector('.sidebar');
    var btn = document.getElementById('hamburger');
    var overlay = document.getElementById('navOverlay');
    var isOpen = nav.classList.contains('open');
    if(isOpen){ closeSidebar(); return; }
    nav.classList.add('open');
    btn.classList.add('open');
    overlay.classList.add('show');
    document.body.style.overflow = 'hidden';
  }
  function closeSidebar(){
    var nav = document.querySelector('nav') || document.querySelector('.sidebar');
    var btn = document.getElementById('hamburger');
    var overlay = document.getElementById('navOverlay');
    nav.classList.remove('open');
    btn.classList.remove('open');
    overlay.classList.remove('show');
    document.body.style.overflow = '';
  }
  window.toggleSidebar = toggleSidebar;
  window.closeSidebar = closeSidebar;
  document.addEventListener('DOMContentLoaded', function(){
    var nav = document.querySelector('nav') || document.querySelector('.sidebar');
    if(!nav) return;
    nav.querySelectorAll('.ni, .si, .nav-item, .sub-item').forEach(function(el){
      el.addEventListener('click', function(){
        if(window.innerWidth <= 768) closeSidebar();
      });
    });
  });
})();
</script>
<script>
(function(){
  function getSidebar(){ return document.querySelector('nav, aside.sidebar, .sidebar'); }
  function toggleSidebar(){
    var s=getSidebar(), b=document.getElementById('hamburger'), o=document.getElementById('navOverlay');
    var open=s.classList.contains('open');
    s.classList.toggle('open',!open); b.classList.toggle('open',!open);
    o.classList.toggle('show',!open);
    document.body.style.overflow = open ? '' : 'hidden';
  }
  function closeSidebar(){
    var s=getSidebar(), b=document.getElementById('hamburger'), o=document.getElementById('navOverlay');
    s.classList.remove('open'); b.classList.remove('open'); o.classList.remove('show');
    document.body.style.overflow='';
  }
  window.toggleSidebar=toggleSidebar; window.closeSidebar=closeSidebar;
  document.addEventListener('DOMContentLoaded',function(){
    var s=getSidebar(); if(!s) return;
    s.querySelectorAll('.ni,.si,.nav-item,.sub-item').forEach(function(el){
      el.addEventListener('click',function(){ if(window.innerWidth<=768) closeSidebar(); });
    });
  });
})();
</script>
<script>
function toggleFidNav(el){
  var sub=document.getElementById('fid-nav-sub');
  var chev=el.querySelector('.fid-chev');
  var open=sub.classList.contains('open');
  sub.classList.toggle('open',!open);
  if(chev)chev.style.transform=open?'':'rotate(90deg)';
}
</script>

</body>
</html>
