<!-- ALTEORE espace-salarie v20260227-enrichi -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover"/>
  <title>Mon espace ‚Äî ALTEORE</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"/>
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    :root{
      --g1:#052e16;--g2:#064e23;--g3:#059669;--g4:#10b981;--g5:#34d399;
      --green-light:#d1fae5;--green-ghost:#f0fdf4;
      --text:#111827;--muted:#6b7280;--border:#e5e7eb;--bg:#f0fdf4;
      --red:#ef4444;--red-bg:#fef2f2;
      --orange:#f59e0b;--orange-bg:#fffbeb;
      --blue:#3b82f6;--blue-bg:#eff6ff;
      --purple:#7c3aed;--purple-bg:#faf5ff;
      --teal:#0891b2;--teal-bg:#ecfeff;
      --pink:#db2777;
      --r:14px;
    }
    html,body{overflow-x:hidden;max-width:100vw;}
    body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;font-size:13px;}

    /* ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ */
    #loading-wrap{position:fixed;inset:0;background:var(--g1);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:18px;z-index:999;transition:opacity .4s;}
    #loading-wrap.fade{opacity:0;pointer-events:none;}
    .load-logo{font-size:26px;font-weight:800;color:white;letter-spacing:1px;opacity:.9;}
    .load-sub{font-size:11px;color:rgba(255,255,255,.35);font-weight:500;}
    @keyframes spin{to{transform:rotate(360deg)}}
    .spin{width:26px;height:26px;border:2.5px solid rgba(255,255,255,.12);border-top-color:#34d399;border-radius:50%;animation:spin .7s linear infinite;}

    /* ‚îÄ‚îÄ NOT FOUND ‚îÄ‚îÄ */
    #not-found{display:none;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;text-align:center;padding:32px;background:var(--g1);}
    #not-found.show{display:flex;}
    .nf-icon{font-size:52px;margin-bottom:14px;}
    .nf-title{font-size:20px;font-weight:800;color:white;margin-bottom:8px;}
    .nf-sub{font-size:12px;color:rgba(255,255,255,.45);max-width:290px;line-height:1.7;}

    /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
    .hero{background:linear-gradient(160deg,var(--g1) 0%,var(--g2) 55%,#0a5c30 100%);padding:22px 18px 88px;position:relative;overflow:hidden;}
    .hero::before{content:'';position:absolute;top:-70px;right:-70px;width:260px;height:260px;background:radial-gradient(circle,rgba(52,211,153,.18) 0%,transparent 70%);border-radius:50%;}
    .hero::after{content:'';position:absolute;bottom:-90px;left:25%;width:320px;height:320px;background:radial-gradient(circle,rgba(5,150,105,.12) 0%,transparent 70%);border-radius:50%;}
    .hero-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:22px;position:relative;z-index:1;}
    .hero-brand{display:flex;align-items:center;gap:8px;}
    .hero-brand-icon{width:28px;height:28px;background:rgba(255,255,255,.15);border:1px solid rgba(255,255,255,.2);border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:12px;}
    .hero-brand-name{font-size:13px;font-weight:800;color:rgba(255,255,255,.9);letter-spacing:.5px;}
    .hero-tag{font-size:10px;font-weight:700;color:rgba(255,255,255,.4);background:rgba(255,255,255,.07);padding:3px 9px;border-radius:20px;border:1px solid rgba(255,255,255,.1);}
    .hero-body{position:relative;z-index:1;display:flex;align-items:flex-end;gap:14px;}
    .hero-avatar{width:52px;height:52px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:800;color:white;border:2px solid rgba(255,255,255,.22);flex-shrink:0;}
    .hero-info{flex:1;min-width:0;}
    .hero-name{font-size:19px;font-weight:800;color:white;margin-bottom:2px;line-height:1.2;}
    .hero-sub{font-size:11.5px;color:rgba(255,255,255,.5);line-height:1.5;}
    .hero-chips{display:flex;gap:5px;margin-top:6px;flex-wrap:wrap;}
    .hero-chip{font-size:9.5px;font-weight:700;color:rgba(255,255,255,.65);background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.15);padding:2px 8px;border-radius:20px;}

    /* ‚îÄ‚îÄ ONGLETS NAVIGATION ‚îÄ‚îÄ */
    .tabs-nav{background:white;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:50;overflow-x:auto;scrollbar-width:none;}
    .tabs-nav::-webkit-scrollbar{display:none;}
    .tabs-inner{display:flex;min-width:max-content;padding:0 14px;}
    .tnav{padding:12px 14px;font-size:12px;font-weight:700;color:var(--muted);border:none;background:none;cursor:pointer;border-bottom:2.5px solid transparent;transition:all .18s;display:flex;align-items:center;gap:5px;white-space:nowrap;font-family:'Plus Jakarta Sans',sans-serif;}
    .tnav:hover{color:var(--g3);}
    .tnav.active{color:var(--g3);border-bottom-color:var(--g3);}
    .tnav .notif{background:var(--red);color:white;border-radius:20px;padding:1px 5px;font-size:9px;font-weight:800;}

    /* ‚îÄ‚îÄ SOLDES FLOTTANTS ‚îÄ‚îÄ */
    .soldes-wrap{padding:0 13px;margin-top:-66px;position:relative;z-index:10;}
    .soldes-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:7px;}
    .sc{background:white;border-radius:11px;padding:12px 11px;box-shadow:0 4px 18px rgba(0,0,0,.1);border:1px solid var(--border);}
    .sc-icon{font-size:18px;margin-bottom:4px;}
    .sc-val{font-size:18px;font-weight:800;line-height:1;color:var(--text);}
    .sc-val.g{color:var(--g3);}.sc-val.o{color:var(--orange);}.sc-val.r{color:var(--red);}.sc-val.b{color:var(--blue);}
    .sc-unit{font-size:9px;font-weight:600;}
    .sc-lbl{font-size:8.5px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-top:3px;}
    .sc-sub{font-size:9px;color:var(--muted);margin-top:2px;line-height:1.3;}
    .sc-bar{height:3px;background:#f3f4f6;border-radius:2px;overflow:hidden;margin-top:6px;}
    .sc-fill{height:100%;border-radius:2px;}

    /* ‚îÄ‚îÄ PAGE TABS ‚îÄ‚îÄ */
    .tab-section{display:none;padding:14px 13px 30px;max-width:640px;margin:0 auto;flex-direction:column;gap:14px;}
    .tab-section.active{display:flex;}

    /* ‚îÄ‚îÄ CARD ‚îÄ‚îÄ */
    .card{background:white;border-radius:var(--r);border:1px solid var(--border);overflow:hidden;box-shadow:0 1px 6px rgba(0,0,0,.04);}
    .card-head{display:flex;align-items:center;justify-content:space-between;padding:12px 15px;border-bottom:1px solid var(--border);}
    .card-title{font-size:13px;font-weight:700;display:flex;align-items:center;gap:6px;}
    .card-body{padding:15px;}

    /* ‚îÄ‚îÄ PROFIL ‚îÄ‚îÄ */
    .profil-section-title{font-size:11px;font-weight:800;color:var(--muted);text-transform:uppercase;letter-spacing:.8px;margin:14px 0 8px;padding-bottom:5px;border-bottom:1px solid var(--border);}
    .profil-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px;}
    .profil-field{display:flex;flex-direction:column;gap:3px;}
    .profil-label{font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;}
    .profil-val{font-size:13px;font-weight:600;color:var(--text);padding:8px 10px;background:#f9fafb;border-radius:8px;border:1.5px solid var(--border);}
    .profil-val.editable{cursor:pointer;transition:all .15s;}
    .profil-val.editable:hover{border-color:var(--g3);background:var(--green-ghost);}
    .profil-input{width:100%;padding:8px 10px;border:1.5px solid var(--g3);border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:600;color:var(--text);outline:none;background:white;box-shadow:0 0 0 3px rgba(5,150,105,.07);}
    .profil-input:focus{box-shadow:0 0 0 3px rgba(5,150,105,.12);}
    .profil-full{grid-column:1/-1;}
    .contrat-card{background:linear-gradient(135deg,var(--g1),var(--g2));border-radius:12px;padding:16px 18px;display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:14px;}
    .contrat-left .contrat-type{font-size:15px;font-weight:800;color:white;margin-bottom:4px;}
    .contrat-left .contrat-sub{font-size:11px;color:rgba(255,255,255,.55);line-height:1.5;}
    .contrat-stat{text-align:right;}
    .contrat-stat .cs-val{font-size:18px;font-weight:800;color:#34d399;}
    .contrat-stat .cs-lbl{font-size:9.5px;color:rgba(255,255,255,.45);text-transform:uppercase;letter-spacing:.5px;}
    .btn-save-profil{width:100%;padding:11px;background:linear-gradient(135deg,var(--g3),var(--g4));color:white;border:none;border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;margin-top:14px;display:none;}
    .btn-save-profil.show{display:block;}
    .btn-save-profil:hover{opacity:.9;}
    .urgence-card{background:var(--orange-bg);border:1.5px solid #fde68a;border-radius:10px;padding:12px 14px;display:flex;align-items:center;gap:10px;}
    .urgence-ico{font-size:22px;flex-shrink:0;}
    .urgence-body{flex:1;min-width:0;}
    .urgence-name{font-size:13px;font-weight:700;margin-bottom:1px;}
    .urgence-lien{font-size:11px;color:var(--muted);}
    .urgence-tel{font-size:12px;font-weight:700;color:var(--orange);margin-top:2px;}

    /* ‚îÄ‚îÄ DOCUMENTS ‚îÄ‚îÄ */
    .doc-section-lbl{font-size:11px;font-weight:800;color:var(--muted);text-transform:uppercase;letter-spacing:.8px;margin:14px 0 8px;padding-bottom:5px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
    .doc-item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;border:1.5px solid var(--border);background:white;margin-bottom:7px;transition:all .15s;cursor:pointer;}
    .doc-item:hover{border-color:#6ee7b7;background:var(--green-ghost);}
    .doc-item.uploaded{border-color:#86efac;background:#f0fdf4;}
    .doc-item.required{border-color:#fca5a5;background:#fff5f5;}
    .doc-item.employer{border-color:#bfdbfe;background:#eff6ff;}
    .doc-ico{width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;}
    .doc-ico.g{background:#dcfce7;}
    .doc-ico.r{background:#fee2e2;}
    .doc-ico.b{background:#dbeafe;}
    .doc-ico.o{background:#fef3c7;}
    .doc-info{flex:1;min-width:0;}
    .doc-name{font-size:12px;font-weight:700;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .doc-meta{font-size:10px;color:var(--muted);margin-top:1px;}
    .doc-action{flex-shrink:0;}
    .btn-upload{padding:5px 11px;background:var(--g3);color:white;border:none;border-radius:7px;font-size:11px;font-weight:700;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;transition:all .15s;}
    .btn-upload:hover{opacity:.85;}
    .btn-view{padding:5px 11px;background:#dbeafe;color:#1e40af;border:none;border-radius:7px;font-size:11px;font-weight:700;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;}
    .badge-req{background:#fee2e2;color:#991b1b;font-size:9px;font-weight:800;padding:2px 6px;border-radius:20px;}
    .badge-ok{background:#dcfce7;color:#166534;font-size:9px;font-weight:800;padding:2px 6px;border-radius:20px;}
    .badge-emp{background:#dbeafe;color:#1e40af;font-size:9px;font-weight:800;padding:2px 6px;border-radius:20px;}
    .doc-progress-bar{height:6px;background:#f3f4f6;border-radius:99px;overflow:hidden;margin:8px 0 2px;}
    .doc-progress-fill{height:100%;background:linear-gradient(90deg,var(--g3),var(--g4));border-radius:99px;transition:width .5s ease;}
    .upload-zone{border:2px dashed var(--border);border-radius:10px;padding:20px 14px;text-align:center;cursor:pointer;background:white;transition:all .15s;margin-top:8px;}
    .upload-zone:hover{border-color:var(--g3);background:var(--green-ghost);}
    .upload-zone-icon{font-size:28px;margin-bottom:6px;}
    .upload-zone-txt{font-size:12px;font-weight:600;color:var(--muted);}
    .upload-zone-sub{font-size:10px;color:var(--muted);margin-top:2px;}

    /* ‚îÄ‚îÄ CONG√âS ‚îÄ‚îÄ */
    .stepper{display:flex;align-items:center;gap:0;margin-bottom:18px;}
    .step-dot{width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:800;border:2px solid var(--border);background:white;color:var(--muted);transition:all .3s;flex-shrink:0;}
    .step-dot.done{background:var(--g3);border-color:var(--g3);color:white;}
    .step-dot.active{background:var(--green-ghost);border-color:var(--g3);color:var(--g3);}
    .step-line{flex:1;height:2px;background:var(--border);transition:background .3s;}
    .step-line.done{background:var(--g3);}
    .form-step{display:none;animation:fin .2s ease;}
    .form-step.active{display:block;}
    @keyframes fin{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}
    .type-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:7px;margin-bottom:12px;}
    .tb{padding:10px 9px;border:2px solid var(--border);border-radius:10px;cursor:pointer;text-align:center;background:white;transition:all .15s;font-family:'Plus Jakarta Sans',sans-serif;}
    .tb:hover{border-color:var(--g4);background:var(--green-ghost);}
    .tb.sel{border-color:var(--g3);background:var(--green-ghost);}
    .tb-icon{font-size:19px;margin-bottom:3px;}
    .tb-lbl{font-size:11px;font-weight:700;color:var(--text);display:block;}
    .tb-sub{font-size:9.5px;color:var(--muted);display:block;margin-top:1px;}
    .field{display:flex;flex-direction:column;gap:4px;margin-bottom:11px;}
    .field label{font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;}
    .finput{width:100%;padding:10px 11px;border:1.5px solid var(--border);border-radius:9px;font-family:'Plus Jakarta Sans',sans-serif;font-size:15px;color:var(--text);outline:none;transition:border-color .15s;-webkit-appearance:none;background:white;}
    .finput:focus{border-color:var(--g3);box-shadow:0 0 0 3px rgba(5,150,105,.07);}
    .date-row{display:grid;grid-template-columns:1fr 1fr;gap:9px;}
    .alert{border-radius:8px;padding:9px 11px;font-size:12px;font-weight:600;margin-bottom:9px;display:none;line-height:1.5;}
    .alert.show{display:block;}
    .alert-green{background:var(--green-ghost);color:#065f46;border-left:3px solid var(--g3);}
    .alert-orange{background:var(--orange-bg);color:#92400e;border-left:3px solid var(--orange);}
    .alert-blue{background:var(--blue-bg);color:#1e40af;border-left:3px solid var(--blue);}
    .alert-red{background:var(--red-bg);color:#991b1b;border-left:3px solid var(--red);}
    .resume{border:2px solid var(--green-light);border-radius:10px;padding:13px;background:var(--green-ghost);margin-bottom:11px;}
    .resume-row{display:flex;justify-content:space-between;align-items:center;padding:5px 0;border-bottom:1px solid var(--green-light);font-size:12px;}
    .resume-row:last-child{border-bottom:none;font-weight:700;font-size:13px;padding-top:7px;}
    .resume-row span:first-child{color:var(--muted);}
    .btn{padding:9px 16px;border:none;border-radius:9px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all .18s;display:inline-flex;align-items:center;justify-content:center;gap:5px;}
    .btn-green{background:linear-gradient(135deg,var(--g3),var(--g4));color:white;box-shadow:0 3px 10px rgba(5,150,105,.25);}
    .btn-green:hover{opacity:.9;transform:translateY(-1px);}
    .btn-green:active{transform:translateY(0);}
    .btn-green:disabled{opacity:.4;transform:none;cursor:not-allowed;}
    .btn-ghost{background:white;color:var(--g3);border:1.5px solid var(--green-light);}
    .btn-ghost:hover{background:var(--green-ghost);}
    .btn-row{display:flex;gap:7px;justify-content:flex-end;margin-top:12px;}
    .success-wrap{display:none;flex-direction:column;align-items:center;padding:28px 18px;text-align:center;}
    .success-wrap.show{display:flex;}
    .success-circle{width:60px;height:60px;background:var(--green-ghost);border:3px solid var(--green-light);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;margin-bottom:12px;animation:pop .35s cubic-bezier(.34,1.56,.64,1);}
    @keyframes pop{from{transform:scale(0)}to{transform:scale(1)}}
    .success-title{font-size:16px;font-weight:800;margin-bottom:5px;}
    .success-sub{font-size:12px;color:var(--muted);max-width:270px;line-height:1.6;}
    .filter-tabs{display:flex;gap:4px;overflow-x:auto;padding-bottom:2px;margin-bottom:11px;scrollbar-width:none;}
    .filter-tabs::-webkit-scrollbar{display:none;}
    .ftab{padding:4px 11px;border-radius:20px;font-size:11px;font-weight:700;cursor:pointer;border:1.5px solid var(--border);background:white;color:var(--muted);white-space:nowrap;transition:all .15s;font-family:'Plus Jakarta Sans',sans-serif;}
    .ftab.active{background:var(--g3);color:white;border-color:var(--g3);}
    .dem-item{display:flex;align-items:flex-start;gap:10px;padding:11px 0;border-bottom:1px solid #f3f4f6;}
    .dem-item:last-child{border-bottom:none;}
    .dem-ico{width:34px;height:34px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;margin-top:1px;}
    .dem-body{flex:1;min-width:0;}
    .dem-name{font-size:12px;font-weight:700;margin-bottom:2px;}
    .dem-dates{font-size:11px;color:var(--muted);}
    .dem-motif{font-size:11px;color:var(--muted);font-style:italic;margin-top:2px;}
    .dem-refus{font-size:10.5px;color:var(--red);margin-top:3px;}
    .badge{display:inline-flex;align-items:center;padding:2px 7px;border-radius:20px;font-size:10px;font-weight:700;flex-shrink:0;margin-top:3px;}
    .badge-pending{background:#fef3c7;color:#92400e;}
    .badge-approved{background:#dcfce7;color:#166534;}
    .badge-refused{background:#fee2e2;color:#991b1b;}
    .badge-cancelled{background:#f3f4f6;color:#6b7280;}
    .year-btn{font-size:11px;font-weight:700;color:rgba(255,255,255,.4);background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.1);padding:5px 11px;border-radius:20px;cursor:pointer;transition:all .15s;display:flex;align-items:center;gap:5px;font-family:'Plus Jakarta Sans',sans-serif;}
    .year-btn:hover{background:rgba(255,255,255,.13);}

    /* ‚îÄ‚îÄ PLANNING ‚îÄ‚îÄ */
    .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:2px;text-align:center;}
    .cal-hdr{font-size:9.5px;font-weight:700;color:var(--muted);padding:2px 0;}
    .cal-day{aspect-ratio:1;border-radius:5px;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:11px;font-weight:500;line-height:1.2;}
    .cal-day.work{font-weight:700;}
    .cal-day.off{opacity:0.4;}
    .cal-day.work-generic{font-weight:500;}
    .cal-day.today{outline:2px solid var(--g3);font-weight:800;}
    .cal-day.abs{color:white;font-weight:700;}
    .cal-day.abs-pending{opacity:.6;}

    /* ‚îÄ‚îÄ JUSTIFICATIF ‚îÄ‚îÄ */
    #justif-wrap{display:none;}
    #justif-preview{display:none;margin-top:7px;padding:8px 12px;background:var(--green-ghost);border:1px solid #6ee7b7;border-radius:8px;align-items:center;gap:8px;}

    /* ‚îÄ‚îÄ INFOS LINE ‚îÄ‚îÄ */
    .info-line{display:flex;align-items:center;gap:8px;padding:8px 0;border-bottom:1px solid #f3f4f6;font-size:12px;}
    .info-line:last-child{border-bottom:none;}
    .info-line-icon{font-size:15px;flex-shrink:0;width:20px;text-align:center;}
    .info-line-label{color:var(--muted);width:110px;flex-shrink:0;font-size:11px;}
    .info-line-val{font-weight:600;flex:1;color:var(--text);}

    /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
    .toast{position:fixed;bottom:22px;left:50%;transform:translateX(-50%) translateY(80px);background:#1a1f36;color:white;padding:10px 20px;border-radius:10px;font-size:13px;font-weight:600;z-index:9999;opacity:0;transition:all .3s;white-space:nowrap;}
    .toast.show{transform:translateX(-50%) translateY(0);opacity:1;}
    .toast.ok{background:var(--g3);}.toast.err{background:var(--red);}.toast.warn{background:var(--orange);}

    /* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
    .modal-overlay{position:fixed;inset:0;background:rgba(5,46,22,.5);backdrop-filter:blur(4px);z-index:200;display:none;align-items:flex-end;justify-content:center;}
    .modal-overlay.show{display:flex;}
    .modal{background:white;border-radius:18px 18px 0 0;width:100%;max-width:600px;max-height:90vh;overflow-y:auto;box-shadow:0 -8px 40px rgba(0,0,0,.15);}
    .modal-head{padding:16px 18px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;background:white;z-index:1;}
    .modal-head h3{font-size:14px;font-weight:800;}
    .modal-close{background:none;border:none;font-size:18px;cursor:pointer;color:var(--muted);}
    .modal-body{padding:16px 18px 20px;}

    /* ‚îÄ‚îÄ EMPTY ‚îÄ‚îÄ */
    .empty{display:flex;flex-direction:column;align-items:center;padding:26px;text-align:center;color:var(--muted);}
    .empty-icon{font-size:30px;margin-bottom:7px;}

    /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
    @media(max-width:480px){
      .soldes-grid{grid-template-columns:1fr 1fr;}
      .date-row{grid-template-columns:1fr;}
      .hero{padding:18px 13px 82px;}
      .profil-row{grid-template-columns:1fr;}
      .tnav{padding:12px 11px;font-size:11px;}
    }
  </style>
</head>
<body>

<div id="loading-wrap">
  <div class="load-logo">üåø ALTEORE</div>
  <div class="spin"></div>
  <div class="load-sub">Chargement de votre espace‚Ä¶</div>
</div>

<div id="not-found">
  <div class="nf-icon">üîó</div>
  <div class="nf-title">Lien invalide</div>
  <div class="nf-sub">Ce lien n'est pas valide ou a expir√©.<br>Demandez √† votre employeur un nouveau lien d'acc√®s.</div>
</div>

<div id="main-wrap" style="display:none">

  <!-- ‚ïê‚ïê HERO ‚ïê‚ïê -->
  <div class="hero">
    <div class="hero-top">
      <div class="hero-brand">
        <div class="hero-brand-icon">üåø</div>
        <div class="hero-brand-name">ALTEORE</div>
      </div>
      <button class="year-btn" onclick="changeYear()" id="year-btn">üìÖ <span id="year-lbl"></span></button>
    </div>
    <div class="hero-body">
      <div class="hero-avatar" id="hero-av">?</div>
      <div class="hero-info">
        <div class="hero-name" id="hero-name">‚Äî</div>
        <div class="hero-sub" id="hero-sub">‚Äî</div>
        <div class="hero-chips" id="hero-chips"></div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê SOLDES ‚ïê‚ïê -->
  <div class="soldes-wrap"><div class="soldes-grid" id="soldes-grid"></div></div>

  <!-- ‚ïê‚ïê NAVIGATION ONGLETS ‚ïê‚ïê -->
  <div class="tabs-nav" style="margin-top:14px">
    <div class="tabs-inner">
      <button class="tnav active" onclick="showTab('accueil',this)">üè† Accueil</button>
      <button class="tnav" onclick="showTab('profil',this)">üë§ Mon profil</button>
      <button class="tnav" onclick="showTab('documents',this)" id="tab-docs-btn">üìé Documents</button>
      <button class="tnav" onclick="showTab('conges',this)" id="tab-conges-btn">üèñÔ∏è Cong√©s</button>
      <button class="tnav" onclick="showTab('planning',this)">üìÖ Planning</button>
    </div>
  </div>

  <!-- ‚ïê‚ïê ONGLET ACCUEIL ‚ïê‚ïê -->
  <div class="tab-section active" id="tab-accueil" style="margin-top:16px">

    <!-- Bienvenue -->
    <div class="card">
      <div class="card-body" style="padding:18px">
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:14px">
          <div style="font-size:32px">üëã</div>
          <div>
            <div style="font-size:15px;font-weight:800;color:var(--text)" id="welcome-name">Bienvenue !</div>
            <div style="font-size:11px;color:var(--muted)" id="welcome-date"></div>
          </div>
        </div>
        <div id="accueil-infos" style="display:flex;flex-direction:column;gap:0"></div>
      </div>
    </div>

    <!-- Solde rapide -->
    <div class="card">
      <div class="card-head"><div class="card-title">üìä Mes soldes <span style="font-size:10px;font-weight:400;color:var(--muted)" id="accueil-annee-lbl"></span></div></div>
      <div class="card-body" style="padding:10px 14px">
        <div id="accueil-soldes"></div>
      </div>
    </div>

    <!-- Demandes r√©centes -->
    <div class="card">
      <div class="card-head">
        <div class="card-title">üìã Derni√®res demandes</div>
        <button class="btn-ghost btn" style="font-size:11px;padding:4px 10px" onclick="showTab('conges',document.querySelector('.tnav:nth-child(4))'))">Voir tout</button>
      </div>
      <div class="card-body" style="padding-top:8px" id="accueil-demandes"></div>
    </div>

    <!-- Actions rapides -->
    <div class="card">
      <div class="card-head"><div class="card-title">‚ö° Actions rapides</div></div>
      <div class="card-body" style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <button class="btn btn-green" onclick="showTab('conges',document.querySelectorAll('.tnav')[3])">‚úâÔ∏è Demander un cong√©</button>
        <button class="btn btn-ghost" onclick="showTab('documents',document.querySelectorAll('.tnav')[2])">üì§ D√©poser un document</button>
        <button class="btn btn-ghost" onclick="showTab('profil',document.querySelectorAll('.tnav')[1])">‚úèÔ∏è Modifier mon profil</button>
        <button class="btn btn-ghost" onclick="showTab('planning',document.querySelectorAll('.tnav')[4])">üìÖ Voir mon planning</button>
      </div>
    </div>

  </div>

  <!-- ‚ïê‚ïê ONGLET PROFIL ‚ïê‚ïê -->
  <div class="tab-section" id="tab-profil" style="margin-top:16px">

    <!-- Carte contrat -->
    <div id="contrat-card-wrap"></div>

    <!-- Infos personnelles modifiables -->
    <div class="card">
      <div class="card-head">
        <div class="card-title">üë§ Informations personnelles</div>
        <span style="font-size:10px;color:var(--muted)">‚úèÔ∏è Modifiable</span>
      </div>
      <div class="card-body">
        <div class="profil-section-title">Coordonn√©es</div>
        <div class="profil-row">
          <div class="profil-field">
            <div class="profil-label">Pr√©nom</div>
            <div class="profil-val" id="pf-prenom"></div>
          </div>
          <div class="profil-field">
            <div class="profil-label">Nom</div>
            <div class="profil-val" id="pf-nom"></div>
          </div>
        </div>
        <div class="profil-row">
          <div class="profil-field">
            <div class="profil-label">Email personnel</div>
            <div class="profil-val editable" id="pf-email-perso" onclick="editField(this,'emailPerso')" title="Cliquer pour modifier">‚Äî</div>
          </div>
          <div class="profil-field">
            <div class="profil-label">T√©l√©phone</div>
            <div class="profil-val editable" id="pf-tel" onclick="editField(this,'telephone')" title="Cliquer pour modifier">‚Äî</div>
          </div>
        </div>
        <div class="profil-row profil-full">
          <div class="profil-field">
            <div class="profil-label">Adresse</div>
            <div class="profil-val editable" id="pf-adresse" onclick="editField(this,'adresse')" title="Cliquer pour modifier">‚Äî</div>
          </div>
        </div>
        <div class="profil-row">
          <div class="profil-field">
            <div class="profil-label">Date de naissance</div>
            <div class="profil-val editable" id="pf-ddn" onclick="editField(this,'dateNaissance')" title="Cliquer pour modifier">‚Äî</div>
          </div>
          <div class="profil-field">
            <div class="profil-label">Nationalit√©</div>
            <div class="profil-val editable" id="pf-nat" onclick="editField(this,'nationalite')" title="Cliquer pour modifier">‚Äî</div>
          </div>
        </div>

        <div class="profil-section-title">Informations bancaires</div>
        <div class="profil-row">
          <div class="profil-field">
            <div class="profil-label">IBAN</div>
            <div class="profil-val editable" id="pf-iban" onclick="editField(this,'iban')" title="Cliquer pour modifier">‚Äî</div>
          </div>
          <div class="profil-field">
            <div class="profil-label">Titulaire du compte</div>
            <div class="profil-val editable" id="pf-titulaire" onclick="editField(this,'ibanTitulaire')" title="Cliquer pour modifier">‚Äî</div>
          </div>
        </div>
        <div style="font-size:10px;color:var(--muted);background:#fafafa;padding:8px 10px;border-radius:8px;border:1px solid var(--border)">
          üîí Vos informations bancaires sont stock√©es de fa√ßon s√©curis√©e et uniquement accessibles par votre employeur pour le versement de votre salaire.
        </div>

        <div class="profil-section-title">Contact d'urgence</div>
        <div id="urgence-wrap"></div>
        <div class="profil-row" style="margin-top:8px">
          <div class="profil-field">
            <div class="profil-label">Nom & pr√©nom</div>
            <div class="profil-val editable" id="pf-urgence-nom" onclick="editField(this,'contactUrgenceNom')" title="Cliquer pour modifier">‚Äî</div>
          </div>
          <div class="profil-field">
            <div class="profil-label">Lien (ex : conjoint)</div>
            <div class="profil-val editable" id="pf-urgence-lien" onclick="editField(this,'contactUrgenceLien')" title="Cliquer pour modifier">‚Äî</div>
          </div>
        </div>
        <div class="profil-row">
          <div class="profil-field">
            <div class="profil-label">T√©l√©phone urgence</div>
            <div class="profil-val editable" id="pf-urgence-tel" onclick="editField(this,'contactUrgenceTel')" title="Cliquer pour modifier">‚Äî</div>
          </div>
        </div>

        <button class="btn-save-profil" id="btn-save-profil" onclick="saveProfil()">üíæ Enregistrer les modifications</button>
      </div>
    </div>

    <!-- Informations contrat (lecture seule) -->
    <div class="card">
      <div class="card-head"><div class="card-title">üìÑ Mon contrat <span style="font-size:10px;color:var(--muted);font-weight:400">‚Äî g√©r√© par votre employeur</span></div></div>
      <div class="card-body" id="contrat-body"></div>
    </div>

  </div>

  <!-- ‚ïê‚ïê ONGLET DOCUMENTS ‚ïê‚ïê -->
  <div class="tab-section" id="tab-documents" style="margin-top:16px">

    <div class="card">
      <div class="card-head">
        <div class="card-title">üìé Mes documents</div>
        <span style="font-size:11px;color:var(--muted)" id="docs-progress-lbl"></span>
      </div>
      <div class="card-body">
        <div class="doc-progress-bar">
          <div class="doc-progress-fill" id="docs-progress-fill" style="width:0%"></div>
        </div>
        <!-- Documents √† fournir par le salari√© -->
        <div class="doc-section-lbl">
          <span>üì§ Documents √† fournir</span>
          <span id="docs-required-count" style="font-size:10px;color:var(--muted)"></span>
        </div>
        <div id="docs-required-list"></div>

        <!-- Documents transmis par l'employeur -->
        <div class="doc-section-lbl" style="margin-top:16px">
          <span>üì• Documents re√ßus de l'employeur</span>
          <span id="docs-employer-count" style="font-size:10px;color:var(--muted)"></span>
        </div>
        <div id="docs-employer-list"></div>
      </div>
    </div>

  </div>

  <!-- ‚ïê‚ïê ONGLET CONG√âS ‚ïê‚ïê -->
  <div class="tab-section" id="tab-conges" style="margin-top:16px">

    <!-- Soldes d√©taill√©s -->
    <div class="card">
      <div class="card-head">
        <div class="card-title">üìä Mes soldes <span id="conges-annee-lbl" style="font-size:10px;font-weight:400;color:var(--muted)"></span></div>
      </div>
      <div class="card-body" style="padding:10px 14px" id="soldes-detail"></div>
    </div>

    <!-- Nouvelle demande -->
    <div class="card">
      <div class="card-head">
        <div class="card-title">‚úâÔ∏è Faire une demande</div>
        <span id="step-lbl" style="font-size:11px;color:var(--muted)">√âtape 1 / 3</span>
      </div>
      <div class="card-body">
        <div class="stepper">
          <div class="step-dot active" id="s1">1</div>
          <div class="step-line" id="sl1"></div>
          <div class="step-dot" id="s2">2</div>
          <div class="step-line" id="sl2"></div>
          <div class="step-dot" id="s3">3</div>
        </div>
        <div class="form-step active" id="st1">
          <div style="font-size:12px;font-weight:700;margin-bottom:10px">Quel type de cong√© ?</div>
          <div class="type-grid" id="type-grid"></div>
          <div class="alert alert-blue" id="evenement-loi">
            <strong>Dur√©es l√©gales :</strong><br>
            Mariage / PACS : 4j &nbsp;¬∑&nbsp; Naissance / Adoption : 3j<br>
            D√©c√®s conjoint ou enfant : 5j &nbsp;¬∑&nbsp; D√©c√®s parent : 3j &nbsp;¬∑&nbsp; D√©c√®s beau-parent : 3j
          </div>
          <div class="btn-row"><button class="btn btn-green" id="next1" onclick="goStep(2)" disabled>Suivant ‚Üí</button></div>
        </div>
        <div class="form-step" id="st2">
          <div class="date-row">
            <div class="field"><label>Date de d√©but</label><input class="finput" type="date" id="f-deb" oninput="onDateChg()"/></div>
            <div class="field"><label>Date de fin</label><input class="finput" type="date" id="f-fin" oninput="onDateChg()"/></div>
          </div>
          <div class="alert alert-green" id="jours-alert"></div>
          <div class="alert alert-orange" id="solde-alert"></div>
          <div class="field"><label>Motif (facultatif)</label><input class="finput" type="text" id="f-motif" placeholder="Ex : vacances, formation, √©v√©nement‚Ä¶"/></div>
          <div id="justif-wrap" style="margin-bottom:11px">
            <div class="field" style="margin-bottom:0">
              <label>üìé Justificatif <span style="font-weight:400;text-transform:none;letter-spacing:0">(arr√™t maladie, ordonnance‚Ä¶)</span></label>
              <div id="justif-drop" onclick="document.getElementById('justif-input').click()" style="border:2px dashed var(--border);border-radius:10px;padding:18px 12px;text-align:center;cursor:pointer;background:white;transition:all .15s;" onmouseover="this.style.borderColor='var(--g3)';this.style.background='var(--green-ghost)'" onmouseout="this.style.borderColor='var(--border)';this.style.background='white'">
                <div style="font-size:26px;margin-bottom:4px">üìÑ</div>
                <div style="font-size:12px;font-weight:600;color:var(--muted)">Appuyez pour joindre un fichier</div>
                <div style="font-size:10px;color:var(--muted);margin-top:2px">PDF, JPG, PNG ¬∑ Max 5 Mo ¬∑ Facultatif</div>
              </div>
              <input type="file" id="justif-input" accept=".pdf,.jpg,.jpeg,.png" style="display:none" onchange="onJustifChange(this)"/>
              <div id="justif-preview" style="margin-top:7px;padding:8px 12px;background:var(--green-ghost);border:1px solid #6ee7b7;border-radius:8px;align-items:center;gap:8px;">
                <span style="font-size:16px">üìé</span>
                <span id="justif-name" style="flex:1;font-size:12px;font-weight:600;color:#065f46;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"></span>
                <span id="justif-size" style="font-size:11px;color:var(--muted);flex-shrink:0"></span>
                <button onclick="clearJustif(event)" style="background:none;border:none;cursor:pointer;color:var(--red);font-size:15px;padding:0 2px;flex-shrink:0;line-height:1">‚úï</button>
              </div>
            </div>
          </div>
          <div class="btn-row">
            <button class="btn btn-ghost" onclick="goStep(1)">‚Üê Retour</button>
            <button class="btn btn-green" id="next2" onclick="goStep(3)" disabled>V√©rifier ‚Üí</button>
          </div>
        </div>
        <div class="form-step" id="st3">
          <div style="font-size:12px;font-weight:700;margin-bottom:11px">R√©capitulatif</div>
          <div class="resume" id="recap"></div>
          <div class="alert alert-orange" id="recap-warn"></div>
          <div class="btn-row">
            <button class="btn btn-ghost" onclick="goStep(2)">‚Üê Modifier</button>
            <button class="btn btn-green" id="btn-submit" onclick="submitDemande()">‚úâÔ∏è Envoyer la demande</button>
          </div>
        </div>
        <div class="success-wrap" id="success-wrap">
          <div class="success-circle">‚úÖ</div>
          <div class="success-title">Demande envoy√©e !</div>
          <div class="success-sub" id="success-sub">Votre demande a √©t√© transmise.</div>
          <button class="btn btn-green" style="margin-top:14px" onclick="resetForm()">+ Nouvelle demande</button>
        </div>
      </div>
    </div>

    <!-- Historique demandes -->
    <div class="card">
      <div class="card-head">
        <div class="card-title">üìã Mes demandes</div>
        <span id="dem-count" style="font-size:11px;color:var(--muted)"></span>
      </div>
      <div class="card-body" style="padding-top:10px">
        <div class="filter-tabs">
          <button class="ftab active" onclick="setFilter(this,'all')">Toutes</button>
          <button class="ftab" onclick="setFilter(this,'pending')">‚è≥ Attente</button>
          <button class="ftab" onclick="setFilter(this,'approved')">‚úÖ Approuv√©es</button>
          <button class="ftab" onclick="setFilter(this,'refused')">‚ùå Refus√©es</button>
          <button class="ftab" onclick="setFilter(this,'cancelled')">üö´ Annul√©es</button>
        </div>
        <div id="dem-list"></div>
      </div>
    </div>

  </div>

  <!-- ‚ïê‚ïê ONGLET PLANNING ‚ïê‚ïê -->
  <div class="tab-section" id="tab-planning" style="margin-top:16px">
    <div class="card">
      <div class="card-head">
        <div class="card-title">üìÖ <span id="cal-title">Mon calendrier</span></div>
        <div style="display:flex;gap:5px">
          <button class="btn btn-ghost" style="padding:4px 9px;font-size:12px" onclick="prevM()">‚Äπ</button>
          <button class="btn btn-ghost" style="padding:4px 9px;font-size:12px" onclick="nextM()">‚Ä∫</button>
        </div>
      </div>
      <div class="card-body" style="padding:12px">
        <div class="cal-grid" id="cal-grid"></div>
        <div style="display:flex;flex-wrap:wrap;gap:7px;margin-top:9px" id="cal-legend"></div>
      </div>
    </div>
    <!-- Horaires habituels -->
    <div class="card" id="horaires-card">
      <div class="card-head"><div class="card-title">‚è∞ Mes horaires habituels</div></div>
      <div class="card-body" id="horaires-body"></div>
    </div>
  </div>

  <div style="text-align:center;padding:8px 0 16px;color:var(--muted);font-size:10.5px">
    Propuls√© par <strong>ALTEORE</strong> ¬∑ Portail salari√© s√©curis√©
  </div>
</div>

<!-- MODAL upload document -->
<div class="modal-overlay" id="upload-modal">
  <div class="modal">
    <div class="modal-head">
      <h3 id="upload-modal-title">üì§ D√©poser un document</h3>
      <button class="modal-close" onclick="closeUploadModal()">‚úï</button>
    </div>
    <div class="modal-body">
      <div style="font-size:12px;color:var(--muted);margin-bottom:12px" id="upload-modal-desc"></div>
      <div class="upload-zone" onclick="document.getElementById('upload-input').click()">
        <div class="upload-zone-icon">üìÑ</div>
        <div class="upload-zone-txt">Cliquer pour s√©lectionner un fichier</div>
        <div class="upload-zone-sub">PDF, JPG, PNG ¬∑ Max 5 Mo</div>
      </div>
      <input type="file" id="upload-input" accept=".pdf,.jpg,.jpeg,.png" style="display:none" onchange="onUploadChange(this)"/>
      <div id="upload-preview" style="display:none;margin-top:10px;padding:10px 12px;background:var(--green-ghost);border:1px solid #6ee7b7;border-radius:8px;align-items:center;gap:8px;flex-direction:row">
        <span style="font-size:20px">üìé</span>
        <div style="flex:1;min-width:0">
          <div id="upload-preview-name" style="font-size:12px;font-weight:700;color:#065f46;white-space:nowrap;overflow:hidden;text-overflow:ellipsis"></div>
          <div id="upload-preview-size" style="font-size:10px;color:var(--muted)"></div>
        </div>
        <button onclick="clearUpload()" style="background:none;border:none;cursor:pointer;color:var(--red);font-size:16px;padding:0">‚úï</button>
      </div>
      <button class="btn btn-green" style="width:100%;margin-top:14px" id="upload-submit-btn" onclick="submitUpload()" disabled>üì§ Envoyer</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<!-- ‚ïê‚ïê FIREBASE ‚ïê‚ïê -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc, addDoc, getDocs, collection, query, where }
    from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
  const app = initializeApp({
    apiKey:"AIzaSyB003WqdRKrT0gbv7P4BNIICuXeqbu8dR4",
    authDomain:"altiora-70599.firebaseapp.com", projectId:"altiora-70599",
    storageBucket:"altiora-70599.firebasestorage.app",
    messagingSenderId:"120905555746", appId:"1:120905555746:web:618460c65cdc9e57cc8f7b"
  });
  const db = getFirestore(app);
  window._db = db;
  window._getDoc   = (path, ...s) => getDoc(doc(db, path, ...s));
  window._setDocFs = (path, id, data, opts) => setDoc(doc(db, path, id), data, opts||{});
  window._setDocPath = (segments, data, opts) => {
    // segments = ['col', 'doc', 'subcol', 'subdoc', ...]
    const ref = doc(db, ...segments);
    return setDoc(ref, data, opts||{});
  };
  window._addDoc   = (colPath, data) => addDoc(collection(db, ...colPath), data);
  window._getDocs  = (...colPath) => getDocs(collection(db, ...colPath));
  window._queryWhere = (colPath, field, val) =>
    getDocs(query(collection(db, ...colPath), where(field, '==', val)));
  window._dbReady  = true;
  window.startApp();
</script>

<script>
(function(){
var b="Lyog4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCiAgIENPTlNUQU5URVMK4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQICovCnZhciBDT0xPUlMgPSB7Y3A6JyMwNTk2NjknLHJ0dDonIzNiODJmNicsY3NzOicjZjU5ZTBiJyxldmVuZW1lbnQ6JyM3YzNhZWQnLG1hbGFkaWU6JyNlZjQ0NDQnLHJlY3VwZXJhdGlvbjonIzA4OTFiMicsZm9ybWF0aW9uOicjZGIyNzc3J307CnZhciBMQUJFTFMgID0ge2NwOidDb25nXHUwMGU5cyBwYXlcdTAwZTlzJyxydHQ6J1JUVCcsY3NzOidTYW5zIHNvbGRlJyxldmVuZW1lbnQ6J1x1MDBjOXZcdTAwZTluZW1lbnQgZmFtaWxpYWwnLG1hbGFkaWU6J01hbGFkaWUgLyBBcnJcdTAwZWF0JyxyZWN1cGVyYXRpb246J1JcdTAwZTljdXBcdTAwZTlyYXRpb24gaGV1cmVzJyxmb3JtYXRpb246J0Zvcm1hdGlvbid9Owp2YXIgSUNPTlMgICA9IHtjcDonXHVkODNjXHVkZmQ2XHVmZTBmJyxydHQ6J1x1MjNmMCcsY3NzOidcdWQ4M2RcdWRjYmMnLGV2ZW5lbWVudDonXHVkODNjXHVkZjg5JyxtYWxhZGllOidcdWQ4M2VcdWRkMTInLHJlY3VwZXJhdGlvbjonXHVkODNkXHVkZDA0Jyxmb3JtYXRpb246J1x1ZDgzY1x1ZGY5Myd9Owp2YXIgU09MREVfSyA9IHtjcDonY3BSZXN0YW50JyxydHQ6J3J0dFJlc3RhbnQnLHJlY3VwZXJhdGlvbjoncmVjdXBSZXN0YW50J307CnZhciBET1dfS0VZID0gWydsdW5kaScsJ21hcmRpJywnbWVyY3JlZGknLCdqZXVkaScsJ3ZlbmRyZWRpJywnc2FtZWRpJywnZGltYW5jaGUnXTsKCi8vIERvY3VtZW50cyByZXF1aXMgLSBsYWJlbHMgZW4gdW5pY29kZSBwdXIgcG91ciBjb21wYXRpYmlsaXRlIFNhZmFyaQp2YXIgRE9DU19SRVFVSVJFRCA9IFsKICB7aWQ6ImNuaSIsICAgICAgICAgbGFiZWw6IlBpXHUwMGU4Y2UgZFx1MjAxOWlkZW50aXRcdTAwZTkiLCAgICAgICBkZXNjOiJDTkkgb3UgcGFzc2Vwb3J0IGVuIGNvdXJzIGRlIHZhbGlkaXRcdTAwZTkiLCBpY29uOiJcdWQ4M2VcdWRlYjQifSwKICB7aWQ6InJpYiIsICAgICAgICAgbGFiZWw6IlJJQiIsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzYzoiUmVsZXZcdTAwZTkgZFx1MjAxOWlkZW50aXRcdTAwZTkgYmFuY2FpcmUiLCBpY29uOiJcdWQ4M2NcdWRmZTYifSwKICB7aWQ6Imp1c3RpZl9kb20iLCAgbGFiZWw6Ikp1c3RpZmljYXRpZiBkZSBkb21pY2lsZSIsICAgICAgICAgICAgICAgZGVzYzoiRmFjdHVyZSBkZSBtb2lucyBkZSAzIG1vaXMiLCBpY29uOiJcdWQ4M2NcdWRmZTAifSwKICB7aWQ6InZpdGFsZSIsICAgICAgbGFiZWw6IkNhcnRlIHZpdGFsZSIsICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzYzoiQ2FydGUgZFx1MjAxOWFzc3VyYW5jZSBtYWxhZGllIiwgaWNvbjoiXHVkODNkXHVkYzlhIn0sCiAge2lkOiJ0aXRyZV9zZWpvdXIiLGxhYmVsOiJUaXRyZSBkZSBzXHUwMGU5am91ciIsICAgICAgICAgICAgICAgICAgZGVzYzoiU2kgcmVzc29ydGlzc2FudCBub24tVUUiLCBpY29uOiJcdWQ4M2RcdWRjY2IiLCBvcHRpb25hbDp0cnVlfSwKICB7aWQ6ImRpcGxvbWUiLCAgICAgbGFiZWw6Ikp1c3RpZmljYXRpZiBkZSBkaXBsXHUwMGY0bWUiLCAgICAgICAgICBkZXNjOiJDb3BpZSBkdSBkaXBsXHUwMGY0bWUgbGUgcGx1cyBcdTAwZTlsZXZcdTAwZTkiLCBpY29uOiJcdWQ4M2NcdWRmOTMiLCBvcHRpb25hbDp0cnVlfSwKXTsKZnVuY3Rpb24gZXNjSHRtbChzKXsgcmV0dXJuIChzfHwiIikucmVwbGFjZSgvJi9nLCImYW1wOyIpLnJlcGxhY2UoLyIvZywiJnF1b3Q7IikucmVwbGFjZSgvPC9nLCImbHQ7IikucmVwbGFjZSgvPi9nLCImZ3Q7Iik7IH0KLy8gRWNoYXBwZXIgbGVzIGxhYmVscyBwb3VyIHVzYWdlIGRhbnMgb25jbGljayBIVE1MCmZ1bmN0aW9uIGVzY0h0bWwocyl7IHJldHVybiAoc3x8JycpLnJlcGxhY2UoLyYvZywnJmFtcDsnKS5yZXBsYWNlKC8iL2csJyZxdW90OycpLnJlcGxhY2UoLycvZywnJiMzOTsnKS5yZXBsYWNlKC88L2csJyZsdDsnKS5yZXBsYWNlKC8+L2csJyZndDsnKTsgfQoKLyog4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCiAgIMOJVEFUIEdMT0JBTArilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAgKi8KdmFyIF91aWQ9JycsIF9lbXBJZD0nJywgX2VtcD17fSwgX3BhcmFtcz17fSwgX2RlbWFuZGVzPVtdOwp2YXIgX3NvbGRlcz17fTsKdmFyIF9zZWxUeXBlPScnOwp2YXIgX2RlbUZpbHRlcj0nYWxsJzsKdmFyIF9jYWxNb250aD1uZXcgRGF0ZSgpOwp2YXIgX3llYXI9bmV3IERhdGUoKS5nZXRGdWxsWWVhcigpOwp2YXIgX3BsYW5uaW5nQ2FjaGU9e307CnZhciBfcHJvZmlsRWRpdHM9e307ICAgICAgIC8vIG1vZGlmaWNhdGlvbnMgZW4gYXR0ZW50ZQp2YXIgX3Byb2ZpbEZpZWxkcz17fTsgICAgICAvLyB2YWxldXJzIGFjdHVlbGxlcyBkdSBwcm9maWwgw6l0ZW5kdQp2YXIgX2RvY3NFbXBsb3llZT17fTsgICAgICAvLyB7ZG9jSWQ6IHtuYW1lLCBzaXplLCB1cGxvYWRlZEF0LCBkYXRhfX0KdmFyIF9kb2NzRW1wbG95ZXI9W107ICAgICAgLy8gW3tsYWJlbCwgbmFtZSwgdXBsb2FkZWRBdCwgZGF0YX1dCnZhciBfdXBsb2FkRG9jSWQ9Jyc7ICAgICAgIC8vIGRvY3VtZW50IGVuIGNvdXJzIGQndXBsb2FkCnZhciBfdXBsb2FkQjY0PW51bGw7CnZhciBfdXBsb2FkTWV0YT1udWxsOwoKLyog4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCiAgIETDiU1BUlJBR0UK4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQICovCndpbmRvdy5zdGFydEFwcCA9IGZ1bmN0aW9uKCkgewogIHZhciBwID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKTsKICB2YXIgcGlkID0gcC5nZXQoJ2lkJykgfHwgJyc7CiAgaWYgKCFwaWQpIHsgc2hvd05vdEZvdW5kKCk7IHJldHVybjsgfQogIHZhciB0ID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7CiAgICBpZiAod2luZG93Ll9kYlJlYWR5KSB7IGNsZWFySW50ZXJ2YWwodCk7IGxvYWRFbXBsb3llKHBpZCk7IH0KICB9LCA4MCk7Cn07Cgphc3luYyBmdW5jdGlvbiBsb2FkRW1wbG95ZShwaWQpIHsKICB0cnkgewogICAgdmFyIHNuYXAgPSBhd2FpdCB3aW5kb3cuX2dldERvYygncmhfZW1wbG95ZXNfcHVibGljJywgcGlkKTsKICAgIGlmICghc25hcC5leGlzdHMoKSkgeyBzaG93Tm90Rm91bmQoKTsgcmV0dXJuOyB9CiAgICB2YXIgZGF0YSA9IHNuYXAuZGF0YSgpOwogICAgX3VpZCA9IGRhdGEudWlkOyBfZW1wSWQgPSBkYXRhLmVtcElkOyBfZW1wID0gZGF0YTsKCiAgICAvLyBDaGFyZ2VyIGxlIHByb2ZpbCDDqXRlbmR1IChkb25uw6llcyBzYWlzaWVzIHBhciBsZSBzYWxhcmnDqSkKICAgIHRyeSB7CiAgICAgIHZhciBwcm9mU25hcCA9IGF3YWl0IHdpbmRvdy5fZ2V0RG9jKCdyaF9lbXBsb3llc19wdWJsaWNfcHJvZmlsJywgcGlkKTsKICAgICAgaWYgKHByb2ZTbmFwLmV4aXN0cygpKSB7CiAgICAgICAgX3Byb2ZpbEZpZWxkcyA9IHByb2ZTbmFwLmRhdGEoKTsKICAgICAgfQogICAgfSBjYXRjaChlKSB7IF9wcm9maWxGaWVsZHMgPSB7fTsgfQoKICAgIC8vIENoYXJnZXIgcGFyYW1zIFJICiAgICB0cnkgewogICAgICB2YXIgcHMgPSBhd2FpdCB3aW5kb3cuX2dldERvYygncmhfcGFyYW1zJywgX3VpZCk7CiAgICAgIF9wYXJhbXMgPSBwcy5leGlzdHMoKSA/IHBzLmRhdGEoKSA6IHt9OwogICAgfSBjYXRjaChlKSB7IF9wYXJhbXMgPSB7fTsgfQoKICAgIC8vIENoYXJnZXIgZG9ubsOpZXMgZW1wbG95w6kgcHJpdsOpZXMgKGxlY3R1cmUgc2V1bGUpCiAgICB0cnkgewogICAgICB2YXIgZW1wU25hcCA9IGF3YWl0IHdpbmRvdy5fZ2V0RG9jKCdyaCcsIF91aWQsICdlbXBsb3llcycsIF9lbXBJZCk7CiAgICAgIGlmIChlbXBTbmFwLmV4aXN0cygpKSB7CiAgICAgICAgdmFyIGVkID0gZW1wU25hcC5kYXRhKCk7CiAgICAgICAgLy8gRnVzaW9uIHPDqWN1cmlzw6llIGRlcyBkb25uw6llcyBSTwogICAgICAgIFsnc2FsYWlyZUJydXQnLCdzYWxhaXJlTmV0JywnaGV1cmVzSGViZG8nLCdmcmVxdWVuY2UnLCdjYXRlZ29yaWVQb3N0ZScsJ2NjbicsCiAgICAgICAgICdkYXRlTmFpc3NhbmNlJywnbmF0aW9uYWxpdGUnLCdwZXJpb2RlRXNzYWknLCdub3RlTW95ZW5uZSddLmZvckVhY2goZnVuY3Rpb24oayl7CiAgICAgICAgICBpZihlZFtrXSAhPT0gdW5kZWZpbmVkICYmIF9lbXBba10gPT09IHVuZGVmaW5lZCkgX2VtcFtrXSA9IGVkW2tdOwogICAgICAgIH0pOwogICAgICAgIC8vIERvY3VtZW50cyBkw6lwb3PDqXMgcGFyIGwnZW1wbG95ZXVyCiAgICAgICAgaWYoZWQuZG9jdW1lbnRzRW1wbG95ZXVyKSBfZG9jc0VtcGxveWVyID0gZWQuZG9jdW1lbnRzRW1wbG95ZXVyOwogICAgICAgIC8vIERvY3VtZW50cyBkdSBzYWxhcmnDqSBkw6lqw6Agc3RvY2vDqXMKICAgICAgICBpZihlZC5kb2N1bWVudHNFbXBsb3llZSkgX2RvY3NFbXBsb3llZSA9IGVkLmRvY3VtZW50c0VtcGxveWVlOwogICAgICB9CiAgICB9IGNhdGNoKGUpIHt9CgogICAgYXdhaXQgbG9hZERlbWFuZGVzKCk7CiAgICBhd2FpdCBsb2FkUGxhbm5pbmdNb250aChfY2FsTW9udGguZ2V0RnVsbFllYXIoKSwgX2NhbE1vbnRoLmdldE1vbnRoKCkpOwogICAgY2FsY1NvbGRlcygpOwogICAgcmVuZGVyQWxsKCk7CgogICAgdmFyIGx3ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmctd3JhcCcpOwogICAgbHcuY2xhc3NMaXN0LmFkZCgnZmFkZScpOwogICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsgbHcuc3R5bGUuZGlzcGxheT0nbm9uZSc7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluLXdyYXAnKS5zdHlsZS5kaXNwbGF5PSdibG9jayc7IH0sIDQwMCk7CiAgfSBjYXRjaChlKSB7IGNvbnNvbGUuZXJyb3IoZSk7IHNob3dOb3RGb3VuZCgpOyB9Cn0KCi8qIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAogICBDSEFSR0VNRU5UIERPTk7DiUVTCuKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkCAqLwphc3luYyBmdW5jdGlvbiBsb2FkRGVtYW5kZXMoKSB7CiAgX2RlbWFuZGVzID0gW107CiAgdHJ5IHsKICAgIHZhciBzbmFwID0gYXdhaXQgd2luZG93Ll9xdWVyeVdoZXJlKFsncmhfY29uZ2VzJywgX3VpZCwgJ2RlbWFuZGVzJ10sICdlbXBJZCcsIF9lbXBJZCk7CiAgICBzbmFwLmZvckVhY2goZnVuY3Rpb24oZCkgeyBfZGVtYW5kZXMucHVzaChPYmplY3QuYXNzaWduKHtpZDpkLmlkfSwgZC5kYXRhKCkpKTsgfSk7CiAgICBfZGVtYW5kZXMuc29ydChmdW5jdGlvbihhLGIpIHsgcmV0dXJuIChiLmNyZWF0ZWRBdHx8JycpLmxvY2FsZUNvbXBhcmUoYS5jcmVhdGVkQXR8fCcnKTsgfSk7CiAgfSBjYXRjaChlKSB7IGNvbnNvbGUud2FybignRGVtYW5kZXM6JywgZS5tZXNzYWdlKTsgfQp9Cgphc3luYyBmdW5jdGlvbiBsb2FkUGxhbm5pbmdNb250aCh5LCBtKSB7CiAgX3BsYW5uaW5nQ2FjaGUgPSB7fTsKICBpZiAoIV91aWQgfHwgIV9lbXBJZCkgcmV0dXJuOwogIHZhciB3ZWVrS2V5cyA9IHt9OwogIHZhciBuYiA9IG5ldyBEYXRlKHksIG0rMSwgMCkuZ2V0RGF0ZSgpOwogIGZvciAodmFyIGQgPSAxOyBkIDw9IG5iOyBkKyspIHsKICAgIHZhciBkdCA9IG5ldyBEYXRlKHksIG0sIGQpOwogICAgdmFyIG1vbiA9IG5ldyBEYXRlKGR0KTsKICAgIHZhciBkYXkgPSBtb24uZ2V0RGF5KCksIGRpZmYgPSAoZGF5ID09PSAwKSA/IC02IDogMSAtIGRheTsKICAgIG1vbi5zZXREYXRlKG1vbi5nZXREYXRlKCkgKyBkaWZmKTsKICAgIG1vbi5zZXRIb3VycygwLDAsMCwwKTsKICAgIHZhciB3ayA9IG1vbi50b0lTT1N0cmluZygpLnNsaWNlKDAsMTApLnJlcGxhY2UoLy0vZywnJyk7CiAgICB3ZWVrS2V5c1t3a10gPSB0cnVlOwogIH0KICBmb3IgKHZhciB3ayBpbiB3ZWVrS2V5cykgewogICAgdHJ5IHsKICAgICAgdmFyIHNuYXAgPSBhd2FpdCB3aW5kb3cuX2dldERvY3MoJ3JoJywgX3VpZCwgJ3BsYW5fJyt3ayk7CiAgICAgIHNuYXAuZm9yRWFjaChmdW5jdGlvbihkb2MpIHsKICAgICAgICBpZiAoZG9jLmlkLmVuZHNXaXRoKCdfJytfZW1wSWQpKSB7CiAgICAgICAgICB2YXIgZGF0ZVN0ciA9IGRvYy5pZC5yZXBsYWNlKCdfJytfZW1wSWQsICcnKTsKICAgICAgICAgIHZhciBkYXRhID0gZG9jLmRhdGEoKTsKICAgICAgICAgIF9wbGFubmluZ0NhY2hlW2RhdGVTdHJdID0gKGRhdGEuaXRlbXMgfHwgW10pLmZpbHRlcihmdW5jdGlvbihpdCkgewogICAgICAgICAgICByZXR1cm4gaXQudHlwZSA9PT0gJ3RyYXZhaWwnIHx8IGl0LnR5cGUgPT09ICdmb3JtYXRpb24nIHx8IGl0LnR5cGUgPT09ICdhc3RyZWludGUnOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0gY2F0Y2goZSkge30KICB9Cn0KCi8qIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAogICBDQUxDVUwgU09MREVTCuKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkCAqLwpmdW5jdGlvbiBjYWxjU29sZGVzKCkgewogIHZhciBub3cgPSBuZXcgRGF0ZSgpOwogIHZhciB5ID0gX3llYXI7CiAgdmFyIGNwQW5udWVscyA9IHBhcnNlRmxvYXQoX3BhcmFtcy5jcEFubnVlbHMpIHx8IDI1OwogIHZhciBjcFBlcmlvZGUgPSBfcGFyYW1zLmNwUGVyaW9kZSB8fCAnMWp1aW4nOwogIHZhciBydHRBbm51ZWxzID0gcGFyc2VGbG9hdChfcGFyYW1zLnJ0dEFubnVlbHMpIHx8IDA7CiAgdmFyIHBEZWIsIHBGaW47CiAgaWYgKGNwUGVyaW9kZSA9PT0gJzFqYW52JykgeyBwRGViID0gbmV3IERhdGUoeSwwLDEpOyBwRmluID0gbmV3IERhdGUoeSwxMSwzMSk7IH0KICBlbHNlIHsgcERlYiA9IG5ldyBEYXRlKHktMSw1LDEpOyBwRmluID0gbmV3IERhdGUoeSw0LDMxKTsgfQogIHZhciBlbnRyZWUgPSBfZW1wLmRhdGVFbnRyZWUgPyBuZXcgRGF0ZShfZW1wLmRhdGVFbnRyZWUrJ1QxMjowMDowMCcpIDogbmV3IERhdGUoeS0yLDAsMSk7CiAgdmFyIGRlYnV0ID0gZW50cmVlID4gcERlYiA/IGVudHJlZSA6IHBEZWI7CiAgdmFyIGZpbiA9IG5vdyA8IHBGaW4gPyBub3cgOiBwRmluOwogIHZhciBtb2lzID0gTWF0aC5tYXgoMCwgKGZpbi5nZXRGdWxsWWVhcigpLWRlYnV0LmdldEZ1bGxZZWFyKCkpKjEyICsgKGZpbi5nZXRNb250aCgpLWRlYnV0LmdldE1vbnRoKCkpKTsKICB2YXIgYWp1c3QgPSBwYXJzZUZsb2F0KF9lbXAuY3BBanVzdEFjcXVpcykgfHwgMDsKICB2YXIgY3BBY3F1aXMgPSBNYXRoLnJvdW5kKE1hdGgubWF4KDAsIG1vaXMqKGNwQW5udWVscy8xMikrYWp1c3QpKjEwKS8xMDsKICB2YXIgY3BQcmlzID0gX2RlbWFuZGVzLmZpbHRlcihmdW5jdGlvbihkKSB7CiAgICBpZiAoIWQuZGF0ZURlYnV0IHx8IGQudHlwZSAhPT0gJ2NwJyB8fCBkLnN0YXR1dCAhPT0gJ2FwcHJvdmVkJykgcmV0dXJuIGZhbHNlOwogICAgdmFyIGR0ID0gbmV3IERhdGUoZC5kYXRlRGVidXQrJ1QxMjowMDowMCcpOwogICAgcmV0dXJuIGR0ID49IHBEZWIgJiYgZHQgPD0gcEZpbjsKICB9KS5yZWR1Y2UoZnVuY3Rpb24ocyxkKSB7IHJldHVybiBzICsgKGQubmJKb3Vyc3x8MCk7IH0sIDApOwogIHZhciBydHRCYXNlID0gKHBhcnNlRmxvYXQoX2VtcC5ydHRBanVzdCkgPj0gMCkgPyBwYXJzZUZsb2F0KF9lbXAucnR0QWp1c3QpIDogcnR0QW5udWVsczsKICB2YXIgcnR0UHJpcyA9IF9kZW1hbmRlcy5maWx0ZXIoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC50eXBlPT09J3J0dCcgJiYgZC5zdGF0dXQ9PT0nYXBwcm92ZWQnICYmIG5ldyBEYXRlKGQuZGF0ZURlYnV0fHwwKS5nZXRGdWxsWWVhcigpPT09eTsgfSkucmVkdWNlKGZ1bmN0aW9uKHMsZCkgeyByZXR1cm4gcysoZC5uYkpvdXJzfHwwKTsgfSwgMCk7CiAgX3NvbGRlcyA9IHsKICAgIGNwQWNxdWlzOiBjcEFjcXVpcywgY3BQcmlzOiBjcFByaXMsCiAgICBjcFJlc3RhbnQ6IE1hdGgubWF4KDAsIGNwQWNxdWlzLWNwUHJpcyksCiAgICBydHRCYXNlOiBydHRCYXNlLCBydHRQcmlzOiBydHRQcmlzLAogICAgcnR0UmVzdGFudDogTWF0aC5tYXgoMCwgcnR0QmFzZS1ydHRQcmlzKSwKICAgIHJlY3VwUmVzdGFudDogcGFyc2VGbG9hdChfZW1wLnJlY3VwSGV1cmVzKSB8fCAwLAogICAgcGVuZGluZzogX2RlbWFuZGVzLmZpbHRlcihmdW5jdGlvbihkKSB7IHJldHVybiBkLnN0YXR1dD09PSdwZW5kaW5nJzsgfSkubGVuZ3RoLAogIH07Cn0KCi8qIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAogICBSRU5ERVIgR0xPQkFMCuKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkCAqLwpmdW5jdGlvbiByZW5kZXJBbGwoKSB7CiAgdmFyIGNvbCA9IF9lbXAuY291bGV1ciB8fCAnIzA1OTY2OSc7CiAgdmFyIGF2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcm8tYXYnKTsKICBhdi50ZXh0Q29udGVudCA9IChfZW1wLnByZW5vbXx8Jz8nKS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKTsKICBhdi5zdHlsZS5iYWNrZ3JvdW5kID0gY29sOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJvLW5hbWUnKS50ZXh0Q29udGVudCA9ICgoX2VtcC5wcmVub218fCcnKSsnICcrKF9lbXAubm9tfHwnJykpLnRyaW0oKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyby1zdWInKS50ZXh0Q29udGVudCAgPSBbX2VtcC5wb3N0ZSxfZW1wLmRlcGFydGVtZW50LF9lbXAudHlwZUNvbnRyYXRdLmZpbHRlcihCb29sZWFuKS5qb2luKCcgXHUwMGI3ICcpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd5ZWFyLWxibCcpLnRleHRDb250ZW50ICA9IF95ZWFyOwoKICAvLyBDaGlwcyBoZXJvCiAgdmFyIGNoaXBzID0gW107CiAgaWYgKF9lbXAudHlwZUNvbnRyYXQpIGNoaXBzLnB1c2goX2VtcC50eXBlQ29udHJhdCk7CiAgaWYgKF9lbXAuZGVwYXJ0ZW1lbnQpIGNoaXBzLnB1c2goX2VtcC5kZXBhcnRlbWVudCk7CiAgaWYgKF9lbXAuaGV1cmVzSGViZG8pIGNoaXBzLnB1c2goX2VtcC5oZXVyZXNIZWJkbysnaC9zZW0nKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyby1jaGlwcycpLmlubmVySFRNTCA9IGNoaXBzLm1hcChmdW5jdGlvbihjKXsgcmV0dXJuICc8c3BhbiBjbGFzcz0iaGVyby1jaGlwIj4nK2MrJzwvc3Bhbj4nOyB9KS5qb2luKCcnKTsKCiAgcmVuZGVyU29sZGVzRmxvdHRhbnRzKCk7CiAgcmVuZGVyQWNjdWVpbCgpOwogIHJlbmRlclByb2ZpbCgpOwogIHJlbmRlckRvY3VtZW50cygpOwogIHJlbmRlclNvbGRlc0RldGFpbCgpOwogIHJlbmRlclR5cGVHcmlkKCk7CiAgcmVuZGVyRGVtYW5kZXMoKTsKICByZW5kZXJDYWwoKTsKICByZW5kZXJIb3JhaXJlcygpOwp9CgovKiDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKICAgU09MREVTIEZMT1RUQU5UUwrilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAgKi8KZnVuY3Rpb24gcmVuZGVyU29sZGVzRmxvdHRhbnRzKCkgewogIHZhciBzID0gX3NvbGRlczsKICB2YXIgY3BQY3QgPSBzLmNwQWNxdWlzPjAgPyBNYXRoLm1pbihzLmNwUHJpcy9zLmNwQWNxdWlzKjEwMCwxMDApLnRvRml4ZWQoMCkgOiAwOwogIHZhciBydHRQY3QgPSBzLnJ0dEJhc2U+MCA/IE1hdGgubWluKHMucnR0UHJpcy9zLnJ0dEJhc2UqMTAwLDEwMCkudG9GaXhlZCgwKSA6IDA7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvbGRlcy1ncmlkJykuaW5uZXJIVE1MID0KICAgIHNjKCdcdWQ4M2NcdWRmZDZcdWZlMGYnLCBzLmNwUmVzdGFudC50b0ZpeGVkKDEpLCAnaicsICdDUCByZXN0YW50cycsIHMuY3BBY3F1aXMudG9GaXhlZCgxKSsnaiBhY3F1aXMnLCBzLmNwUmVzdGFudD4xMD8nZyc6cy5jcFJlc3RhbnQ+NT8nbyc6J3InLCBjcFBjdCwgJ3ZhcigtLW9yYW5nZSknKQogICArc2MoJ1x1MjNmMCcsIHMucnR0UmVzdGFudC50b0ZpeGVkKDEpLCAnaicsICdSVFQgcmVzdGFudHMnLCBzLnJ0dEJhc2UrJ2ogYWxsb3VcdTAwZTlzJywgcy5ydHRSZXN0YW50PjA/J2cnOidyJywgcnR0UGN0LCAndmFyKC0tYmx1ZSknKQogICArc2MoJ1x1ZDgzZFx1ZGQwNCcsIHMucmVjdXBSZXN0YW50LnRvRml4ZWQoMSksICdoJywgJ1JcdTAwZTljdXBcdTAwZTlyYXRpb24nLCAnSGV1cmVzIFx1MDBlMCBwcmVuZHJlJywgcy5yZWN1cFJlc3RhbnQ+MD8nZyc6JycsIDAsICcnKQogICArc2MoJ1x1MjNmMycsIHMucGVuZGluZywgJycsICdFbiBhdHRlbnRlJywgJ2RlbWFuZGUnKyhzLnBlbmRpbmc+MT8ncyc6JycpKycgXHUwMGUwIHZhbGlkZXInLCBzLnBlbmRpbmc+MD8nbyc6JycsIDAsICcnKTsKfQpmdW5jdGlvbiBzYyhpY29uLCB2YWwsIHVuaXQsIGxibCwgc3ViLCBjbHMsIHBjdCwgZmlsbENvbG9yKSB7CiAgcmV0dXJuICc8ZGl2IGNsYXNzPSJzYyI+JwogICAgKyc8ZGl2IGNsYXNzPSJzYy1pY29uIj4nK2ljb24rJzwvZGl2PicKICAgICsnPGRpdiBjbGFzcz0ic2MtdmFsICcrY2xzKyciPicrdmFsKyc8c3BhbiBjbGFzcz0ic2MtdW5pdCI+Jyt1bml0Kyc8L3NwYW4+PC9kaXY+JwogICAgKyc8ZGl2IGNsYXNzPSJzYy1sYmwiPicrbGJsKyc8L2Rpdj4nCiAgICArJzxkaXYgY2xhc3M9InNjLXN1YiI+JytzdWIrJzwvZGl2PicKICAgICsocGN0PjA/JzxkaXYgY2xhc3M9InNjLWJhciI+PGRpdiBjbGFzcz0ic2MtZmlsbCIgc3R5bGU9IndpZHRoOicrcGN0KyclO2JhY2tncm91bmQ6JytmaWxsQ29sb3IrJyI+PC9kaXY+PC9kaXY+JzonJykKICAgICsnPC9kaXY+JzsKfQoKLyog4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCiAgIEFDQ1VFSUwK4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQICovCmZ1bmN0aW9uIHJlbmRlckFjY3VlaWwoKSB7CiAgdmFyIG5vdyA9IG5ldyBEYXRlKCk7CiAgdmFyIGpvdXJzID0gWydkaW1hbmNoZScsJ2x1bmRpJywnbWFyZGknLCdtZXJjcmVkaScsJ2pldWRpJywndmVuZHJlZGknLCdzYW1lZGknXTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2VsY29tZS1uYW1lJykudGV4dENvbnRlbnQgPSAnQm9uam91ciAnKyhfZW1wLnByZW5vbXx8JycpICsnICEgXHVkODNkXHVkYzRiJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2VsY29tZS1kYXRlJykudGV4dENvbnRlbnQgPSBqb3Vyc1tub3cuZ2V0RGF5KCldKycgJytub3cudG9Mb2NhbGVEYXRlU3RyaW5nKCdmci1GUicse2RheTonbnVtZXJpYycsbW9udGg6J2xvbmcnLHllYXI6J251bWVyaWMnfSk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjY3VlaWwtYW5uZWUtbGJsJykudGV4dENvbnRlbnQgPSAnXHUyMDE0ICcrX3llYXI7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nvbmdlcy1hbm5lZS1sYmwnKS50ZXh0Q29udGVudCA9ICdcdTIwMTQgJytfeWVhcjsKCiAgLy8gSW5mb3MgY29udHJhdAogIHZhciBpbmZvcyA9IFtdOwogIGlmKF9lbXAucG9zdGUpIGluZm9zLnB1c2goe2ljb246J1x1ZDgzZFx1ZGNiYycsIGxhYmVsOidQb3N0ZScsIHZhbDpfZW1wLnBvc3RlfSk7CiAgaWYoX2VtcC5kYXRlRW50cmVlKSBpbmZvcy5wdXNoKHtpY29uOidcdWQ4M2RcdWRjYzUnLCBsYWJlbDonRW50clx1MDBlOWUnLCB2YWw6Zm10RGF0ZShfZW1wLmRhdGVFbnRyZWUpfSk7CiAgaWYoX2VtcC50eXBlQ29udHJhdCkgaW5mb3MucHVzaCh7aWNvbjonXHVkODNkXHVkY2M0JywgbGFiZWw6J0NvbnRyYXQnLCB2YWw6X2VtcC50eXBlQ29udHJhdH0pOwogIGlmKF9lbXAuZGVwYXJ0ZW1lbnQpIGluZm9zLnB1c2goe2ljb246J1x1ZDgzY1x1ZGZlMicsIGxhYmVsOidcdTAwYzlxdWlwZScsIHZhbDpfZW1wLmRlcGFydGVtZW50fSk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjY3VlaWwtaW5mb3MnKS5pbm5lckhUTUwgPSBpbmZvcy5tYXAoZnVuY3Rpb24oaSl7CiAgICByZXR1cm4gJzxkaXYgY2xhc3M9ImluZm8tbGluZSI+PHNwYW4gY2xhc3M9ImluZm8tbGluZS1pY29uIj4nK2kuaWNvbisnPC9zcGFuPjxzcGFuIGNsYXNzPSJpbmZvLWxpbmUtbGFiZWwiPicraS5sYWJlbCsnPC9zcGFuPjxzcGFuIGNsYXNzPSJpbmZvLWxpbmUtdmFsIj4nK2kudmFsKyc8L3NwYW4+PC9kaXY+JzsKICB9KS5qb2luKCcnKTsKCiAgLy8gU29sZGVzIGFjY3VlaWwKICB2YXIgcyA9IF9zb2xkZXM7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjY3VlaWwtc29sZGVzJykuaW5uZXJIVE1MID0KICAgIHNvbGRlQmFyKCdcdWQ4M2NcdWRmZDZcdWZlMGYgQ1AgcmVzdGFudHMnLCBzLmNwUmVzdGFudCwgcy5jcEFjcXVpcywgJ2onLCBzLmNwUmVzdGFudD4xMD8ndmFyKC0tZzMpJzpzLmNwUmVzdGFudD41Pyd2YXIoLS1vcmFuZ2UpJzondmFyKC0tcmVkKScpCiAgICtzb2xkZUJhcignXHUyM2YwIFJUVCByZXN0YW50cycsIHMucnR0UmVzdGFudCwgcy5ydHRCYXNlLCAnaicsIHMucnR0UmVzdGFudD4wPyd2YXIoLS1ibHVlKSc6J3ZhcigtLXJlZCknKQogICArKHMucmVjdXBSZXN0YW50PjA/c29sZGVCYXIoJ1x1ZDgzZFx1ZGQwNCBSXHUwMGU5Y3VwXHUwMGU5cmF0aW9uJywgcy5yZWN1cFJlc3RhbnQsIHMucmVjdXBSZXN0YW50LCAnaCcsICd2YXIoLS10ZWFsKScpOicnKTsKCiAgLy8gMyBkZXJuacOocmVzIGRlbWFuZGVzCiAgdmFyIHJlY2VudCA9IF9kZW1hbmRlcy5zbGljZSgwLDMpOwogIHZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY2N1ZWlsLWRlbWFuZGVzJyk7CiAgaWYoIXJlY2VudC5sZW5ndGgpeyBlbC5pbm5lckhUTUw9JzxkaXYgY2xhc3M9ImVtcHR5Ij48ZGl2IGNsYXNzPSJlbXB0eS1pY29uIj5cdWQ4M2RcdWRjY2I8L2Rpdj5BdWN1bmUgZGVtYW5kZS48L2Rpdj4nOyByZXR1cm47IH0KICBlbC5pbm5lckhUTUwgPSByZWNlbnQubWFwKGZ1bmN0aW9uKGQpewogICAgcmV0dXJuIGRlbUl0ZW1IdG1sKGQpOwogIH0pLmpvaW4oJycpOwoKICAvLyBCYWRnZSBjb25nw6lzIGVuIGF0dGVudGUKICB2YXIgcGVuZGluZ0NvdW50ID0gX3NvbGRlcy5wZW5kaW5nOwogIHZhciB0YWJCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFiLWNvbmdlcy1idG4nKTsKICBpZihwZW5kaW5nQ291bnQ+MCAmJiB0YWJCdG4pewogICAgdGFiQnRuLmlubmVySFRNTCA9ICdcdWQ4M2NcdWRmZDZcdWZlMGYgQ29uZ1x1MDBlOXMgPHNwYW4gY2xhc3M9Im5vdGlmIj4nK3BlbmRpbmdDb3VudCsnPC9zcGFuPic7CiAgfQoKICAvLyBCYWRnZSBkb2N1bWVudHMgbWFucXVhbnRzCiAgdmFyIG1pc3NpbmdEb2NzID0gRE9DU19SRVFVSVJFRC5maWx0ZXIoZnVuY3Rpb24oZCl7IHJldHVybiAhZC5vcHRpb25hbCAmJiAhX2RvY3NFbXBsb3llZVtkLmlkXTsgfSkubGVuZ3RoOwogIHZhciB0YWJEb2NzQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhYi1kb2NzLWJ0bicpOwogIGlmKG1pc3NpbmdEb2NzPjAgJiYgdGFiRG9jc0J0bil7CiAgICB0YWJEb2NzQnRuLmlubmVySFRNTCA9ICdcdWQ4M2RcdWRjY2UgRG9jdW1lbnRzIDxzcGFuIGNsYXNzPSJub3RpZiI+JyttaXNzaW5nRG9jcysnPC9zcGFuPic7CiAgfQp9CgpmdW5jdGlvbiBzb2xkZUJhcihsYWJlbCwgdmFsLCBtYXgsIHVuaXQsIGNvbG9yKSB7CiAgdmFyIHBjdCA9IG1heD4wID8gTWF0aC5taW4odmFsL21heCoxMDAsMTAwKS50b0ZpeGVkKDApIDogMDsKICByZXR1cm4gJzxkaXYgc3R5bGU9Im1hcmdpbi1ib3R0b206MTJweCI+JwogICAgKyc8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47YWxpZ24taXRlbXM6YmFzZWxpbmU7bWFyZ2luLWJvdHRvbTo0cHgiPicKICAgICAgKyc8c3BhbiBzdHlsZT0iZm9udC1zaXplOjEycHg7Zm9udC13ZWlnaHQ6NzAwIj4nK2xhYmVsKyc8L3NwYW4+JwogICAgICArJzxzcGFuIHN0eWxlPSJmb250LXNpemU6MTRweDtmb250LXdlaWdodDo4MDA7Y29sb3I6Jytjb2xvcisnIj4nK3ZhbC50b0ZpeGVkKDEpKyc8c3BhbiBzdHlsZT0iZm9udC1zaXplOjEwcHg7Zm9udC13ZWlnaHQ6NjAwIj4gJyt1bml0Kyc8L3NwYW4+PC9zcGFuPicKICAgICsnPC9kaXY+JwogICAgKyc8ZGl2IHN0eWxlPSJoZWlnaHQ6NnB4O2JhY2tncm91bmQ6I2YzZjRmNjtib3JkZXItcmFkaXVzOjk5cHg7b3ZlcmZsb3c6aGlkZGVuIj4nCiAgICAgICsnPGRpdiBzdHlsZT0iaGVpZ2h0OjEwMCU7d2lkdGg6JytwY3QrJyU7YmFja2dyb3VuZDonK2NvbG9yKyc7Ym9yZGVyLXJhZGl1czo5OXB4O3RyYW5zaXRpb246d2lkdGggLjVzIGVhc2UiPjwvZGl2PicKICAgICsnPC9kaXY+JwogICAgKyc8ZGl2IHN0eWxlPSJmb250LXNpemU6MTBweDtjb2xvcjp2YXIoLS1tdXRlZCk7bWFyZ2luLXRvcDoycHgiPicrdmFsLnRvRml4ZWQoMSkrJyAvICcrbWF4LnRvRml4ZWQoMSkrJyAnK3VuaXQrJyAoJytwY3QrJyUgdXRpbGlzXHUwMGU5cyk8L2Rpdj4nCiAgKyc8L2Rpdj4nOwp9CgovKiDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKICAgUFJPRklMCuKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkCAqLwpmdW5jdGlvbiByZW5kZXJQcm9maWwoKSB7CiAgLy8gQ29udHJhdCBjYXJkCiAgdmFyIGRhdGVFbnRyZWUgPSBfZW1wLmRhdGVFbnRyZWUgPyBmbXREYXRlKF9lbXAuZGF0ZUVudHJlZSkgOiAnXHUyMDE0JzsKICB2YXIgYW5jaWVubmV0ZSA9IF9lbXAuZGF0ZUVudHJlZSA/IGNhbGNBbmNpZW5uZXRlKF9lbXAuZGF0ZUVudHJlZSkgOiAnJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udHJhdC1jYXJkLXdyYXAnKS5pbm5lckhUTUwgPQogICAgJzxkaXYgY2xhc3M9ImNvbnRyYXQtY2FyZCI+JwogICAgICArJzxkaXYgY2xhc3M9ImNvbnRyYXQtbGVmdCI+JwogICAgICAgICsnPGRpdiBjbGFzcz0iY29udHJhdC10eXBlIj4nKygoX2VtcC50eXBlQ29udHJhdHx8J0NvbnRyYXQnKSkrJyBcdTAwYjcgJysoX2VtcC5wb3N0ZXx8J1x1MjAxNCcpKyc8L2Rpdj4nCiAgICAgICAgKyc8ZGl2IGNsYXNzPSJjb250cmF0LXN1YiI+JwogICAgICAgICAgKyhfZW1wLmRlcGFydGVtZW50P19lbXAuZGVwYXJ0ZW1lbnQrJyBcdTAwYjcgJzonJykKICAgICAgICAgICsoX2VtcC5oZXVyZXNIZWJkbz9fZW1wLmhldXJlc0hlYmRvKydoL3NlbWFpbmUgXHUwMGI3ICc6JycpCiAgICAgICAgICArKF9lbXAuZnJlcXVlbmNlP19lbXAuZnJlcXVlbmNlLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpK19lbXAuZnJlcXVlbmNlLnNsaWNlKDEpKycnOicnKQogICAgICAgICsnPC9kaXY+JwogICAgICAgICsnPGRpdiBjbGFzcz0iY29udHJhdC1zdWIiIHN0eWxlPSJtYXJnaW4tdG9wOjRweCI+RW50clx1MDBlOWUgOiAnK2RhdGVFbnRyZWUrJzwvZGl2PicKICAgICAgKyc8L2Rpdj4nCiAgICAgICsoYW5jaWVubmV0ZT8nPGRpdiBjbGFzcz0iY29udHJhdC1zdGF0Ij48ZGl2IGNsYXNzPSJjcy12YWwiPicrYW5jaWVubmV0ZSsnPC9kaXY+PGRpdiBjbGFzcz0iY3MtbGJsIj5BbmNpZW5uZXRcdTAwZTk8L2Rpdj48L2Rpdj4nOicnKQogICAgKyc8L2Rpdj4nOwoKICAvLyBJbmZvcyBwZXJzb25uZWxsZXMKICB2YXIgcGYgPSBfcHJvZmlsRmllbGRzOwogIHNldFZhbCgncGYtcHJlbm9tJywgX2VtcC5wcmVub218fCdcdTIwMTQnKTsKICBzZXRWYWwoJ3BmLW5vbScsIF9lbXAubm9tfHwnXHUyMDE0Jyk7CiAgc2V0RWRpdFZhbCgncGYtZW1haWwtcGVyc28nLCBwZi5lbWFpbFBlcnNvLCAnQWpvdXRlciBlbWFpbCBwZXJzb25uZWwnKTsKICBzZXRFZGl0VmFsKCdwZi10ZWwnLCBwZi50ZWxlcGhvbmUsICdBam91dGVyIHRcdTAwZTlsXHUwMGU5cGhvbmUnKTsKICBzZXRFZGl0VmFsKCdwZi1hZHJlc3NlJywgcGYuYWRyZXNzZSwgJ0Fqb3V0ZXIgYWRyZXNzZScpOwogIHNldEVkaXRWYWwoJ3BmLWRkbicsIHBmLmRhdGVOYWlzc2FuY2UsICdBam91dGVyIGRhdGUgZGUgbmFpc3NhbmNlJyk7CiAgc2V0RWRpdFZhbCgncGYtbmF0JywgcGYubmF0aW9uYWxpdGUsICdBam91dGVyIG5hdGlvbmFsaXRcdTAwZTknKTsKICBzZXRFZGl0VmFsKCdwZi1pYmFuJywgcGYuaWJhbiA/IG1hc2tJYmFuKHBmLmliYW4pIDogJycsICdBam91dGVyIElCQU4nKTsKICBzZXRFZGl0VmFsKCdwZi10aXR1bGFpcmUnLCBwZi5pYmFuVGl0dWxhaXJlLCAnQWpvdXRlciB0aXR1bGFpcmUnKTsKICBzZXRFZGl0VmFsKCdwZi11cmdlbmNlLW5vbScsIHBmLmNvbnRhY3RVcmdlbmNlTm9tLCAnQWpvdXRlciBjb250YWN0IHVyZ2VuY2UnKTsKICBzZXRFZGl0VmFsKCdwZi11cmdlbmNlLWxpZW4nLCBwZi5jb250YWN0VXJnZW5jZUxpZW4sICdFeCA6IGNvbmpvaW50LCBwYXJlbnQuLi4nKTsKICBzZXRFZGl0VmFsKCdwZi11cmdlbmNlLXRlbCcsIHBmLmNvbnRhY3RVcmdlbmNlVGVsLCAnVFx1MDBlOWxcdTAwZTlwaG9uZSB1cmdlbmNlJyk7CgogIC8vIFVyZ2VuY2UgY2FyZAogIHZhciB1dyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1cmdlbmNlLXdyYXAnKTsKICBpZihwZi5jb250YWN0VXJnZW5jZU5vbSAmJiBwZi5jb250YWN0VXJnZW5jZVRlbCl7CiAgICB1dy5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz0idXJnZW5jZS1jYXJkIj4nCiAgICAgICsnPGRpdiBjbGFzcz0idXJnZW5jZS1pY28iPlx1ZDgzZFx1ZGVhODwvZGl2PicKICAgICAgKyc8ZGl2IGNsYXNzPSJ1cmdlbmNlLWJvZHkiPicKICAgICAgICArJzxkaXYgY2xhc3M9InVyZ2VuY2UtbmFtZSI+JytwZi5jb250YWN0VXJnZW5jZU5vbSsnPC9kaXY+JwogICAgICAgICsocGYuY29udGFjdFVyZ2VuY2VMaWVuPyc8ZGl2IGNsYXNzPSJ1cmdlbmNlLWxpZW4iPicrcGYuY29udGFjdFVyZ2VuY2VMaWVuKyc8L2Rpdj4nOicnKQogICAgICAgICsnPGRpdiBjbGFzcz0idXJnZW5jZS10ZWwiPlx1ZDgzZFx1ZGNkZSAnK3BmLmNvbnRhY3RVcmdlbmNlVGVsKyc8L2Rpdj4nCiAgICAgICsnPC9kaXY+JwogICAgKyc8L2Rpdj4nOwogIH0gZWxzZSB7IHV3LmlubmVySFRNTCA9ICcnOyB9CgogIC8vIENvbnRyYXQgUk8KICB2YXIgY29udHJhdFJvd3MgPSBbXTsKICBpZihfZW1wLnR5cGVDb250cmF0KSBjb250cmF0Um93cy5wdXNoKHtpY29uOidcdWQ4M2RcdWRjYzQnLCBsYWJlbDonVHlwZScsIHZhbDpfZW1wLnR5cGVDb250cmF0fSk7CiAgaWYoX2VtcC5kYXRlRW50cmVlKSBjb250cmF0Um93cy5wdXNoKHtpY29uOidcdWQ4M2RcdWRjYzUnLCBsYWJlbDonRGF0ZSBlbnRyXHUwMGU5ZScsIHZhbDpmbXREYXRlKF9lbXAuZGF0ZUVudHJlZSl9KTsKICBpZihfZW1wLmhldXJlc0hlYmRvKSBjb250cmF0Um93cy5wdXNoKHtpY29uOidcdTIzZjAnLCBsYWJlbDonSG9yYWlyZScsIHZhbDpfZW1wLmhldXJlc0hlYmRvKydoIC8gc2VtYWluZSd9KTsKICBpZihfZW1wLmNhdGVnb3JpZVBvc3RlKSBjb250cmF0Um93cy5wdXNoKHtpY29uOidcdWQ4M2RcdWRjYmMnLCBsYWJlbDonQ2F0XHUwMGU5Z29yaWUnLCB2YWw6Y2FwaXRhbGl6ZShfZW1wLmNhdGVnb3JpZVBvc3RlKX0pOwogIGlmKF9lbXAuY2NuKSBjb250cmF0Um93cy5wdXNoKHtpY29uOidcdWQ4M2RcdWRjY2InLCBsYWJlbDonQ29udmVudGlvbicsIHZhbDpfZW1wLmNjbn0pOwogIGlmKF9lbXAucGVyaW9kZUVzc2FpICYmIF9lbXAucGVyaW9kZUVzc2FpLmFjdGl2ZSkgY29udHJhdFJvd3MucHVzaCh7aWNvbjonXHUyNmEwXHVmZTBmJywgbGFiZWw6J1BcdTAwZTlyaW9kZSBlc3NhaScsIHZhbDonRW4gY291cnMnfSk7CiAgdmFyIGNiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRyYXQtYm9keScpOwogIGlmKGNvbnRyYXRSb3dzLmxlbmd0aCl7CiAgICBjYi5pbm5lckhUTUwgPSBjb250cmF0Um93cy5tYXAoZnVuY3Rpb24ocil7CiAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0iaW5mby1saW5lIj48c3BhbiBjbGFzcz0iaW5mby1saW5lLWljb24iPicrci5pY29uKyc8L3NwYW4+PHNwYW4gY2xhc3M9ImluZm8tbGluZS1sYWJlbCI+JytyLmxhYmVsKyc8L3NwYW4+PHNwYW4gY2xhc3M9ImluZm8tbGluZS12YWwiPicrci52YWwrJzwvc3Bhbj48L2Rpdj4nOwogICAgfSkuam9pbignJyk7CiAgfSBlbHNlIHsKICAgIGNiLmlubmVySFRNTCA9ICc8ZGl2IGNsYXNzPSJlbXB0eSI+PGRpdiBjbGFzcz0iZW1wdHktaWNvbiI+XHVkODNkXHVkY2NiPC9kaXY+PHNwYW4+SW5mb3MgZGUgY29udHJhdCBcdTAwZTAgcmVuc2VpZ25lciBwYXIgdm90cmUgZW1wbG95ZXVyLjwvc3Bhbj48L2Rpdj4nOwogIH0KfQoKZnVuY3Rpb24gc2V0VmFsKGlkLCB2YWwpIHsgdmFyIGVsPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsgaWYoZWwpIGVsLnRleHRDb250ZW50PXZhbDsgfQpmdW5jdGlvbiBzZXRFZGl0VmFsKGlkLCB2YWwsIHBsYWNlaG9sZGVyKSB7CiAgdmFyIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOwogIGlmKCFlbCkgcmV0dXJuOwogIGlmKHZhbCkgewogICAgZWwudGV4dENvbnRlbnQgPSB2YWw7CiAgICBlbC5zdHlsZS5jb2xvciA9ICd2YXIoLS10ZXh0KSc7CiAgfSBlbHNlIHsKICAgIGVsLnRleHRDb250ZW50ID0gcGxhY2Vob2xkZXJ8fCdcdTIwMTQnOwogICAgZWwuc3R5bGUuY29sb3IgPSAndmFyKC0tbXV0ZWQpJzsKICB9Cn0KCmZ1bmN0aW9uIGVkaXRGaWVsZChlbCwgZmllbGRLZXkpIHsKICB2YXIgY3VycmVudFZhbCA9IF9wcm9maWxGaWVsZHNbZmllbGRLZXldIHx8ICcnOwogIHZhciBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7CiAgaW5wdXQuY2xhc3NOYW1lID0gJ3Byb2ZpbC1pbnB1dCc7CiAgaW5wdXQudmFsdWUgPSBjdXJyZW50VmFsOwogIGlucHV0LnBsYWNlaG9sZGVyID0gZWwuZ2V0QXR0cmlidXRlKCd0aXRsZScpIHx8ICdTYWlzaXIuLi4nOwogIGVsLnJlcGxhY2VXaXRoKGlucHV0KTsKICBpbnB1dC5mb2N1cygpOwogIGlucHV0LnNlbGVjdCgpOwoKICBmdW5jdGlvbiBzYXZlKCkgewogICAgdmFyIG5ld1ZhbCA9IGlucHV0LnZhbHVlLnRyaW0oKTsKICAgIF9wcm9maWxFZGl0c1tmaWVsZEtleV0gPSBuZXdWYWw7CiAgICBfcHJvZmlsRmllbGRzW2ZpZWxkS2V5XSA9IG5ld1ZhbDsKICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGRpdi5pZCA9IGVsLmlkOwogICAgZGl2LmNsYXNzTmFtZSA9IGVsLmNsYXNzTmFtZTsKICAgIGRpdi5zZXRBdHRyaWJ1dGUoJ29uY2xpY2snLCBlbC5nZXRBdHRyaWJ1dGUoJ29uY2xpY2snKSk7CiAgICBkaXYuc2V0QXR0cmlidXRlKCd0aXRsZScsIGVsLmdldEF0dHJpYnV0ZSgndGl0bGUnKSk7CiAgICBkaXYuc3R5bGUuY29sb3IgPSBuZXdWYWwgPyAndmFyKC0tdGV4dCknIDogJ3ZhcigtLW11dGVkKSc7CiAgICBpZihmaWVsZEtleT09PSdpYmFuJyAmJiBuZXdWYWwpIGRpdi50ZXh0Q29udGVudCA9IG1hc2tJYmFuKG5ld1ZhbCk7CiAgICBlbHNlIGRpdi50ZXh0Q29udGVudCA9IG5ld1ZhbCB8fCAoZWwuZ2V0QXR0cmlidXRlKCd0aXRsZScpfHwnXHUyMDE0Jyk7CiAgICBpbnB1dC5yZXBsYWNlV2l0aChkaXYpOwogICAgLy8gUsOpYXR0YWNoZXIgbGUgZXZlbnQgb25jbGljawogICAgZGl2LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKXsgZWRpdEZpZWxkKGRpdiwgZmllbGRLZXkpOyB9KTsKICAgIC8vIEFmZmljaGVyIGJvdXRvbiBzYXZlCiAgICBpZihPYmplY3Qua2V5cyhfcHJvZmlsRWRpdHMpLmxlbmd0aCA+IDApewogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRuLXNhdmUtcHJvZmlsJykuY2xhc3NMaXN0LmFkZCgnc2hvdycpOwogICAgfQogIH0KICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgc2F2ZSk7CiAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGZ1bmN0aW9uKGUpeyBpZihlLmtleT09PSdFbnRlcicpIGlucHV0LmJsdXIoKTsgaWYoZS5rZXk9PT0nRXNjYXBlJyl7IGlucHV0LnZhbHVlPWN1cnJlbnRWYWw7IGlucHV0LmJsdXIoKTsgfSB9KTsKfQp3aW5kb3cuZWRpdEZpZWxkID0gZWRpdEZpZWxkOwoKYXN5bmMgZnVuY3Rpb24gc2F2ZVByb2ZpbCgpIHsKICBpZighT2JqZWN0LmtleXMoX3Byb2ZpbEVkaXRzKS5sZW5ndGgpIHJldHVybjsKICB2YXIgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bi1zYXZlLXByb2ZpbCcpOwogIGJ0bi50ZXh0Q29udGVudCA9ICdcdTIzZjMgRW5yZWdpc3RyZW1lbnQuLi4nOwogIGJ0bi5kaXNhYmxlZCA9IHRydWU7CiAgdHJ5IHsKICAgIC8vIEZ1c2lvbm5lciBhdmVjIGRvbm7DqWVzIGV4aXN0YW50ZXMKICAgIHZhciB0b1NhdmUgPSBPYmplY3QuYXNzaWduKHt9LCBfcHJvZmlsRmllbGRzLCBfcHJvZmlsRWRpdHMsIHsKICAgICAgZW1wSWQ6IF9lbXBJZCwKICAgICAgdWlkOiBfdWlkLAogICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKQogICAgfSk7CiAgICBhd2FpdCB3aW5kb3cuX3NldERvY0ZzKCdyaF9lbXBsb3llc19wdWJsaWNfcHJvZmlsJywgX3VpZCsnXycrX2VtcElkLCB0b1NhdmUsIHttZXJnZTp0cnVlfSk7CiAgICAvLyBBdXNzaSBtZXR0cmUgw6Agam91ciBsZXMgY2hhbXBzIG5vbi1zZW5zaWJsZXMgc3VyIGxlIGRvYyBwdWJsaWMKICAgIHZhciBwdWJsaWNVcGRhdGUgPSB7fTsKICAgIGlmKF9wcm9maWxFZGl0cy50ZWxlcGhvbmUpIHB1YmxpY1VwZGF0ZS50ZWxlcGhvbmUgPSBfcHJvZmlsRWRpdHMudGVsZXBob25lOwogICAgaWYoX3Byb2ZpbEVkaXRzLmNvbnRhY3RVcmdlbmNlTm9tKSBwdWJsaWNVcGRhdGUuY29udGFjdFVyZ2VuY2VOb20gPSBfcHJvZmlsRWRpdHMuY29udGFjdFVyZ2VuY2VOb207CiAgICBpZihfcHJvZmlsRWRpdHMuY29udGFjdFVyZ2VuY2VUZWwpIHB1YmxpY1VwZGF0ZS5jb250YWN0VXJnZW5jZVRlbCA9IF9wcm9maWxFZGl0cy5jb250YWN0VXJnZW5jZVRlbDsKICAgIGlmKF9wcm9maWxFZGl0cy5jb250YWN0VXJnZW5jZUxpZW4pIHB1YmxpY1VwZGF0ZS5jb250YWN0VXJnZW5jZUxpZW4gPSBfcHJvZmlsRWRpdHMuY29udGFjdFVyZ2VuY2VMaWVuOwogICAgaWYoT2JqZWN0LmtleXMocHVibGljVXBkYXRlKS5sZW5ndGgpewogICAgICBPYmplY3QuYXNzaWduKF9lbXAsIHB1YmxpY1VwZGF0ZSk7CiAgICB9CiAgICBfcHJvZmlsRWRpdHMgPSB7fTsKICAgIGJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgICBidG4udGV4dENvbnRlbnQgPSAnXHVkODNkXHVkY2JlIEVucmVnaXN0cmVyIGxlcyBtb2RpZmljYXRpb25zJzsKICAgIGJ0bi5kaXNhYmxlZCA9IGZhbHNlOwogICAgc2hvd1RvYXN0KCdcdTI3MDUgUHJvZmlsIGVucmVnaXN0clx1MDBlOScsJ29rJyk7CiAgICByZW5kZXJQcm9maWwoKTsgLy8gcmUtcmVuZGVyIHVyZ2VuY2UgY2FyZAogIH0gY2F0Y2goZSkgewogICAgY29uc29sZS5lcnJvcihlKTsKICAgIHNob3dUb2FzdCgnRXJyZXVyIDogJytlLm1lc3NhZ2UsJ2VycicpOwogICAgYnRuLnRleHRDb250ZW50ID0gJ1x1ZDgzZFx1ZGNiZSBFbnJlZ2lzdHJlciBsZXMgbW9kaWZpY2F0aW9ucyc7CiAgICBidG4uZGlzYWJsZWQgPSBmYWxzZTsKICB9Cn0Kd2luZG93LnNhdmVQcm9maWwgPSBzYXZlUHJvZmlsOwoKLyog4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCiAgIERPQ1VNRU5UUwrilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAgKi8KZnVuY3Rpb24gcmVuZGVyRG9jdW1lbnRzKCkgewogIHZhciB0b3RhbCA9IERPQ1NfUkVRVUlSRUQuZmlsdGVyKGZ1bmN0aW9uKGQpeyByZXR1cm4gIWQub3B0aW9uYWw7IH0pLmxlbmd0aDsKICB2YXIgZG9uZSAgPSBET0NTX1JFUVVJUkVELmZpbHRlcihmdW5jdGlvbihkKXsgcmV0dXJuICFkLm9wdGlvbmFsICYmIF9kb2NzRW1wbG95ZWVbZC5pZF07IH0pLmxlbmd0aDsKICB2YXIgcGN0ICAgPSB0b3RhbCA+IDAgPyBNYXRoLnJvdW5kKGRvbmUgLyB0b3RhbCAqIDEwMCkgOiAwOwoKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG9jcy1wcm9ncmVzcy1sYmwnKS50ZXh0Q29udGVudCAgID0gZG9uZSArICcgLyAnICsgdG90YWwgKyAnIGRvY3VtZW50cyBmb3VybmlzJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG9jcy1wcm9ncmVzcy1maWxsJykuc3R5bGUud2lkdGggID0gcGN0ICsgJyUnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb2NzLXJlcXVpcmVkLWNvdW50JykudGV4dENvbnRlbnQgPSBkb25lICsgJy8nICsgdG90YWw7CgogIC8vIOKUgOKUgCBDb25zdHJ1Y3Rpb24gRE9NIHB1cmUg4oCUIHrDqXJvIGlubmVySFRNTCBhdmVjIGFjY2VudHMg4pSA4pSACiAgdmFyIHJlcUxpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG9jcy1yZXF1aXJlZC1saXN0Jyk7CiAgcmVxTGlzdC5pbm5lckhUTUwgPSAnJzsKCiAgRE9DU19SRVFVSVJFRC5mb3JFYWNoKGZ1bmN0aW9uKGRvYywgaWR4KSB7CiAgICB2YXIgdXBsb2FkZWQgID0gX2RvY3NFbXBsb3llZVtkb2MuaWRdOwogICAgdmFyIGNscyAgICAgICA9IHVwbG9hZGVkID8gJ2RvYy1pdGVtIHVwbG9hZGVkJyA6IChkb2Mub3B0aW9uYWwgPyAnZG9jLWl0ZW0nIDogJ2RvYy1pdGVtIHJlcXVpcmVkJyk7CiAgICB2YXIgaWNvQ2xhc3MgID0gdXBsb2FkZWQgPyAnZycgOiAoZG9jLm9wdGlvbmFsID8gJ28nIDogJ3InKTsKICAgIHZhciBkYXRlU3RyICAgPSB1cGxvYWRlZCAmJiB1cGxvYWRlZC51cGxvYWRlZEF0ID8gJyBcdTAwYjcgJyArIGZtdERhdGUodXBsb2FkZWQudXBsb2FkZWRBdC5zcGxpdCgnVCcpWzBdKSA6ICcnOwoKICAgIC8vIENvbnRlbmV1cgogICAgdmFyIGl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGl0ZW0uY2xhc3NOYW1lID0gY2xzOwoKICAgIC8vIEljw7RuZQogICAgdmFyIGljbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgaWNvLmNsYXNzTmFtZSA9ICdkb2MtaWNvICcgKyBpY29DbGFzczsKICAgIGljby50ZXh0Q29udGVudCA9IGRvYy5pY29uOwogICAgaXRlbS5hcHBlbmRDaGlsZChpY28pOwoKICAgIC8vIEluZm9zCiAgICB2YXIgaW5mbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgaW5mby5jbGFzc05hbWUgPSAnZG9jLWluZm8nOwoKICAgIHZhciBuYW1lRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBuYW1lRGl2LmNsYXNzTmFtZSA9ICdkb2MtbmFtZSc7CiAgICBuYW1lRGl2LnRleHRDb250ZW50ID0gZG9jLmxhYmVsOwogICAgaWYgKGRvYy5vcHRpb25hbCkgewogICAgICB2YXIgb3B0U3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgb3B0U3Bhbi5zdHlsZS5jc3NUZXh0ID0gJ2ZvbnQtc2l6ZTo5cHg7Zm9udC13ZWlnaHQ6NDAwO2NvbG9yOnZhcigtLW11dGVkKTttYXJnaW4tbGVmdDo0cHgnOwogICAgICBvcHRTcGFuLnRleHRDb250ZW50ID0gJyhmYWN1bHRhdGlmKSc7CiAgICAgIG5hbWVEaXYuYXBwZW5kQ2hpbGQob3B0U3Bhbik7CiAgICB9CiAgICBpbmZvLmFwcGVuZENoaWxkKG5hbWVEaXYpOwoKICAgIHZhciBtZXRhRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBtZXRhRGl2LmNsYXNzTmFtZSA9ICdkb2MtbWV0YSc7CiAgICBtZXRhRGl2LnRleHRDb250ZW50ID0gdXBsb2FkZWQgPyAoJ1x1MjcwNSAnICsgdXBsb2FkZWQubmFtZSArIGRhdGVTdHIpIDogZG9jLmRlc2M7CiAgICBpbmZvLmFwcGVuZENoaWxkKG1ldGFEaXYpOwoKICAgIGl0ZW0uYXBwZW5kQ2hpbGQoaW5mbyk7CgogICAgLy8gQm91dG9uIGFjdGlvbgogICAgdmFyIGFjdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgYWN0aW9uLmNsYXNzTmFtZSA9ICdkb2MtYWN0aW9uJzsKICAgIHZhciBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICAgIGJ0bi5zZXRBdHRyaWJ1dGUoJ2RhdGEtaWR4JywgaWR4KTsKICAgIGlmICh1cGxvYWRlZCkgewogICAgICBidG4uY2xhc3NOYW1lID0gJ2J0bi12aWV3JzsKICAgICAgYnRuLnRleHRDb250ZW50ID0gJ1x1ZDgzZFx1ZGM0MSBWb2lyJzsKICAgICAgYnRuLm9uY2xpY2sgPSBmdW5jdGlvbigpIHsgdmlld0RvY0lkeCh0aGlzKTsgfTsKICAgIH0gZWxzZSB7CiAgICAgIGJ0bi5jbGFzc05hbWUgPSAnYnRuLXVwbG9hZCc7CiAgICAgIGJ0bi50ZXh0Q29udGVudCA9ICdcdWQ4M2RcdWRjZTQgRFx1MDBlOXBvc2VyJzsKICAgICAgYnRuLm9uY2xpY2sgPSBmdW5jdGlvbigpIHsgb3BlblVwbG9hZElkeCh0aGlzKTsgfTsKICAgIH0KICAgIGFjdGlvbi5hcHBlbmRDaGlsZChidG4pOwogICAgaXRlbS5hcHBlbmRDaGlsZChhY3Rpb24pOwoKICAgIHJlcUxpc3QuYXBwZW5kQ2hpbGQoaXRlbSk7CiAgfSk7CgogIC8vIOKUgOKUgCBEb2NzIHJlw6d1cyBkZSBsJ2VtcGxveWV1ciDilIDilIAKICB2YXIgZW1wTGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb2NzLWVtcGxveWVyLWxpc3QnKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZG9jcy1lbXBsb3llci1jb3VudCcpLnRleHRDb250ZW50ID0gX2RvY3NFbXBsb3llci5sZW5ndGggfHwgJzAnOwogIGVtcExpc3QuaW5uZXJIVE1MID0gJyc7CgogIGlmICghX2RvY3NFbXBsb3llci5sZW5ndGgpIHsKICAgIHZhciBlbXB0eSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgZW1wdHkuY2xhc3NOYW1lID0gJ2VtcHR5JzsKICAgIGVtcHR5LmlubmVySFRNTCA9ICc8ZGl2IGNsYXNzPSJlbXB0eS1pY29uIj5cdWQ4M2RcdWRjZTU8L2Rpdj4nOwogICAgdmFyIGVtcHR5VHh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgZW1wdHlUeHQudGV4dENvbnRlbnQgPSAnQXVjdW4gZG9jdW1lbnQgdHJhbnNtaXMgcGFyIHZvdHJlIGVtcGxveWV1ciBwb3VyIGxcdTIwMTlpbnN0YW50Lic7CiAgICBlbXB0eS5hcHBlbmRDaGlsZChlbXB0eVR4dCk7CiAgICBlbXBMaXN0LmFwcGVuZENoaWxkKGVtcHR5KTsKICB9IGVsc2UgewogICAgX2RvY3NFbXBsb3llci5mb3JFYWNoKGZ1bmN0aW9uKGRvYywgaSkgewogICAgICB2YXIgZGF0ZVN0ciA9IGRvYy51cGxvYWRlZEF0ID8gZm10RGF0ZShkb2MudXBsb2FkZWRBdC5zcGxpdCgnVCcpWzBdKSA6ICcnOwoKICAgICAgdmFyIGl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgaXRlbS5jbGFzc05hbWUgPSAnZG9jLWl0ZW0gZW1wbG95ZXInOwoKICAgICAgdmFyIGljbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICBpY28uY2xhc3NOYW1lID0gJ2RvYy1pY28gYic7CiAgICAgIGljby50ZXh0Q29udGVudCA9ICdcdWQ4M2RcdWRjYzQnOwogICAgICBpdGVtLmFwcGVuZENoaWxkKGljbyk7CgogICAgICB2YXIgaW5mbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICBpbmZvLmNsYXNzTmFtZSA9ICdkb2MtaW5mbyc7CgogICAgICB2YXIgbmFtZURpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICBuYW1lRGl2LmNsYXNzTmFtZSA9ICdkb2MtbmFtZSc7CiAgICAgIG5hbWVEaXYudGV4dENvbnRlbnQgPSBkb2MubGFiZWwgfHwgJ0RvY3VtZW50JzsKICAgICAgaW5mby5hcHBlbmRDaGlsZChuYW1lRGl2KTsKCiAgICAgIHZhciBtZXRhRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIG1ldGFEaXYuY2xhc3NOYW1lID0gJ2RvYy1tZXRhJzsKICAgICAgbWV0YURpdi50ZXh0Q29udGVudCA9IChkb2MubmFtZSB8fCAnJykgKyAoZGF0ZVN0ciA/ICcgXHUwMGI3ICcgKyBkYXRlU3RyIDogJycpOwogICAgICBpbmZvLmFwcGVuZENoaWxkKG1ldGFEaXYpOwoKICAgICAgaXRlbS5hcHBlbmRDaGlsZChpbmZvKTsKCiAgICAgIGlmIChkb2MuZGF0YSkgewogICAgICAgIHZhciBhY3Rpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBhY3Rpb24uY2xhc3NOYW1lID0gJ2RvYy1hY3Rpb24nOwogICAgICAgIHZhciBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICAgICAgICBidG4uY2xhc3NOYW1lID0gJ2J0bi12aWV3JzsKICAgICAgICBidG4udGV4dENvbnRlbnQgPSAnXHVkODNkXHVkYzQxIFZvaXInOwogICAgICAgIChmdW5jdGlvbihpZHgpeyBidG4ub25jbGljayA9IGZ1bmN0aW9uKCkgeyB2aWV3RW1wbG95ZXJEb2MoaWR4KTsgfTsgfSkoaSk7CiAgICAgICAgYWN0aW9uLmFwcGVuZENoaWxkKGJ0bik7CiAgICAgICAgaXRlbS5hcHBlbmRDaGlsZChhY3Rpb24pOwogICAgICB9CgogICAgICBlbXBMaXN0LmFwcGVuZENoaWxkKGl0ZW0pOwogICAgfSk7CiAgfQp9CgovLyBPdXZyZSBsYSBtb2RhbCB2aWEgaW5kZXggKHBhcyBkZSBzdHJpbmcgZGFucyBvbmNsaWNrKQpmdW5jdGlvbiBvcGVuVXBsb2FkSWR4KGJ0bikgewogIHZhciBpZHggPSBwYXJzZUludChidG4uZ2V0QXR0cmlidXRlKCdkYXRhLWlkeCcpKTsKICB2YXIgZG9jRGVmID0gRE9DU19SRVFVSVJFRFtpZHhdIHx8IHt9OwogIG9wZW5VcGxvYWRNb2RhbChkb2NEZWYuaWQsIGRvY0RlZi5sYWJlbCwgZG9jRGVmLmRlc2MpOwp9CndpbmRvdy5vcGVuVXBsb2FkSWR4ID0gb3BlblVwbG9hZElkeDsKCmZ1bmN0aW9uIG9wZW5VcGxvYWRNb2RhbChkb2NJZCwgbGFiZWwsIGRlc2MpIHsKICBfdXBsb2FkRG9jSWQgPSBkb2NJZDsKICBfdXBsb2FkQjY0ID0gbnVsbDsgX3VwbG9hZE1ldGEgPSBudWxsOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1cGxvYWQtbW9kYWwtdGl0bGUnKS50ZXh0Q29udGVudCA9ICdcdWQ4M2RcdWRjZTQgJysobGFiZWx8fGRvY0lkKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXBsb2FkLW1vZGFsLWRlc2MnKS50ZXh0Q29udGVudCA9IGRlc2N8fCcnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1cGxvYWQtaW5wdXQnKS52YWx1ZSA9ICcnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1cGxvYWQtcHJldmlldycpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VwbG9hZC1zdWJtaXQtYnRuJykuZGlzYWJsZWQgPSB0cnVlOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1cGxvYWQtbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7Cn0Kd2luZG93Lm9wZW5VcGxvYWRNb2RhbCA9IG9wZW5VcGxvYWRNb2RhbDsKCmZ1bmN0aW9uIGNsb3NlVXBsb2FkTW9kYWwoKSB7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VwbG9hZC1tb2RhbCcpLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsKICBfdXBsb2FkQjY0ID0gbnVsbDsgX3VwbG9hZE1ldGEgPSBudWxsOwp9CndpbmRvdy5jbG9zZVVwbG9hZE1vZGFsID0gY2xvc2VVcGxvYWRNb2RhbDsKCmZ1bmN0aW9uIG9uVXBsb2FkQ2hhbmdlKGlucHV0KSB7CiAgdmFyIGZpbGUgPSBpbnB1dC5maWxlc1swXTsKICBpZiAoIWZpbGUpIHJldHVybjsKICBpZiAoZmlsZS5zaXplID4gNSoxMDI0KjEwMjQpIHsgc2hvd1RvYXN0KCdGaWNoaWVyIHRyb3AgbG91cmQgKG1heCA1IE1vKScsJ2VycicpOyByZXR1cm47IH0KICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24oZSkgewogICAgX3VwbG9hZEI2NCA9IGUudGFyZ2V0LnJlc3VsdDsKICAgIF91cGxvYWRNZXRhID0geyBuYW1lOiBmaWxlLm5hbWUsIHNpemU6IGZpbGUuc2l6ZSwgdHlwZTogZmlsZS50eXBlIH07CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXBsb2FkLXByZXZpZXctbmFtZScpLnRleHRDb250ZW50ID0gZmlsZS5uYW1lOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VwbG9hZC1wcmV2aWV3LXNpemUnKS50ZXh0Q29udGVudCA9IChmaWxlLnNpemUvMTAyNCkudG9GaXhlZCgwKSsnS28nOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VwbG9hZC1wcmV2aWV3Jykuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1cGxvYWQtc3VibWl0LWJ0bicpLmRpc2FibGVkID0gZmFsc2U7CiAgfTsKICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKfQp3aW5kb3cub25VcGxvYWRDaGFuZ2UgPSBvblVwbG9hZENoYW5nZTsKCmZ1bmN0aW9uIGNsZWFyVXBsb2FkKCkgewogIF91cGxvYWRCNjQgPSBudWxsOyBfdXBsb2FkTWV0YSA9IG51bGw7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VwbG9hZC1pbnB1dCcpLnZhbHVlID0gJyc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VwbG9hZC1wcmV2aWV3Jykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXBsb2FkLXN1Ym1pdC1idG4nKS5kaXNhYmxlZCA9IHRydWU7Cn0Kd2luZG93LmNsZWFyVXBsb2FkID0gY2xlYXJVcGxvYWQ7Cgphc3luYyBmdW5jdGlvbiBzdWJtaXRVcGxvYWQoKSB7CiAgaWYoIV91cGxvYWRCNjQgfHwgIV91cGxvYWREb2NJZCkgcmV0dXJuOwogIHZhciBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXBsb2FkLXN1Ym1pdC1idG4nKTsKICBidG4uZGlzYWJsZWQgPSB0cnVlOyBidG4udGV4dENvbnRlbnQgPSAnXHUyM2YzIEVudm9pLi4uJzsKICB0cnkgewogICAgdmFyIGRvY0RhdGEgPSB7CiAgICAgIG5hbWU6IF91cGxvYWRNZXRhLm5hbWUsCiAgICAgIHNpemU6IF91cGxvYWRNZXRhLnNpemUsCiAgICAgIHR5cGU6IF91cGxvYWRNZXRhLnR5cGUsCiAgICAgIGRhdGE6IF91cGxvYWRCNjQsCiAgICAgIHVwbG9hZGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKQogICAgfTsKICAgIF9kb2NzRW1wbG95ZWVbX3VwbG9hZERvY0lkXSA9IGRvY0RhdGE7CiAgICAvLyBTYXV2ZWdhcmRlciBkYW5zIEZpcmVzdG9yZSAoc3VyIGxhIGZpY2hlIGVtcGxvecOpIHByaXbDqWUpCiAgICB2YXIgZG9jc1VwZGF0ZSA9IHt9OwogICAgZG9jc1VwZGF0ZVsnZG9jdW1lbnRzRW1wbG95ZWUnXSA9IF9kb2NzRW1wbG95ZWU7CiAgICBhd2FpdCB3aW5kb3cuX3NldERvY1BhdGgoWydyaCcsIF91aWQsICdlbXBsb3llcycsIF9lbXBJZF0sIGRvY3NVcGRhdGUsIHttZXJnZTp0cnVlfSk7CiAgICBjbG9zZVVwbG9hZE1vZGFsKCk7CiAgICByZW5kZXJEb2N1bWVudHMoKTsKICAgIHNob3dUb2FzdCgnXHUyNzA1IERvY3VtZW50IGRcdTAwZTlwb3NcdTAwZTkgYXZlYyBzdWNjXHUwMGU4cycsJ29rJyk7CiAgfSBjYXRjaChlKSB7CiAgICBjb25zb2xlLmVycm9yKGUpOwogICAgc2hvd1RvYXN0KCdFcnJldXIgOiAnK2UubWVzc2FnZSwnZXJyJyk7CiAgICBidG4uZGlzYWJsZWQgPSBmYWxzZTsgYnRuLnRleHRDb250ZW50ID0gJ1x1ZDgzZFx1ZGNlNCBFbnZveWVyJzsKICB9Cn0Kd2luZG93LnN1Ym1pdFVwbG9hZCA9IHN1Ym1pdFVwbG9hZDsKCmZ1bmN0aW9uIHZpZXdEb2NJZHgoYnRuKSB7CiAgdmFyIGlkeCA9IHBhcnNlSW50KGJ0bi5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWR4JykpOwogIHZhciBkb2NEZWYgPSBET0NTX1JFUVVJUkVEW2lkeF0gfHwge307CiAgdmlld0RvYyhkb2NEZWYuaWQpOwp9CndpbmRvdy52aWV3RG9jSWR4ID0gdmlld0RvY0lkeDsKCmZ1bmN0aW9uIHZpZXdEb2MoZG9jSWQpIHsKICB2YXIgZG9jID0gX2RvY3NFbXBsb3llZVtkb2NJZF07CiAgaWYoIWRvYyB8fCAhZG9jLmRhdGEpIHsgc2hvd1RvYXN0KCdEb2N1bWVudCBub24gZGlzcG9uaWJsZScsJ2VycicpOyByZXR1cm47IH0KICB2YXIgd2luID0gd2luZG93Lm9wZW4oJycsJ19ibGFuaycpOwogIGlmKGRvYy50eXBlICYmIGRvYy50eXBlLnN0YXJ0c1dpdGgoJ2ltYWdlLycpKXsKICAgIHdpbi5kb2N1bWVudC53cml0ZSgnPGh0bWw+PGJvZHkgc3R5bGU9Im1hcmdpbjowO2JhY2tncm91bmQ6IzExMSI+PGltZyBzcmM9IicrZG9jLmRhdGErJyIgc3R5bGU9Im1heC13aWR0aDoxMDAlO2Rpc3BsYXk6YmxvY2s7bWFyZ2luOmF1dG8iLz48L2JvZHk+PC9odG1sPicpOwogIH0gZWxzZSB7CiAgICB3aW4ubG9jYXRpb24uaHJlZiA9IGRvYy5kYXRhOwogIH0KfQp3aW5kb3cudmlld0RvYyA9IHZpZXdEb2M7CgpmdW5jdGlvbiB2aWV3RW1wbG95ZXJEb2MoaSkgewogIHZhciBkb2MgPSBfZG9jc0VtcGxveWVyW2ldOwogIGlmKCFkb2MgfHwgIWRvYy5kYXRhKSB7IHNob3dUb2FzdCgnRG9jdW1lbnQgbm9uIGRpc3BvbmlibGUnLCdlcnInKTsgcmV0dXJuOyB9CiAgdmFyIHdpbiA9IHdpbmRvdy5vcGVuKCcnLCdfYmxhbmsnKTsKICBpZihkb2MudHlwZSAmJiBkb2MudHlwZS5zdGFydHNXaXRoKCdpbWFnZS8nKSl7CiAgICB3aW4uZG9jdW1lbnQud3JpdGUoJzxodG1sPjxib2R5IHN0eWxlPSJtYXJnaW46MDtiYWNrZ3JvdW5kOiMxMTEiPjxpbWcgc3JjPSInK2RvYy5kYXRhKyciIHN0eWxlPSJtYXgtd2lkdGg6MTAwJTtkaXNwbGF5OmJsb2NrO21hcmdpbjphdXRvIi8+PC9ib2R5PjwvaHRtbD4nKTsKICB9IGVsc2UgewogICAgd2luLmxvY2F0aW9uLmhyZWYgPSBkb2MuZGF0YTsKICB9Cn0Kd2luZG93LnZpZXdFbXBsb3llckRvYyA9IHZpZXdFbXBsb3llckRvYzsKCi8qIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAogICBTT0xERVMgRMOJVEFJTEzDiVMgKG9uZ2xldCBjb25nw6lzKQrilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAgKi8KZnVuY3Rpb24gcmVuZGVyU29sZGVzRGV0YWlsKCkgewogIHZhciBzID0gX3NvbGRlczsKICB2YXIgaXRlbXMgPSBbCiAgICB7aWNvbjonXHVkODNjXHVkZmQ2XHVmZTBmJywgbGFiZWw6J0NvbmdcdTAwZTlzIHBheVx1MDBlOXMnLCBhY3F1aXM6cy5jcEFjcXVpcywgcHJpczpzLmNwUHJpcywgcmVzdGFudDpzLmNwUmVzdGFudCwgdW5pdDonaicsIGNvbG9yOid2YXIoLS1nMyknfSwKICAgIHtpY29uOidcdTIzZjAnLCBsYWJlbDonUlRUJywgYWNxdWlzOnMucnR0QmFzZSwgcHJpczpzLnJ0dFByaXMsIHJlc3RhbnQ6cy5ydHRSZXN0YW50LCB1bml0OidqJywgY29sb3I6J3ZhcigtLWJsdWUpJ30sCiAgICB7aWNvbjonXHVkODNkXHVkZDA0JywgbGFiZWw6J1JcdTAwZTljdXBcdTAwZTlyYXRpb24nLCBhY3F1aXM6cy5yZWN1cFJlc3RhbnQsIHByaXM6MCwgcmVzdGFudDpzLnJlY3VwUmVzdGFudCwgdW5pdDonaCcsIGNvbG9yOid2YXIoLS10ZWFsKSd9LAogIF07CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvbGRlcy1kZXRhaWwnKS5pbm5lckhUTUwgPSBpdGVtcy5tYXAoZnVuY3Rpb24oaXQpewogICAgdmFyIHBjdCA9IGl0LmFjcXVpcz4wID8gTWF0aC5taW4oaXQucHJpcy9pdC5hY3F1aXMqMTAwLDEwMCkudG9GaXhlZCgwKSA6IDA7CiAgICByZXR1cm4gJzxkaXYgc3R5bGU9Im1hcmdpbi1ib3R0b206MTJweDtwYWRkaW5nOjEwcHggMTJweDtiYWNrZ3JvdW5kOiNmOWZhZmI7Ym9yZGVyLXJhZGl1czoxMHB4O2JvcmRlcjoxcHggc29saWQgdmFyKC0tYm9yZGVyKSI+JwogICAgICArJzxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjthbGlnbi1pdGVtczpjZW50ZXI7bWFyZ2luLWJvdHRvbTo2cHgiPicKICAgICAgICArJzxzcGFuIHN0eWxlPSJmb250LXNpemU6MTJweDtmb250LXdlaWdodDo3MDAiPicraXQuaWNvbisnICcraXQubGFiZWwrJzwvc3Bhbj4nCiAgICAgICAgKyc8c3BhbiBzdHlsZT0iZm9udC1zaXplOjE2cHg7Zm9udC13ZWlnaHQ6ODAwO2NvbG9yOicraXQuY29sb3IrJyI+JytpdC5yZXN0YW50LnRvRml4ZWQoMSkrJzxzcGFuIHN0eWxlPSJmb250LXNpemU6MTBweDtmb250LXdlaWdodDo2MDAiPiAnK2l0LnVuaXQrJzwvc3Bhbj48L3NwYW4+JwogICAgICArJzwvZGl2PicKICAgICAgKyc8ZGl2IHN0eWxlPSJoZWlnaHQ6NnB4O2JhY2tncm91bmQ6I2U1ZTdlYjtib3JkZXItcmFkaXVzOjk5cHg7b3ZlcmZsb3c6aGlkZGVuO21hcmdpbi1ib3R0b206NXB4Ij4nCiAgICAgICAgKyc8ZGl2IHN0eWxlPSJoZWlnaHQ6MTAwJTt3aWR0aDonK3BjdCsnJTtiYWNrZ3JvdW5kOicraXQuY29sb3IrJztib3JkZXItcmFkaXVzOjk5cHg7dHJhbnNpdGlvbjp3aWR0aCAuNXMgZWFzZSI+PC9kaXY+JwogICAgICArJzwvZGl2PicKICAgICAgKyc8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47Zm9udC1zaXplOjEwcHg7Y29sb3I6dmFyKC0tbXV0ZWQpIj4nCiAgICAgICAgKyc8c3Bhbj4nK2l0LnByaXMudG9GaXhlZCgxKSsnICcraXQudW5pdCsnIHByaXM8L3NwYW4+JwogICAgICAgICsnPHNwYW4+JytpdC5hY3F1aXMudG9GaXhlZCgxKSsnICcraXQudW5pdCsnIGFsbG91XHUwMGU5czwvc3Bhbj4nCiAgICAgICsnPC9kaXY+JwogICAgKyc8L2Rpdj4nOwogIH0pLmpvaW4oJycpOwp9CgovKiDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKICAgVFlQRSBHUklEIChjb25nw6lzKQrilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAgKi8KZnVuY3Rpb24gcmVuZGVyVHlwZUdyaWQoKSB7CiAgdmFyIHR5cGVzID0gWwogICAge2s6J2NwJywgICAgICAgICAgc3ViOiBfc29sZGVzLmNwUmVzdGFudC50b0ZpeGVkKDEpKydqIGRpc3BvbmlibGVzJ30sCiAgICB7azoncnR0JywgICAgICAgICBzdWI6IF9zb2xkZXMucnR0UmVzdGFudC50b0ZpeGVkKDEpKydqIGRpc3BvbmlibGVzJ30sCiAgICB7azoncmVjdXBlcmF0aW9uJyxzdWI6KF9zb2xkZXMucmVjdXBSZXN0YW50fHwwKSsnaCBkaXNwb25pYmxlcyd9LAogICAge2s6J2NzcycsICAgICAgICAgc3ViOidOb24gZFx1MDBlOWNvbXB0XHUwMGU5IGR1IHNvbGRlJ30sCiAgICB7azonZXZlbmVtZW50JywgICBzdWI6J0R1clx1MDBlOWVzIGxcdTAwZTlnYWxlcyd9LAogICAge2s6J21hbGFkaWUnLCAgICAgc3ViOidBcnJcdTAwZWF0IG1cdTAwZTlkaWNhbCd9LAogICAge2s6J2Zvcm1hdGlvbicsICAgc3ViOidGb3JtYXRpb24gcHJvZmVzc2lvbm5lbGxlJ30sCiAgXTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndHlwZS1ncmlkJykuaW5uZXJIVE1MID0gdHlwZXMubWFwKGZ1bmN0aW9uKHQpIHsKICAgIHJldHVybiAnPGJ1dHRvbiBjbGFzcz0idGIgJysoKF9zZWxUeXBlPT09dC5rKT8nc2VsJzonJykrJyIgb25jbGljaz0ic2VsVHlwZShcJycrdC5rKydcJykiPicKICAgICAgKyc8ZGl2IGNsYXNzPSJ0Yi1pY29uIj4nK0lDT05TW3Qua10rJzwvZGl2PicKICAgICAgKyc8c3BhbiBjbGFzcz0idGItbGJsIj4nK0xBQkVMU1t0LmtdKyc8L3NwYW4+JwogICAgICArJzxzcGFuIGNsYXNzPSJ0Yi1zdWIiPicrdC5zdWIrJzwvc3Bhbj4nCiAgICAgICsnPC9idXR0b24+JzsKICB9KS5qb2luKCcnKTsKfQoKZnVuY3Rpb24gc2V0RmlsdGVyKGJ0biwgZikgewogIF9kZW1GaWx0ZXIgPSBmOwogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5mdGFiJykuZm9yRWFjaChmdW5jdGlvbihiKSB7IGIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7IH0pOwogIGJ0bi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICByZW5kZXJEZW1hbmRlcygpOwp9CndpbmRvdy5zZXRGaWx0ZXIgPSBzZXRGaWx0ZXI7CgpmdW5jdGlvbiByZW5kZXJEZW1hbmRlcygpIHsKICB2YXIgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVtLWxpc3QnKTsKICB2YXIgY250ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlbS1jb3VudCcpOwogIHZhciBsaXN0ID0gX2RlbUZpbHRlciA9PT0gJ2FsbCcgPyBfZGVtYW5kZXMgOiBfZGVtYW5kZXMuZmlsdGVyKGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuc3RhdHV0ID09PSBfZGVtRmlsdGVyOyB9KTsKICBjbnQudGV4dENvbnRlbnQgPSBfZGVtYW5kZXMubGVuZ3RoKycgZGVtYW5kZScrKF9kZW1hbmRlcy5sZW5ndGg+MT8ncyc6JycpOwogIGlmICghbGlzdC5sZW5ndGgpIHsgZWwuaW5uZXJIVE1MPSc8ZGl2IGNsYXNzPSJlbXB0eSI+PGRpdiBjbGFzcz0iZW1wdHktaWNvbiI+XHVkODNkXHVkY2NiPC9kaXY+QXVjdW5lIGRlbWFuZGUuPC9kaXY+JzsgcmV0dXJuOyB9CiAgZWwuaW5uZXJIVE1MID0gbGlzdC5tYXAoZnVuY3Rpb24oZCl7IHJldHVybiBkZW1JdGVtSHRtbChkKTsgfSkuam9pbignJyk7Cn0KCmZ1bmN0aW9uIGRlbUl0ZW1IdG1sKGQpIHsKICB2YXIgZGIgPSBkLmRhdGVEZWJ1dCA/IG5ldyBEYXRlKGQuZGF0ZURlYnV0KydUMTI6MDA6MDAnKS50b0xvY2FsZURhdGVTdHJpbmcoJ2ZyLUZSJyx7ZGF5OidudW1lcmljJyxtb250aDonc2hvcnQnLHllYXI6J251bWVyaWMnfSkgOiAnPyc7CiAgdmFyIGRlID0gKGQuZGF0ZUZpbiAmJiBkLmRhdGVGaW4hPT1kLmRhdGVEZWJ1dCkgPyAnIFx1MjE5MiAnK25ldyBEYXRlKGQuZGF0ZUZpbisnVDEyOjAwOjAwJykudG9Mb2NhbGVEYXRlU3RyaW5nKCdmci1GUicse2RheTonbnVtZXJpYycsbW9udGg6J3Nob3J0J30pIDogJyc7CiAgdmFyIGJUeHQgPSB7cGVuZGluZzonXHUyM2YzIEVuIGF0dGVudGUnLGFwcHJvdmVkOidcdTI3MDUgQXBwcm91dlx1MDBlOWUnLHJlZnVzZWQ6J1x1Mjc0YyBSZWZ1c1x1MDBlOWUnLGNhbmNlbGxlZDonXHVkODNkXHVkZWFiIEFubnVsXHUwMGU5ZSd9W2Quc3RhdHV0XSB8fCBkLnN0YXR1dDsKICByZXR1cm4gJzxkaXYgY2xhc3M9ImRlbS1pdGVtIj4nCiAgICArJzxkaXYgY2xhc3M9ImRlbS1pY28iIHN0eWxlPSJiYWNrZ3JvdW5kOicrKENPTE9SU1tkLnR5cGVdfHwnIzZiNzI4MCcpKycyMiI+JysoSUNPTlNbZC50eXBlXXx8J1x1ZDgzZFx1ZGNjYicpKyc8L2Rpdj4nCiAgICArJzxkaXYgY2xhc3M9ImRlbS1ib2R5Ij4nCiAgICAgICsnPGRpdiBjbGFzcz0iZGVtLW5hbWUiPicrKExBQkVMU1tkLnR5cGVdfHxkLnR5cGUpKycgPHN0cm9uZyBzdHlsZT0iY29sb3I6JysoQ09MT1JTW2QudHlwZV18fCd2YXIoLS1nMyknKSsnIj4nKyhkLm5iSm91cnN8fDApKydqPC9zdHJvbmc+PC9kaXY+JwogICAgICArJzxkaXYgY2xhc3M9ImRlbS1kYXRlcyI+JytkYitkZSsnPC9kaXY+JwogICAgICArKGQubW90aWY/JzxkaXYgY2xhc3M9ImRlbS1tb3RpZiI+JytkLm1vdGlmKyc8L2Rpdj4nOicnKQogICAgICArKGQubW90aWZSZWZ1cz8nPGRpdiBjbGFzcz0iZGVtLXJlZnVzIj5Nb3RpZiBkdSByZWZ1cyA6ICcrZC5tb3RpZlJlZnVzKyc8L2Rpdj4nOicnKQogICAgICArJzxzcGFuIGNsYXNzPSJiYWRnZSBiYWRnZS0nKyhkLnN0YXR1dHx8J3BlbmRpbmcnKSsnIj4nK2JUeHQrJzwvc3Bhbj4nCiAgICArJzwvZGl2PicKICArJzwvZGl2Pic7Cn0KCi8qIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAogICBQTEFOTklORyAmIEhPUkFJUkVTCuKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkCAqLwpmdW5jdGlvbiByZW5kZXJDYWwoKSB7CiAgdmFyIHkgPSBfY2FsTW9udGguZ2V0RnVsbFllYXIoKSwgbSA9IF9jYWxNb250aC5nZXRNb250aCgpOwogIHZhciBuYiA9IG5ldyBEYXRlKHksbSsxLDApLmdldERhdGUoKTsKICB2YXIgZmlyc3REb3cgPSAobmV3IERhdGUoeSxtLDEpLmdldERheSgpKzYpJTc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbC10aXRsZScpLnRleHRDb250ZW50ID0gbmV3IERhdGUoeSxtLDEpLnRvTG9jYWxlRGF0ZVN0cmluZygnZnItRlInLHttb250aDonbG9uZycseWVhcjonbnVtZXJpYyd9KTsKICB2YXIgaG9yYWlyZXMgPSAoX3BhcmFtcyAmJiBfcGFyYW1zLmhvcmFpcmVzKSB8fCB7CiAgICBsdW5kaTp7YWN0aWY6dHJ1ZX0sbWFyZGk6e2FjdGlmOnRydWV9LG1lcmNyZWRpOnthY3RpZjp0cnVlfSwKICAgIGpldWRpOnthY3RpZjp0cnVlfSx2ZW5kcmVkaTp7YWN0aWY6dHJ1ZX0sc2FtZWRpOnthY3RpZjpmYWxzZX0sZGltYW5jaGU6e2FjdGlmOmZhbHNlfQogIH07CiAgdmFyIGFic01hcCA9IHt9OwogIF9kZW1hbmRlcy5maWx0ZXIoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5zdGF0dXQ9PT0nYXBwcm92ZWQnfHxkLnN0YXR1dD09PSdwZW5kaW5nJzsgfSkuZm9yRWFjaChmdW5jdGlvbihkKSB7CiAgICBpZiAoIWQuZGF0ZURlYnV0KSByZXR1cm47CiAgICB2YXIgY3VyID0gbmV3IERhdGUoZC5kYXRlRGVidXQrJ1QxMjowMDowMCcpOwogICAgdmFyIGZpbiA9IG5ldyBEYXRlKChkLmRhdGVGaW58fGQuZGF0ZURlYnV0KSsnVDEyOjAwOjAwJyk7CiAgICB3aGlsZSAoY3VyIDw9IGZpbikgewogICAgICBpZiAoY3VyLmdldEZ1bGxZZWFyKCk9PT15ICYmIGN1ci5nZXRNb250aCgpPT09bSkKICAgICAgICBhYnNNYXBbY3VyLmdldERhdGUoKV0gPSB7dHlwZTpkLnR5cGUsIHBlbmRpbmc6ZC5zdGF0dXQ9PT0ncGVuZGluZyd9OwogICAgICBjdXIuc2V0RGF0ZShjdXIuZ2V0RGF0ZSgpKzEpOwogICAgfQogIH0pOwogIHZhciB0b2RheSA9IG5ldyBEYXRlKCk7CiAgdmFyIGhkcnMgPSBbJ0wnLCdNJywnTScsJ0onLCdWJywnUycsJ0QnXTsKICB2YXIgY2FsSHRtbCA9ICcnOwogIGhkcnMuZm9yRWFjaChmdW5jdGlvbihoKSB7IGNhbEh0bWwgKz0gJzxkaXYgY2xhc3M9ImNhbC1oZHIiPicraCsnPC9kaXY+JzsgfSk7CiAgZm9yICh2YXIgaT0wOyBpPGZpcnN0RG93OyBpKyspIGNhbEh0bWwgKz0gJzxkaXY+PC9kaXY+JzsKICB2YXIgdXNlZFR5cGVzID0ge307CiAgZm9yICh2YXIgZD0xOyBkPD1uYjsgZCsrKSB7CiAgICB2YXIgZG93ID0gKGZpcnN0RG93K2QtMSklNzsKICAgIHZhciBqb3VyS2V5ID0gRE9XX0tFWVtkb3ddOwogICAgdmFyIGRhdGVTdHIgPSB5KyctJytTdHJpbmcobSsxKS5wYWRTdGFydCgyLCcwJykrJy0nK1N0cmluZyhkKS5wYWRTdGFydCgyLCcwJyk7CiAgICB2YXIgaXRlbXMgPSBfcGxhbm5pbmdDYWNoZVtkYXRlU3RyXSB8fCBudWxsOwogICAgdmFyIGhhc1BsYW4gPSBpdGVtcyAmJiBpdGVtcy5sZW5ndGggPiAwOwogICAgdmFyIGFicyA9IGFic01hcFtkXTsKICAgIHZhciBpc1RvZGF5ID0gZD09PXRvZGF5LmdldERhdGUoKSAmJiBtPT09dG9kYXkuZ2V0TW9udGgoKSAmJiB5PT09dG9kYXkuZ2V0RnVsbFllYXIoKTsKICAgIHZhciBiZz0nJywgY29sPScnLCB0dGw9JycsIGNscz0nY2FsLWRheScsIGV4dHJhPScnOwogICAgaWYgKGlzVG9kYXkpIGNscyArPSAnIHRvZGF5JzsKICAgIGlmIChhYnMpIHsKICAgICAgYmcgPSBhYnMucGVuZGluZyA/IChDT0xPUlNbYWJzLnR5cGVdKydjYycpIDogQ09MT1JTW2Ficy50eXBlXTsKICAgICAgY29sID0gJ3doaXRlJzsKICAgICAgdHRsID0gTEFCRUxTW2Ficy50eXBlXSsoYWJzLnBlbmRpbmc/JyAoZW4gYXR0ZW50ZSknOicnKTsKICAgICAgY2xzICs9ICcgYWJzJysoYWJzLnBlbmRpbmc/JyBhYnMtcGVuZGluZyc6JycpOwogICAgICB1c2VkVHlwZXNbYWJzLnR5cGVdID0gdHJ1ZTsKICAgICAgaWYgKGhhc1BsYW4pIGV4dHJhID0gJzxkaXYgc3R5bGU9ImZvbnQtc2l6ZTo3cHg7b3BhY2l0eTowLjc7bGluZS1oZWlnaHQ6MTttYXJnaW4tdG9wOjJweCI+JytnZXRQbGFnZXNTdHIoaXRlbXNbMF0pKyc8L2Rpdj4nOwogICAgfSBlbHNlIGlmIChoYXNQbGFuKSB7CiAgICAgIHZhciB0b3RhbEggPSBpdGVtcy5yZWR1Y2UoZnVuY3Rpb24ocyxpdCkgeyByZXR1cm4gcyArIGl0ZW1IKGl0KTsgfSwgMCk7CiAgICAgIGJnID0gJ3JnYmEoNSwxNTAsMTA1LDAuMTIpJzsgY29sID0gJyMwNDc4NTcnOyBjbHMgKz0gJyB3b3JrJzsKICAgICAgdHRsID0gZ2V0UGxhZ2VzU3RyKGl0ZW1zWzBdKSArICcgKCcgKyB0b3RhbEgudG9GaXhlZCgxKSArICdoKSc7CiAgICAgIGV4dHJhID0gJzxkaXYgc3R5bGU9ImZvbnQtc2l6ZTo3LjVweDtmb250LXdlaWdodDo3MDA7bGluZS1oZWlnaHQ6MS4yO21hcmdpbi10b3A6MnB4O29wYWNpdHk6MC44NSI+JytnZXRQbGFnZXNTdHIoaXRlbXNbMF0pKyc8L2Rpdj4nOwogICAgICB1c2VkVHlwZXNbJ19fdHJhdmFpbCddID0gdHJ1ZTsKICAgIH0gZWxzZSBpZiAoaG9yYWlyZXNbam91cktleV0gJiYgaG9yYWlyZXNbam91cktleV0uYWN0aWYpIHsKICAgICAgYmcgPSAncmdiYSg1LDE1MCwxMDUsMC4wNiknOyBjb2wgPSAnIzZlZTdiNyc7IGNscyArPSAnIHdvcmsgd29yay1nZW5lcmljJzsKICAgICAgdmFyIGggPSBob3JhaXJlc1tqb3VyS2V5XTsKICAgICAgdHRsID0gJ0hvcmFpcmUgaGFiaXR1ZWwnKyhoLmRlYiYmaC5maW4/JyBcdTAwYjcgJytoLmRlYisnIFx1MjAxMyAnK2guZmluOicnKTsKICAgIH0gZWxzZSB7CiAgICAgIGJnID0gJ3RyYW5zcGFyZW50JzsgY29sID0gJyNkMWQ1ZGInOyBjbHMgKz0gJyBvZmYnOwogICAgfQogICAgdmFyIHN0eWxlID0gJ2JhY2tncm91bmQ6JytiZysnO2NvbG9yOicrY29sKyc7JzsKICAgIGlmIChpc1RvZGF5KSBzdHlsZSArPSAnb3V0bGluZToycHggc29saWQgIzA1OTY2OTtvdXRsaW5lLW9mZnNldDotMnB4Oyc7CiAgICBjYWxIdG1sICs9ICc8ZGl2IGNsYXNzPSInK2NscysnIiBzdHlsZT0iJytzdHlsZSsnIiB0aXRsZT0iJyt0dGwrJyI+JytkK2V4dHJhKyc8L2Rpdj4nOwogIH0KICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FsLWdyaWQnKS5pbm5lckhUTUwgPSBjYWxIdG1sOwogIHZhciBsZWdIdG1sID0gJyc7CiAgaWYgKE9iamVjdC5rZXlzKF9wbGFubmluZ0NhY2hlKS5sZW5ndGggPiAwKQogICAgbGVnSHRtbCArPSAnPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6NXB4O2ZvbnQtc2l6ZToxMHB4O2NvbG9yOnZhcigtLW11dGVkKSI+PGRpdiBzdHlsZT0id2lkdGg6OXB4O2hlaWdodDo5cHg7Ym9yZGVyLXJhZGl1czoycHg7YmFja2dyb3VuZDpyZ2JhKDUsMTUwLDEwNSwwLjQpIj48L2Rpdj5QbGFuaWZpXHUwMGU5PC9kaXY+JzsKICBlbHNlCiAgICBsZWdIdG1sICs9ICc8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDo1cHg7Zm9udC1zaXplOjEwcHg7Y29sb3I6dmFyKC0tbXV0ZWQpIj48ZGl2IHN0eWxlPSJ3aWR0aDo5cHg7aGVpZ2h0OjlweDtib3JkZXItcmFkaXVzOjJweDtiYWNrZ3JvdW5kOnJnYmEoNSwxNTAsMTA1LDAuMTUpIj48L2Rpdj5Ib3JhaXJlIGhhYml0dWVsPC9kaXY+JzsKICBsZWdIdG1sICs9IE9iamVjdC5rZXlzKHVzZWRUeXBlcykuZmlsdGVyKGZ1bmN0aW9uKHQpeyByZXR1cm4gdCE9PSdfX3RyYXZhaWwnOyB9KS5tYXAoZnVuY3Rpb24odCkgewogICAgcmV0dXJuICc8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDo1cHg7Zm9udC1zaXplOjEwcHg7Y29sb3I6dmFyKC0tbXV0ZWQpIj48ZGl2IHN0eWxlPSJ3aWR0aDo5cHg7aGVpZ2h0OjlweDtib3JkZXItcmFkaXVzOjJweDtiYWNrZ3JvdW5kOicrKENPTE9SU1t0XXx8JyM2YjcyODAnKSsnIj48L2Rpdj4nKyhMQUJFTFNbdF18fHQpKyc8L2Rpdj4nOwogIH0pLmpvaW4oJycpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYWwtbGVnZW5kJykuaW5uZXJIVE1MID0gbGVnSHRtbDsKfQoKZnVuY3Rpb24gcmVuZGVySG9yYWlyZXMoKSB7CiAgdmFyIGhvcmFpcmVzID0gKF9wYXJhbXMgJiYgX3BhcmFtcy5ob3JhaXJlcykgfHwge307CiAgdmFyIGpvdXJzQWN0aWZzID0gRE9XX0tFWS5maWx0ZXIoZnVuY3Rpb24oail7IHJldHVybiBob3JhaXJlc1tqXSAmJiBob3JhaXJlc1tqXS5hY3RpZjsgfSk7CiAgdmFyIGNhcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaG9yYWlyZXMtY2FyZCcpOwogIGlmKCFqb3Vyc0FjdGlmcy5sZW5ndGgpeyBjYXJkLnN0eWxlLmRpc3BsYXk9J25vbmUnOyByZXR1cm47IH0KICBjYXJkLnN0eWxlLmRpc3BsYXk9Jyc7CiAgdmFyIGpMYWJlbHMgPSB7bHVuZGk6J0x1bmRpJyxtYXJkaTonTWFyZGknLG1lcmNyZWRpOidNZXJjcmVkaScsamV1ZGk6J0pldWRpJyx2ZW5kcmVkaTonVmVuZHJlZGknLHNhbWVkaTonU2FtZWRpJyxkaW1hbmNoZTonRGltYW5jaGUnfTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaG9yYWlyZXMtYm9keScpLmlubmVySFRNTCA9IGpvdXJzQWN0aWZzLm1hcChmdW5jdGlvbihqKXsKICAgIHZhciBoID0gaG9yYWlyZXNbal07CiAgICByZXR1cm4gJzxkaXYgY2xhc3M9ImluZm8tbGluZSI+JwogICAgICArJzxzcGFuIGNsYXNzPSJpbmZvLWxpbmUtaWNvbiI+XHVkODNkXHVkY2M2PC9zcGFuPicKICAgICAgKyc8c3BhbiBjbGFzcz0iaW5mby1saW5lLWxhYmVsIj4nK2pMYWJlbHNbal0rJzwvc3Bhbj4nCiAgICAgICsnPHNwYW4gY2xhc3M9ImluZm8tbGluZS12YWwiIHN0eWxlPSJmb250LXNpemU6MTJweCI+JysoaC5kZWImJmguZmluP2guZGViKycgXHUyMDEzICcraC5maW46J0FjdGlmJykrJzwvc3Bhbj4nCiAgICArJzwvZGl2Pic7CiAgfSkuam9pbignJyk7Cn0KCi8qIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAogICBGT1JNVUxBSVJFIENPTkfDiVMK4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQICovCnZhciBfY3VyU3RlcCA9IDE7CnZhciBfanVzdGlmQjY0ID0gbnVsbDsKdmFyIF9qdXN0aWZNZXRhID0gbnVsbDsKCmZ1bmN0aW9uIG9uSnVzdGlmQ2hhbmdlKGlucHV0KSB7CiAgdmFyIGZpbGUgPSBpbnB1dC5maWxlc1swXTsKICBpZiAoIWZpbGUpIHJldHVybjsKICBpZiAoZmlsZS5zaXplID4gNSoxMDI0KjEwMjQpIHsgc2hvd1RvYXN0KCdGaWNoaWVyIHRyb3AgbG91cmQgKG1heCA1IE1vKScsJ2VycicpOyByZXR1cm47IH0KICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24oZSkgewogICAgX2p1c3RpZkI2NCA9IGUudGFyZ2V0LnJlc3VsdDsKICAgIF9qdXN0aWZNZXRhID0geyBuYW1lOiBmaWxlLm5hbWUsIHNpemU6IGZpbGUuc2l6ZSwgdHlwZTogZmlsZS50eXBlIH07CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanVzdGlmLW5hbWUnKS50ZXh0Q29udGVudCA9IGZpbGUubmFtZTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqdXN0aWYtc2l6ZScpLnRleHRDb250ZW50ID0gKGZpbGUuc2l6ZS8xMDI0KS50b0ZpeGVkKDApKydLbyc7CiAgICB2YXIgcHJldiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqdXN0aWYtcHJldmlldycpOwogICAgcHJldi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2p1c3RpZi1kcm9wJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICB9OwogIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwp9CndpbmRvdy5vbkp1c3RpZkNoYW5nZSA9IG9uSnVzdGlmQ2hhbmdlOwoKZnVuY3Rpb24gY2xlYXJKdXN0aWYoZSkgewogIGlmIChlKSBlLnN0b3BQcm9wYWdhdGlvbigpOwogIF9qdXN0aWZCNjQgPSBudWxsOyBfanVzdGlmTWV0YSA9IG51bGw7CiAgdmFyIGlucCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqdXN0aWYtaW5wdXQnKTsKICBpZiAoaW5wKSBpbnAudmFsdWUgPSAnJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanVzdGlmLXByZXZpZXcnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqdXN0aWYtZHJvcCcpLnN0eWxlLmRpc3BsYXkgPSAnJzsKfQp3aW5kb3cuY2xlYXJKdXN0aWYgPSBjbGVhckp1c3RpZjsKCmZ1bmN0aW9uIHNlbFR5cGUoaykgewogIF9zZWxUeXBlID0gazsKICByZW5kZXJUeXBlR3JpZCgpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXh0MScpLmRpc2FibGVkID0gZmFsc2U7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V2ZW5lbWVudC1sb2knKS5jbGFzc05hbWUgPSAnYWxlcnQgYWxlcnQtYmx1ZScrKGs9PT0nZXZlbmVtZW50Jz8nIHNob3cnOicnKTsKICB2YXIgancgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanVzdGlmLXdyYXAnKTsKICBpZiAoancpIGp3LnN0eWxlLmRpc3BsYXkgPSAoaz09PSdtYWxhZGllJyB8fCBrPT09J2Zvcm1hdGlvbicpID8gJycgOiAnbm9uZSc7CiAgY2xlYXJKdXN0aWYoKTsKfQp3aW5kb3cuc2VsVHlwZSA9IHNlbFR5cGU7CgpmdW5jdGlvbiBnb1N0ZXAobikgewogIGlmIChuPT09MiAmJiAhX3NlbFR5cGUpIHJldHVybjsKICBpZiAobj09PTMpIHsKICAgIHZhciBkZWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZi1kZWInKS52YWx1ZTsKICAgIGlmICghZGViKSB7IHNob3dUb2FzdCgnU1x1MDBlOWxlY3Rpb25uZXogdW5lIGRhdGUgZGUgZFx1MDBlOWJ1dCcsJ2VycicpOyByZXR1cm47IH0KICAgIGJ1aWxkUmVjYXAoKTsKICB9CiAgX2N1clN0ZXAgPSBuOwogIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5mb3JtLXN0ZXAnKS5mb3JFYWNoKGZ1bmN0aW9uKGUpIHsgZS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsgfSk7CiAgdmFyIHN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0JytuKTsKICBpZiAoc3QpIHN0LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogIGZvciAodmFyIGk9MTsgaTw9MzsgaSsrKSB7CiAgICB2YXIgZGQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncycraSk7CiAgICB2YXIgbGwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2wnK2kpOwogICAgaWYgKGRkKSBkZC5jbGFzc05hbWUgPSAnc3RlcC1kb3QnKyhpPG4/JyBkb25lJzppPT09bj8nIGFjdGl2ZSc6JycpOwogICAgaWYgKGxsICYmIGk8MykgbGwuY2xhc3NOYW1lID0gJ3N0ZXAtbGluZScrKGk8bj8nIGRvbmUnOicnKTsKICB9CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0ZXAtbGJsJykudGV4dENvbnRlbnQgPSAnXHUwMGM5dGFwZSAnK24rJyAvIDMnOwp9CndpbmRvdy5nb1N0ZXAgPSBnb1N0ZXA7CgpmdW5jdGlvbiBqb3Vyc091dnJlcyhkZWIsIGZpbikgewogIGlmICghZGViIHx8ICFmaW4pIHJldHVybiAwOwogIHZhciBkID0gbmV3IERhdGUoZGViKydUMTI6MDA6MDAnKSwgZiA9IG5ldyBEYXRlKGZpbisnVDEyOjAwOjAwJyksIGMgPSAwOwogIHdoaWxlIChkIDw9IGYpIHsgdmFyIGR3ID0gZC5nZXREYXkoKTsgaWYgKGR3IT09MCAmJiBkdyE9PTYpIGMrKzsgZC5zZXREYXRlKGQuZ2V0RGF0ZSgpKzEpOyB9CiAgcmV0dXJuIGM7Cn0KCmZ1bmN0aW9uIG9uRGF0ZUNoZygpIHsKICB2YXIgZGViID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2YtZGViJykudmFsdWU7CiAgdmFyIGZpbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmLWZpbicpLnZhbHVlOwogIGlmIChmaW4gJiYgZmluIDwgZGViKSB7IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmLWZpbicpLnZhbHVlID0gZGViOyBmaW4gPSBkZWI7IH0KICB2YXIgamEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnam91cnMtYWxlcnQnKTsKICB2YXIgc2EgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc29sZGUtYWxlcnQnKTsKICBpZiAoIWRlYikgeyBqYS5jbGFzc05hbWU9J2FsZXJ0IGFsZXJ0LWdyZWVuJzsgc2EuY2xhc3NOYW1lPSdhbGVydCBhbGVydC1vcmFuZ2UnOyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmV4dDInKS5kaXNhYmxlZD10cnVlOyByZXR1cm47IH0KICB2YXIgam91cnMgPSBqb3Vyc091dnJlcyhkZWIsIGZpbnx8ZGViKTsKICBqYS50ZXh0Q29udGVudCA9ICdcdWQ4M2RcdWRjYzUgJytqb3VycysnIGpvdXInKyhqb3Vycz4xPydzJzonJykrJyBvdXZyXHUwMGU5Jysoam91cnM+MT8ncyc6JycpOwogIGphLmNsYXNzTmFtZSA9ICdhbGVydCBhbGVydC1ncmVlbiBzaG93JzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmV4dDInKS5kaXNhYmxlZCA9IGZhbHNlOwogIHZhciBzayA9IFNPTERFX0tbX3NlbFR5cGVdOwogIGlmIChzayAmJiBfc29sZGVzW3NrXSAhPT0gdW5kZWZpbmVkKSB7CiAgICB2YXIgc29sZGUgPSBwYXJzZUZsb2F0KF9zb2xkZXNbc2tdKSB8fCAwOwogICAgaWYgKGpvdXJzID4gc29sZGUpIHsKICAgICAgc2EudGV4dENvbnRlbnQgPSAnXHUyNmEwXHVmZTBmIFNvbGRlIGluc3VmZmlzYW50IDogJytzb2xkZS50b0ZpeGVkKDEpKyhfc2VsVHlwZT09PSdyZWN1cGVyYXRpb24nPydoJzonaicpKycgZGlzcG9uaWJsZXMsICcram91cnMrJ2ogZGVtYW5kXHUwMGU5cyc7CiAgICAgIHNhLmNsYXNzTmFtZSA9ICdhbGVydCBhbGVydC1vcmFuZ2Ugc2hvdyc7CiAgICB9IGVsc2Ugc2EuY2xhc3NOYW1lID0gJ2FsZXJ0IGFsZXJ0LW9yYW5nZSc7CiAgfSBlbHNlIHNhLmNsYXNzTmFtZSA9ICdhbGVydCBhbGVydC1vcmFuZ2UnOwp9CndpbmRvdy5vbkRhdGVDaGcgPSBvbkRhdGVDaGc7CgpmdW5jdGlvbiBidWlsZFJlY2FwKCkgewogIHZhciBkZWIgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZi1kZWInKS52YWx1ZTsKICB2YXIgZmluICAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2YtZmluJykudmFsdWUgfHwgZGViOwogIHZhciBtb3RpZiAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZi1tb3RpZicpLnZhbHVlLnRyaW0oKTsKICB2YXIgam91cnMgID0gam91cnNPdXZyZXMoZGViLCBmaW4pOwogIHZhciBkZWJGbXQgPSBuZXcgRGF0ZShkZWIrJ1QxMjowMDowMCcpLnRvTG9jYWxlRGF0ZVN0cmluZygnZnItRlInLHt3ZWVrZGF5Oidsb25nJyxkYXk6J251bWVyaWMnLG1vbnRoOidsb25nJyx5ZWFyOidudW1lcmljJ30pOwogIHZhciBmaW5GbXQgPSBuZXcgRGF0ZShmaW4rJ1QxMjowMDowMCcpLnRvTG9jYWxlRGF0ZVN0cmluZygnZnItRlInLHt3ZWVrZGF5Oidsb25nJyxkYXk6J251bWVyaWMnLG1vbnRoOidsb25nJ30pOwogIHZhciBzayAgICAgPSBTT0xERV9LW19zZWxUeXBlXTsKICB2YXIgc29sZGUgID0gKHNrICE9PSB1bmRlZmluZWQpID8gKHBhcnNlRmxvYXQoX3NvbGRlc1tza10pfHwwKSA6IG51bGw7CiAgdmFyIGFwcmVzICA9IHNvbGRlICE9PSBudWxsID8gTWF0aC5tYXgoMCwgc29sZGUtam91cnMpIDogbnVsbDsKICB2YXIgcncgICAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlY2FwLXdhcm4nKTsKICBpZiAoc29sZGUgIT09IG51bGwgJiYgam91cnMgPiBzb2xkZSkgewogICAgcncudGV4dENvbnRlbnQgPSAnXHUyNmEwXHVmZTBmIFNvbGRlIGluc3VmZmlzYW50ICgnK3NvbGRlLnRvRml4ZWQoMSkrJ2ogZGlzcG8pLiBWb3RyZSBlbXBsb3lldXIgZW4gc2VyYSBpbmZvcm1cdTAwZTkuJzsKICAgIHJ3LmNsYXNzTmFtZSA9ICdhbGVydCBhbGVydC1vcmFuZ2Ugc2hvdyc7CiAgfSBlbHNlIHJ3LmNsYXNzTmFtZSA9ICdhbGVydCBhbGVydC1vcmFuZ2UnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZWNhcCcpLmlubmVySFRNTCA9CiAgICAnPGRpdiBjbGFzcz0icmVzdW1lLXJvdyI+PHNwYW4+VHlwZTwvc3Bhbj48c3Bhbj4nK0lDT05TW19zZWxUeXBlXSsnICcrTEFCRUxTW19zZWxUeXBlXSsnPC9zcGFuPjwvZGl2PicKICAgICsnPGRpdiBjbGFzcz0icmVzdW1lLXJvdyI+PHNwYW4+RHU8L3NwYW4+PHNwYW4+JytkZWJGbXQrJzwvc3Bhbj48L2Rpdj4nCiAgICArJzxkaXYgY2xhc3M9InJlc3VtZS1yb3ciPjxzcGFuPkF1PC9zcGFuPjxzcGFuPicrZmluRm10Kyc8L3NwYW4+PC9kaXY+JwogICAgKyhtb3RpZj8nPGRpdiBjbGFzcz0icmVzdW1lLXJvdyI+PHNwYW4+TW90aWY8L3NwYW4+PHNwYW4+Jyttb3RpZisnPC9zcGFuPjwvZGl2Pic6JycpCiAgICArJzxkaXYgY2xhc3M9InJlc3VtZS1yb3ciPjxzcGFuPlRvdGFsPC9zcGFuPjxzcGFuIHN0eWxlPSJjb2xvcjp2YXIoLS1nMykiPicram91cnMrJyBqb3VyJysoam91cnM+MT8ncyc6JycpKycgb3V2clx1MDBlOScrKGpvdXJzPjE/J3MnOicnKSsnPC9zcGFuPjwvZGl2PicKICAgICsoYXByZXMhPT1udWxsPyc8ZGl2IGNsYXNzPSJyZXN1bWUtcm93Ij48c3Bhbj5Tb2xkZSBhcHJcdTAwZThzPC9zcGFuPjxzcGFuIHN0eWxlPSJjb2xvcjonKyhhcHJlcz41Pyd2YXIoLS1nMyknOid2YXIoLS1vcmFuZ2UpJykrJyI+JythcHJlcy50b0ZpeGVkKDEpKydqPC9zcGFuPjwvZGl2Pic6JycpCiAgICArKF9qdXN0aWZCNjQ/JzxkaXYgY2xhc3M9InJlc3VtZS1yb3ciPjxzcGFuPkp1c3RpZmljYXRpZjwvc3Bhbj48c3BhbiBzdHlsZT0iY29sb3I6dmFyKC0tZzMpIj5cdWQ4M2RcdWRjY2UgJysoX2p1c3RpZk1ldGE/X2p1c3RpZk1ldGEubmFtZTonRmljaGllciBqb2ludCcpKyc8L3NwYW4+PC9kaXY+JzonJyk7Cn0KCmFzeW5jIGZ1bmN0aW9uIHN1Ym1pdERlbWFuZGUoKSB7CiAgdmFyIGRlYiAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2YtZGViJykudmFsdWU7CiAgdmFyIGZpbiAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2YtZmluJykudmFsdWUgfHwgZGViOwogIHZhciBtb3RpZiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmLW1vdGlmJykudmFsdWUudHJpbSgpOwogIHZhciBqb3VycyA9IGpvdXJzT3V2cmVzKGRlYiwgZmluKTsKICB2YXIgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bi1zdWJtaXQnKTsKICBidG4uZGlzYWJsZWQgPSB0cnVlOyBidG4udGV4dENvbnRlbnQgPSAnRW52b2lcdTIwMjYnOwogIHZhciBkZW1hbmRlRGF0YSA9IHsKICAgIGVtcElkOl9lbXBJZCwgdWlkOl91aWQsIHR5cGU6X3NlbFR5cGUsIGRhdGVEZWJ1dDpkZWIsIGRhdGVGaW46ZmluLCBuYkpvdXJzOmpvdXJzLAogICAgc3RhdHV0OidwZW5kaW5nJywgbW90aWY6bW90aWZ8fG51bGwsCiAgICBjcmVhdGVkQXQ6bmV3IERhdGUoKS50b0lTT1N0cmluZygpLCBzb3VyY2U6J3NhbGFyaWUnLAogIH07CiAgaWYgKF9qdXN0aWZCNjQgJiYgX2p1c3RpZk1ldGEpIHsKICAgIGRlbWFuZGVEYXRhLmp1c3RpZmljYXRpZiA9IHsgZGF0YTpfanVzdGlmQjY0LCBuYW1lOl9qdXN0aWZNZXRhLm5hbWUsIHNpemU6X2p1c3RpZk1ldGEuc2l6ZSwgdHlwZTpfanVzdGlmTWV0YS50eXBlIH07CiAgfQogIHRyeSB7CiAgICBhd2FpdCB3aW5kb3cuX2FkZERvYyhbJ3JoX2NvbmdlcycsIF91aWQsICdkZW1hbmRlcyddLCBkZW1hbmRlRGF0YSk7CiAgICBfZGVtYW5kZXMudW5zaGlmdCh7aWQ6J3RtcF8nK0RhdGUubm93KCksZW1wSWQ6X2VtcElkLHR5cGU6X3NlbFR5cGUsZGF0ZURlYnV0OmRlYixkYXRlRmluOmZpbixuYkpvdXJzOmpvdXJzLHN0YXR1dDoncGVuZGluZycsbW90aWY6bW90aWZ8fG51bGwsY3JlYXRlZEF0Om5ldyBEYXRlKCkudG9JU09TdHJpbmcoKX0pOwogICAgY2FsY1NvbGRlcygpOyByZW5kZXJTb2xkZXNGbG90dGFudHMoKTsgcmVuZGVyRGVtYW5kZXMoKTsgcmVuZGVyQ2FsKCk7IHJlbmRlckFjY3VlaWwoKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdDMnKS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgIHZhciBzdyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWNjZXNzLXdyYXAnKTsKICAgIHN3LnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7IHN3LmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWNjZXNzLXN1YicpLnRleHRDb250ZW50ID0gJ1ZvdHJlIGRlbWFuZGUgZGUgJytqb3VycysnaiAoJytMQUJFTFNbX3NlbFR5cGVdKycpIGEgXHUwMGU5dFx1MDBlOSB0cmFuc21pc2UuIFZvdHJlIGVtcGxveWV1ciBsYSB0cmFpdGVyYSBwcm9jaGFpbmVtZW50Lic7CiAgfSBjYXRjaChlKSB7CiAgICBjb25zb2xlLmVycm9yKGUpOyBzaG93VG9hc3QoJ0VycmV1ciA6ICcrZS5tZXNzYWdlLCAnZXJyJyk7CiAgICBidG4uZGlzYWJsZWQgPSBmYWxzZTsgYnRuLnRleHRDb250ZW50ID0gJ1x1MjcwOVx1ZmUwZiBFbnZveWVyIGxhIGRlbWFuZGUnOwogIH0KfQp3aW5kb3cuc3VibWl0RGVtYW5kZSA9IHN1Ym1pdERlbWFuZGU7CgpmdW5jdGlvbiByZXNldEZvcm0oKSB7CiAgX3NlbFR5cGUgPSAnJzsgX2N1clN0ZXAgPSAxOwogIHZhciBzdyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWNjZXNzLXdyYXAnKTsKICBzdy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyBzdy5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2YtZGViJykudmFsdWUgPSAnJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZi1maW4nKS52YWx1ZSA9ICcnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmLW1vdGlmJykudmFsdWUgPSAnJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnam91cnMtYWxlcnQnKS5jbGFzc05hbWUgPSAnYWxlcnQgYWxlcnQtZ3JlZW4nOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb2xkZS1hbGVydCcpLmNsYXNzTmFtZSA9ICdhbGVydCBhbGVydC1vcmFuZ2UnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXh0MScpLmRpc2FibGVkID0gdHJ1ZTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmV4dDInKS5kaXNhYmxlZCA9IHRydWU7CiAgY2xlYXJKdXN0aWYoKTsKICB2YXIgancgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanVzdGlmLXdyYXAnKTsKICBpZiAoancpIGp3LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgZ29TdGVwKDEpOyByZW5kZXJUeXBlR3JpZCgpOwp9CndpbmRvdy5yZXNldEZvcm0gPSByZXNldEZvcm07CgovKiDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKICAgTkFWSUdBVElPTiBPTkdMRVRTCuKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkCAqLwpmdW5jdGlvbiBzaG93VGFiKGlkLCBidG4pIHsKICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudGFiLXNlY3Rpb24nKS5mb3JFYWNoKGZ1bmN0aW9uKHMpeyBzLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOyB9KTsKICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudG5hdicpLmZvckVhY2goZnVuY3Rpb24oYil7IGIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7IH0pOwogIHZhciBzZWMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFiLScraWQpOwogIGlmKHNlYykgc2VjLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogIGlmKGJ0bikgYnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwp9CndpbmRvdy5zaG93VGFiID0gc2hvd1RhYjsKCmZ1bmN0aW9uIGdvVGFiKGJ0bikgewogIHZhciB0YWIgPSBidG4uZ2V0QXR0cmlidXRlKCdkYXRhLXRhYicpOwogIHZhciBlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50bmF2W29uY2xpY2sqPSInICsgdGFiICsgJyJdJyk7CiAgc2hvd1RhYih0YWIsIGVsKTsKfQp3aW5kb3cuZ29UYWIgPSBnb1RhYjsKCgovKiDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKICAgVVRJTFMK4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQICovCmZ1bmN0aW9uIGNoYW5nZVllYXIoKSB7CiAgdmFyIHYgPSBwcm9tcHQoJ0Fublx1MDBlOWUgXHUwMGUwIGFmZmljaGVyIDonLCBfeWVhcik7CiAgdmFyIG4gPSBwYXJzZUludCh2KXx8MDsKICBpZiAobj49MjAyMCAmJiBuPD0yMDMwKSB7CiAgICBfeWVhciA9IG47CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgneWVhci1sYmwnKS50ZXh0Q29udGVudCA9IF95ZWFyOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjY3VlaWwtYW5uZWUtbGJsJykudGV4dENvbnRlbnQgPSAnXHUyMDE0ICcrX3llYXI7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZ2VzLWFubmVlLWxibCcpLnRleHRDb250ZW50ID0gJ1x1MjAxNCAnK195ZWFyOwogICAgY2FsY1NvbGRlcygpOyByZW5kZXJTb2xkZXNGbG90dGFudHMoKTsgcmVuZGVyQWNjdWVpbCgpOyByZW5kZXJTb2xkZXNEZXRhaWwoKTsgcmVuZGVyRGVtYW5kZXMoKTsKICB9Cn0Kd2luZG93LmNoYW5nZVllYXIgPSBjaGFuZ2VZZWFyOwoKZnVuY3Rpb24gcHJldk0oKSB7CiAgX2NhbE1vbnRoLnNldE1vbnRoKF9jYWxNb250aC5nZXRNb250aCgpLTEpOwogIGxvYWRQbGFubmluZ01vbnRoKF9jYWxNb250aC5nZXRGdWxsWWVhcigpLCBfY2FsTW9udGguZ2V0TW9udGgoKSkudGhlbihyZW5kZXJDYWwpOwp9CmZ1bmN0aW9uIG5leHRNKCkgewogIF9jYWxNb250aC5zZXRNb250aChfY2FsTW9udGguZ2V0TW9udGgoKSsxKTsKICBsb2FkUGxhbm5pbmdNb250aChfY2FsTW9udGguZ2V0RnVsbFllYXIoKSwgX2NhbE1vbnRoLmdldE1vbnRoKCkpLnRoZW4ocmVuZGVyQ2FsKTsKfQp3aW5kb3cucHJldk0gPSBwcmV2TTsgd2luZG93Lm5leHRNID0gbmV4dE07CgpmdW5jdGlvbiBmbXREYXRlKHMpIHsKICBpZighcykgcmV0dXJuICdcdTIwMTQnOwogIHRyeSB7IHJldHVybiBuZXcgRGF0ZShzKydUMTI6MDA6MDAnKS50b0xvY2FsZURhdGVTdHJpbmcoJ2ZyLUZSJyx7ZGF5OicyLWRpZ2l0Jyxtb250aDonMi1kaWdpdCcseWVhcjonbnVtZXJpYyd9KTsgfSBjYXRjaChlKXsgcmV0dXJuIHM7IH0KfQoKZnVuY3Rpb24gY2FsY0FuY2llbm5ldGUoZGF0ZVN0cikgewogIGlmKCFkYXRlU3RyKSByZXR1cm4gJyc7CiAgdmFyIGQgPSBuZXcgRGF0ZShkYXRlU3RyKydUMTI6MDA6MDAnKTsKICB2YXIgbm93ID0gbmV3IERhdGUoKTsKICB2YXIgbW9pcyA9IChub3cuZ2V0RnVsbFllYXIoKS1kLmdldEZ1bGxZZWFyKCkpKjEyICsgKG5vdy5nZXRNb250aCgpLWQuZ2V0TW9udGgoKSk7CiAgaWYobW9pczwxKSByZXR1cm4gJ05vdXZlYXUnOwogIGlmKG1vaXM8MTIpIHJldHVybiBtb2lzKycgbW9pcyc7CiAgdmFyIGFucyA9IE1hdGguZmxvb3IobW9pcy8xMik7CiAgdmFyIHJtID0gbW9pcyUxMjsKICByZXR1cm4gYW5zKydhbicrKGFucz4xPydzJzonJykrKHJtPjA/JyAnK3JtKydtJzonJyk7Cn0KCmZ1bmN0aW9uIG1hc2tJYmFuKGliYW4pIHsKICBpZighaWJhbiB8fCBpYmFuLmxlbmd0aDw4KSByZXR1cm4gaWJhbjsKICByZXR1cm4gaWJhbi5zbGljZSgwLDQpICsgJyAqKioqICoqKiogJyArIGliYW4uc2xpY2UoLTQpOwp9CgpmdW5jdGlvbiBjYXBpdGFsaXplKHMpIHsgcmV0dXJuIHMgPyBzLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpK3Muc2xpY2UoMSkgOiBzOyB9CgpmdW5jdGlvbiBnZXRQbGFnZXNTdHIoaXQpIHsKICBpZiAoIWl0KSByZXR1cm4gJyc7CiAgaWYgKGl0LnBsYWdlcyAmJiBpdC5wbGFnZXMubGVuZ3RoID4gMCkgcmV0dXJuIGl0LnBsYWdlcy5tYXAoZnVuY3Rpb24ocCl7IHJldHVybiBwLmRlYisnXHUyMDEzJytwLmZpbjsgfSkuam9pbignIHwgJyk7CiAgcmV0dXJuIChpdC5kZWJ8fCcnKSArIChpdC5maW4gPyAnXHUyMDEzJytpdC5maW4gOiAnJyk7Cn0KCmZ1bmN0aW9uIGl0ZW1IKGl0KSB7CiAgaWYgKGl0LnBsYWdlcyAmJiBpdC5wbGFnZXMubGVuZ3RoID4gMCkgewogICAgcmV0dXJuIGl0LnBsYWdlcy5yZWR1Y2UoZnVuY3Rpb24ocyxwKSB7CiAgICAgIGlmICghcC5kZWJ8fCFwLmZpbikgcmV0dXJuIHM7CiAgICAgIHZhciBhPXAuZGViLnNwbGl0KCc6JykubWFwKE51bWJlciksIGI9cC5maW4uc3BsaXQoJzonKS5tYXAoTnVtYmVyKTsKICAgICAgcmV0dXJuIHMgKyBNYXRoLm1heCgwLCAoKGJbMF0qNjArYlsxXSktKGFbMF0qNjArYVsxXSkpLzYwKTsKICAgIH0sIDApOwogIH0KICBpZiAoIWl0LmRlYnx8IWl0LmZpbikgcmV0dXJuIDA7CiAgdmFyIGE9aXQuZGViLnNwbGl0KCc6JykubWFwKE51bWJlciksIGI9aXQuZmluLnNwbGl0KCc6JykubWFwKE51bWJlcik7CiAgcmV0dXJuIE1hdGgubWF4KDAsICgoYlswXSo2MCtiWzFdKS0oYVswXSo2MCthWzFdKSkvNjApOwp9CgpmdW5jdGlvbiBzaG93Tm90Rm91bmQoKSB7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmctd3JhcCcpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vdC1mb3VuZCcpLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsKfQoKZnVuY3Rpb24gc2hvd1RvYXN0KG1zZywgdHlwZSkgewogIHZhciB0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvYXN0Jyk7CiAgdC50ZXh0Q29udGVudCA9IG1zZzsgdC5jbGFzc05hbWUgPSAndG9hc3Qgc2hvdyAnKyh0eXBlfHwnJyk7CiAgc2V0VGltZW91dChmdW5jdGlvbigpIHsgdC5jbGFzc05hbWU9J3RvYXN0JzsgfSwgMzIwMCk7Cn0=";
var bn=atob(b);
var by=new Uint8Array(bn.length);
for(var i=0;i<bn.length;i++)by[i]=bn.charCodeAt(i);
var js=new TextDecoder('utf-8').decode(by);
var s=document.createElement('script');
s.textContent=js;
document.head.appendChild(s);
})();
</script>
</body>
</html>
