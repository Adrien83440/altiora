<!-- ALTEORE espace-salarie v20260227-enrichi -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover"/>
  <title>Mon espace ‚Äî ALTEORE</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"/>
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    :root{
      --g1:#052e16;--g2:#064e23;--g3:#059669;--g4:#10b981;--g5:#34d399;
      --green-light:#d1fae5;--green-ghost:#f0fdf4;
      --text:#111827;--muted:#6b7280;--border:#e5e7eb;--bg:#f0fdf4;
      --red:#ef4444;--red-bg:#fef2f2;
      --orange:#f59e0b;--orange-bg:#fffbeb;
      --blue:#3b82f6;--blue-bg:#eff6ff;
      --purple:#7c3aed;--purple-bg:#faf5ff;
      --teal:#0891b2;--teal-bg:#ecfeff;
      --pink:#db2777;
      --r:14px;
    }
    html,body{overflow-x:hidden;max-width:100vw;}
    body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;font-size:13px;}

    /* ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ */
    #loading-wrap{position:fixed;inset:0;background:var(--g1);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:18px;z-index:999;transition:opacity .4s;}
    #loading-wrap.fade{opacity:0;pointer-events:none;}
    .load-logo{font-size:26px;font-weight:800;color:white;letter-spacing:1px;opacity:.9;}
    .load-sub{font-size:11px;color:rgba(255,255,255,.35);font-weight:500;}
    @keyframes spin{to{transform:rotate(360deg)}}
    .spin{width:26px;height:26px;border:2.5px solid rgba(255,255,255,.12);border-top-color:#34d399;border-radius:50%;animation:spin .7s linear infinite;}

    /* ‚îÄ‚îÄ NOT FOUND ‚îÄ‚îÄ */
    #not-found{display:none;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;text-align:center;padding:32px;background:var(--g1);}
    #not-found.show{display:flex;}
    .nf-icon{font-size:52px;margin-bottom:14px;}
    .nf-title{font-size:20px;font-weight:800;color:white;margin-bottom:8px;}
    .nf-sub{font-size:12px;color:rgba(255,255,255,.45);max-width:290px;line-height:1.7;}

    /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
    .hero{background:linear-gradient(160deg,var(--g1) 0%,var(--g2) 55%,#0a5c30 100%);padding:22px 18px 88px;position:relative;overflow:hidden;}
    .hero::before{content:'';position:absolute;top:-70px;right:-70px;width:260px;height:260px;background:radial-gradient(circle,rgba(52,211,153,.18) 0%,transparent 70%);border-radius:50%;}
    .hero::after{content:'';position:absolute;bottom:-90px;left:25%;width:320px;height:320px;background:radial-gradient(circle,rgba(5,150,105,.12) 0%,transparent 70%);border-radius:50%;}
    .hero-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:22px;position:relative;z-index:1;}
    .hero-brand{display:flex;align-items:center;gap:8px;}
    .hero-brand-icon{width:28px;height:28px;background:rgba(255,255,255,.15);border:1px solid rgba(255,255,255,.2);border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:12px;}
    .hero-brand-name{font-size:13px;font-weight:800;color:rgba(255,255,255,.9);letter-spacing:.5px;}
    .hero-tag{font-size:10px;font-weight:700;color:rgba(255,255,255,.4);background:rgba(255,255,255,.07);padding:3px 9px;border-radius:20px;border:1px solid rgba(255,255,255,.1);}
    .hero-body{position:relative;z-index:1;display:flex;align-items:flex-end;gap:14px;}
    .hero-avatar{width:52px;height:52px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:800;color:white;border:2px solid rgba(255,255,255,.22);flex-shrink:0;}
    .hero-info{flex:1;min-width:0;}
    .hero-name{font-size:19px;font-weight:800;color:white;margin-bottom:2px;line-height:1.2;}
    .hero-sub{font-size:11.5px;color:rgba(255,255,255,.5);line-height:1.5;}
    .hero-chips{display:flex;gap:5px;margin-top:6px;flex-wrap:wrap;}
    .hero-chip{font-size:9.5px;font-weight:700;color:rgba(255,255,255,.65);background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.15);padding:2px 8px;border-radius:20px;}

    /* ‚îÄ‚îÄ ONGLETS NAVIGATION ‚îÄ‚îÄ */
    .tabs-nav{background:white;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:50;overflow-x:auto;scrollbar-width:none;}
    .tabs-nav::-webkit-scrollbar{display:none;}
    .tabs-inner{display:flex;min-width:max-content;padding:0 14px;}
    .tnav{padding:12px 14px;font-size:12px;font-weight:700;color:var(--muted);border:none;background:none;cursor:pointer;border-bottom:2.5px solid transparent;transition:all .18s;display:flex;align-items:center;gap:5px;white-space:nowrap;font-family:'Plus Jakarta Sans',sans-serif;}
    .tnav:hover{color:var(--g3);}
    .tnav.active{color:var(--g3);border-bottom-color:var(--g3);}
    .tnav .notif{background:var(--red);color:white;border-radius:20px;padding:1px 5px;font-size:9px;font-weight:800;}

    /* ‚îÄ‚îÄ SOLDES FLOTTANTS ‚îÄ‚îÄ */
    .soldes-wrap{padding:0 13px;margin-top:-66px;position:relative;z-index:10;}
    .soldes-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:7px;}
    .sc{background:white;border-radius:11px;padding:12px 11px;box-shadow:0 4px 18px rgba(0,0,0,.1);border:1px solid var(--border);}
    .sc-icon{font-size:18px;margin-bottom:4px;}
    .sc-val{font-size:18px;font-weight:800;line-height:1;color:var(--text);}
    .sc-val.g{color:var(--g3);}.sc-val.o{color:var(--orange);}.sc-val.r{color:var(--red);}.sc-val.b{color:var(--blue);}
    .sc-unit{font-size:9px;font-weight:600;}
    .sc-lbl{font-size:8.5px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-top:3px;}
    .sc-sub{font-size:9px;color:var(--muted);margin-top:2px;line-height:1.3;}
    .sc-bar{height:3px;background:#f3f4f6;border-radius:2px;overflow:hidden;margin-top:6px;}
    .sc-fill{height:100%;border-radius:2px;}

    /* ‚îÄ‚îÄ PAGE TABS ‚îÄ‚îÄ */
    .tab-section{display:none;padding:14px 13px 30px;max-width:640px;margin:0 auto;flex-direction:column;gap:14px;}
    .tab-section.active{display:flex;}

    /* ‚îÄ‚îÄ CARD ‚îÄ‚îÄ */
    .card{background:white;border-radius:var(--r);border:1px solid var(--border);overflow:hidden;box-shadow:0 1px 6px rgba(0,0,0,.04);}
    .card-head{display:flex;align-items:center;justify-content:space-between;padding:12px 15px;border-bottom:1px solid var(--border);}
    .card-title{font-size:13px;font-weight:700;display:flex;align-items:center;gap:6px;}
    .card-body{padding:15px;}

    /* ‚îÄ‚îÄ PROFIL ‚îÄ‚îÄ */
    .profil-section-title{font-size:11px;font-weight:800;color:var(--muted);text-transform:uppercase;letter-spacing:.8px;margin:14px 0 8px;padding-bottom:5px;border-bottom:1px solid var(--border);}
    .profil-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px;}
    .profil-field{display:flex;flex-direction:column;gap:3px;}
    .profil-label{font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;}
    .profil-val{font-size:13px;font-weight:600;color:var(--text);padding:8px 10px;background:#f9fafb;border-radius:8px;border:1.5px solid var(--border);}
    .profil-val.editable{cursor:pointer;transition:all .15s;}
    .profil-val.editable:hover{border-color:var(--g3);background:var(--green-ghost);}
    .profil-input{width:100%;padding:8px 10px;border:1.5px solid var(--g3);border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:600;color:var(--text);outline:none;background:white;box-shadow:0 0 0 3px rgba(5,150,105,.07);}
    .profil-input:focus{box-shadow:0 0 0 3px rgba(5,150,105,.12);}
    .profil-full{grid-column:1/-1;}
    .contrat-card{background:linear-gradient(135deg,var(--g1),var(--g2));border-radius:12px;padding:16px 18px;display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:14px;}
    .contrat-left .contrat-type{font-size:15px;font-weight:800;color:white;margin-bottom:4px;}
    .contrat-left .contrat-sub{font-size:11px;color:rgba(255,255,255,.55);line-height:1.5;}
    .contrat-stat{text-align:right;}
    .contrat-stat .cs-val{font-size:18px;font-weight:800;color:#34d399;}
    .contrat-stat .cs-lbl{font-size:9.5px;color:rgba(255,255,255,.45);text-transform:uppercase;letter-spacing:.5px;}
    .btn-save-profil{width:100%;padding:11px;background:linear-gradient(135deg,var(--g3),var(--g4));color:white;border:none;border-radius:10px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;margin-top:14px;display:none;}
    .btn-save-profil.show{display:block;}
    .btn-save-profil:hover{opacity:.9;}
    .urgence-card{background:var(--orange-bg);border:1.5px solid #fde68a;border-radius:10px;padding:12px 14px;display:flex;align-items:center;gap:10px;}
    .urgence-ico{font-size:22px;flex-shrink:0;}
    .urgence-body{flex:1;min-width:0;}
    .urgence-name{font-size:13px;font-weight:700;margin-bottom:1px;}
    .urgence-lien{font-size:11px;color:var(--muted);}
    .urgence-tel{font-size:12px;font-weight:700;color:var(--orange);margin-top:2px;}

    /* ‚îÄ‚îÄ DOCUMENTS ‚îÄ‚îÄ */
    .doc-section-lbl{font-size:11px;font-weight:800;color:var(--muted);text-transform:uppercase;letter-spacing:.8px;margin:14px 0 8px;padding-bottom:5px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
    .doc-item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;border:1.5px solid var(--border);background:white;margin-bottom:7px;transition:all .15s;cursor:pointer;}
    .doc-item:hover{border-color:#6ee7b7;background:var(--green-ghost);}
    .doc-item.uploaded{border-color:#86efac;background:#f0fdf4;}
    .doc-item.required{border-color:#fca5a5;background:#fff5f5;}
    .doc-item.employer{border-color:#bfdbfe;background:#eff6ff;}
    .doc-ico{width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;}
    .doc-ico.g{background:#dcfce7;}
    .doc-ico.r{background:#fee2e2;}
    .doc-ico.b{background:#dbeafe;}
    .doc-ico.o{background:#fef3c7;}
    .doc-info{flex:1;min-width:0;}
    .doc-name{font-size:12px;font-weight:700;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .doc-meta{font-size:10px;color:var(--muted);margin-top:1px;}
    .doc-action{flex-shrink:0;}
    .btn-upload{padding:5px 11px;background:var(--g3);color:white;border:none;border-radius:7px;font-size:11px;font-weight:700;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;transition:all .15s;}
    .btn-upload:hover{opacity:.85;}
    .btn-view{padding:5px 11px;background:#dbeafe;color:#1e40af;border:none;border-radius:7px;font-size:11px;font-weight:700;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;}
    .badge-req{background:#fee2e2;color:#991b1b;font-size:9px;font-weight:800;padding:2px 6px;border-radius:20px;}
    .badge-ok{background:#dcfce7;color:#166534;font-size:9px;font-weight:800;padding:2px 6px;border-radius:20px;}
    .badge-emp{background:#dbeafe;color:#1e40af;font-size:9px;font-weight:800;padding:2px 6px;border-radius:20px;}
    .doc-progress-bar{height:6px;background:#f3f4f6;border-radius:99px;overflow:hidden;margin:8px 0 2px;}
    .doc-progress-fill{height:100%;background:linear-gradient(90deg,var(--g3),var(--g4));border-radius:99px;transition:width .5s ease;}
    .upload-zone{border:2px dashed var(--border);border-radius:10px;padding:20px 14px;text-align:center;cursor:pointer;background:white;transition:all .15s;margin-top:8px;}
    .upload-zone:hover{border-color:var(--g3);background:var(--green-ghost);}
    .upload-zone-icon{font-size:28px;margin-bottom:6px;}
    .upload-zone-txt{font-size:12px;font-weight:600;color:var(--muted);}
    .upload-zone-sub{font-size:10px;color:var(--muted);margin-top:2px;}

    /* ‚îÄ‚îÄ CONG√âS ‚îÄ‚îÄ */
    .stepper{display:flex;align-items:center;gap:0;margin-bottom:18px;}
    .step-dot{width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:800;border:2px solid var(--border);background:white;color:var(--muted);transition:all .3s;flex-shrink:0;}
    .step-dot.done{background:var(--g3);border-color:var(--g3);color:white;}
    .step-dot.active{background:var(--green-ghost);border-color:var(--g3);color:var(--g3);}
    .step-line{flex:1;height:2px;background:var(--border);transition:background .3s;}
    .step-line.done{background:var(--g3);}
    .form-step{display:none;animation:fin .2s ease;}
    .form-step.active{display:block;}
    @keyframes fin{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}
    .type-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:7px;margin-bottom:12px;}
    .tb{padding:10px 9px;border:2px solid var(--border);border-radius:10px;cursor:pointer;text-align:center;background:white;transition:all .15s;font-family:'Plus Jakarta Sans',sans-serif;}
    .tb:hover{border-color:var(--g4);background:var(--green-ghost);}
    .tb.sel{border-color:var(--g3);background:var(--green-ghost);}
    .tb-icon{font-size:19px;margin-bottom:3px;}
    .tb-lbl{font-size:11px;font-weight:700;color:var(--text);display:block;}
    .tb-sub{font-size:9.5px;color:var(--muted);display:block;margin-top:1px;}
    .field{display:flex;flex-direction:column;gap:4px;margin-bottom:11px;}
    .field label{font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;}
    .finput{width:100%;padding:10px 11px;border:1.5px solid var(--border);border-radius:9px;font-family:'Plus Jakarta Sans',sans-serif;font-size:15px;color:var(--text);outline:none;transition:border-color .15s;-webkit-appearance:none;background:white;}
    .finput:focus{border-color:var(--g3);box-shadow:0 0 0 3px rgba(5,150,105,.07);}
    .date-row{display:grid;grid-template-columns:1fr 1fr;gap:9px;}
    .alert{border-radius:8px;padding:9px 11px;font-size:12px;font-weight:600;margin-bottom:9px;display:none;line-height:1.5;}
    .alert.show{display:block;}
    .alert-green{background:var(--green-ghost);color:#065f46;border-left:3px solid var(--g3);}
    .alert-orange{background:var(--orange-bg);color:#92400e;border-left:3px solid var(--orange);}
    .alert-blue{background:var(--blue-bg);color:#1e40af;border-left:3px solid var(--blue);}
    .alert-red{background:var(--red-bg);color:#991b1b;border-left:3px solid var(--red);}
    .resume{border:2px solid var(--green-light);border-radius:10px;padding:13px;background:var(--green-ghost);margin-bottom:11px;}
    .resume-row{display:flex;justify-content:space-between;align-items:center;padding:5px 0;border-bottom:1px solid var(--green-light);font-size:12px;}
    .resume-row:last-child{border-bottom:none;font-weight:700;font-size:13px;padding-top:7px;}
    .resume-row span:first-child{color:var(--muted);}
    .btn{padding:9px 16px;border:none;border-radius:9px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all .18s;display:inline-flex;align-items:center;justify-content:center;gap:5px;}
    .btn-green{background:linear-gradient(135deg,var(--g3),var(--g4));color:white;box-shadow:0 3px 10px rgba(5,150,105,.25);}
    .btn-green:hover{opacity:.9;transform:translateY(-1px);}
    .btn-green:active{transform:translateY(0);}
    .btn-green:disabled{opacity:.4;transform:none;cursor:not-allowed;}
    .btn-ghost{background:white;color:var(--g3);border:1.5px solid var(--green-light);}
    .btn-ghost:hover{background:var(--green-ghost);}
    .btn-row{display:flex;gap:7px;justify-content:flex-end;margin-top:12px;}
    .success-wrap{display:none;flex-direction:column;align-items:center;padding:28px 18px;text-align:center;}
    .success-wrap.show{display:flex;}
    .success-circle{width:60px;height:60px;background:var(--green-ghost);border:3px solid var(--green-light);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;margin-bottom:12px;animation:pop .35s cubic-bezier(.34,1.56,.64,1);}
    @keyframes pop{from{transform:scale(0)}to{transform:scale(1)}}
    .success-title{font-size:16px;font-weight:800;margin-bottom:5px;}
    .success-sub{font-size:12px;color:var(--muted);max-width:270px;line-height:1.6;}
    .filter-tabs{display:flex;gap:4px;overflow-x:auto;padding-bottom:2px;margin-bottom:11px;scrollbar-width:none;}
    .filter-tabs::-webkit-scrollbar{display:none;}
    .ftab{padding:4px 11px;border-radius:20px;font-size:11px;font-weight:700;cursor:pointer;border:1.5px solid var(--border);background:white;color:var(--muted);white-space:nowrap;transition:all .15s;font-family:'Plus Jakarta Sans',sans-serif;}
    .ftab.active{background:var(--g3);color:white;border-color:var(--g3);}
    .dem-item{display:flex;align-items:flex-start;gap:10px;padding:11px 0;border-bottom:1px solid #f3f4f6;}
    .dem-item:last-child{border-bottom:none;}
    .dem-ico{width:34px;height:34px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;margin-top:1px;}
    .dem-body{flex:1;min-width:0;}
    .dem-name{font-size:12px;font-weight:700;margin-bottom:2px;}
    .dem-dates{font-size:11px;color:var(--muted);}
    .dem-motif{font-size:11px;color:var(--muted);font-style:italic;margin-top:2px;}
    .dem-refus{font-size:10.5px;color:var(--red);margin-top:3px;}
    .badge{display:inline-flex;align-items:center;padding:2px 7px;border-radius:20px;font-size:10px;font-weight:700;flex-shrink:0;margin-top:3px;}
    .badge-pending{background:#fef3c7;color:#92400e;}
    .badge-approved{background:#dcfce7;color:#166534;}
    .badge-refused{background:#fee2e2;color:#991b1b;}
    .badge-cancelled{background:#f3f4f6;color:#6b7280;}
    .year-btn{font-size:11px;font-weight:700;color:rgba(255,255,255,.4);background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.1);padding:5px 11px;border-radius:20px;cursor:pointer;transition:all .15s;display:flex;align-items:center;gap:5px;font-family:'Plus Jakarta Sans',sans-serif;}
    .year-btn:hover{background:rgba(255,255,255,.13);}

    /* ‚îÄ‚îÄ PLANNING ‚îÄ‚îÄ */
    .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:2px;text-align:center;}
    .cal-hdr{font-size:9.5px;font-weight:700;color:var(--muted);padding:2px 0;}
    .cal-day{aspect-ratio:1;border-radius:5px;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:11px;font-weight:500;line-height:1.2;}
    .cal-day.work{font-weight:700;}
    .cal-day.off{opacity:0.4;}
    .cal-day.work-generic{font-weight:500;}
    .cal-day.today{outline:2px solid var(--g3);font-weight:800;}
    .cal-day.abs{color:white;font-weight:700;}
    .cal-day.abs-pending{opacity:.6;}

    /* ‚îÄ‚îÄ JUSTIFICATIF ‚îÄ‚îÄ */
    #justif-wrap{display:none;}
    #justif-preview{display:none;margin-top:7px;padding:8px 12px;background:var(--green-ghost);border:1px solid #6ee7b7;border-radius:8px;align-items:center;gap:8px;}

    /* ‚îÄ‚îÄ INFOS LINE ‚îÄ‚îÄ */
    .info-line{display:flex;align-items:center;gap:8px;padding:8px 0;border-bottom:1px solid #f3f4f6;font-size:12px;}
    .info-line:last-child{border-bottom:none;}
    .info-line-icon{font-size:15px;flex-shrink:0;width:20px;text-align:center;}
    .info-line-label{color:var(--muted);width:110px;flex-shrink:0;font-size:11px;}
    .info-line-val{font-weight:600;flex:1;color:var(--text);}

    /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
    .toast{position:fixed;bottom:22px;left:50%;transform:translateX(-50%) translateY(80px);background:#1a1f36;color:white;padding:10px 20px;border-radius:10px;font-size:13px;font-weight:600;z-index:9999;opacity:0;transition:all .3s;white-space:nowrap;}
    .toast.show{transform:translateX(-50%) translateY(0);opacity:1;}
    .toast.ok{background:var(--g3);}.toast.err{background:var(--red);}.toast.warn{background:var(--orange);}

    /* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
    .modal-overlay{position:fixed;inset:0;background:rgba(5,46,22,.5);backdrop-filter:blur(4px);z-index:200;display:none;align-items:flex-end;justify-content:center;}
    .modal-overlay.show{display:flex;}
    .modal{background:white;border-radius:18px 18px 0 0;width:100%;max-width:600px;max-height:90vh;overflow-y:auto;box-shadow:0 -8px 40px rgba(0,0,0,.15);}
    .modal-head{padding:16px 18px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;background:white;z-index:1;}
    .modal-head h3{font-size:14px;font-weight:800;}
    .modal-close{background:none;border:none;font-size:18px;cursor:pointer;color:var(--muted);}
    .modal-body{padding:16px 18px 20px;}

    /* ‚îÄ‚îÄ EMPTY ‚îÄ‚îÄ */
    .empty{display:flex;flex-direction:column;align-items:center;padding:26px;text-align:center;color:var(--muted);}
    .empty-icon{font-size:30px;margin-bottom:7px;}

    /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
    @media(max-width:480px){
      .soldes-grid{grid-template-columns:1fr 1fr;}
      .date-row{grid-template-columns:1fr;}
      .hero{padding:18px 13px 82px;}
      .profil-row{grid-template-columns:1fr;}
      .tnav{padding:12px 11px;font-size:11px;}
    }
  </style>
</head>
<body>

<div id="loading-wrap">
  <div class="load-logo">üåø ALTEORE</div>
  <div class="spin"></div>
  <div class="load-sub">Chargement de votre espace‚Ä¶</div>
</div>

<div id="not-found">
  <div class="nf-icon">üîó</div>
  <div class="nf-title">Lien invalide</div>
  <div class="nf-sub">Ce lien n'est pas valide ou a expir√©.<br>Demandez √† votre employeur un nouveau lien d'acc√®s.</div>
</div>

<div id="main-wrap" style="display:none">

  <!-- ‚ïê‚ïê HERO ‚ïê‚ïê -->
  <div class="hero">
    <div class="hero-top">
      <div class="hero-brand">
        <div class="hero-brand-icon">üåø</div>
        <div class="hero-brand-name">ALTEORE</div>
      </div>
      <button class="year-btn" onclick="changeYear()" id="year-btn">üìÖ <span id="year-lbl"></span></button>
    </div>
    <div class="hero-body">
      <div class="hero-avatar" id="hero-av">?</div>
      <div class="hero-info">
        <div class="hero-name" id="hero-name">‚Äî</div>
        <div class="hero-sub" id="hero-sub">‚Äî</div>
        <div class="hero-chips" id="hero-chips"></div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê SOLDES ‚ïê‚ïê -->
  <div class="soldes-wrap"><div class="soldes-grid" id="soldes-grid"></div></div>

  <!-- ‚ïê‚ïê NAVIGATION ONGLETS ‚ïê‚ïê -->
  <div class="tabs-nav" style="margin-top:14px">
    <div class="tabs-inner">
      <button class="tnav active" onclick="showTab('accueil',this)">üè† Accueil</button>
      <button class="tnav" onclick="showTab('profil',this)">üë§ Mon profil</button>
      
      <button class="tnav" onclick="showTab('conges',this)" id="tab-conges-btn">üèñÔ∏è Cong√©s</button>
      <button class="tnav" onclick="showTab('planning',this)">üìÖ Planning</button>
    </div>
  </div>

  <!-- ‚ïê‚ïê ONGLET ACCUEIL ‚ïê‚ïê -->
  <div class="tab-section active" id="tab-accueil" style="margin-top:16px">

    <!-- Bienvenue -->
    <div class="card">
      <div class="card-body" style="padding:18px">
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:14px">
          <div style="font-size:32px">üëã</div>
          <div>
            <div style="font-size:15px;font-weight:800;color:var(--text)" id="welcome-name">Bienvenue !</div>
            <div style="font-size:11px;color:var(--muted)" id="welcome-date"></div>
          </div>
        </div>
        <div id="accueil-infos" style="display:flex;flex-direction:column;gap:0"></div>
      </div>
    </div>

    <!-- Solde rapide -->
    <div class="card">
      <div class="card-head"><div class="card-title">üìä Mes soldes <span style="font-size:10px;font-weight:400;color:var(--muted)" id="accueil-annee-lbl"></span></div></div>
      <div class="card-body" style="padding:10px 14px">
        <div id="accueil-soldes"></div>
      </div>
    </div>

    <!-- Demandes r√©centes -->
    <div class="card">
      <div class="card-head">
        <div class="card-title">üìã Derni√®res demandes</div>
        <button class="btn-ghost btn" style="font-size:11px;padding:4px 10px" onclick="showTab('conges',document.querySelector('.tnav:nth-child(4))'))">Voir tout</button>
      </div>
      <div class="card-body" style="padding-top:8px" id="accueil-demandes"></div>
    </div>

    <!-- Actions rapides -->
    <div class="card">
      <div class="card-head"><div class="card-title">‚ö° Actions rapides</div></div>
      <div class="card-body" style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <button class="btn btn-green" onclick="showTab('conges',document.querySelectorAll('.tnav')[3])">‚úâÔ∏è Demander un cong√©</button>
        <button class="btn btn-ghost" onclick="showTab('profil',document.querySelectorAll('.tnav')[1])">‚úèÔ∏è Modifier mon profil</button>
        <button class="btn btn-ghost" onclick="showTab('planning',document.querySelectorAll('.tnav')[4])">üìÖ Voir mon planning</button>
      </div>
    </div>

  </div>

  <!-- ‚ïê‚ïê ONGLET PROFIL ‚ïê‚ïê -->
  <div class="tab-section" id="tab-profil" style="margin-top:16px">

    <!-- Carte contrat -->
    <div id="contrat-card-wrap"></div>

    <!-- Infos personnelles modifiables -->
    <div class="card">
      <div class="card-head">
        <div class="card-title">üë§ Informations personnelles</div>
        <span style="font-size:10px;color:var(--muted)">‚úèÔ∏è Modifiable</span>
      </div>
      <div class="card-body">
        <div class="profil-section-title">Coordonn√©es</div>
        <div class="profil-row">
          <div class="profil-field">
            <div class="profil-label">Pr√©nom</div>
            <div class="profil-val" id="pf-prenom"></div>
          </div>
          <div class="profil-field">
            <div class="profil-label">Nom</div>
            <div class="profil-val" id="pf-nom"></div>
          </div>
        </div>
        <div class="profil-row">
          <div class="profil-field">
            <div class="profil-label">Email personnel</div>
            <div class="profil-val editable" id="pf-email-perso" onclick="editField(this,'emailPerso')" title="Cliquer pour modifier">‚Äî</div>
          </div>
          <div class="profil-field">
            <div class="profil-label">T√©l√©phone</div>
            <div class="profil-val editable" id="pf-tel" onclick="editField(this,'telephone')" title="Cliquer pour modifier">‚Äî</div>
          </div>
        </div>
        <div class="profil-row profil-full">
          <div class="profil-field">
            <div class="profil-label">Adresse</div>
            <div class="profil-val editable" id="pf-adresse" onclick="editField(this,'adresse')" title="Cliquer pour modifier">‚Äî</div>
          </div>
        </div>
        <div class="profil-row">
          <div class="profil-field">
            <div class="profil-label">Date de naissance</div>
            <div class="profil-val editable" id="pf-ddn" onclick="editField(this,'dateNaissance')" title="Cliquer pour modifier">‚Äî</div>
          </div>
          <div class="profil-field">
            <div class="profil-label">Nationalit√©</div>
            <div class="profil-val editable" id="pf-nat" onclick="editField(this,'nationalite')" title="Cliquer pour modifier">‚Äî</div>
          </div>
        </div>

        <div class="profil-section-title">Informations bancaires</div>
        <div class="profil-row">
          <div class="profil-field">
            <div class="profil-label">IBAN</div>
            <div class="profil-val editable" id="pf-iban" onclick="editField(this,'iban')" title="Cliquer pour modifier">‚Äî</div>
          </div>
          <div class="profil-field">
            <div class="profil-label">Titulaire du compte</div>
            <div class="profil-val editable" id="pf-titulaire" onclick="editField(this,'ibanTitulaire')" title="Cliquer pour modifier">‚Äî</div>
          </div>
        </div>
        <div style="font-size:10px;color:var(--muted);background:#fafafa;padding:8px 10px;border-radius:8px;border:1px solid var(--border)">
          üîí Vos informations bancaires sont stock√©es de fa√ßon s√©curis√©e et uniquement accessibles par votre employeur pour le versement de votre salaire.
        </div>

        <div class="profil-section-title">Contact d'urgence</div>
        <div id="urgence-wrap"></div>
        <div class="profil-row" style="margin-top:8px">
          <div class="profil-field">
            <div class="profil-label">Nom & pr√©nom</div>
            <div class="profil-val editable" id="pf-urgence-nom" onclick="editField(this,'contactUrgenceNom')" title="Cliquer pour modifier">‚Äî</div>
          </div>
          <div class="profil-field">
            <div class="profil-label">Lien (ex : conjoint)</div>
            <div class="profil-val editable" id="pf-urgence-lien" onclick="editField(this,'contactUrgenceLien')" title="Cliquer pour modifier">‚Äî</div>
          </div>
        </div>
        <div class="profil-row">
          <div class="profil-field">
            <div class="profil-label">T√©l√©phone urgence</div>
            <div class="profil-val editable" id="pf-urgence-tel" onclick="editField(this,'contactUrgenceTel')" title="Cliquer pour modifier">‚Äî</div>
          </div>
        </div>

        <button class="btn-save-profil" id="btn-save-profil" onclick="saveProfil()">üíæ Enregistrer les modifications</button>
      </div>
    </div>

    <!-- Informations contrat (lecture seule) -->
    <div class="card">
      <div class="card-head"><div class="card-title">üìÑ Mon contrat <span style="font-size:10px;color:var(--muted);font-weight:400">‚Äî g√©r√© par votre employeur</span></div></div>
      <div class="card-body" id="contrat-body"></div>
    </div>

  </div>

  <!-- ‚ïê‚ïê ONGLET DOCUMENTS ‚ïê‚ïê -->
  <div class="tab-section" id="tab-conges" style="margin-top:16px">

    <!-- Soldes d√©taill√©s -->
    <div class="card">
      <div class="card-head">
        <div class="card-title">üìä Mes soldes <span id="conges-annee-lbl" style="font-size:10px;font-weight:400;color:var(--muted)"></span></div>
      </div>
      <div class="card-body" style="padding:10px 14px" id="soldes-detail"></div>
    </div>

    <!-- Nouvelle demande -->
    <div class="card">
      <div class="card-head">
        <div class="card-title">‚úâÔ∏è Faire une demande</div>
        <span id="step-lbl" style="font-size:11px;color:var(--muted)">√âtape 1 / 3</span>
      </div>
      <div class="card-body">
        <div class="stepper">
          <div class="step-dot active" id="s1">1</div>
          <div class="step-line" id="sl1"></div>
          <div class="step-dot" id="s2">2</div>
          <div class="step-line" id="sl2"></div>
          <div class="step-dot" id="s3">3</div>
        </div>
        <div class="form-step active" id="st1">
          <div style="font-size:12px;font-weight:700;margin-bottom:10px">Quel type de cong√© ?</div>
          <div class="type-grid" id="type-grid"></div>
          <div class="alert alert-blue" id="evenement-loi">
            <strong>Dur√©es l√©gales :</strong><br>
            Mariage / PACS : 4j &nbsp;¬∑&nbsp; Naissance / Adoption : 3j<br>
            D√©c√®s conjoint ou enfant : 5j &nbsp;¬∑&nbsp; D√©c√®s parent : 3j &nbsp;¬∑&nbsp; D√©c√®s beau-parent : 3j
          </div>
          <div class="btn-row"><button class="btn btn-green" id="next1" onclick="goStep(2)" disabled>Suivant ‚Üí</button></div>
        </div>
        <div class="form-step" id="st2">
          <div class="date-row">
            <div class="field"><label>Date de d√©but</label><input class="finput" type="date" id="f-deb" oninput="onDateChg()"/></div>
            <div class="field"><label>Date de fin</label><input class="finput" type="date" id="f-fin" oninput="onDateChg()"/></div>
          </div>
          <div class="alert alert-green" id="jours-alert"></div>
          <div class="alert alert-orange" id="solde-alert"></div>
          <div class="field"><label>Motif (facultatif)</label><input class="finput" type="text" id="f-motif" placeholder="Ex : vacances, formation, √©v√©nement‚Ä¶"/></div>
          <div id="justif-wrap" style="margin-bottom:11px">
            <div class="field" style="margin-bottom:0">
              <label>üìé Justificatif <span style="font-weight:400;text-transform:none;letter-spacing:0">(arr√™t maladie, ordonnance‚Ä¶)</span></label>
              <div id="justif-drop" onclick="document.getElementById('justif-input').click()" style="border:2px dashed var(--border);border-radius:10px;padding:18px 12px;text-align:center;cursor:pointer;background:white;transition:all .15s;" onmouseover="this.style.borderColor='var(--g3)';this.style.background='var(--green-ghost)'" onmouseout="this.style.borderColor='var(--border)';this.style.background='white'">
                <div style="font-size:26px;margin-bottom:4px">üìÑ</div>
                <div style="font-size:12px;font-weight:600;color:var(--muted)">Appuyez pour joindre un fichier</div>
                <div style="font-size:10px;color:var(--muted);margin-top:2px">PDF, JPG, PNG ¬∑ Max 5 Mo ¬∑ Facultatif</div>
              </div>
              <input type="file" id="justif-input" accept=".pdf,.jpg,.jpeg,.png" style="display:none" onchange="onJustifChange(this)"/>
              <div id="justif-preview" style="margin-top:7px;padding:8px 12px;background:var(--green-ghost);border:1px solid #6ee7b7;border-radius:8px;align-items:center;gap:8px;">
                <span style="font-size:16px">üìé</span>
                <span id="justif-name" style="flex:1;font-size:12px;font-weight:600;color:#065f46;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"></span>
                <span id="justif-size" style="font-size:11px;color:var(--muted);flex-shrink:0"></span>
                <button onclick="clearJustif(event)" style="background:none;border:none;cursor:pointer;color:var(--red);font-size:15px;padding:0 2px;flex-shrink:0;line-height:1">‚úï</button>
              </div>
            </div>
          </div>
          <div class="btn-row">
            <button class="btn btn-ghost" onclick="goStep(1)">‚Üê Retour</button>
            <button class="btn btn-green" id="next2" onclick="goStep(3)" disabled>V√©rifier ‚Üí</button>
          </div>
        </div>
        <div class="form-step" id="st3">
          <div style="font-size:12px;font-weight:700;margin-bottom:11px">R√©capitulatif</div>
          <div class="resume" id="recap"></div>
          <div class="alert alert-orange" id="recap-warn"></div>
          <div class="btn-row">
            <button class="btn btn-ghost" onclick="goStep(2)">‚Üê Modifier</button>
            <button class="btn btn-green" id="btn-submit" onclick="submitDemande()">‚úâÔ∏è Envoyer la demande</button>
          </div>
        </div>
        <div class="success-wrap" id="success-wrap">
          <div class="success-circle">‚úÖ</div>
          <div class="success-title">Demande envoy√©e !</div>
          <div class="success-sub" id="success-sub">Votre demande a √©t√© transmise.</div>
          <button class="btn btn-green" style="margin-top:14px" onclick="resetForm()">+ Nouvelle demande</button>
        </div>
      </div>
    </div>

    <!-- Historique demandes -->
    <div class="card">
      <div class="card-head">
        <div class="card-title">üìã Mes demandes</div>
        <span id="dem-count" style="font-size:11px;color:var(--muted)"></span>
      </div>
      <div class="card-body" style="padding-top:10px">
        <div class="filter-tabs">
          <button class="ftab active" onclick="setFilter(this,'all')">Toutes</button>
          <button class="ftab" onclick="setFilter(this,'pending')">‚è≥ Attente</button>
          <button class="ftab" onclick="setFilter(this,'approved')">‚úÖ Approuv√©es</button>
          <button class="ftab" onclick="setFilter(this,'refused')">‚ùå Refus√©es</button>
          <button class="ftab" onclick="setFilter(this,'cancelled')">üö´ Annul√©es</button>
        </div>
        <div id="dem-list"></div>
      </div>
    </div>

  </div>

  <!-- ‚ïê‚ïê ONGLET PLANNING ‚ïê‚ïê -->
  <div class="tab-section" id="tab-planning" style="margin-top:16px">
    <div class="card">
      <div class="card-head">
        <div class="card-title">üìÖ <span id="cal-title">Mon calendrier</span></div>
        <div style="display:flex;gap:5px">
          <button class="btn btn-ghost" style="padding:4px 9px;font-size:12px" onclick="prevM()">‚Äπ</button>
          <button class="btn btn-ghost" style="padding:4px 9px;font-size:12px" onclick="nextM()">‚Ä∫</button>
        </div>
      </div>
      <div class="card-body" style="padding:12px">
        <div class="cal-grid" id="cal-grid"></div>
        <div style="display:flex;flex-wrap:wrap;gap:7px;margin-top:9px" id="cal-legend"></div>
      </div>
    </div>
    <!-- Horaires habituels -->
    <div class="card" id="horaires-card">
      <div class="card-head"><div class="card-title">‚è∞ Mes horaires habituels</div></div>
      <div class="card-body" id="horaires-body"></div>
    </div>
  </div>

  <div style="text-align:center;padding:8px 0 16px;color:var(--muted);font-size:10.5px">
    Propuls√© par <strong>ALTEORE</strong> ¬∑ Portail salari√© s√©curis√©
  </div>
</div>



<div class="toast" id="toast"></div>

<!-- ‚ïê‚ïê FIREBASE ‚ïê‚ïê -->
<script type="module">  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc, addDoc, getDocs, collection, query, where }
    from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
  const app = initializeApp({
    apiKey:"AIzaSyB003WqdRKrT0gbv7P4BNIICuXeqbu8dR4",
    authDomain:"altiora-70599.firebaseapp.com", projectId:"altiora-70599",
    storageBucket:"altiora-70599.firebasestorage.app",
    messagingSenderId:"120905555746", appId:"1:120905555746:web:618460c65cdc9e57cc8f7b"
  });
  const db = getFirestore(app);
  window._db = db;
  window._getDoc   = (path, ...s) => getDoc(doc(db, path, ...s));
  window._setDocFs = (path, id, data, opts) => setDoc(doc(db, path, id), data, opts||{});
  window._setDocPath = (segments, data, opts) => {
    const ref2 = doc(db, ...segments);
    return setDoc(ref2, data, opts||{});
  };
  window._addDoc   = (colPath, data) => addDoc(collection(db, ...colPath), data);
  window._getDocs  = (...colPath) => getDocs(collection(db, ...colPath));
  window._queryWhere = (colPath, field, val) =>
    getDocs(query(collection(db, ...colPath), where(field, '==', val)));
  window._dbReady = true;
  // Attendre que startApp soit d\u00e9fini par le script inline
  function tryStart() {
    if(typeof window.startApp === 'function') { window.startApp(); }
    else { setTimeout(tryStart, 30); }
  }
  tryStart();
</script>

<script>
(function(){
var b="Lyog4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCiAgIENPTlNUQU5URVMK4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQICovCnZhciBDT0xPUlMgPSB7Y3A6JyMwNTk2NjknLHJ0dDonIzNiODJmNicsY3NzOicjZjU5ZTBiJyxldmVuZW1lbnQ6JyM3YzNhZWQnLG1hbGFkaWU6JyNlZjQ0NDQnLHJlY3VwZXJhdGlvbjonIzA4OTFiMicsZm9ybWF0aW9uOicjZGIyNzc3J307CnZhciBMQUJFTFMgID0ge2NwOidDb25nXHUwMGU5cyBwYXlcdTAwZTlzJyxydHQ6J1JUVCcsY3NzOidTYW5zIHNvbGRlJyxldmVuZW1lbnQ6J1x1MDBjOXZcdTAwZTluZW1lbnQgZmFtaWxpYWwnLG1hbGFkaWU6J01hbGFkaWUgLyBBcnJcdTAwZWF0JyxyZWN1cGVyYXRpb246J1JcdTAwZTljdXBcdTAwZTlyYXRpb24gaGV1cmVzJyxmb3JtYXRpb246J0Zvcm1hdGlvbid9Owp2YXIgSUNPTlMgICA9IHtjcDonXHVkODNjXHVkZmQ2XHVmZTBmJyxydHQ6J1x1MjNmMCcsY3NzOidcdWQ4M2RcdWRjYmMnLGV2ZW5lbWVudDonXHVkODNjXHVkZjg5JyxtYWxhZGllOidcdWQ4M2VcdWRkMTInLHJlY3VwZXJhdGlvbjonXHVkODNkXHVkZDA0Jyxmb3JtYXRpb246J1x1ZDgzY1x1ZGY5Myd9Owp2YXIgU09MREVfSyA9IHtjcDonY3BSZXN0YW50JyxydHQ6J3J0dFJlc3RhbnQnLHJlY3VwZXJhdGlvbjoncmVjdXBSZXN0YW50J307CnZhciBET1dfS0VZID0gWydsdW5kaScsJ21hcmRpJywnbWVyY3JlZGknLCdqZXVkaScsJ3ZlbmRyZWRpJywnc2FtZWRpJywnZGltYW5jaGUnXTsKCi8vIERvY3VtZW50cyByZXF1aXMgLSBsYWJlbHMgZW4gdW5pY29kZSBwdXIgcG91ciBjb21wYXRpYmlsaXRlIFNhZmFyaQpmdW5jdGlvbiBlc2NIdG1sKHMpeyByZXR1cm4gKHN8fCIiKS5yZXBsYWNlKC8mL2csIiZhbXA7IikucmVwbGFjZSgvIi9nLCImcXVvdDsiKS5yZXBsYWNlKC88L2csIiZsdDsiKS5yZXBsYWNlKC8+L2csIiZndDsiKTsgfQovLyBFY2hhcHBlciBsZXMgbGFiZWxzIHBvdXIgdXNhZ2UgZGFucyBvbmNsaWNrIEhUTUwKZnVuY3Rpb24gZXNjSHRtbChzKXsgcmV0dXJuIChzfHwnJykucmVwbGFjZSgvJi9nLCcmYW1wOycpLnJlcGxhY2UoLyIvZywnJnF1b3Q7JykucmVwbGFjZSgvJy9nLCcmIzM5OycpLnJlcGxhY2UoLzwvZywnJmx0OycpLnJlcGxhY2UoLz4vZywnJmd0OycpOyB9CgovKiDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKICAgw4lUQVQgR0xPQkFMCuKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkCAqLwp2YXIgX3VpZD0nJywgX2VtcElkPScnLCBfZW1wPXt9LCBfcGFyYW1zPXt9LCBfZGVtYW5kZXM9W107CnZhciBfc29sZGVzPXt9Owp2YXIgX3NlbFR5cGU9Jyc7CnZhciBfZGVtRmlsdGVyPSdhbGwnOwp2YXIgX2NhbE1vbnRoPW5ldyBEYXRlKCk7CnZhciBfeWVhcj1uZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCk7CnZhciBfcGxhbm5pbmdDYWNoZT17fTsKdmFyIF9wcm9maWxFZGl0cz17fTsgICAgICAgLy8gbW9kaWZpY2F0aW9ucyBlbiBhdHRlbnRlCnZhciBfcHJvZmlsRmllbGRzPXt9OyAgICAgIC8vIHZhbGV1cnMgYWN0dWVsbGVzIGR1IHByb2ZpbCDDqXRlbmR1CnZhciBfZG9jc0VtcGxveWVlPXt9OyAgICAgIC8vIHtkb2NJZDoge25hbWUsIHNpemUsIHVwbG9hZGVkQXQsIGRhdGF9fQp2YXIgX2RvY3NFbXBsb3llcj1bXTsgICAgICAvLyBbe2xhYmVsLCBuYW1lLCB1cGxvYWRlZEF0LCBkYXRhfV0KLy8gcmVtb3ZlZD0nJzsgICAgICAgLy8gZG9jdW1lbnQgZW4gY291cnMgZCd1cGxvYWQKLy8gcmVtb3ZlZD1udWxsOwovLyByZW1vdmVkPW51bGw7CgovKiDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKICAgRMOJTUFSUkFHRQrilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAgKi8Kd2luZG93LnN0YXJ0QXBwID0gZnVuY3Rpb24oKSB7CiAgdmFyIHAgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpOwogIHZhciBwaWQgPSBwLmdldCgnaWQnKSB8fCAnJzsKICBpZiAoIXBpZCkgeyBzaG93Tm90Rm91bmQoKTsgcmV0dXJuOyB9CiAgdmFyIHQgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHsKICAgIGlmICh3aW5kb3cuX2RiUmVhZHkpIHsgY2xlYXJJbnRlcnZhbCh0KTsgbG9hZEVtcGxveWUocGlkKTsgfQogIH0sIDgwKTsKfTsKCmFzeW5jIGZ1bmN0aW9uIGxvYWRFbXBsb3llKHBpZCkgewogIHRyeSB7CiAgICB2YXIgc25hcCA9IGF3YWl0IHdpbmRvdy5fZ2V0RG9jKCdyaF9lbXBsb3llc19wdWJsaWMnLCBwaWQpOwogICAgaWYgKCFzbmFwLmV4aXN0cygpKSB7IHNob3dOb3RGb3VuZCgpOyByZXR1cm47IH0KICAgIHZhciBkYXRhID0gc25hcC5kYXRhKCk7CiAgICBfdWlkID0gZGF0YS51aWQ7IF9lbXBJZCA9IGRhdGEuZW1wSWQ7IF9lbXAgPSBkYXRhOwoKICAgIC8vIENoYXJnZXIgbGUgcHJvZmlsIMOpdGVuZHUgKGRvbm7DqWVzIHNhaXNpZXMgcGFyIGxlIHNhbGFyacOpKQogICAgdHJ5IHsKICAgICAgdmFyIHByb2ZTbmFwID0gYXdhaXQgd2luZG93Ll9nZXREb2MoJ3JoX2VtcGxveWVzX3B1YmxpY19wcm9maWwnLCBwaWQpOwogICAgICBpZiAocHJvZlNuYXAuZXhpc3RzKCkpIHsKICAgICAgICBfcHJvZmlsRmllbGRzID0gcHJvZlNuYXAuZGF0YSgpOwogICAgICB9CiAgICB9IGNhdGNoKGUpIHsgX3Byb2ZpbEZpZWxkcyA9IHt9OyB9CgogICAgLy8gQ2hhcmdlciBwYXJhbXMgUkgKICAgIHRyeSB7CiAgICAgIHZhciBwcyA9IGF3YWl0IHdpbmRvdy5fZ2V0RG9jKCdyaF9wYXJhbXMnLCBfdWlkKTsKICAgICAgX3BhcmFtcyA9IHBzLmV4aXN0cygpID8gcHMuZGF0YSgpIDoge307CiAgICB9IGNhdGNoKGUpIHsgX3BhcmFtcyA9IHt9OyB9CgogICAgLy8gQ2hhcmdlciBkb25uw6llcyBlbXBsb3nDqSBwcml2w6llcyAobGVjdHVyZSBzZXVsZSkKICAgIHRyeSB7CiAgICAgIHZhciBlbXBTbmFwID0gYXdhaXQgd2luZG93Ll9nZXREb2MoJ3JoJywgX3VpZCwgJ2VtcGxveWVzJywgX2VtcElkKTsKICAgICAgaWYgKGVtcFNuYXAuZXhpc3RzKCkpIHsKICAgICAgICB2YXIgZWQgPSBlbXBTbmFwLmRhdGEoKTsKICAgICAgICAvLyBGdXNpb24gc8OpY3VyaXPDqWUgZGVzIGRvbm7DqWVzIFJPCiAgICAgICAgWydzYWxhaXJlQnJ1dCcsJ3NhbGFpcmVOZXQnLCdoZXVyZXNIZWJkbycsJ2ZyZXF1ZW5jZScsJ2NhdGVnb3JpZVBvc3RlJywnY2NuJywKICAgICAgICAgJ2RhdGVOYWlzc2FuY2UnLCduYXRpb25hbGl0ZScsJ3BlcmlvZGVFc3NhaScsJ25vdGVNb3llbm5lJ10uZm9yRWFjaChmdW5jdGlvbihrKXsKICAgICAgICAgIGlmKGVkW2tdICE9PSB1bmRlZmluZWQgJiYgX2VtcFtrXSA9PT0gdW5kZWZpbmVkKSBfZW1wW2tdID0gZWRba107CiAgICAgICAgfSk7CiAgICAgICAgLy8gRG9jdW1lbnRzIGTDqXBvc8OpcyBwYXIgbCdlbXBsb3lldXIKICAgICAgICBpZihlZC5kb2N1bWVudHNFbXBsb3lldXIpIF9kb2NzRW1wbG95ZXIgPSBlZC5kb2N1bWVudHNFbXBsb3lldXI7CiAgICAgICAgLy8gRG9jdW1lbnRzIGR1IHNhbGFyacOpIGTDqWrDoCBzdG9ja8OpcwogICAgICAgICAgICAgIH0KICAgIH0gY2F0Y2goZSkge30KCiAgICBhd2FpdCBsb2FkRGVtYW5kZXMoKTsKICAgIGF3YWl0IGxvYWRQbGFubmluZ01vbnRoKF9jYWxNb250aC5nZXRGdWxsWWVhcigpLCBfY2FsTW9udGguZ2V0TW9udGgoKSk7CiAgICBjYWxjU29sZGVzKCk7CiAgICByZW5kZXJBbGwoKTsKCiAgICB2YXIgbHcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZy13cmFwJyk7CiAgICBsdy5jbGFzc0xpc3QuYWRkKCdmYWRlJyk7CiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyBsdy5zdHlsZS5kaXNwbGF5PSdub25lJzsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW4td3JhcCcpLnN0eWxlLmRpc3BsYXk9J2Jsb2NrJzsgfSwgNDAwKTsKICB9IGNhdGNoKGUpIHsgY29uc29sZS5lcnJvcihlKTsgc2hvd05vdEZvdW5kKCk7IH0KfQoKLyog4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCiAgIENIQVJHRU1FTlQgRE9OTsOJRVMK4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQICovCmFzeW5jIGZ1bmN0aW9uIGxvYWREZW1hbmRlcygpIHsKICBfZGVtYW5kZXMgPSBbXTsKICB0cnkgewogICAgdmFyIHNuYXAgPSBhd2FpdCB3aW5kb3cuX3F1ZXJ5V2hlcmUoWydyaF9jb25nZXMnLCBfdWlkLCAnZGVtYW5kZXMnXSwgJ2VtcElkJywgX2VtcElkKTsKICAgIHNuYXAuZm9yRWFjaChmdW5jdGlvbihkKSB7IF9kZW1hbmRlcy5wdXNoKE9iamVjdC5hc3NpZ24oe2lkOmQuaWR9LCBkLmRhdGEoKSkpOyB9KTsKICAgIF9kZW1hbmRlcy5zb3J0KGZ1bmN0aW9uKGEsYikgeyByZXR1cm4gKGIuY3JlYXRlZEF0fHwnJykubG9jYWxlQ29tcGFyZShhLmNyZWF0ZWRBdHx8JycpOyB9KTsKICB9IGNhdGNoKGUpIHsgY29uc29sZS53YXJuKCdEZW1hbmRlczonLCBlLm1lc3NhZ2UpOyB9Cn0KCmFzeW5jIGZ1bmN0aW9uIGxvYWRQbGFubmluZ01vbnRoKHksIG0pIHsKICBfcGxhbm5pbmdDYWNoZSA9IHt9OwogIGlmICghX3VpZCB8fCAhX2VtcElkKSByZXR1cm47CiAgdmFyIHdlZWtLZXlzID0ge307CiAgdmFyIG5iID0gbmV3IERhdGUoeSwgbSsxLCAwKS5nZXREYXRlKCk7CiAgZm9yICh2YXIgZCA9IDE7IGQgPD0gbmI7IGQrKykgewogICAgdmFyIGR0ID0gbmV3IERhdGUoeSwgbSwgZCk7CiAgICB2YXIgbW9uID0gbmV3IERhdGUoZHQpOwogICAgdmFyIGRheSA9IG1vbi5nZXREYXkoKSwgZGlmZiA9IChkYXkgPT09IDApID8gLTYgOiAxIC0gZGF5OwogICAgbW9uLnNldERhdGUobW9uLmdldERhdGUoKSArIGRpZmYpOwogICAgbW9uLnNldEhvdXJzKDAsMCwwLDApOwogICAgdmFyIHdrID0gbW9uLnRvSVNPU3RyaW5nKCkuc2xpY2UoMCwxMCkucmVwbGFjZSgvLS9nLCcnKTsKICAgIHdlZWtLZXlzW3drXSA9IHRydWU7CiAgfQogIGZvciAodmFyIHdrIGluIHdlZWtLZXlzKSB7CiAgICB0cnkgewogICAgICB2YXIgc25hcCA9IGF3YWl0IHdpbmRvdy5fZ2V0RG9jcygncmgnLCBfdWlkLCAncGxhbl8nK3drKTsKICAgICAgc25hcC5mb3JFYWNoKGZ1bmN0aW9uKGRvYykgewogICAgICAgIGlmIChkb2MuaWQuZW5kc1dpdGgoJ18nK19lbXBJZCkpIHsKICAgICAgICAgIHZhciBkYXRlU3RyID0gZG9jLmlkLnJlcGxhY2UoJ18nK19lbXBJZCwgJycpOwogICAgICAgICAgdmFyIGRhdGEgPSBkb2MuZGF0YSgpOwogICAgICAgICAgX3BsYW5uaW5nQ2FjaGVbZGF0ZVN0cl0gPSAoZGF0YS5pdGVtcyB8fCBbXSkuZmlsdGVyKGZ1bmN0aW9uKGl0KSB7CiAgICAgICAgICAgIHJldHVybiBpdC50eXBlID09PSAndHJhdmFpbCcgfHwgaXQudHlwZSA9PT0gJ2Zvcm1hdGlvbicgfHwgaXQudHlwZSA9PT0gJ2FzdHJlaW50ZSc7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSBjYXRjaChlKSB7fQogIH0KfQoKLyog4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCiAgIENBTENVTCBTT0xERVMK4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQICovCmZ1bmN0aW9uIGNhbGNTb2xkZXMoKSB7CiAgdmFyIG5vdyA9IG5ldyBEYXRlKCk7CiAgdmFyIHkgPSBfeWVhcjsKICB2YXIgY3BBbm51ZWxzID0gcGFyc2VGbG9hdChfcGFyYW1zLmNwQW5udWVscykgfHwgMjU7CiAgdmFyIGNwUGVyaW9kZSA9IF9wYXJhbXMuY3BQZXJpb2RlIHx8ICcxanVpbic7CiAgdmFyIHJ0dEFubnVlbHMgPSBwYXJzZUZsb2F0KF9wYXJhbXMucnR0QW5udWVscykgfHwgMDsKICB2YXIgcERlYiwgcEZpbjsKICBpZiAoY3BQZXJpb2RlID09PSAnMWphbnYnKSB7IHBEZWIgPSBuZXcgRGF0ZSh5LDAsMSk7IHBGaW4gPSBuZXcgRGF0ZSh5LDExLDMxKTsgfQogIGVsc2UgeyBwRGViID0gbmV3IERhdGUoeS0xLDUsMSk7IHBGaW4gPSBuZXcgRGF0ZSh5LDQsMzEpOyB9CiAgdmFyIGVudHJlZSA9IF9lbXAuZGF0ZUVudHJlZSA/IG5ldyBEYXRlKF9lbXAuZGF0ZUVudHJlZSsnVDEyOjAwOjAwJykgOiBuZXcgRGF0ZSh5LTIsMCwxKTsKICB2YXIgZGVidXQgPSBlbnRyZWUgPiBwRGViID8gZW50cmVlIDogcERlYjsKICB2YXIgZmluID0gbm93IDwgcEZpbiA/IG5vdyA6IHBGaW47CiAgdmFyIG1vaXMgPSBNYXRoLm1heCgwLCAoZmluLmdldEZ1bGxZZWFyKCktZGVidXQuZ2V0RnVsbFllYXIoKSkqMTIgKyAoZmluLmdldE1vbnRoKCktZGVidXQuZ2V0TW9udGgoKSkpOwogIHZhciBhanVzdCA9IHBhcnNlRmxvYXQoX2VtcC5jcEFqdXN0QWNxdWlzKSB8fCAwOwogIHZhciBjcEFjcXVpcyA9IE1hdGgucm91bmQoTWF0aC5tYXgoMCwgbW9pcyooY3BBbm51ZWxzLzEyKSthanVzdCkqMTApLzEwOwogIHZhciBjcFByaXMgPSBfZGVtYW5kZXMuZmlsdGVyKGZ1bmN0aW9uKGQpIHsKICAgIGlmICghZC5kYXRlRGVidXQgfHwgZC50eXBlICE9PSAnY3AnIHx8IGQuc3RhdHV0ICE9PSAnYXBwcm92ZWQnKSByZXR1cm4gZmFsc2U7CiAgICB2YXIgZHQgPSBuZXcgRGF0ZShkLmRhdGVEZWJ1dCsnVDEyOjAwOjAwJyk7CiAgICByZXR1cm4gZHQgPj0gcERlYiAmJiBkdCA8PSBwRmluOwogIH0pLnJlZHVjZShmdW5jdGlvbihzLGQpIHsgcmV0dXJuIHMgKyAoZC5uYkpvdXJzfHwwKTsgfSwgMCk7CiAgdmFyIHJ0dEJhc2UgPSAocGFyc2VGbG9hdChfZW1wLnJ0dEFqdXN0KSA+PSAwKSA/IHBhcnNlRmxvYXQoX2VtcC5ydHRBanVzdCkgOiBydHRBbm51ZWxzOwogIHZhciBydHRQcmlzID0gX2RlbWFuZGVzLmZpbHRlcihmdW5jdGlvbihkKSB7IHJldHVybiBkLnR5cGU9PT0ncnR0JyAmJiBkLnN0YXR1dD09PSdhcHByb3ZlZCcgJiYgbmV3IERhdGUoZC5kYXRlRGVidXR8fDApLmdldEZ1bGxZZWFyKCk9PT15OyB9KS5yZWR1Y2UoZnVuY3Rpb24ocyxkKSB7IHJldHVybiBzKyhkLm5iSm91cnN8fDApOyB9LCAwKTsKICBfc29sZGVzID0gewogICAgY3BBY3F1aXM6IGNwQWNxdWlzLCBjcFByaXM6IGNwUHJpcywKICAgIGNwUmVzdGFudDogTWF0aC5tYXgoMCwgY3BBY3F1aXMtY3BQcmlzKSwKICAgIHJ0dEJhc2U6IHJ0dEJhc2UsIHJ0dFByaXM6IHJ0dFByaXMsCiAgICBydHRSZXN0YW50OiBNYXRoLm1heCgwLCBydHRCYXNlLXJ0dFByaXMpLAogICAgcmVjdXBSZXN0YW50OiBwYXJzZUZsb2F0KF9lbXAucmVjdXBIZXVyZXMpIHx8IDAsCiAgICBwZW5kaW5nOiBfZGVtYW5kZXMuZmlsdGVyKGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuc3RhdHV0PT09J3BlbmRpbmcnOyB9KS5sZW5ndGgsCiAgfTsKfQoKLyog4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCiAgIFJFTkRFUiBHTE9CQUwK4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQICovCmZ1bmN0aW9uIHJlbmRlckFsbCgpIHsKICB2YXIgY29sID0gX2VtcC5jb3VsZXVyIHx8ICcjMDU5NjY5JzsKICB2YXIgYXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGVyby1hdicpOwogIGF2LnRleHRDb250ZW50ID0gKF9lbXAucHJlbm9tfHwnPycpLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpOwogIGF2LnN0eWxlLmJhY2tncm91bmQgPSBjb2w7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlcm8tbmFtZScpLnRleHRDb250ZW50ID0gKChfZW1wLnByZW5vbXx8JycpKycgJysoX2VtcC5ub218fCcnKSkudHJpbSgpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJvLXN1YicpLnRleHRDb250ZW50ICA9IFtfZW1wLnBvc3RlLF9lbXAuZGVwYXJ0ZW1lbnQsX2VtcC50eXBlQ29udHJhdF0uZmlsdGVyKEJvb2xlYW4pLmpvaW4oJyBcdTAwYjcgJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3llYXItbGJsJykudGV4dENvbnRlbnQgID0gX3llYXI7CgogIC8vIENoaXBzIGhlcm8KICB2YXIgY2hpcHMgPSBbXTsKICBpZiAoX2VtcC50eXBlQ29udHJhdCkgY2hpcHMucHVzaChfZW1wLnR5cGVDb250cmF0KTsKICBpZiAoX2VtcC5kZXBhcnRlbWVudCkgY2hpcHMucHVzaChfZW1wLmRlcGFydGVtZW50KTsKICBpZiAoX2VtcC5oZXVyZXNIZWJkbykgY2hpcHMucHVzaChfZW1wLmhldXJlc0hlYmRvKydoL3NlbScpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZXJvLWNoaXBzJykuaW5uZXJIVE1MID0gY2hpcHMubWFwKGZ1bmN0aW9uKGMpeyByZXR1cm4gJzxzcGFuIGNsYXNzPSJoZXJvLWNoaXAiPicrYysnPC9zcGFuPic7IH0pLmpvaW4oJycpOwoKICByZW5kZXJTb2xkZXNGbG90dGFudHMoKTsKICByZW5kZXJBY2N1ZWlsKCk7CiAgcmVuZGVyUHJvZmlsKCk7CiAgcmVuZGVyU29sZGVzRGV0YWlsKCk7CiAgcmVuZGVyVHlwZUdyaWQoKTsKICByZW5kZXJEZW1hbmRlcygpOwogIHJlbmRlckNhbCgpOwogIHJlbmRlckhvcmFpcmVzKCk7Cn0KCi8qIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAogICBTT0xERVMgRkxPVFRBTlRTCuKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkCAqLwpmdW5jdGlvbiByZW5kZXJTb2xkZXNGbG90dGFudHMoKSB7CiAgdmFyIHMgPSBfc29sZGVzOwogIHZhciBjcFBjdCA9IHMuY3BBY3F1aXM+MCA/IE1hdGgubWluKHMuY3BQcmlzL3MuY3BBY3F1aXMqMTAwLDEwMCkudG9GaXhlZCgwKSA6IDA7CiAgdmFyIHJ0dFBjdCA9IHMucnR0QmFzZT4wID8gTWF0aC5taW4ocy5ydHRQcmlzL3MucnR0QmFzZSoxMDAsMTAwKS50b0ZpeGVkKDApIDogMDsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc29sZGVzLWdyaWQnKS5pbm5lckhUTUwgPQogICAgc2MoJ1x1ZDgzY1x1ZGZkNlx1ZmUwZicsIHMuY3BSZXN0YW50LnRvRml4ZWQoMSksICdqJywgJ0NQIHJlc3RhbnRzJywgcy5jcEFjcXVpcy50b0ZpeGVkKDEpKydqIGFjcXVpcycsIHMuY3BSZXN0YW50PjEwPydnJzpzLmNwUmVzdGFudD41PydvJzoncicsIGNwUGN0LCAndmFyKC0tb3JhbmdlKScpCiAgICtzYygnXHUyM2YwJywgcy5ydHRSZXN0YW50LnRvRml4ZWQoMSksICdqJywgJ1JUVCByZXN0YW50cycsIHMucnR0QmFzZSsnaiBhbGxvdVx1MDBlOXMnLCBzLnJ0dFJlc3RhbnQ+MD8nZyc6J3InLCBydHRQY3QsICd2YXIoLS1ibHVlKScpCiAgICtzYygnXHVkODNkXHVkZDA0Jywgcy5yZWN1cFJlc3RhbnQudG9GaXhlZCgxKSwgJ2gnLCAnUlx1MDBlOWN1cFx1MDBlOXJhdGlvbicsICdIZXVyZXMgXHUwMGUwIHByZW5kcmUnLCBzLnJlY3VwUmVzdGFudD4wPydnJzonJywgMCwgJycpCiAgICtzYygnXHUyM2YzJywgcy5wZW5kaW5nLCAnJywgJ0VuIGF0dGVudGUnLCAnZGVtYW5kZScrKHMucGVuZGluZz4xPydzJzonJykrJyBcdTAwZTAgdmFsaWRlcicsIHMucGVuZGluZz4wPydvJzonJywgMCwgJycpOwp9CmZ1bmN0aW9uIHNjKGljb24sIHZhbCwgdW5pdCwgbGJsLCBzdWIsIGNscywgcGN0LCBmaWxsQ29sb3IpIHsKICByZXR1cm4gJzxkaXYgY2xhc3M9InNjIj4nCiAgICArJzxkaXYgY2xhc3M9InNjLWljb24iPicraWNvbisnPC9kaXY+JwogICAgKyc8ZGl2IGNsYXNzPSJzYy12YWwgJytjbHMrJyI+Jyt2YWwrJzxzcGFuIGNsYXNzPSJzYy11bml0Ij4nK3VuaXQrJzwvc3Bhbj48L2Rpdj4nCiAgICArJzxkaXYgY2xhc3M9InNjLWxibCI+JytsYmwrJzwvZGl2PicKICAgICsnPGRpdiBjbGFzcz0ic2Mtc3ViIj4nK3N1YisnPC9kaXY+JwogICAgKyhwY3Q+MD8nPGRpdiBjbGFzcz0ic2MtYmFyIj48ZGl2IGNsYXNzPSJzYy1maWxsIiBzdHlsZT0id2lkdGg6JytwY3QrJyU7YmFja2dyb3VuZDonK2ZpbGxDb2xvcisnIj48L2Rpdj48L2Rpdj4nOicnKQogICAgKyc8L2Rpdj4nOwp9CgovKiDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKICAgQUNDVUVJTArilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAgKi8KZnVuY3Rpb24gcmVuZGVyQWNjdWVpbCgpIHsKICB2YXIgbm93ID0gbmV3IERhdGUoKTsKICB2YXIgam91cnMgPSBbJ2RpbWFuY2hlJywnbHVuZGknLCdtYXJkaScsJ21lcmNyZWRpJywnamV1ZGknLCd2ZW5kcmVkaScsJ3NhbWVkaSddOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3ZWxjb21lLW5hbWUnKS50ZXh0Q29udGVudCA9ICdCb25qb3VyICcrKF9lbXAucHJlbm9tfHwnJykgKycgISBcdWQ4M2RcdWRjNGInOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3ZWxjb21lLWRhdGUnKS50ZXh0Q29udGVudCA9IGpvdXJzW25vdy5nZXREYXkoKV0rJyAnK25vdy50b0xvY2FsZURhdGVTdHJpbmcoJ2ZyLUZSJyx7ZGF5OidudW1lcmljJyxtb250aDonbG9uZycseWVhcjonbnVtZXJpYyd9KTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWNjdWVpbC1hbm5lZS1sYmwnKS50ZXh0Q29udGVudCA9ICdcdTIwMTQgJytfeWVhcjsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZ2VzLWFubmVlLWxibCcpLnRleHRDb250ZW50ID0gJ1x1MjAxNCAnK195ZWFyOwoKICAvLyBJbmZvcyBjb250cmF0CiAgdmFyIGluZm9zID0gW107CiAgaWYoX2VtcC5wb3N0ZSkgaW5mb3MucHVzaCh7aWNvbjonXHVkODNkXHVkY2JjJywgbGFiZWw6J1Bvc3RlJywgdmFsOl9lbXAucG9zdGV9KTsKICBpZihfZW1wLmRhdGVFbnRyZWUpIGluZm9zLnB1c2goe2ljb246J1x1ZDgzZFx1ZGNjNScsIGxhYmVsOidFbnRyXHUwMGU5ZScsIHZhbDpmbXREYXRlKF9lbXAuZGF0ZUVudHJlZSl9KTsKICBpZihfZW1wLnR5cGVDb250cmF0KSBpbmZvcy5wdXNoKHtpY29uOidcdWQ4M2RcdWRjYzQnLCBsYWJlbDonQ29udHJhdCcsIHZhbDpfZW1wLnR5cGVDb250cmF0fSk7CiAgaWYoX2VtcC5kZXBhcnRlbWVudCkgaW5mb3MucHVzaCh7aWNvbjonXHVkODNjXHVkZmUyJywgbGFiZWw6J1x1MDBjOXF1aXBlJywgdmFsOl9lbXAuZGVwYXJ0ZW1lbnR9KTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWNjdWVpbC1pbmZvcycpLmlubmVySFRNTCA9IGluZm9zLm1hcChmdW5jdGlvbihpKXsKICAgIHJldHVybiAnPGRpdiBjbGFzcz0iaW5mby1saW5lIj48c3BhbiBjbGFzcz0iaW5mby1saW5lLWljb24iPicraS5pY29uKyc8L3NwYW4+PHNwYW4gY2xhc3M9ImluZm8tbGluZS1sYWJlbCI+JytpLmxhYmVsKyc8L3NwYW4+PHNwYW4gY2xhc3M9ImluZm8tbGluZS12YWwiPicraS52YWwrJzwvc3Bhbj48L2Rpdj4nOwogIH0pLmpvaW4oJycpOwoKICAvLyBTb2xkZXMgYWNjdWVpbAogIHZhciBzID0gX3NvbGRlczsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWNjdWVpbC1zb2xkZXMnKS5pbm5lckhUTUwgPQogICAgc29sZGVCYXIoJ1x1ZDgzY1x1ZGZkNlx1ZmUwZiBDUCByZXN0YW50cycsIHMuY3BSZXN0YW50LCBzLmNwQWNxdWlzLCAnaicsIHMuY3BSZXN0YW50PjEwPyd2YXIoLS1nMyknOnMuY3BSZXN0YW50PjU/J3ZhcigtLW9yYW5nZSknOid2YXIoLS1yZWQpJykKICAgK3NvbGRlQmFyKCdcdTIzZjAgUlRUIHJlc3RhbnRzJywgcy5ydHRSZXN0YW50LCBzLnJ0dEJhc2UsICdqJywgcy5ydHRSZXN0YW50PjA/J3ZhcigtLWJsdWUpJzondmFyKC0tcmVkKScpCiAgICsocy5yZWN1cFJlc3RhbnQ+MD9zb2xkZUJhcignXHVkODNkXHVkZDA0IFJcdTAwZTljdXBcdTAwZTlyYXRpb24nLCBzLnJlY3VwUmVzdGFudCwgcy5yZWN1cFJlc3RhbnQsICdoJywgJ3ZhcigtLXRlYWwpJyk6JycpOwoKICAvLyAzIGRlcm5pw6hyZXMgZGVtYW5kZXMKICB2YXIgcmVjZW50ID0gX2RlbWFuZGVzLnNsaWNlKDAsMyk7CiAgdmFyIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjY3VlaWwtZGVtYW5kZXMnKTsKICBpZighcmVjZW50Lmxlbmd0aCl7IGVsLmlubmVySFRNTD0nPGRpdiBjbGFzcz0iZW1wdHkiPjxkaXYgY2xhc3M9ImVtcHR5LWljb24iPlx1ZDgzZFx1ZGNjYjwvZGl2PkF1Y3VuZSBkZW1hbmRlLjwvZGl2Pic7IHJldHVybjsgfQogIGVsLmlubmVySFRNTCA9IHJlY2VudC5tYXAoZnVuY3Rpb24oZCl7CiAgICByZXR1cm4gZGVtSXRlbUh0bWwoZCk7CiAgfSkuam9pbignJyk7CgogIC8vIEJhZGdlIGNvbmfDqXMgZW4gYXR0ZW50ZQogIHZhciBwZW5kaW5nQ291bnQgPSBfc29sZGVzLnBlbmRpbmc7CiAgdmFyIHRhYkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YWItY29uZ2VzLWJ0bicpOwogIGlmKHBlbmRpbmdDb3VudD4wICYmIHRhYkJ0bil7CiAgICB0YWJCdG4uaW5uZXJIVE1MID0gJ1x1ZDgzY1x1ZGZkNlx1ZmUwZiBDb25nXHUwMGU5cyA8c3BhbiBjbGFzcz0ibm90aWYiPicrcGVuZGluZ0NvdW50Kyc8L3NwYW4+JzsKICB9CgogIC8vIEJhZGdlIGRvY3VtZW50cyBtYW5xdWFudHMKICB2YXIgbWlzc2luZ0RvY3MgPSBET0NTX1JFUVVJUkVELmZpbHRlcihmdW5jdGlvbihkKXsgcmV0dXJuICFkLm9wdGlvbmFsICYmICFfZG9jc0VtcGxveWVlW2QuaWRdOyB9KS5sZW5ndGg7CiAgdmFyIHRhYkRvY3NCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFiLWRvY3MtYnRuJyk7CiAgaWYobWlzc2luZ0RvY3M+MCAmJiB0YWJEb2NzQnRuKXsKICAgIHRhYkRvY3NCdG4uaW5uZXJIVE1MID0gJ1x1ZDgzZFx1ZGNjZSBEb2N1bWVudHMgPHNwYW4gY2xhc3M9Im5vdGlmIj4nK21pc3NpbmdEb2NzKyc8L3NwYW4+JzsKICB9Cn0KCmZ1bmN0aW9uIHNvbGRlQmFyKGxhYmVsLCB2YWwsIG1heCwgdW5pdCwgY29sb3IpIHsKICB2YXIgcGN0ID0gbWF4PjAgPyBNYXRoLm1pbih2YWwvbWF4KjEwMCwxMDApLnRvRml4ZWQoMCkgOiAwOwogIHJldHVybiAnPGRpdiBzdHlsZT0ibWFyZ2luLWJvdHRvbToxMnB4Ij4nCiAgICArJzxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjthbGlnbi1pdGVtczpiYXNlbGluZTttYXJnaW4tYm90dG9tOjRweCI+JwogICAgICArJzxzcGFuIHN0eWxlPSJmb250LXNpemU6MTJweDtmb250LXdlaWdodDo3MDAiPicrbGFiZWwrJzwvc3Bhbj4nCiAgICAgICsnPHNwYW4gc3R5bGU9ImZvbnQtc2l6ZToxNHB4O2ZvbnQtd2VpZ2h0OjgwMDtjb2xvcjonK2NvbG9yKyciPicrdmFsLnRvRml4ZWQoMSkrJzxzcGFuIHN0eWxlPSJmb250LXNpemU6MTBweDtmb250LXdlaWdodDo2MDAiPiAnK3VuaXQrJzwvc3Bhbj48L3NwYW4+JwogICAgKyc8L2Rpdj4nCiAgICArJzxkaXYgc3R5bGU9ImhlaWdodDo2cHg7YmFja2dyb3VuZDojZjNmNGY2O2JvcmRlci1yYWRpdXM6OTlweDtvdmVyZmxvdzpoaWRkZW4iPicKICAgICAgKyc8ZGl2IHN0eWxlPSJoZWlnaHQ6MTAwJTt3aWR0aDonK3BjdCsnJTtiYWNrZ3JvdW5kOicrY29sb3IrJztib3JkZXItcmFkaXVzOjk5cHg7dHJhbnNpdGlvbjp3aWR0aCAuNXMgZWFzZSI+PC9kaXY+JwogICAgKyc8L2Rpdj4nCiAgICArJzxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxMHB4O2NvbG9yOnZhcigtLW11dGVkKTttYXJnaW4tdG9wOjJweCI+Jyt2YWwudG9GaXhlZCgxKSsnIC8gJyttYXgudG9GaXhlZCgxKSsnICcrdW5pdCsnICgnK3BjdCsnJSB1dGlsaXNcdTAwZTlzKTwvZGl2PicKICArJzwvZGl2Pic7Cn0KCi8qIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkAogICBQUk9GSUwK4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQICovCmZ1bmN0aW9uIHJlbmRlclByb2ZpbCgpIHsKICAvLyBDb250cmF0IGNhcmQKICB2YXIgZGF0ZUVudHJlZSA9IF9lbXAuZGF0ZUVudHJlZSA/IGZtdERhdGUoX2VtcC5kYXRlRW50cmVlKSA6ICdcdTIwMTQnOwogIHZhciBhbmNpZW5uZXRlID0gX2VtcC5kYXRlRW50cmVlID8gY2FsY0FuY2llbm5ldGUoX2VtcC5kYXRlRW50cmVlKSA6ICcnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250cmF0LWNhcmQtd3JhcCcpLmlubmVySFRNTCA9CiAgICAnPGRpdiBjbGFzcz0iY29udHJhdC1jYXJkIj4nCiAgICAgICsnPGRpdiBjbGFzcz0iY29udHJhdC1sZWZ0Ij4nCiAgICAgICAgKyc8ZGl2IGNsYXNzPSJjb250cmF0LXR5cGUiPicrKChfZW1wLnR5cGVDb250cmF0fHwnQ29udHJhdCcpKSsnIFx1MDBiNyAnKyhfZW1wLnBvc3RlfHwnXHUyMDE0JykrJzwvZGl2PicKICAgICAgICArJzxkaXYgY2xhc3M9ImNvbnRyYXQtc3ViIj4nCiAgICAgICAgICArKF9lbXAuZGVwYXJ0ZW1lbnQ/X2VtcC5kZXBhcnRlbWVudCsnIFx1MDBiNyAnOicnKQogICAgICAgICAgKyhfZW1wLmhldXJlc0hlYmRvP19lbXAuaGV1cmVzSGViZG8rJ2gvc2VtYWluZSBcdTAwYjcgJzonJykKICAgICAgICAgICsoX2VtcC5mcmVxdWVuY2U/X2VtcC5mcmVxdWVuY2UuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkrX2VtcC5mcmVxdWVuY2Uuc2xpY2UoMSkrJyc6JycpCiAgICAgICAgKyc8L2Rpdj4nCiAgICAgICAgKyc8ZGl2IGNsYXNzPSJjb250cmF0LXN1YiIgc3R5bGU9Im1hcmdpbi10b3A6NHB4Ij5FbnRyXHUwMGU5ZSA6ICcrZGF0ZUVudHJlZSsnPC9kaXY+JwogICAgICArJzwvZGl2PicKICAgICAgKyhhbmNpZW5uZXRlPyc8ZGl2IGNsYXNzPSJjb250cmF0LXN0YXQiPjxkaXYgY2xhc3M9ImNzLXZhbCI+JythbmNpZW5uZXRlKyc8L2Rpdj48ZGl2IGNsYXNzPSJjcy1sYmwiPkFuY2llbm5ldFx1MDBlOTwvZGl2PjwvZGl2Pic6JycpCiAgICArJzwvZGl2Pic7CgogIC8vIEluZm9zIHBlcnNvbm5lbGxlcwogIHZhciBwZiA9IF9wcm9maWxGaWVsZHM7CiAgc2V0VmFsKCdwZi1wcmVub20nLCBfZW1wLnByZW5vbXx8J1x1MjAxNCcpOwogIHNldFZhbCgncGYtbm9tJywgX2VtcC5ub218fCdcdTIwMTQnKTsKICBzZXRFZGl0VmFsKCdwZi1lbWFpbC1wZXJzbycsIHBmLmVtYWlsUGVyc28sICdBam91dGVyIGVtYWlsIHBlcnNvbm5lbCcpOwogIHNldEVkaXRWYWwoJ3BmLXRlbCcsIHBmLnRlbGVwaG9uZSwgJ0Fqb3V0ZXIgdFx1MDBlOWxcdTAwZTlwaG9uZScpOwogIHNldEVkaXRWYWwoJ3BmLWFkcmVzc2UnLCBwZi5hZHJlc3NlLCAnQWpvdXRlciBhZHJlc3NlJyk7CiAgc2V0RWRpdFZhbCgncGYtZGRuJywgcGYuZGF0ZU5haXNzYW5jZSwgJ0Fqb3V0ZXIgZGF0ZSBkZSBuYWlzc2FuY2UnKTsKICBzZXRFZGl0VmFsKCdwZi1uYXQnLCBwZi5uYXRpb25hbGl0ZSwgJ0Fqb3V0ZXIgbmF0aW9uYWxpdFx1MDBlOScpOwogIHNldEVkaXRWYWwoJ3BmLWliYW4nLCBwZi5pYmFuID8gbWFza0liYW4ocGYuaWJhbikgOiAnJywgJ0Fqb3V0ZXIgSUJBTicpOwogIHNldEVkaXRWYWwoJ3BmLXRpdHVsYWlyZScsIHBmLmliYW5UaXR1bGFpcmUsICdBam91dGVyIHRpdHVsYWlyZScpOwogIHNldEVkaXRWYWwoJ3BmLXVyZ2VuY2Utbm9tJywgcGYuY29udGFjdFVyZ2VuY2VOb20sICdBam91dGVyIGNvbnRhY3QgdXJnZW5jZScpOwogIHNldEVkaXRWYWwoJ3BmLXVyZ2VuY2UtbGllbicsIHBmLmNvbnRhY3RVcmdlbmNlTGllbiwgJ0V4IDogY29uam9pbnQsIHBhcmVudC4uLicpOwogIHNldEVkaXRWYWwoJ3BmLXVyZ2VuY2UtdGVsJywgcGYuY29udGFjdFVyZ2VuY2VUZWwsICdUXHUwMGU5bFx1MDBlOXBob25lIHVyZ2VuY2UnKTsKCiAgLy8gVXJnZW5jZSBjYXJkCiAgdmFyIHV3ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VyZ2VuY2Utd3JhcCcpOwogIGlmKHBmLmNvbnRhY3RVcmdlbmNlTm9tICYmIHBmLmNvbnRhY3RVcmdlbmNlVGVsKXsKICAgIHV3LmlubmVySFRNTCA9ICc8ZGl2IGNsYXNzPSJ1cmdlbmNlLWNhcmQiPicKICAgICAgKyc8ZGl2IGNsYXNzPSJ1cmdlbmNlLWljbyI+XHVkODNkXHVkZWE4PC9kaXY+JwogICAgICArJzxkaXYgY2xhc3M9InVyZ2VuY2UtYm9keSI+JwogICAgICAgICsnPGRpdiBjbGFzcz0idXJnZW5jZS1uYW1lIj4nK3BmLmNvbnRhY3RVcmdlbmNlTm9tKyc8L2Rpdj4nCiAgICAgICAgKyhwZi5jb250YWN0VXJnZW5jZUxpZW4/JzxkaXYgY2xhc3M9InVyZ2VuY2UtbGllbiI+JytwZi5jb250YWN0VXJnZW5jZUxpZW4rJzwvZGl2Pic6JycpCiAgICAgICAgKyc8ZGl2IGNsYXNzPSJ1cmdlbmNlLXRlbCI+XHVkODNkXHVkY2RlICcrcGYuY29udGFjdFVyZ2VuY2VUZWwrJzwvZGl2PicKICAgICAgKyc8L2Rpdj4nCiAgICArJzwvZGl2Pic7CiAgfSBlbHNlIHsgdXcuaW5uZXJIVE1MID0gJyc7IH0KCiAgLy8gQ29udHJhdCBSTwogIHZhciBjb250cmF0Um93cyA9IFtdOwogIGlmKF9lbXAudHlwZUNvbnRyYXQpIGNvbnRyYXRSb3dzLnB1c2goe2ljb246J1x1ZDgzZFx1ZGNjNCcsIGxhYmVsOidUeXBlJywgdmFsOl9lbXAudHlwZUNvbnRyYXR9KTsKICBpZihfZW1wLmRhdGVFbnRyZWUpIGNvbnRyYXRSb3dzLnB1c2goe2ljb246J1x1ZDgzZFx1ZGNjNScsIGxhYmVsOidEYXRlIGVudHJcdTAwZTllJywgdmFsOmZtdERhdGUoX2VtcC5kYXRlRW50cmVlKX0pOwogIGlmKF9lbXAuaGV1cmVzSGViZG8pIGNvbnRyYXRSb3dzLnB1c2goe2ljb246J1x1MjNmMCcsIGxhYmVsOidIb3JhaXJlJywgdmFsOl9lbXAuaGV1cmVzSGViZG8rJ2ggLyBzZW1haW5lJ30pOwogIGlmKF9lbXAuY2F0ZWdvcmllUG9zdGUpIGNvbnRyYXRSb3dzLnB1c2goe2ljb246J1x1ZDgzZFx1ZGNiYycsIGxhYmVsOidDYXRcdTAwZTlnb3JpZScsIHZhbDpjYXBpdGFsaXplKF9lbXAuY2F0ZWdvcmllUG9zdGUpfSk7CiAgaWYoX2VtcC5jY24pIGNvbnRyYXRSb3dzLnB1c2goe2ljb246J1x1ZDgzZFx1ZGNjYicsIGxhYmVsOidDb252ZW50aW9uJywgdmFsOl9lbXAuY2NufSk7CiAgaWYoX2VtcC5wZXJpb2RlRXNzYWkgJiYgX2VtcC5wZXJpb2RlRXNzYWkuYWN0aXZlKSBjb250cmF0Um93cy5wdXNoKHtpY29uOidcdTI2YTBcdWZlMGYnLCBsYWJlbDonUFx1MDBlOXJpb2RlIGVzc2FpJywgdmFsOidFbiBjb3Vycyd9KTsKICB2YXIgY2IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udHJhdC1ib2R5Jyk7CiAgaWYoY29udHJhdFJvd3MubGVuZ3RoKXsKICAgIGNiLmlubmVySFRNTCA9IGNvbnRyYXRSb3dzLm1hcChmdW5jdGlvbihyKXsKICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSJpbmZvLWxpbmUiPjxzcGFuIGNsYXNzPSJpbmZvLWxpbmUtaWNvbiI+JytyLmljb24rJzwvc3Bhbj48c3BhbiBjbGFzcz0iaW5mby1saW5lLWxhYmVsIj4nK3IubGFiZWwrJzwvc3Bhbj48c3BhbiBjbGFzcz0iaW5mby1saW5lLXZhbCI+JytyLnZhbCsnPC9zcGFuPjwvZGl2Pic7CiAgICB9KS5qb2luKCcnKTsKICB9IGVsc2UgewogICAgY2IuaW5uZXJIVE1MID0gJzxkaXYgY2xhc3M9ImVtcHR5Ij48ZGl2IGNsYXNzPSJlbXB0eS1pY29uIj5cdWQ4M2RcdWRjY2I8L2Rpdj48c3Bhbj5JbmZvcyBkZSBjb250cmF0IFx1MDBlMCByZW5zZWlnbmVyIHBhciB2b3RyZSBlbXBsb3lldXIuPC9zcGFuPjwvZGl2Pic7CiAgfQp9CgpmdW5jdGlvbiBzZXRWYWwoaWQsIHZhbCkgeyB2YXIgZWw9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOyBpZihlbCkgZWwudGV4dENvbnRlbnQ9dmFsOyB9CmZ1bmN0aW9uIHNldEVkaXRWYWwoaWQsIHZhbCwgcGxhY2Vob2xkZXIpIHsKICB2YXIgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7CiAgaWYoIWVsKSByZXR1cm47CiAgaWYodmFsKSB7CiAgICBlbC50ZXh0Q29udGVudCA9IHZhbDsKICAgIGVsLnN0eWxlLmNvbG9yID0gJ3ZhcigtLXRleHQpJzsKICB9IGVsc2UgewogICAgZWwudGV4dENvbnRlbnQgPSBwbGFjZWhvbGRlcnx8J1x1MjAxNCc7CiAgICBlbC5zdHlsZS5jb2xvciA9ICd2YXIoLS1tdXRlZCknOwogIH0KfQoKZnVuY3Rpb24gZWRpdEZpZWxkKGVsLCBmaWVsZEtleSkgewogIHZhciBjdXJyZW50VmFsID0gX3Byb2ZpbEZpZWxkc1tmaWVsZEtleV0gfHwgJyc7CiAgdmFyIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKICBpbnB1dC5jbGFzc05hbWUgPSAncHJvZmlsLWlucHV0JzsKICBpbnB1dC52YWx1ZSA9IGN1cnJlbnRWYWw7CiAgaW5wdXQucGxhY2Vob2xkZXIgPSBlbC5nZXRBdHRyaWJ1dGUoJ3RpdGxlJykgfHwgJ1NhaXNpci4uLic7CiAgZWwucmVwbGFjZVdpdGgoaW5wdXQpOwogIGlucHV0LmZvY3VzKCk7CiAgaW5wdXQuc2VsZWN0KCk7CgogIGZ1bmN0aW9uIHNhdmUoKSB7CiAgICB2YXIgbmV3VmFsID0gaW5wdXQudmFsdWUudHJpbSgpOwogICAgX3Byb2ZpbEVkaXRzW2ZpZWxkS2V5XSA9IG5ld1ZhbDsKICAgIF9wcm9maWxGaWVsZHNbZmllbGRLZXldID0gbmV3VmFsOwogICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgZGl2LmlkID0gZWwuaWQ7CiAgICBkaXYuY2xhc3NOYW1lID0gZWwuY2xhc3NOYW1lOwogICAgZGl2LnNldEF0dHJpYnV0ZSgnb25jbGljaycsIGVsLmdldEF0dHJpYnV0ZSgnb25jbGljaycpKTsKICAgIGRpdi5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgZWwuZ2V0QXR0cmlidXRlKCd0aXRsZScpKTsKICAgIGRpdi5zdHlsZS5jb2xvciA9IG5ld1ZhbCA/ICd2YXIoLS10ZXh0KScgOiAndmFyKC0tbXV0ZWQpJzsKICAgIGlmKGZpZWxkS2V5PT09J2liYW4nICYmIG5ld1ZhbCkgZGl2LnRleHRDb250ZW50ID0gbWFza0liYW4obmV3VmFsKTsKICAgIGVsc2UgZGl2LnRleHRDb250ZW50ID0gbmV3VmFsIHx8IChlbC5nZXRBdHRyaWJ1dGUoJ3RpdGxlJyl8fCdcdTIwMTQnKTsKICAgIGlucHV0LnJlcGxhY2VXaXRoKGRpdik7CiAgICAvLyBSw6lhdHRhY2hlciBsZSBldmVudCBvbmNsaWNrCiAgICBkaXYuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpeyBlZGl0RmllbGQoZGl2LCBmaWVsZEtleSk7IH0pOwogICAgLy8gQWZmaWNoZXIgYm91dG9uIHNhdmUKICAgIGlmKE9iamVjdC5rZXlzKF9wcm9maWxFZGl0cykubGVuZ3RoID4gMCl7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG4tc2F2ZS1wcm9maWwnKS5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7CiAgICB9CiAgfQogIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBzYXZlKTsKICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24oZSl7IGlmKGUua2V5PT09J0VudGVyJykgaW5wdXQuYmx1cigpOyBpZihlLmtleT09PSdFc2NhcGUnKXsgaW5wdXQudmFsdWU9Y3VycmVudFZhbDsgaW5wdXQuYmx1cigpOyB9IH0pOwp9CndpbmRvdy5lZGl0RmllbGQgPSBlZGl0RmllbGQ7Cgphc3luYyBmdW5jdGlvbiBzYXZlUHJvZmlsKCkgewogIGlmKCFPYmplY3Qua2V5cyhfcHJvZmlsRWRpdHMpLmxlbmd0aCkgcmV0dXJuOwogIHZhciBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRuLXNhdmUtcHJvZmlsJyk7CiAgYnRuLnRleHRDb250ZW50ID0gJ1x1MjNmMyBFbnJlZ2lzdHJlbWVudC4uLic7CiAgYnRuLmRpc2FibGVkID0gdHJ1ZTsKICB0cnkgewogICAgLy8gRnVzaW9ubmVyIGF2ZWMgZG9ubsOpZXMgZXhpc3RhbnRlcwogICAgdmFyIHRvU2F2ZSA9IE9iamVjdC5hc3NpZ24oe30sIF9wcm9maWxGaWVsZHMsIF9wcm9maWxFZGl0cywgewogICAgICBlbXBJZDogX2VtcElkLAogICAgICB1aWQ6IF91aWQsCiAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpCiAgICB9KTsKICAgIGF3YWl0IHdpbmRvdy5fc2V0RG9jRnMoJ3JoX2VtcGxveWVzX3B1YmxpY19wcm9maWwnLCBfdWlkKydfJytfZW1wSWQsIHRvU2F2ZSwge21lcmdlOnRydWV9KTsKICAgIC8vIEF1c3NpIG1ldHRyZSDDoCBqb3VyIGxlcyBjaGFtcHMgbm9uLXNlbnNpYmxlcyBzdXIgbGUgZG9jIHB1YmxpYwogICAgdmFyIHB1YmxpY1VwZGF0ZSA9IHt9OwogICAgaWYoX3Byb2ZpbEVkaXRzLnRlbGVwaG9uZSkgcHVibGljVXBkYXRlLnRlbGVwaG9uZSA9IF9wcm9maWxFZGl0cy50ZWxlcGhvbmU7CiAgICBpZihfcHJvZmlsRWRpdHMuY29udGFjdFVyZ2VuY2VOb20pIHB1YmxpY1VwZGF0ZS5jb250YWN0VXJnZW5jZU5vbSA9IF9wcm9maWxFZGl0cy5jb250YWN0VXJnZW5jZU5vbTsKICAgIGlmKF9wcm9maWxFZGl0cy5jb250YWN0VXJnZW5jZVRlbCkgcHVibGljVXBkYXRlLmNvbnRhY3RVcmdlbmNlVGVsID0gX3Byb2ZpbEVkaXRzLmNvbnRhY3RVcmdlbmNlVGVsOwogICAgaWYoX3Byb2ZpbEVkaXRzLmNvbnRhY3RVcmdlbmNlTGllbikgcHVibGljVXBkYXRlLmNvbnRhY3RVcmdlbmNlTGllbiA9IF9wcm9maWxFZGl0cy5jb250YWN0VXJnZW5jZUxpZW47CiAgICBpZihPYmplY3Qua2V5cyhwdWJsaWNVcGRhdGUpLmxlbmd0aCl7CiAgICAgIE9iamVjdC5hc3NpZ24oX2VtcCwgcHVibGljVXBkYXRlKTsKICAgIH0KICAgIF9wcm9maWxFZGl0cyA9IHt9OwogICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTsKICAgIGJ0bi50ZXh0Q29udGVudCA9ICdcdWQ4M2RcdWRjYmUgRW5yZWdpc3RyZXIgbGVzIG1vZGlmaWNhdGlvbnMnOwogICAgYnRuLmRpc2FibGVkID0gZmFsc2U7CiAgICBzaG93VG9hc3QoJ1x1MjcwNSBQcm9maWwgZW5yZWdpc3RyXHUwMGU5Jywnb2snKTsKICAgIHJlbmRlclByb2ZpbCgpOyAvLyByZS1yZW5kZXIgdXJnZW5jZSBjYXJkCiAgfSBjYXRjaChlKSB7CiAgICBjb25zb2xlLmVycm9yKGUpOwogICAgc2hvd1RvYXN0KCdFcnJldXIgOiAnK2UubWVzc2FnZSwnZXJyJyk7CiAgICBidG4udGV4dENvbnRlbnQgPSAnXHVkODNkXHVkY2JlIEVucmVnaXN0cmVyIGxlcyBtb2RpZmljYXRpb25zJzsKICAgIGJ0bi5kaXNhYmxlZCA9IGZhbHNlOwogIH0KfQp3aW5kb3cuc2F2ZVByb2ZpbCA9IHNhdmVQcm9maWw7CgovKiDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKICAgRE9DVU1FTlRTCuKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkCAqLwovKiDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKICAgU09MREVTIETDiVRBSUxMw4lTIChvbmdsZXQgY29uZ8OpcykK4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQICovCmZ1bmN0aW9uIHJlbmRlclNvbGRlc0RldGFpbCgpIHsKICB2YXIgcyA9IF9zb2xkZXM7CiAgdmFyIGl0ZW1zID0gWwogICAge2ljb246J1x1ZDgzY1x1ZGZkNlx1ZmUwZicsIGxhYmVsOidDb25nXHUwMGU5cyBwYXlcdTAwZTlzJywgYWNxdWlzOnMuY3BBY3F1aXMsIHByaXM6cy5jcFByaXMsIHJlc3RhbnQ6cy5jcFJlc3RhbnQsIHVuaXQ6J2onLCBjb2xvcjondmFyKC0tZzMpJ30sCiAgICB7aWNvbjonXHUyM2YwJywgbGFiZWw6J1JUVCcsIGFjcXVpczpzLnJ0dEJhc2UsIHByaXM6cy5ydHRQcmlzLCByZXN0YW50OnMucnR0UmVzdGFudCwgdW5pdDonaicsIGNvbG9yOid2YXIoLS1ibHVlKSd9LAogICAge2ljb246J1x1ZDgzZFx1ZGQwNCcsIGxhYmVsOidSXHUwMGU5Y3VwXHUwMGU5cmF0aW9uJywgYWNxdWlzOnMucmVjdXBSZXN0YW50LCBwcmlzOjAsIHJlc3RhbnQ6cy5yZWN1cFJlc3RhbnQsIHVuaXQ6J2gnLCBjb2xvcjondmFyKC0tdGVhbCknfSwKICBdOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb2xkZXMtZGV0YWlsJykuaW5uZXJIVE1MID0gaXRlbXMubWFwKGZ1bmN0aW9uKGl0KXsKICAgIHZhciBwY3QgPSBpdC5hY3F1aXM+MCA/IE1hdGgubWluKGl0LnByaXMvaXQuYWNxdWlzKjEwMCwxMDApLnRvRml4ZWQoMCkgOiAwOwogICAgcmV0dXJuICc8ZGl2IHN0eWxlPSJtYXJnaW4tYm90dG9tOjEycHg7cGFkZGluZzoxMHB4IDEycHg7YmFja2dyb3VuZDojZjlmYWZiO2JvcmRlci1yYWRpdXM6MTBweDtib3JkZXI6MXB4IHNvbGlkIHZhcigtLWJvcmRlcikiPicKICAgICAgKyc8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW47YWxpZ24taXRlbXM6Y2VudGVyO21hcmdpbi1ib3R0b206NnB4Ij4nCiAgICAgICAgKyc8c3BhbiBzdHlsZT0iZm9udC1zaXplOjEycHg7Zm9udC13ZWlnaHQ6NzAwIj4nK2l0Lmljb24rJyAnK2l0LmxhYmVsKyc8L3NwYW4+JwogICAgICAgICsnPHNwYW4gc3R5bGU9ImZvbnQtc2l6ZToxNnB4O2ZvbnQtd2VpZ2h0OjgwMDtjb2xvcjonK2l0LmNvbG9yKyciPicraXQucmVzdGFudC50b0ZpeGVkKDEpKyc8c3BhbiBzdHlsZT0iZm9udC1zaXplOjEwcHg7Zm9udC13ZWlnaHQ6NjAwIj4gJytpdC51bml0Kyc8L3NwYW4+PC9zcGFuPicKICAgICAgKyc8L2Rpdj4nCiAgICAgICsnPGRpdiBzdHlsZT0iaGVpZ2h0OjZweDtiYWNrZ3JvdW5kOiNlNWU3ZWI7Ym9yZGVyLXJhZGl1czo5OXB4O292ZXJmbG93OmhpZGRlbjttYXJnaW4tYm90dG9tOjVweCI+JwogICAgICAgICsnPGRpdiBzdHlsZT0iaGVpZ2h0OjEwMCU7d2lkdGg6JytwY3QrJyU7YmFja2dyb3VuZDonK2l0LmNvbG9yKyc7Ym9yZGVyLXJhZGl1czo5OXB4O3RyYW5zaXRpb246d2lkdGggLjVzIGVhc2UiPjwvZGl2PicKICAgICAgKyc8L2Rpdj4nCiAgICAgICsnPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO2ZvbnQtc2l6ZToxMHB4O2NvbG9yOnZhcigtLW11dGVkKSI+JwogICAgICAgICsnPHNwYW4+JytpdC5wcmlzLnRvRml4ZWQoMSkrJyAnK2l0LnVuaXQrJyBwcmlzPC9zcGFuPicKICAgICAgICArJzxzcGFuPicraXQuYWNxdWlzLnRvRml4ZWQoMSkrJyAnK2l0LnVuaXQrJyBhbGxvdVx1MDBlOXM8L3NwYW4+JwogICAgICArJzwvZGl2PicKICAgICsnPC9kaXY+JzsKICB9KS5qb2luKCcnKTsKfQoKLyog4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCiAgIFRZUEUgR1JJRCAoY29uZ8OpcykK4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQICovCmZ1bmN0aW9uIHJlbmRlclR5cGVHcmlkKCkgewogIHZhciB0eXBlcyA9IFsKICAgIHtrOidjcCcsICAgICAgICAgIHN1YjogX3NvbGRlcy5jcFJlc3RhbnQudG9GaXhlZCgxKSsnaiBkaXNwb25pYmxlcyd9LAogICAge2s6J3J0dCcsICAgICAgICAgc3ViOiBfc29sZGVzLnJ0dFJlc3RhbnQudG9GaXhlZCgxKSsnaiBkaXNwb25pYmxlcyd9LAogICAge2s6J3JlY3VwZXJhdGlvbicsc3ViOihfc29sZGVzLnJlY3VwUmVzdGFudHx8MCkrJ2ggZGlzcG9uaWJsZXMnfSwKICAgIHtrOidjc3MnLCAgICAgICAgIHN1YjonTm9uIGRcdTAwZTljb21wdFx1MDBlOSBkdSBzb2xkZSd9LAogICAge2s6J2V2ZW5lbWVudCcsICAgc3ViOidEdXJcdTAwZTllcyBsXHUwMGU5Z2FsZXMnfSwKICAgIHtrOidtYWxhZGllJywgICAgIHN1YjonQXJyXHUwMGVhdCBtXHUwMGU5ZGljYWwnfSwKICAgIHtrOidmb3JtYXRpb24nLCAgIHN1YjonRm9ybWF0aW9uIHByb2Zlc3Npb25uZWxsZSd9LAogIF07CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3R5cGUtZ3JpZCcpLmlubmVySFRNTCA9IHR5cGVzLm1hcChmdW5jdGlvbih0KSB7CiAgICByZXR1cm4gJzxidXR0b24gY2xhc3M9InRiICcrKChfc2VsVHlwZT09PXQuayk/J3NlbCc6JycpKyciIG9uY2xpY2s9InNlbFR5cGUoXCcnK3QuaysnXCcpIj4nCiAgICAgICsnPGRpdiBjbGFzcz0idGItaWNvbiI+JytJQ09OU1t0LmtdKyc8L2Rpdj4nCiAgICAgICsnPHNwYW4gY2xhc3M9InRiLWxibCI+JytMQUJFTFNbdC5rXSsnPC9zcGFuPicKICAgICAgKyc8c3BhbiBjbGFzcz0idGItc3ViIj4nK3Quc3ViKyc8L3NwYW4+JwogICAgICArJzwvYnV0dG9uPic7CiAgfSkuam9pbignJyk7Cn0KCmZ1bmN0aW9uIHNldEZpbHRlcihidG4sIGYpIHsKICBfZGVtRmlsdGVyID0gZjsKICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZnRhYicpLmZvckVhY2goZnVuY3Rpb24oYikgeyBiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOyB9KTsKICBidG4uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgcmVuZGVyRGVtYW5kZXMoKTsKfQp3aW5kb3cuc2V0RmlsdGVyID0gc2V0RmlsdGVyOwoKZnVuY3Rpb24gcmVuZGVyRGVtYW5kZXMoKSB7CiAgdmFyIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlbS1saXN0Jyk7CiAgdmFyIGNudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZW0tY291bnQnKTsKICB2YXIgbGlzdCA9IF9kZW1GaWx0ZXIgPT09ICdhbGwnID8gX2RlbWFuZGVzIDogX2RlbWFuZGVzLmZpbHRlcihmdW5jdGlvbihkKSB7IHJldHVybiBkLnN0YXR1dCA9PT0gX2RlbUZpbHRlcjsgfSk7CiAgY250LnRleHRDb250ZW50ID0gX2RlbWFuZGVzLmxlbmd0aCsnIGRlbWFuZGUnKyhfZGVtYW5kZXMubGVuZ3RoPjE/J3MnOicnKTsKICBpZiAoIWxpc3QubGVuZ3RoKSB7IGVsLmlubmVySFRNTD0nPGRpdiBjbGFzcz0iZW1wdHkiPjxkaXYgY2xhc3M9ImVtcHR5LWljb24iPlx1ZDgzZFx1ZGNjYjwvZGl2PkF1Y3VuZSBkZW1hbmRlLjwvZGl2Pic7IHJldHVybjsgfQogIGVsLmlubmVySFRNTCA9IGxpc3QubWFwKGZ1bmN0aW9uKGQpeyByZXR1cm4gZGVtSXRlbUh0bWwoZCk7IH0pLmpvaW4oJycpOwp9CgpmdW5jdGlvbiBkZW1JdGVtSHRtbChkKSB7CiAgdmFyIGRiID0gZC5kYXRlRGVidXQgPyBuZXcgRGF0ZShkLmRhdGVEZWJ1dCsnVDEyOjAwOjAwJykudG9Mb2NhbGVEYXRlU3RyaW5nKCdmci1GUicse2RheTonbnVtZXJpYycsbW9udGg6J3Nob3J0Jyx5ZWFyOidudW1lcmljJ30pIDogJz8nOwogIHZhciBkZSA9IChkLmRhdGVGaW4gJiYgZC5kYXRlRmluIT09ZC5kYXRlRGVidXQpID8gJyBcdTIxOTIgJytuZXcgRGF0ZShkLmRhdGVGaW4rJ1QxMjowMDowMCcpLnRvTG9jYWxlRGF0ZVN0cmluZygnZnItRlInLHtkYXk6J251bWVyaWMnLG1vbnRoOidzaG9ydCd9KSA6ICcnOwogIHZhciBiVHh0ID0ge3BlbmRpbmc6J1x1MjNmMyBFbiBhdHRlbnRlJyxhcHByb3ZlZDonXHUyNzA1IEFwcHJvdXZcdTAwZTllJyxyZWZ1c2VkOidcdTI3NGMgUmVmdXNcdTAwZTllJyxjYW5jZWxsZWQ6J1x1ZDgzZFx1ZGVhYiBBbm51bFx1MDBlOWUnfVtkLnN0YXR1dF0gfHwgZC5zdGF0dXQ7CiAgcmV0dXJuICc8ZGl2IGNsYXNzPSJkZW0taXRlbSI+JwogICAgKyc8ZGl2IGNsYXNzPSJkZW0taWNvIiBzdHlsZT0iYmFja2dyb3VuZDonKyhDT0xPUlNbZC50eXBlXXx8JyM2YjcyODAnKSsnMjIiPicrKElDT05TW2QudHlwZV18fCdcdWQ4M2RcdWRjY2InKSsnPC9kaXY+JwogICAgKyc8ZGl2IGNsYXNzPSJkZW0tYm9keSI+JwogICAgICArJzxkaXYgY2xhc3M9ImRlbS1uYW1lIj4nKyhMQUJFTFNbZC50eXBlXXx8ZC50eXBlKSsnIDxzdHJvbmcgc3R5bGU9ImNvbG9yOicrKENPTE9SU1tkLnR5cGVdfHwndmFyKC0tZzMpJykrJyI+JysoZC5uYkpvdXJzfHwwKSsnajwvc3Ryb25nPjwvZGl2PicKICAgICAgKyc8ZGl2IGNsYXNzPSJkZW0tZGF0ZXMiPicrZGIrZGUrJzwvZGl2PicKICAgICAgKyhkLm1vdGlmPyc8ZGl2IGNsYXNzPSJkZW0tbW90aWYiPicrZC5tb3RpZisnPC9kaXY+JzonJykKICAgICAgKyhkLm1vdGlmUmVmdXM/JzxkaXYgY2xhc3M9ImRlbS1yZWZ1cyI+TW90aWYgZHUgcmVmdXMgOiAnK2QubW90aWZSZWZ1cysnPC9kaXY+JzonJykKICAgICAgKyc8c3BhbiBjbGFzcz0iYmFkZ2UgYmFkZ2UtJysoZC5zdGF0dXR8fCdwZW5kaW5nJykrJyI+JytiVHh0Kyc8L3NwYW4+JwogICAgKyc8L2Rpdj4nCiAgKyc8L2Rpdj4nOwp9CgovKiDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKICAgUExBTk5JTkcgJiBIT1JBSVJFUwrilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAgKi8KZnVuY3Rpb24gcmVuZGVyQ2FsKCkgewogIHZhciB5ID0gX2NhbE1vbnRoLmdldEZ1bGxZZWFyKCksIG0gPSBfY2FsTW9udGguZ2V0TW9udGgoKTsKICB2YXIgbmIgPSBuZXcgRGF0ZSh5LG0rMSwwKS5nZXREYXRlKCk7CiAgdmFyIGZpcnN0RG93ID0gKG5ldyBEYXRlKHksbSwxKS5nZXREYXkoKSs2KSU3OwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYWwtdGl0bGUnKS50ZXh0Q29udGVudCA9IG5ldyBEYXRlKHksbSwxKS50b0xvY2FsZURhdGVTdHJpbmcoJ2ZyLUZSJyx7bW9udGg6J2xvbmcnLHllYXI6J251bWVyaWMnfSk7CiAgdmFyIGhvcmFpcmVzID0gKF9wYXJhbXMgJiYgX3BhcmFtcy5ob3JhaXJlcykgfHwgewogICAgbHVuZGk6e2FjdGlmOnRydWV9LG1hcmRpOnthY3RpZjp0cnVlfSxtZXJjcmVkaTp7YWN0aWY6dHJ1ZX0sCiAgICBqZXVkaTp7YWN0aWY6dHJ1ZX0sdmVuZHJlZGk6e2FjdGlmOnRydWV9LHNhbWVkaTp7YWN0aWY6ZmFsc2V9LGRpbWFuY2hlOnthY3RpZjpmYWxzZX0KICB9OwogIHZhciBhYnNNYXAgPSB7fTsKICBfZGVtYW5kZXMuZmlsdGVyKGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuc3RhdHV0PT09J2FwcHJvdmVkJ3x8ZC5zdGF0dXQ9PT0ncGVuZGluZyc7IH0pLmZvckVhY2goZnVuY3Rpb24oZCkgewogICAgaWYgKCFkLmRhdGVEZWJ1dCkgcmV0dXJuOwogICAgdmFyIGN1ciA9IG5ldyBEYXRlKGQuZGF0ZURlYnV0KydUMTI6MDA6MDAnKTsKICAgIHZhciBmaW4gPSBuZXcgRGF0ZSgoZC5kYXRlRmlufHxkLmRhdGVEZWJ1dCkrJ1QxMjowMDowMCcpOwogICAgd2hpbGUgKGN1ciA8PSBmaW4pIHsKICAgICAgaWYgKGN1ci5nZXRGdWxsWWVhcigpPT09eSAmJiBjdXIuZ2V0TW9udGgoKT09PW0pCiAgICAgICAgYWJzTWFwW2N1ci5nZXREYXRlKCldID0ge3R5cGU6ZC50eXBlLCBwZW5kaW5nOmQuc3RhdHV0PT09J3BlbmRpbmcnfTsKICAgICAgY3VyLnNldERhdGUoY3VyLmdldERhdGUoKSsxKTsKICAgIH0KICB9KTsKICB2YXIgdG9kYXkgPSBuZXcgRGF0ZSgpOwogIHZhciBoZHJzID0gWydMJywnTScsJ00nLCdKJywnVicsJ1MnLCdEJ107CiAgdmFyIGNhbEh0bWwgPSAnJzsKICBoZHJzLmZvckVhY2goZnVuY3Rpb24oaCkgeyBjYWxIdG1sICs9ICc8ZGl2IGNsYXNzPSJjYWwtaGRyIj4nK2grJzwvZGl2Pic7IH0pOwogIGZvciAodmFyIGk9MDsgaTxmaXJzdERvdzsgaSsrKSBjYWxIdG1sICs9ICc8ZGl2PjwvZGl2Pic7CiAgdmFyIHVzZWRUeXBlcyA9IHt9OwogIGZvciAodmFyIGQ9MTsgZDw9bmI7IGQrKykgewogICAgdmFyIGRvdyA9IChmaXJzdERvdytkLTEpJTc7CiAgICB2YXIgam91cktleSA9IERPV19LRVlbZG93XTsKICAgIHZhciBkYXRlU3RyID0geSsnLScrU3RyaW5nKG0rMSkucGFkU3RhcnQoMiwnMCcpKyctJytTdHJpbmcoZCkucGFkU3RhcnQoMiwnMCcpOwogICAgdmFyIGl0ZW1zID0gX3BsYW5uaW5nQ2FjaGVbZGF0ZVN0cl0gfHwgbnVsbDsKICAgIHZhciBoYXNQbGFuID0gaXRlbXMgJiYgaXRlbXMubGVuZ3RoID4gMDsKICAgIHZhciBhYnMgPSBhYnNNYXBbZF07CiAgICB2YXIgaXNUb2RheSA9IGQ9PT10b2RheS5nZXREYXRlKCkgJiYgbT09PXRvZGF5LmdldE1vbnRoKCkgJiYgeT09PXRvZGF5LmdldEZ1bGxZZWFyKCk7CiAgICB2YXIgYmc9JycsIGNvbD0nJywgdHRsPScnLCBjbHM9J2NhbC1kYXknLCBleHRyYT0nJzsKICAgIGlmIChpc1RvZGF5KSBjbHMgKz0gJyB0b2RheSc7CiAgICBpZiAoYWJzKSB7CiAgICAgIGJnID0gYWJzLnBlbmRpbmcgPyAoQ09MT1JTW2Ficy50eXBlXSsnY2MnKSA6IENPTE9SU1thYnMudHlwZV07CiAgICAgIGNvbCA9ICd3aGl0ZSc7CiAgICAgIHR0bCA9IExBQkVMU1thYnMudHlwZV0rKGFicy5wZW5kaW5nPycgKGVuIGF0dGVudGUpJzonJyk7CiAgICAgIGNscyArPSAnIGFicycrKGFicy5wZW5kaW5nPycgYWJzLXBlbmRpbmcnOicnKTsKICAgICAgdXNlZFR5cGVzW2Ficy50eXBlXSA9IHRydWU7CiAgICAgIGlmIChoYXNQbGFuKSBleHRyYSA9ICc8ZGl2IHN0eWxlPSJmb250LXNpemU6N3B4O29wYWNpdHk6MC43O2xpbmUtaGVpZ2h0OjE7bWFyZ2luLXRvcDoycHgiPicrZ2V0UGxhZ2VzU3RyKGl0ZW1zWzBdKSsnPC9kaXY+JzsKICAgIH0gZWxzZSBpZiAoaGFzUGxhbikgewogICAgICB2YXIgdG90YWxIID0gaXRlbXMucmVkdWNlKGZ1bmN0aW9uKHMsaXQpIHsgcmV0dXJuIHMgKyBpdGVtSChpdCk7IH0sIDApOwogICAgICBiZyA9ICdyZ2JhKDUsMTUwLDEwNSwwLjEyKSc7IGNvbCA9ICcjMDQ3ODU3JzsgY2xzICs9ICcgd29yayc7CiAgICAgIHR0bCA9IGdldFBsYWdlc1N0cihpdGVtc1swXSkgKyAnICgnICsgdG90YWxILnRvRml4ZWQoMSkgKyAnaCknOwogICAgICBleHRyYSA9ICc8ZGl2IHN0eWxlPSJmb250LXNpemU6Ny41cHg7Zm9udC13ZWlnaHQ6NzAwO2xpbmUtaGVpZ2h0OjEuMjttYXJnaW4tdG9wOjJweDtvcGFjaXR5OjAuODUiPicrZ2V0UGxhZ2VzU3RyKGl0ZW1zWzBdKSsnPC9kaXY+JzsKICAgICAgdXNlZFR5cGVzWydfX3RyYXZhaWwnXSA9IHRydWU7CiAgICB9IGVsc2UgaWYgKGhvcmFpcmVzW2pvdXJLZXldICYmIGhvcmFpcmVzW2pvdXJLZXldLmFjdGlmKSB7CiAgICAgIGJnID0gJ3JnYmEoNSwxNTAsMTA1LDAuMDYpJzsgY29sID0gJyM2ZWU3YjcnOyBjbHMgKz0gJyB3b3JrIHdvcmstZ2VuZXJpYyc7CiAgICAgIHZhciBoID0gaG9yYWlyZXNbam91cktleV07CiAgICAgIHR0bCA9ICdIb3JhaXJlIGhhYml0dWVsJysoaC5kZWImJmguZmluPycgXHUwMGI3ICcraC5kZWIrJyBcdTIwMTMgJytoLmZpbjonJyk7CiAgICB9IGVsc2UgewogICAgICBiZyA9ICd0cmFuc3BhcmVudCc7IGNvbCA9ICcjZDFkNWRiJzsgY2xzICs9ICcgb2ZmJzsKICAgIH0KICAgIHZhciBzdHlsZSA9ICdiYWNrZ3JvdW5kOicrYmcrJztjb2xvcjonK2NvbCsnOyc7CiAgICBpZiAoaXNUb2RheSkgc3R5bGUgKz0gJ291dGxpbmU6MnB4IHNvbGlkICMwNTk2Njk7b3V0bGluZS1vZmZzZXQ6LTJweDsnOwogICAgY2FsSHRtbCArPSAnPGRpdiBjbGFzcz0iJytjbHMrJyIgc3R5bGU9Iicrc3R5bGUrJyIgdGl0bGU9IicrdHRsKyciPicrZCtleHRyYSsnPC9kaXY+JzsKICB9CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbC1ncmlkJykuaW5uZXJIVE1MID0gY2FsSHRtbDsKICB2YXIgbGVnSHRtbCA9ICcnOwogIGlmIChPYmplY3Qua2V5cyhfcGxhbm5pbmdDYWNoZSkubGVuZ3RoID4gMCkKICAgIGxlZ0h0bWwgKz0gJzxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjVweDtmb250LXNpemU6MTBweDtjb2xvcjp2YXIoLS1tdXRlZCkiPjxkaXYgc3R5bGU9IndpZHRoOjlweDtoZWlnaHQ6OXB4O2JvcmRlci1yYWRpdXM6MnB4O2JhY2tncm91bmQ6cmdiYSg1LDE1MCwxMDUsMC40KSI+PC9kaXY+UGxhbmlmaVx1MDBlOTwvZGl2Pic7CiAgZWxzZQogICAgbGVnSHRtbCArPSAnPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6NXB4O2ZvbnQtc2l6ZToxMHB4O2NvbG9yOnZhcigtLW11dGVkKSI+PGRpdiBzdHlsZT0id2lkdGg6OXB4O2hlaWdodDo5cHg7Ym9yZGVyLXJhZGl1czoycHg7YmFja2dyb3VuZDpyZ2JhKDUsMTUwLDEwNSwwLjE1KSI+PC9kaXY+SG9yYWlyZSBoYWJpdHVlbDwvZGl2Pic7CiAgbGVnSHRtbCArPSBPYmplY3Qua2V5cyh1c2VkVHlwZXMpLmZpbHRlcihmdW5jdGlvbih0KXsgcmV0dXJuIHQhPT0nX190cmF2YWlsJzsgfSkubWFwKGZ1bmN0aW9uKHQpIHsKICAgIHJldHVybiAnPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6NXB4O2ZvbnQtc2l6ZToxMHB4O2NvbG9yOnZhcigtLW11dGVkKSI+PGRpdiBzdHlsZT0id2lkdGg6OXB4O2hlaWdodDo5cHg7Ym9yZGVyLXJhZGl1czoycHg7YmFja2dyb3VuZDonKyhDT0xPUlNbdF18fCcjNmI3MjgwJykrJyI+PC9kaXY+JysoTEFCRUxTW3RdfHx0KSsnPC9kaXY+JzsKICB9KS5qb2luKCcnKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FsLWxlZ2VuZCcpLmlubmVySFRNTCA9IGxlZ0h0bWw7Cn0KCmZ1bmN0aW9uIHJlbmRlckhvcmFpcmVzKCkgewogIHZhciBob3JhaXJlcyA9IChfcGFyYW1zICYmIF9wYXJhbXMuaG9yYWlyZXMpIHx8IHt9OwogIHZhciBqb3Vyc0FjdGlmcyA9IERPV19LRVkuZmlsdGVyKGZ1bmN0aW9uKGopeyByZXR1cm4gaG9yYWlyZXNbal0gJiYgaG9yYWlyZXNbal0uYWN0aWY7IH0pOwogIHZhciBjYXJkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hvcmFpcmVzLWNhcmQnKTsKICBpZigham91cnNBY3RpZnMubGVuZ3RoKXsgY2FyZC5zdHlsZS5kaXNwbGF5PSdub25lJzsgcmV0dXJuOyB9CiAgY2FyZC5zdHlsZS5kaXNwbGF5PScnOwogIHZhciBqTGFiZWxzID0ge2x1bmRpOidMdW5kaScsbWFyZGk6J01hcmRpJyxtZXJjcmVkaTonTWVyY3JlZGknLGpldWRpOidKZXVkaScsdmVuZHJlZGk6J1ZlbmRyZWRpJyxzYW1lZGk6J1NhbWVkaScsZGltYW5jaGU6J0RpbWFuY2hlJ307CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hvcmFpcmVzLWJvZHknKS5pbm5lckhUTUwgPSBqb3Vyc0FjdGlmcy5tYXAoZnVuY3Rpb24oail7CiAgICB2YXIgaCA9IGhvcmFpcmVzW2pdOwogICAgcmV0dXJuICc8ZGl2IGNsYXNzPSJpbmZvLWxpbmUiPicKICAgICAgKyc8c3BhbiBjbGFzcz0iaW5mby1saW5lLWljb24iPlx1ZDgzZFx1ZGNjNjwvc3Bhbj4nCiAgICAgICsnPHNwYW4gY2xhc3M9ImluZm8tbGluZS1sYWJlbCI+JytqTGFiZWxzW2pdKyc8L3NwYW4+JwogICAgICArJzxzcGFuIGNsYXNzPSJpbmZvLWxpbmUtdmFsIiBzdHlsZT0iZm9udC1zaXplOjEycHgiPicrKGguZGViJiZoLmZpbj9oLmRlYisnIFx1MjAxMyAnK2guZmluOidBY3RpZicpKyc8L3NwYW4+JwogICAgKyc8L2Rpdj4nOwogIH0pLmpvaW4oJycpOwp9CgovKiDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAKICAgRk9STVVMQUlSRSBDT05Hw4lTCuKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkCAqLwp2YXIgX2N1clN0ZXAgPSAxOwp2YXIgX2p1c3RpZkI2NCA9IG51bGw7CnZhciBfanVzdGlmTWV0YSA9IG51bGw7CgpmdW5jdGlvbiBvbkp1c3RpZkNoYW5nZShpbnB1dCkgewogIHZhciBmaWxlID0gaW5wdXQuZmlsZXNbMF07CiAgaWYgKCFmaWxlKSByZXR1cm47CiAgaWYgKGZpbGUuc2l6ZSA+IDUqMTAyNCoxMDI0KSB7IHNob3dUb2FzdCgnRmljaGllciB0cm9wIGxvdXJkIChtYXggNSBNbyknLCdlcnInKTsgcmV0dXJuOyB9CiAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uKGUpIHsKICAgIF9qdXN0aWZCNjQgPSBlLnRhcmdldC5yZXN1bHQ7CiAgICBfanVzdGlmTWV0YSA9IHsgbmFtZTogZmlsZS5uYW1lLCBzaXplOiBmaWxlLnNpemUsIHR5cGU6IGZpbGUudHlwZSB9OwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2p1c3RpZi1uYW1lJykudGV4dENvbnRlbnQgPSBmaWxlLm5hbWU7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanVzdGlmLXNpemUnKS50ZXh0Q29udGVudCA9IChmaWxlLnNpemUvMTAyNCkudG9GaXhlZCgwKSsnS28nOwogICAgdmFyIHByZXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanVzdGlmLXByZXZpZXcnKTsKICAgIHByZXYuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqdXN0aWYtZHJvcCcpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgfTsKICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKfQp3aW5kb3cub25KdXN0aWZDaGFuZ2UgPSBvbkp1c3RpZkNoYW5nZTsKCmZ1bmN0aW9uIGNsZWFySnVzdGlmKGUpIHsKICBpZiAoZSkgZS5zdG9wUHJvcGFnYXRpb24oKTsKICBfanVzdGlmQjY0ID0gbnVsbDsgX2p1c3RpZk1ldGEgPSBudWxsOwogIHZhciBpbnAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanVzdGlmLWlucHV0Jyk7CiAgaWYgKGlucCkgaW5wLnZhbHVlID0gJyc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2p1c3RpZi1wcmV2aWV3Jykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanVzdGlmLWRyb3AnKS5zdHlsZS5kaXNwbGF5ID0gJyc7Cn0Kd2luZG93LmNsZWFySnVzdGlmID0gY2xlYXJKdXN0aWY7CgpmdW5jdGlvbiBzZWxUeXBlKGspIHsKICBfc2VsVHlwZSA9IGs7CiAgcmVuZGVyVHlwZUdyaWQoKTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmV4dDEnKS5kaXNhYmxlZCA9IGZhbHNlOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdldmVuZW1lbnQtbG9pJykuY2xhc3NOYW1lID0gJ2FsZXJ0IGFsZXJ0LWJsdWUnKyhrPT09J2V2ZW5lbWVudCc/JyBzaG93JzonJyk7CiAgdmFyIGp3ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2p1c3RpZi13cmFwJyk7CiAgaWYgKGp3KSBqdy5zdHlsZS5kaXNwbGF5ID0gKGs9PT0nbWFsYWRpZScgfHwgaz09PSdmb3JtYXRpb24nKSA/ICcnIDogJ25vbmUnOwogIGNsZWFySnVzdGlmKCk7Cn0Kd2luZG93LnNlbFR5cGUgPSBzZWxUeXBlOwoKZnVuY3Rpb24gZ29TdGVwKG4pIHsKICBpZiAobj09PTIgJiYgIV9zZWxUeXBlKSByZXR1cm47CiAgaWYgKG49PT0zKSB7CiAgICB2YXIgZGViID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2YtZGViJykudmFsdWU7CiAgICBpZiAoIWRlYikgeyBzaG93VG9hc3QoJ1NcdTAwZTlsZWN0aW9ubmV6IHVuZSBkYXRlIGRlIGRcdTAwZTlidXQnLCdlcnInKTsgcmV0dXJuOyB9CiAgICBidWlsZFJlY2FwKCk7CiAgfQogIF9jdXJTdGVwID0gbjsKICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZm9ybS1zdGVwJykuZm9yRWFjaChmdW5jdGlvbihlKSB7IGUuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7IH0pOwogIHZhciBzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdCcrbik7CiAgaWYgKHN0KSBzdC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICBmb3IgKHZhciBpPTE7IGk8PTM7IGkrKykgewogICAgdmFyIGRkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3MnK2kpOwogICAgdmFyIGxsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NsJytpKTsKICAgIGlmIChkZCkgZGQuY2xhc3NOYW1lID0gJ3N0ZXAtZG90JysoaTxuPycgZG9uZSc6aT09PW4/JyBhY3RpdmUnOicnKTsKICAgIGlmIChsbCAmJiBpPDMpIGxsLmNsYXNzTmFtZSA9ICdzdGVwLWxpbmUnKyhpPG4/JyBkb25lJzonJyk7CiAgfQogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGVwLWxibCcpLnRleHRDb250ZW50ID0gJ1x1MDBjOXRhcGUgJytuKycgLyAzJzsKfQp3aW5kb3cuZ29TdGVwID0gZ29TdGVwOwoKZnVuY3Rpb24gam91cnNPdXZyZXMoZGViLCBmaW4pIHsKICBpZiAoIWRlYiB8fCAhZmluKSByZXR1cm4gMDsKICB2YXIgZCA9IG5ldyBEYXRlKGRlYisnVDEyOjAwOjAwJyksIGYgPSBuZXcgRGF0ZShmaW4rJ1QxMjowMDowMCcpLCBjID0gMDsKICB3aGlsZSAoZCA8PSBmKSB7IHZhciBkdyA9IGQuZ2V0RGF5KCk7IGlmIChkdyE9PTAgJiYgZHchPT02KSBjKys7IGQuc2V0RGF0ZShkLmdldERhdGUoKSsxKTsgfQogIHJldHVybiBjOwp9CgpmdW5jdGlvbiBvbkRhdGVDaGcoKSB7CiAgdmFyIGRlYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmLWRlYicpLnZhbHVlOwogIHZhciBmaW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZi1maW4nKS52YWx1ZTsKICBpZiAoZmluICYmIGZpbiA8IGRlYikgeyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZi1maW4nKS52YWx1ZSA9IGRlYjsgZmluID0gZGViOyB9CiAgdmFyIGphID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pvdXJzLWFsZXJ0Jyk7CiAgdmFyIHNhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvbGRlLWFsZXJ0Jyk7CiAgaWYgKCFkZWIpIHsgamEuY2xhc3NOYW1lPSdhbGVydCBhbGVydC1ncmVlbic7IHNhLmNsYXNzTmFtZT0nYWxlcnQgYWxlcnQtb3JhbmdlJzsgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25leHQyJykuZGlzYWJsZWQ9dHJ1ZTsgcmV0dXJuOyB9CiAgdmFyIGpvdXJzID0gam91cnNPdXZyZXMoZGViLCBmaW58fGRlYik7CiAgamEudGV4dENvbnRlbnQgPSAnXHVkODNkXHVkY2M1ICcram91cnMrJyBqb3VyJysoam91cnM+MT8ncyc6JycpKycgb3V2clx1MDBlOScrKGpvdXJzPjE/J3MnOicnKTsKICBqYS5jbGFzc05hbWUgPSAnYWxlcnQgYWxlcnQtZ3JlZW4gc2hvdyc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25leHQyJykuZGlzYWJsZWQgPSBmYWxzZTsKICB2YXIgc2sgPSBTT0xERV9LW19zZWxUeXBlXTsKICBpZiAoc2sgJiYgX3NvbGRlc1tza10gIT09IHVuZGVmaW5lZCkgewogICAgdmFyIHNvbGRlID0gcGFyc2VGbG9hdChfc29sZGVzW3NrXSkgfHwgMDsKICAgIGlmIChqb3VycyA+IHNvbGRlKSB7CiAgICAgIHNhLnRleHRDb250ZW50ID0gJ1x1MjZhMFx1ZmUwZiBTb2xkZSBpbnN1ZmZpc2FudCA6ICcrc29sZGUudG9GaXhlZCgxKSsoX3NlbFR5cGU9PT0ncmVjdXBlcmF0aW9uJz8naCc6J2onKSsnIGRpc3BvbmlibGVzLCAnK2pvdXJzKydqIGRlbWFuZFx1MDBlOXMnOwogICAgICBzYS5jbGFzc05hbWUgPSAnYWxlcnQgYWxlcnQtb3JhbmdlIHNob3cnOwogICAgfSBlbHNlIHNhLmNsYXNzTmFtZSA9ICdhbGVydCBhbGVydC1vcmFuZ2UnOwogIH0gZWxzZSBzYS5jbGFzc05hbWUgPSAnYWxlcnQgYWxlcnQtb3JhbmdlJzsKfQp3aW5kb3cub25EYXRlQ2hnID0gb25EYXRlQ2hnOwoKZnVuY3Rpb24gYnVpbGRSZWNhcCgpIHsKICB2YXIgZGViICAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2YtZGViJykudmFsdWU7CiAgdmFyIGZpbiAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmLWZpbicpLnZhbHVlIHx8IGRlYjsKICB2YXIgbW90aWYgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2YtbW90aWYnKS52YWx1ZS50cmltKCk7CiAgdmFyIGpvdXJzICA9IGpvdXJzT3V2cmVzKGRlYiwgZmluKTsKICB2YXIgZGViRm10ID0gbmV3IERhdGUoZGViKydUMTI6MDA6MDAnKS50b0xvY2FsZURhdGVTdHJpbmcoJ2ZyLUZSJyx7d2Vla2RheTonbG9uZycsZGF5OidudW1lcmljJyxtb250aDonbG9uZycseWVhcjonbnVtZXJpYyd9KTsKICB2YXIgZmluRm10ID0gbmV3IERhdGUoZmluKydUMTI6MDA6MDAnKS50b0xvY2FsZURhdGVTdHJpbmcoJ2ZyLUZSJyx7d2Vla2RheTonbG9uZycsZGF5OidudW1lcmljJyxtb250aDonbG9uZyd9KTsKICB2YXIgc2sgICAgID0gU09MREVfS1tfc2VsVHlwZV07CiAgdmFyIHNvbGRlICA9IChzayAhPT0gdW5kZWZpbmVkKSA/IChwYXJzZUZsb2F0KF9zb2xkZXNbc2tdKXx8MCkgOiBudWxsOwogIHZhciBhcHJlcyAgPSBzb2xkZSAhPT0gbnVsbCA/IE1hdGgubWF4KDAsIHNvbGRlLWpvdXJzKSA6IG51bGw7CiAgdmFyIHJ3ICAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZWNhcC13YXJuJyk7CiAgaWYgKHNvbGRlICE9PSBudWxsICYmIGpvdXJzID4gc29sZGUpIHsKICAgIHJ3LnRleHRDb250ZW50ID0gJ1x1MjZhMFx1ZmUwZiBTb2xkZSBpbnN1ZmZpc2FudCAoJytzb2xkZS50b0ZpeGVkKDEpKydqIGRpc3BvKS4gVm90cmUgZW1wbG95ZXVyIGVuIHNlcmEgaW5mb3JtXHUwMGU5Lic7CiAgICBydy5jbGFzc05hbWUgPSAnYWxlcnQgYWxlcnQtb3JhbmdlIHNob3cnOwogIH0gZWxzZSBydy5jbGFzc05hbWUgPSAnYWxlcnQgYWxlcnQtb3JhbmdlJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVjYXAnKS5pbm5lckhUTUwgPQogICAgJzxkaXYgY2xhc3M9InJlc3VtZS1yb3ciPjxzcGFuPlR5cGU8L3NwYW4+PHNwYW4+JytJQ09OU1tfc2VsVHlwZV0rJyAnK0xBQkVMU1tfc2VsVHlwZV0rJzwvc3Bhbj48L2Rpdj4nCiAgICArJzxkaXYgY2xhc3M9InJlc3VtZS1yb3ciPjxzcGFuPkR1PC9zcGFuPjxzcGFuPicrZGViRm10Kyc8L3NwYW4+PC9kaXY+JwogICAgKyc8ZGl2IGNsYXNzPSJyZXN1bWUtcm93Ij48c3Bhbj5BdTwvc3Bhbj48c3Bhbj4nK2ZpbkZtdCsnPC9zcGFuPjwvZGl2PicKICAgICsobW90aWY/JzxkaXYgY2xhc3M9InJlc3VtZS1yb3ciPjxzcGFuPk1vdGlmPC9zcGFuPjxzcGFuPicrbW90aWYrJzwvc3Bhbj48L2Rpdj4nOicnKQogICAgKyc8ZGl2IGNsYXNzPSJyZXN1bWUtcm93Ij48c3Bhbj5Ub3RhbDwvc3Bhbj48c3BhbiBzdHlsZT0iY29sb3I6dmFyKC0tZzMpIj4nK2pvdXJzKycgam91cicrKGpvdXJzPjE/J3MnOicnKSsnIG91dnJcdTAwZTknKyhqb3Vycz4xPydzJzonJykrJzwvc3Bhbj48L2Rpdj4nCiAgICArKGFwcmVzIT09bnVsbD8nPGRpdiBjbGFzcz0icmVzdW1lLXJvdyI+PHNwYW4+U29sZGUgYXByXHUwMGU4czwvc3Bhbj48c3BhbiBzdHlsZT0iY29sb3I6JysoYXByZXM+NT8ndmFyKC0tZzMpJzondmFyKC0tb3JhbmdlKScpKyciPicrYXByZXMudG9GaXhlZCgxKSsnajwvc3Bhbj48L2Rpdj4nOicnKQogICAgKyhfanVzdGlmQjY0Pyc8ZGl2IGNsYXNzPSJyZXN1bWUtcm93Ij48c3Bhbj5KdXN0aWZpY2F0aWY8L3NwYW4+PHNwYW4gc3R5bGU9ImNvbG9yOnZhcigtLWczKSI+XHVkODNkXHVkY2NlICcrKF9qdXN0aWZNZXRhP19qdXN0aWZNZXRhLm5hbWU6J0ZpY2hpZXIgam9pbnQnKSsnPC9zcGFuPjwvZGl2Pic6JycpOwp9Cgphc3luYyBmdW5jdGlvbiBzdWJtaXREZW1hbmRlKCkgewogIHZhciBkZWIgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmLWRlYicpLnZhbHVlOwogIHZhciBmaW4gICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmLWZpbicpLnZhbHVlIHx8IGRlYjsKICB2YXIgbW90aWYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZi1tb3RpZicpLnZhbHVlLnRyaW0oKTsKICB2YXIgam91cnMgPSBqb3Vyc091dnJlcyhkZWIsIGZpbik7CiAgdmFyIGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG4tc3VibWl0Jyk7CiAgYnRuLmRpc2FibGVkID0gdHJ1ZTsgYnRuLnRleHRDb250ZW50ID0gJ0Vudm9pXHUyMDI2JzsKICB2YXIgZGVtYW5kZURhdGEgPSB7CiAgICBlbXBJZDpfZW1wSWQsIHVpZDpfdWlkLCB0eXBlOl9zZWxUeXBlLCBkYXRlRGVidXQ6ZGViLCBkYXRlRmluOmZpbiwgbmJKb3Vyczpqb3VycywKICAgIHN0YXR1dDoncGVuZGluZycsIG1vdGlmOm1vdGlmfHxudWxsLAogICAgY3JlYXRlZEF0Om5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwgc291cmNlOidzYWxhcmllJywKICB9OwogIGlmIChfanVzdGlmQjY0ICYmIF9qdXN0aWZNZXRhKSB7CiAgICBkZW1hbmRlRGF0YS5qdXN0aWZpY2F0aWYgPSB7IGRhdGE6X2p1c3RpZkI2NCwgbmFtZTpfanVzdGlmTWV0YS5uYW1lLCBzaXplOl9qdXN0aWZNZXRhLnNpemUsIHR5cGU6X2p1c3RpZk1ldGEudHlwZSB9OwogIH0KICB0cnkgewogICAgYXdhaXQgd2luZG93Ll9hZGREb2MoWydyaF9jb25nZXMnLCBfdWlkLCAnZGVtYW5kZXMnXSwgZGVtYW5kZURhdGEpOwogICAgX2RlbWFuZGVzLnVuc2hpZnQoe2lkOid0bXBfJytEYXRlLm5vdygpLGVtcElkOl9lbXBJZCx0eXBlOl9zZWxUeXBlLGRhdGVEZWJ1dDpkZWIsZGF0ZUZpbjpmaW4sbmJKb3Vyczpqb3VycyxzdGF0dXQ6J3BlbmRpbmcnLG1vdGlmOm1vdGlmfHxudWxsLGNyZWF0ZWRBdDpuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCl9KTsKICAgIGNhbGNTb2xkZXMoKTsgcmVuZGVyU29sZGVzRmxvdHRhbnRzKCk7IHJlbmRlckRlbWFuZGVzKCk7IHJlbmRlckNhbCgpOyByZW5kZXJBY2N1ZWlsKCk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3QzJykuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICB2YXIgc3cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VjY2Vzcy13cmFwJyk7CiAgICBzdy5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOyBzdy5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VjY2Vzcy1zdWInKS50ZXh0Q29udGVudCA9ICdWb3RyZSBkZW1hbmRlIGRlICcram91cnMrJ2ogKCcrTEFCRUxTW19zZWxUeXBlXSsnKSBhIFx1MDBlOXRcdTAwZTkgdHJhbnNtaXNlLiBWb3RyZSBlbXBsb3lldXIgbGEgdHJhaXRlcmEgcHJvY2hhaW5lbWVudC4nOwogIH0gY2F0Y2goZSkgewogICAgY29uc29sZS5lcnJvcihlKTsgc2hvd1RvYXN0KCdFcnJldXIgOiAnK2UubWVzc2FnZSwgJ2VycicpOwogICAgYnRuLmRpc2FibGVkID0gZmFsc2U7IGJ0bi50ZXh0Q29udGVudCA9ICdcdTI3MDlcdWZlMGYgRW52b3llciBsYSBkZW1hbmRlJzsKICB9Cn0Kd2luZG93LnN1Ym1pdERlbWFuZGUgPSBzdWJtaXREZW1hbmRlOwoKZnVuY3Rpb24gcmVzZXRGb3JtKCkgewogIF9zZWxUeXBlID0gJyc7IF9jdXJTdGVwID0gMTsKICB2YXIgc3cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VjY2Vzcy13cmFwJyk7CiAgc3cuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgc3cuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmLWRlYicpLnZhbHVlID0gJyc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2YtZmluJykudmFsdWUgPSAnJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZi1tb3RpZicpLnZhbHVlID0gJyc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pvdXJzLWFsZXJ0JykuY2xhc3NOYW1lID0gJ2FsZXJ0IGFsZXJ0LWdyZWVuJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc29sZGUtYWxlcnQnKS5jbGFzc05hbWUgPSAnYWxlcnQgYWxlcnQtb3JhbmdlJzsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmV4dDEnKS5kaXNhYmxlZCA9IHRydWU7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25leHQyJykuZGlzYWJsZWQgPSB0cnVlOwogIGNsZWFySnVzdGlmKCk7CiAgdmFyIGp3ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2p1c3RpZi13cmFwJyk7CiAgaWYgKGp3KSBqdy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogIGdvU3RlcCgxKTsgcmVuZGVyVHlwZUdyaWQoKTsKfQp3aW5kb3cucmVzZXRGb3JtID0gcmVzZXRGb3JtOwoKLyog4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCiAgIE5BVklHQVRJT04gT05HTEVUUwrilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAgKi8KZnVuY3Rpb24gc2hvd1RhYihpZCwgYnRuKSB7CiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRhYi1zZWN0aW9uJykuZm9yRWFjaChmdW5jdGlvbihzKXsgcy5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsgfSk7CiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnRuYXYnKS5mb3JFYWNoKGZ1bmN0aW9uKGIpeyBiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOyB9KTsKICB2YXIgc2VjID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhYi0nK2lkKTsKICBpZihzZWMpIHNlYy5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICBpZihidG4pIGJ0bi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKfQp3aW5kb3cuc2hvd1RhYiA9IHNob3dUYWI7CgpmdW5jdGlvbiBnb1RhYihidG4pIHsKICB2YXIgdGFiID0gYnRuLmdldEF0dHJpYnV0ZSgnZGF0YS10YWInKTsKICB2YXIgZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudG5hdltvbmNsaWNrKj0iJyArIHRhYiArICciXScpOwogIHNob3dUYWIodGFiLCBlbCk7Cn0Kd2luZG93LmdvVGFiID0gZ29UYWI7CgoKLyog4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQCiAgIFVUSUxTCuKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkCAqLwpmdW5jdGlvbiBjaGFuZ2VZZWFyKCkgewogIHZhciB2ID0gcHJvbXB0KCdBbm5cdTAwZTllIFx1MDBlMCBhZmZpY2hlciA6JywgX3llYXIpOwogIHZhciBuID0gcGFyc2VJbnQodil8fDA7CiAgaWYgKG4+PTIwMjAgJiYgbjw9MjAzMCkgewogICAgX3llYXIgPSBuOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3llYXItbGJsJykudGV4dENvbnRlbnQgPSBfeWVhcjsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY2N1ZWlsLWFubmVlLWxibCcpLnRleHRDb250ZW50ID0gJ1x1MjAxNCAnK195ZWFyOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nvbmdlcy1hbm5lZS1sYmwnKS50ZXh0Q29udGVudCA9ICdcdTIwMTQgJytfeWVhcjsKICAgIGNhbGNTb2xkZXMoKTsgcmVuZGVyU29sZGVzRmxvdHRhbnRzKCk7IHJlbmRlckFjY3VlaWwoKTsgcmVuZGVyU29sZGVzRGV0YWlsKCk7IHJlbmRlckRlbWFuZGVzKCk7CiAgfQp9CndpbmRvdy5jaGFuZ2VZZWFyID0gY2hhbmdlWWVhcjsKCmZ1bmN0aW9uIHByZXZNKCkgewogIF9jYWxNb250aC5zZXRNb250aChfY2FsTW9udGguZ2V0TW9udGgoKS0xKTsKICBsb2FkUGxhbm5pbmdNb250aChfY2FsTW9udGguZ2V0RnVsbFllYXIoKSwgX2NhbE1vbnRoLmdldE1vbnRoKCkpLnRoZW4ocmVuZGVyQ2FsKTsKfQpmdW5jdGlvbiBuZXh0TSgpIHsKICBfY2FsTW9udGguc2V0TW9udGgoX2NhbE1vbnRoLmdldE1vbnRoKCkrMSk7CiAgbG9hZFBsYW5uaW5nTW9udGgoX2NhbE1vbnRoLmdldEZ1bGxZZWFyKCksIF9jYWxNb250aC5nZXRNb250aCgpKS50aGVuKHJlbmRlckNhbCk7Cn0Kd2luZG93LnByZXZNID0gcHJldk07IHdpbmRvdy5uZXh0TSA9IG5leHRNOwoKZnVuY3Rpb24gZm10RGF0ZShzKSB7CiAgaWYoIXMpIHJldHVybiAnXHUyMDE0JzsKICB0cnkgeyByZXR1cm4gbmV3IERhdGUocysnVDEyOjAwOjAwJykudG9Mb2NhbGVEYXRlU3RyaW5nKCdmci1GUicse2RheTonMi1kaWdpdCcsbW9udGg6JzItZGlnaXQnLHllYXI6J251bWVyaWMnfSk7IH0gY2F0Y2goZSl7IHJldHVybiBzOyB9Cn0KCmZ1bmN0aW9uIGNhbGNBbmNpZW5uZXRlKGRhdGVTdHIpIHsKICBpZighZGF0ZVN0cikgcmV0dXJuICcnOwogIHZhciBkID0gbmV3IERhdGUoZGF0ZVN0cisnVDEyOjAwOjAwJyk7CiAgdmFyIG5vdyA9IG5ldyBEYXRlKCk7CiAgdmFyIG1vaXMgPSAobm93LmdldEZ1bGxZZWFyKCktZC5nZXRGdWxsWWVhcigpKSoxMiArIChub3cuZ2V0TW9udGgoKS1kLmdldE1vbnRoKCkpOwogIGlmKG1vaXM8MSkgcmV0dXJuICdOb3V2ZWF1JzsKICBpZihtb2lzPDEyKSByZXR1cm4gbW9pcysnIG1vaXMnOwogIHZhciBhbnMgPSBNYXRoLmZsb29yKG1vaXMvMTIpOwogIHZhciBybSA9IG1vaXMlMTI7CiAgcmV0dXJuIGFucysnYW4nKyhhbnM+MT8ncyc6JycpKyhybT4wPycgJytybSsnbSc6JycpOwp9CgpmdW5jdGlvbiBtYXNrSWJhbihpYmFuKSB7CiAgaWYoIWliYW4gfHwgaWJhbi5sZW5ndGg8OCkgcmV0dXJuIGliYW47CiAgcmV0dXJuIGliYW4uc2xpY2UoMCw0KSArICcgKioqKiAqKioqICcgKyBpYmFuLnNsaWNlKC00KTsKfQoKZnVuY3Rpb24gY2FwaXRhbGl6ZShzKSB7IHJldHVybiBzID8gcy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKStzLnNsaWNlKDEpIDogczsgfQoKZnVuY3Rpb24gZ2V0UGxhZ2VzU3RyKGl0KSB7CiAgaWYgKCFpdCkgcmV0dXJuICcnOwogIGlmIChpdC5wbGFnZXMgJiYgaXQucGxhZ2VzLmxlbmd0aCA+IDApIHJldHVybiBpdC5wbGFnZXMubWFwKGZ1bmN0aW9uKHApeyByZXR1cm4gcC5kZWIrJ1x1MjAxMycrcC5maW47IH0pLmpvaW4oJyB8ICcpOwogIHJldHVybiAoaXQuZGVifHwnJykgKyAoaXQuZmluID8gJ1x1MjAxMycraXQuZmluIDogJycpOwp9CgpmdW5jdGlvbiBpdGVtSChpdCkgewogIGlmIChpdC5wbGFnZXMgJiYgaXQucGxhZ2VzLmxlbmd0aCA+IDApIHsKICAgIHJldHVybiBpdC5wbGFnZXMucmVkdWNlKGZ1bmN0aW9uKHMscCkgewogICAgICBpZiAoIXAuZGVifHwhcC5maW4pIHJldHVybiBzOwogICAgICB2YXIgYT1wLmRlYi5zcGxpdCgnOicpLm1hcChOdW1iZXIpLCBiPXAuZmluLnNwbGl0KCc6JykubWFwKE51bWJlcik7CiAgICAgIHJldHVybiBzICsgTWF0aC5tYXgoMCwgKChiWzBdKjYwK2JbMV0pLShhWzBdKjYwK2FbMV0pKS82MCk7CiAgICB9LCAwKTsKICB9CiAgaWYgKCFpdC5kZWJ8fCFpdC5maW4pIHJldHVybiAwOwogIHZhciBhPWl0LmRlYi5zcGxpdCgnOicpLm1hcChOdW1iZXIpLCBiPWl0LmZpbi5zcGxpdCgnOicpLm1hcChOdW1iZXIpOwogIHJldHVybiBNYXRoLm1heCgwLCAoKGJbMF0qNjArYlsxXSktKGFbMF0qNjArYVsxXSkpLzYwKTsKfQoKZnVuY3Rpb24gc2hvd05vdEZvdW5kKCkgewogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkaW5nLXdyYXAnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub3QtZm91bmQnKS5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7Cn0KCmZ1bmN0aW9uIHNob3dUb2FzdChtc2csIHR5cGUpIHsKICB2YXIgdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2FzdCcpOwogIHQudGV4dENvbnRlbnQgPSBtc2c7IHQuY2xhc3NOYW1lID0gJ3RvYXN0IHNob3cgJysodHlwZXx8JycpOwogIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IHQuY2xhc3NOYW1lPSd0b2FzdCc7IH0sIDMyMDApOwp9";
var bn=atob(b);
var by=new Uint8Array(bn.length);
for(var i=0;i<bn.length;i++)by[i]=bn.charCodeAt(i);
var js=new TextDecoder('utf-8').decode(by);
var s=document.createElement('script');
s.textContent=js;
document.head.appendChild(s);
})();
</script>
</body>
</html>
